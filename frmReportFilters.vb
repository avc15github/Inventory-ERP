Imports System.Data.SqlClient
Imports Microsoft.Office.Interop
Imports System.Text.RegularExpressions
Imports System.Globalization
Imports OfficeOpenXml  'RAJASHRI-18-01-2022
Imports System.ComponentModel
Imports System.IO
Imports System.Windows.Forms
Imports System.Windows
Imports System.Web.Script.Serialization
'rajashri
Imports System
Imports System.Deployment.Application
Imports System.Collections.Specialized
Imports System.Text
Imports System.Net.Http
Imports System.Web
Imports System.Net


Public Class frmReportFilters
    Dim rptType As ReportType
    Dim DispDetailSummary As DetailSummary
    Dim TransType As TransactionType
    Dim Formulas As Hashtable
    Dim ReportCaption As String = ""
    Dim Series As String = ""
    Dim DisplayOption As Boolean
    Dim CurrOptionType As OptionType
    Dim MouseIsDown As Boolean
    Dim GrpOptAdded As Boolean
    Dim Loading As Boolean = True
    Dim IsSupplier As Boolean
    Dim StkType As String = ""

    Enum FilterFor
        DateWise
        Party
        Stock
        SummaryDetail
        Group
        SubGroup
        Product
        Style
        Type
        Shade
        Size
        Brand
        Quality
        Season
        Occassion
        Location
        Counter
        Tax
        Consignee
        Broker
        MopAnalysis

    End Enum

    'Dim subrpt() As SubReportDetails

    'Structure SubReportDetails
    '    Dim Report As String
    '    Dim Filter As String
    '    Dim FormulaName As String
    '    Dim FormulaValue As String
    'End Structure

    Enum OptionType
        None
        DefaultWise
        DateWise
        Bill
        OperatorWise
        Counter
        Country
        District
        State
        City
        Station
        Customer
        Supplier
        Section
        Group
        SubGroup
        Product
        Style
        Type
        Shade
        Size
        Brand
        Quality
        Season
        Occassion
        Location
        Tax
        SalePerson
        Consignee
        Broker
        Process
        StyleCosting
        Transport
    End Enum

    Enum TransactionType
        PurchaseOrder
        Purchase
        PurchaseRtn
        Sales
        SalesRtn
        Stock
        StockTransfer
        Others
        SalesOrder
        Delivery
        SaleBill
        SaleReturn
        PendAgstPack
        PendDrNtAgstPurRtd
        PendCrNtAgstSaleRtd
        ServiceJobOrder
        ServiceChallan
        ServiceBill
        MonthlySaleProd
        PurchaseBill ''ankita 24042019
        'production

        '' CHANGE BY RAHUL ON 29/07/2019
        JobWorkPO
        JobWorkOrder
        JobOrder
        '' END

        JobCard
        ProcessIssue
        ProcessReceipt
        ProcessProdnDelay
        ProcessStkWithParty
        SemiProcStkAtWarehouse
        ProcessLedger
        ProcessShortage
        FabricIssue
        FabricReceive  '''Satyam 29072022
        FabricIssueBack
        StoresIssue
        StoresIssueBack
        ClosingStock
        FabricStkWithParty
        StoresStkWithParty
        StyleCosting
        ProcessDate
        ProcessDoc
        ProcessSum
        StyleCol
        StyleColSum
        ReverseMechanism1  '' saurabh 08092018
        MRN
        MIN
        MRT
        OrderInHand
        PreShipmentAnalysis ' jyoti 18022022
    End Enum

    Enum LedgerType
        Customers
        Suppliers
        Broker
        Consignee
    End Enum

    Enum DetailSummary
        Yes
        No
    End Enum

    Enum ReportType
        StockTransfer_DateWise
        StockTransfer_DocWise
        StockTransfer_SalepersonWise
        StockTransfer_TfrOut
        StockTransfer_TfrIn
        StockTransfer_TfrOutSalesperson
        StockTransfer_TfrInSalesperson

        PurTaxRegister_DocWise
        PurTaxRegister_DateWise
        PurTaxRegister_Summary
        PurTaxRegister_ProductWise
        PurTaxRegister_SupplierWise

        SaleTaxRegister

        FabPurOrderRegister_DateWise
        FabPurOrderRegister_BillWise
        FabPurOrderRegister_SupplierWise
        FabPurOrderRegister_LocationWise
        FabPurOrderRegister_SubGroupWise
        FabPurOrderRegister_ProductWise
        FabPurOrderRegister_BrandWise

        PurOrderRegister_DateWise
        PurOrderRegister_BillWise
        PurOrderRegister_SupplierWise
        PurOrderRegister_LocationWise
        PurOrderRegister_SubGroupWise
        PurOrderRegister_ProductWise
        PurOrderRegister_BrandWise

        PendPurOrderRegister_DateWise
        PendPurOrderRegister_BillWise
        PendPurOrderRegister_SupplierWise
        PendPurOrderRegister_LocationWise

        PendPurOrderRegister_SubGroupWise
        PendPurOrderRegister_ProductWise
        PendPurOrderRegister_BrandWise
        PurOrderRegisterAsPerPurchase_DateWise ''ankita 09052019

        PurOrderCancelled_SupplierWise
        PurOrderShortClose_SupplierWise


        FabPurOrderRegister_AllInOne

        Karigar_Salary

        PurchaseRegister_OperatorWise
        PurchaseRegister_CounterWise
        PurchaseRegister_DateWise
        PurchaseRegister_BillWise
        PurchaseRegister_SupplierWise
        PurchaseRegister_LocationWise

        PurchaseRegister_SubGroupWise
        PurchaseRegister_ProductWise
        PurchaseRegister_BrandWise
        BarcodeWisePurchase
        PurRegister_DateWise ''ankita 20042019
        PurbillRegister_DateWise  ''ankita 20042019

        PurRtnRegister_OperatorWise
        PurRtnRegister_CounterWise
        PurRtnRegister_DateWise
        PurRtnRegister_BillWise
        PurRtnRegister_SupplierWise
        PurRtnRegister_LocationWise

        PurRtnRegister_SubGroupWise
        PurRtnRegister_ProductWise
        PurRtnRegister_BrandWise


        SalesRegister_OperatorWise
        SalesRegister_CounterWise
        SalesRegister_DateWise
        SalesRegister_BillWise
        SalesRegister_CustomerWise
        SalesRegister_LocationWise
        SalesRegister_SupplierWise
        SalesRegister_SalepersonWise

        DailySalesReport_DateWise
        SalesRegisterWithRtn_DateWise
        SalesRegisterWithRtn_ProductWise
        SalesRegisterWithRtn_BrandWise

        SalesRegister_SubGroupWise
        SalesRegister_ProductWise
        SalesRegister_BrandWise
        SalesRegister_CustProductWise

        SalesRtnRegister_OperatorWise
        SalesRtnRegister_CounterWise
        SalesRtnRegister_DateWise
        SalesRtnRegister_BillWise
        SalesRtnRegister_PartyWise
        SalesRtnRegister_LocationWise
        SalesRtnRegister_SalepersonWise

        SalesRtnRegister_SubGroupWise
        SalesRtnRegister_ProductWise
        SalesRtnRegister_BrandWise
        SalesRtnRegister_ProdSalepersonWise
        SalesRtnRegister_BrokerPartyWise

        PurchaseRtn_SummaryDateWise
        PurchaseRtn_SummaryPartyWise
        PurchaseRtn_DateWise
        PurchaseRtn_PartyWise
        PurchaseRtn_ProductWise
        PurchaseRtn_PartyProductWise
        PurchaseRtn_BrandWise

        PurchaseOrder_SummaryDateWise
        PurchaseOrder_SummaryPartyWise
        PurchaseOrder_DateWise
        PurchaseOrder_PartyWise
        PurchaseOrder_ProductWise
        PurchaseOrder_PartyProductWise
        PurchaseOrder_BrandWise

        SalesTaxRegister_DocWise
        SalesTaxRegister_DateWise
        SalesTaxRegister_Summary
        SalesVATRegister
        SalesTaxRegister_ProductWise
        SalesTaxRegister_SubGroupWise

        SalesRtnTaxRegister_DocWise
        SalesRtnTaxRegister_DateWise
        SalesRtnTaxRegister_Summary
        SalesRtnVATRegister
        SalesRtnTaxRegister_ProductWise
        SalesRtnTaxRegister_SubGroupWise

        TaxComputation


        CounterWiseProductSold
        TopSoldItems
        BottomSoldItems
        TopNCustomers
        TopCustomersNotVisitedThisMonth
        TopNBills
        ProductsSoldPerHour
        BusyDays
        BusyHours
        Profitability
        MarginSummary_DateWise
        MarginSummary_SubGroupWise
        CancelledBills_DateWise

        SalesSummary_DateWise
        'SalesRegister_DateWise
        'SalesRegister_PartyWise
        'SalesRegister_ProductWise
        'SalesRegister_OperatorWise
        'SalesRegister_CounterWise
        'SalesRegister_BillWise
        ProductWiseSales
        SalesWithRtnTaxDetails_BillWise
        SalesWithRtnTaxDetails_ProductWise
        SalesWithRtnTaxDetails_BrandWise

        StockReport
        NoStockReport
        BirthdayList
        AnniversaryList

        OpeningStockSubGroup
        OpeningStockProduct
        OpeningStockBrand
        OpeningStockLocation

        ClosingStockDocument
        ClosingStockSubGroup
        ClosingStockProduct
        ClosingStockBrand
        ClosingStockSupplier
        ClosingStockLocation

        BarcodeStockSubGroup
        BarcodeStockProduct
        BarcodeStockBrand
        BarcodeStockSupplier
        BarcodeStockLocation

        StockAtAGlanceSubGroup
        StockAtAGlanceProduct
        StockAtAGlanceBrand
        StockAtAGlanceSupplier
        StockAtAGlanceCustomer
        StockAtAGlanceLocation

        StockAgingSubGroup
        StockAgingProduct
        StockAgingBrand
        StockAgingSupplier
        StockAgingLocation
        StockSupplierWise

        StockAgingBarcode
        StockLedger
        StockStatement
        StockUnsold
        StockNotYetSold
        StockAsOnPrevDate
        stockledgerlocation
        Physical_Stock
        Physical_StockShort
        Physical_StockExcess

        DesignWiseStockWithImages

        FastMovingSupplier
        FastMovingSubGroup
        FastMovingProduct

        SlowMovingSupplier
        SlowMovingSubGroup
        SlowMovingProduct

        DeadStock

        CurrentStock
        CurrentStockBrandWise
        BarcodeStock
        'BarcodeStockBrand
        CurrentStockWithValue
        'StockAtAGlanceProductWise
        'StockAtAGlanceBrandWise
        'StockAtAGlanceSupplierWise

        SalePersonCommission
        MOPAnalysis
        AllInOneSales
        AllInOnePurchase
        AllInOnePurchaseRtn
        AllInOnePurchaseOrder
        DiscountGiven_Bill
        DiscountGiven_Customer
        DiscountGiven_Product
        HourlySales
        PeriodicalSales
        MonthlySales
        MonthlySalesDate

        MonthlySalesRtn
        MonthlySalesRtnDate

        MonthlySalesSaleperson
        SupplierDocWiseStock
        SaleByTypeAnalysis

        PeriodicalPurchase
        MonthlyPurchase
        MonthlyPurchaseDate

        PeriodicalPurchaseRtn
        MonthlyPurchaseRtn
        MonthlyPurchaseDateRtn

        TopNSuppliers
        TopNPurchase
        ConsolidatedPurchase_DtProduct
        ExcessLessQty_AgainstOrder
        MarginSummary_Purchase

        CustomerReport
        CustomerStmt

        'ServiceJobOrder
        ServiceJobOrderRegister_DateWise
        ServiceJobOrderRegister_BillWise
        ServiceJobOrderRegister_PartyWise
        ServiceJobOrderRegister_PartyProdWise
        ServiceJobOrderRegister_ProductWise
        PendServiceJobOrderRegister_DateWise
        PendServiceJobOrderRegister_BillWise
        PendServiceJobOrderRegister_PartyWise
        PendServiceJobOrderRegister_PartyProdWise
        PendServiceJobOrderRegister_ProductWise

        'ServiceChallan
        ServiceChallanRegister_DateWise
        ServiceChallanRegister_BillWise
        ServiceChallanRegister_PartyWise
        ServiceChallanRegister_PartyProdWise
        ServiceChallanRegister_ProductWise

        ''SERVICE INVOICE
        ServiceBillRegister_DateWise
        ServiceBillRegister_BillWise
        ServiceBillRegister_PartyWise
        ServiceBillRegister_PartyProdWise
        ServiceBillRegister_ProductWise

        ''Sales Order
        SalesOrderRegister_DateWise
        SalesOrderRegister_BillWise
        SalesOrderRegister_PartyWise
        StockReadyToDispatch
        SalesOrderRegister_PartyProdWise

        SalesOrderRegister_ConsigneeWise
        SalesOrderRegister_ConsigneeProdWise

        SalesOrderRegister_ProductWise
        SalesOrderRegister_BrandWise
        SalesOrderRegister_BrokerWise

        PendSalesOrderRegister_DateWise
        PendSalesOrderRegister_BillWise
        PendSalesOrderRegister_PartyWise
        PendSalesOrderRegister_PartyProdWise

        PendSalesOrderRegister_ConsigneeWise
        PendSalesOrderRegister_ConsigneeProdWise

        PendSalesOrderRegister_ProductWise
        PendSalesOrderRegister_BrandWise
        PendSalesOrderRegister_BrokerWise

        PendSalesOrderCrossTab_StyleWise
        PendSalesOrderCrossTab_Stock
        PendSalesOrderCrossTab_StylePartyWise
        PendSalesOrderCrossTab_PartyStyleWise
        PendSalesOrderCrossTab_PartySizeWise
        PendSalesOrderCrossTab_PartyConsigneeWise
        PendSalesOrderCrossTab_StylePartyConsigneeWise
        PendSalesOrderCrossTab_PartyConsigneeWiseStyle

        SalesOrderRegister_AllInOne
        SalesOrderRegister_AllInOneANS

        SalesOrderCrossTab_StyleWise
        SalesOrderCrossTab_StylePartyWise
        SalesOrderCrossTab_PartyStyleWise
        SalesOrderCrossTab_PartySizeWise
        SalesOrderCrossTab_StylePartyConsigneeWise
        SalesOrderCrossTab_PartyConsigneeStyleWise
        SalesOrderpackingCrossTab_StylePartyConsigneeWise
        RetailerWiseSaleOrder
        RetailerWiseSaleOrder_design
        ''Delivery Challan
        PackingRegister_DateWise
        PackingRegister_BillWise
        PackingRegister_PartyWise
        PackingRegister_PartyProdWise

        PackingRegister_ConsigneeWise
        PackingRegister_ConsigneeProdWise

        PackingRegister_ProductWise
        PackingRegister_BrandWise
        PackingRegister_Brokerwise         ''Added by Pooja on 17-08-17


        ''Sales Bill
        SalesBillRegister_DateWise
        SalesBillRegister_BillWise
        SalesBillRegister_PartyWise
        SalesBillRegister_PartyProdWise

        SalesBillRegister_ConsigneeWise
        SalesBillRegister_ConsigneeProdWise

        SalesBillRegister_ProductWise

        DesignWiseNetSalesRegister ''Satyam 05082022

        SalesBillRegister_BrandWise
        SalesBillRegister_BrokerWise
        SalesBillRegister_BrokerBrandWise
        SalesBillRegister_SalePersonWise
        MonthlySales_ProductWise

        '' CHANGE BY RAHUL ON 29/07/2019
        JobWorkPOStatus_Billwise
        GoodsRecvAgst_JobWorkPO
        JobWorkOrderStatus_Billwise
        GoodsRecvAgst_JobWorkOrder
        JobOrderReg_Datewise
        JobWorkOrderStatus

        JobWorkOrder_Status
        JobWorkPO_Status
        '' END

        'Production Reports
        JobCardReg_DateWise
        JobCardReg_JobberWise
        JobCardReg_ProcessWise
        JobCardReg_SubGroupWise
        JobCardReg_ProductWise
        JobCardReg_BrandWise
        JobCardStatus_DateWise

        ProcessIsuReg_DateWise
        ProcessIsuReg_JobberWise
        ProcessIsuReg_ProcessWise
        ProcessIsuReg_SubGroupWise
        ProcessIsuReg_ProductWise
        ProcessIsuReg_BrandWise

        ProcessRcptReg_DateWise
        ProcessRcptReg_JobberWise
        ProcessRcptReg_ProcessWise
        ProcessRcptReg_SubGroupWise
        ProcessRcptReg_ProductWise
        ProcessRcptReg_BrandWise

        ProcessDelayReg_DateWise
        ProcessDelayReg_JobberWise
        ProcessDelayReg_ProcessWise
        ProcessDelayReg_SubGroupWise
        ProcessDelayReg_ProductWise
        ProcessDelayReg_BrandWise

        ProcessStkWithPartyReg_DateWise
        ProcessStkWithPartyReg_JobberWise
        ProcessStkWithPartyReg_ProcessWise
        ProcessStkWithPartyReg_SubGroupWise
        ProcessStkWithPartyReg_ProductWise
        ProcessStkWithPartyReg_BrandWise

        SemiProcStkAtWHReg_DateWise
        SemiProcStkAtWHReg_JobberWise
        SemiProcStkAtWHReg_ProcessWise
        SemiProcStkAtWHReg_SubGroupWise
        SemiProcStkAtWHReg_ProductWise
        SemiProcStkAtWHReg_BrandWise

        ProcessLedReg_DateWise
        ProcessLedReg_JobberWise
        ProcessLedReg_ProcessWise
        ProcessLedReg_SubGroupWise
        ProcessLedReg_ProductWise
        ProcessLedReg_BrandWise

        ProcessShortReg_DateWise
        ProcessShortReg_JobberWise
        ProcessShortReg_ProcessWise
        ProcessShortReg_SubGroupWise
        ProcessShortReg_ProductWise
        ProcessShortReg_BrandWise

        FabricIsuReg_DateWise
        FabricIsuReg_JobberWise
        FabricIsuReg_ProcessWise
        FabricIsuReg_SubGroupWise
        FabricIsuReg_ProductWise
        FabricIsuReg_BrandWise

        '==Satyam 29072022
        FabricRctReg_JobberWise
        '======
        FabricIsuBkReg_DateWise
        FabricIsuBkReg_JobberWise
        FabricIsuBkReg_ProcessWise
        FabricIsuBkReg_SubGroupWise
        FabricIsuBkReg_ProductWise
        FabricIsuBkReg_BrandWise

        StoresIsuReg_DateWise
        StoresIsuReg_JobberWise
        StoresIsuReg_ProcessWise
        StoresIsuReg_SubGroupWise
        StoresIsuReg_ProductWise
        StoresIsuReg_BrandWise

        StoresIsuBkReg_DateWise
        StoresIsuBkReg_JobberWise
        StoresIsuBkReg_ProcessWise
        StoresIsuBkReg_SubGroupWise
        StoresIsuBkReg_ProductWise
        StoresIsuBkReg_BrandWise

        OpeningStk_SubGroup
        OpeningStk_Product
        OpeningStk_Brand
        OpeningStk_Location

        ClosingStk_SubGroup
        ClosingStk_Product
        ClosingStk_Brand
        ClosingStk_Location
        ClosingStk_Supplier

        ''ADDED BY RAHUL ON 18/07/2019
        StockLedgerAcc
        ''END

        ''ADDED BY RAHUL ON 11/02/2019
        StockLedgerFab
        ''END

        ''Pending Bill Agst Packing
        PendAgstPack_BillWise
        PendAgstPack_PartyWise
        PendDrNtAgstPurRtd_BillWise
        PendDrNtAgstPurRtd_PartyWise
        PendCrNtAgstSaleRtd_BillWise
        PendCrNtAgstSaleRtd_PartyWise

        FabricStk_JobberWise
        FabricStk_ProductWise

        StoresStk_JobberWise
        StoresStk_ProductWise
        AccStockLedgerAtJobber

        StyleCosting
        GSTSummaries
        GSTR1
        GSTR2
        SalesBillRegister_SalePersonPartyWise
        SalesOrderStatus
        SalesOrderStatusANS
        OCPendingStatus
        BuyerProgressChart
        CountryBuyerwiseOrderAnalysis
        ProductCategorywiseBuyerwiseOrderAnal
        TopStyle
        ProcessDateWise
        ProcessDocWise
        ProcessSumWise
        StyleColWise
        StyleColSumWise
        PendingOrderReport
        ReverseMechanism1   ''saurabh08092018

        ''ADDED BY RAHUL ON 14/11/2019
        PPStatus
        ''END

        PPFABStatus
        PPAccStatus

        ''ankita 23112018
        PackingCrossTab_StyleWise
        PackingCrossTab_StylePartyWise
        PackingCrossTab_PartyStyleWise
        PackingCrossTab_PartySizeWise
        '' end ankita 23112018
        JobOrderStatus
        SalesOrderReport ''ankita 15122018
        SalesInvoiceReport ''ankita 15122018
        FabricLedgerAtJobber
        StockLedgerAtJobber
        JobWorkPPWise
        GRNPendingAgainstPO
        ItemStockRpt
        SoBalanceRpt
        SoFabricIssueAgtJobWorkRpt 'added by prashant on date 03/12/2019
        GSTR3B 'added by satish 13042019
        retailsaleregister
        taxregister
        MRN
        MIN
        MRT
        OrderInHandMonthWise
        OrderInHandPartyWise
        SalesorderSummarySizeWise 'Rajashri-28-01-2022
        ExportInvoiceSummarySizeWise 'Rajashri-29-01-2022
        PreShipmentAnalysis 'Jyoti 18-02-2022
        Ready_Stock_Multi 'suraj 28122023
    End Enum


    Private Sub btnClose_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnClose.Click
        Me.Close()
    End Sub

    Private Sub FillPartyAttribCombos()
        Try
            Me.Cursor = Cursors.WaitCursor

            If rptType = ReportType.SalesOrderRegister_AllInOne Or rptType = ReportType.FabPurOrderRegister_AllInOne Or rptType = ReportType.SalesOrderStatusANS Or rptType = ReportType.SalesOrderRegister_AllInOneANS Or rptType = ReportType.OCPendingStatus Or rptType = ReportType.BuyerProgressChart Or rptType = ReportType.CountryBuyerwiseOrderAnalysis Or rptType = ReportType.ProductCategorywiseBuyerwiseOrderAnal Or rptType = ReportType.TopStyle Then
                Query = "Select REGN_ID, REGN_NAME " _
                  & " From Region " _
                  & " Where Status = '1' And Regn_Name <> '' " _
                  & " Order By Regn_Name"
                Common.FillCheckBoxCombo(Query, cmbRegion, "REGN_NAME", "REGN_ID")

                Query = "Select CONT_KEY, CONT_NAME " _
                   & " From Country " _
                   & " Where Status = '1' And Cont_Name <> '' " _
                   & BranchFixFilter _
                   & " Order By Cont_Name"
                Common.FillCheckBoxCombo(Query, cmbCountry, "CONT_NAME", "CONT_KEY")

                Query = "Select STN_KEY, STN_NAME " _
                & " From Station " _
                & " Where Status = '1' And Stn_Name <> '' " _
                & BranchFixFilter _
                & " Order By STN_NAME"
                Common.FillCheckBoxCombo(Query, cmbStation, "STN_NAME", "STN_KEY")

            End If

            If rptType = ReportType.SalesOrderReport Or rptType = ReportType.SalesInvoiceReport Then ''ankita 181220018
                Query = "Select CONT_KEY, CONT_NAME " _
                    & " From Country " _
                    & " Where Status = '1' And Cont_Name <> '' " _
                    & BranchFilter _
                    & " Order By Cont_Name"
                Common.FillCheckBoxCombo(Query, cmbCountry, "CONT_NAME", "CONT_KEY")
            End If


            If rptType = ReportType.SalesInvoiceReport Then
                Query = " Select LED_KEY, LED_NAME " _
                & " From Ledger Where Led_Cat = 'L' And Status = '1' " _
                & " And AccLGrp_Key In(Select AccLgrp_Key From AccLGrp Where AccGrp_Id = 13)" _
                & BranchLedFixFilter _
                & " Order By Led_Name"
                Common.FillCheckBoxCombo(Query, cmbSalesType, "LED_NAME", "LED_KEY")

            End If

            Query = "Select STATE_KEY, STATE_NAME " _
                & " From State " _
                & " Where Status = '1' And State_Name <> '' " _
                & BranchFixFilter _
                & " Order By State_Name"
            Common.FillCheckBoxCombo(Query, cmbState, "STATE_NAME", "STATE_KEY")

            'Query = "Select DIST_KEY, DIST_NAME " _
            '    & " From District " _
            '    & " Where Status = '1' And Dist_Name <> '' " _
            '    & BranchFilter _
            '    & " Order By Dist_Name"
            'Common.FillCheckBoxCombo(Query, cmbDistrict, "DIST_NAME", "DIST_KEY")

            'Query = "Select CITY_KEY, CITY_NAME " _
            '    & " From City " _
            '    & " Where Status = '1' And City_Name <> '' " _
            '    & BranchFilter _
            '    & " Order By City_Name"
            'Common.FillCheckBoxCombo(Query, cmbCity, "CITY_NAME", "CITY_KEY")

            'Query = "Select STN_KEY, STN_NAME " _
            '    & " From Station " _
            '    & " Where Status = '1' And Stn_Name <> '' " _
            '    & BranchFilter _
            '    & " Order By Stn_Name"
            'Common.FillCheckBoxCombo(Query, cmbStation, "STN_NAME", "STN_KEY")


            'Dim LedgerFltr As String = ""
            'If rptType = ReportType.SalesRegister_SupplierWise Then
            '    LedgerFltr = " And Led_Cat In ('V', 'J', 'O', 'A')"
            'ElseIf TransType = TransactionType.Sales Or TransType = TransactionType.SalesRtn Then
            '    LedgerFltr = " And Led_Cat In ('R', 'W', 'D')"
            'ElseIf TransType = TransactionType.Stock Or TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseRtn Then
            '    LedgerFltr = " And Led_Cat In ('V', 'J', 'O', 'A')"
            'End If

            'Query = "Select LED_KEY, LED_NAME " _
            '    & " From Ledger " _
            '    & " Where Status = '1' And Led_Name <> '' " _
            '    & LedgerFltr & BranchFilter _
            '    & " Order By Led_Name"
            'Common.FillCheckBoxCombo(Query, cmbParty, "LED_NAME", "LED_KEY")


        Catch sqlEx As SqlException
            Common.LogAndDisplayException(sqlEx)
        Catch ex As Exception
            Common.LogAndDisplayException(ex)
        Finally
            Me.Cursor = Cursors.Default
        End Try
    End Sub

    Private Sub FillProductAttribCombos()
        Try
            Me.Cursor = Cursors.WaitCursor

            Dim FltrType As String = ""
            If IsFabric Then
                FltrType = " And ItemGrp_Type = 'G'"
            ElseIf IsFinished Then
                FltrType = " And ItemGrp_Type = 'F'"
            ElseIf IsStores Then
                If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" And rptType = ReportType.ClosingStk_Product Then
                    FltrType = " And ItemGrp_Type In ('P', 'A', 'L')"
                Else
                    FltrType = " And ItemGrp_Type In ('P', 'A')"
                End If
            End If

                Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from jobOrder  Where DOC_ID >0  " _
                & BranchFixFilter _
                 & " Order By DOCNO"
                Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")

                ''ankita 03122018
                Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from SalesOrder  Where DOC_ID >0  " _
                & BranchFixFilter _
                 & " Order By DOCNO"
                Common.FillCombo2(Query, cmbSONo, "DOCNO", "DOCID")

                'Query = "select SalesOrder.Doc_id DOCID,SalesOrder.Doc_no DOCNO from SalesOrder Left Join MRN On SalesOrder.DOc_Id = MRN.SODOC_ID  Where MRN.DOC_ID >0 AND " _
                '& " MRN.COBR_ID = '" & SelBranchId & "'" _
                '& " Order By DOCNO"
                'Common.FillCombo2(Query, cmbOCNO, "DOCNO", "DOCID")

                'Query = "select SampleCreation.SampleCreation_ID SampleCreation_ID, SampleCreation.SampleCreationNumber SampleCreationNO From SampleCreation Left Join MRN On SampleCreation.SampleCreation_Id = MRN.SampleCreation_Id Where MRN.SampleCreation_ID > 0 AND" _
                '        & " MRN.COBR_ID = '" & SelBranchId & "'" _
                '        & " Order By SampleCreationNO"
                'Common.FillCombo2(Query, cmbCreationNo, "SampleCreationNO", "SampleCreation_ID")

                'Query = "select '' Dept_Key , '' Dept_name Union All select Dept.Dept_Key , Dept.Dept_name  From Dept Left Join MRN On Dept.Dept_Key = MRN.FromDept_Key Where MRN.FromDept_Key > 0 AND" _
                '       & " MRN.COBR_ID = '" & SelBranchId & "'" _
                '       & " Order By Dept_name"
                'Common.FillCombo2(Query, cmbFromDept, "Dept_name", "Dept_Key")


                If rptType = rptType.JobWorkOrderStatus Then
                    Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from jobOrder  Where DOC_ID >0  " _
                    & BranchFixFilter _
                     & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbJOrderNo, "DOCNO", "DOCID")
                    'End
                End If
            If rptType = rptType.JobWorkPOStatus_Billwise Or rptType = ReportType.GoodsRecvAgst_JobWorkPO Or rptType = ReportType.JobWorkPO_Status Then
                Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobWorkPO  Where DOC_ID >0  " _
                & BranchFixFilter _
                 & " Order By DOCNO"
                Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                'End
            End If
            If rptType = rptType.JobWorkOrderStatus_Billwise Or rptType = ReportType.GoodsRecvAgst_JobWorkOrder Or rptType = ReportType.JobWorkOrder_Status Then
                Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobOrder  Where DOC_ID >0  " _
                & BranchFixFilter _
                 & " Order By DOCNO"
                Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                'End
            End If
            If rptType = ReportType.FabricIsuReg_JobberWise Or rptType = ReportType.StoresIsuReg_JobberWise Or rptType = ReportType.JobCardReg_JobberWise Or rptType = ReportType.FabricRctReg_JobberWise Then ''SATYAM 29072022
                If chkData.Checked = True Then
                    Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobWOrkPO  Where DOC_ID >0  " _
                   & BranchFixFilter _
                    & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                Else
                    Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobOrder  Where DOC_ID >0  " _
                    & BranchFixFilter _
                     & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                    'End
                End If
            End If
                If rptType = rptType.PendPurOrderRegister_SupplierWise Or rptType = ReportType.PurOrderRegister_SupplierWise Or rptType = ReportType.PurchaseRegister_SupplierWise Or rptType = ReportType.PurRtnRegister_SupplierWise Then
                    If IsFabric = True Then
                        Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from Purorder  Where DOC_ID >0 And PO_Type = 'G' " _
                        & BranchFixFilter _
                         & " Order By DOCNO"
                        Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                    ElseIf IsFinished = True Then
                        Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from Purorder  Where DOC_ID >0 And PO_Type = 'F' " _
                       & BranchFixFilter _
                        & " Order By DOCNO"
                        Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                    ElseIf IsStores = True Then
                        Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from Purorder  Where DOC_ID >0 And PO_Type = 'S' " _
                      & BranchFixFilter _
                       & " Order By DOCNO"
                        Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                    End If
                End If
                If rptType = rptType.ClosingStk_Product Or rptType = ReportType.OpeningStk_Product Or rptType = ReportType.ClosingStockProduct Or rptType = ReportType.OpeningStockProduct Then
                    Query = "select Doc_id DOCID,Doc_no DOCNO from SalesOrder  Where DOC_ID >0  " _
                    & BranchFixFilter _
                     & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbSONo, "DOCNO", "DOCID")
                    'End
                End If

                If rptType = ReportType.PurRegister_DateWise Then
                    With cmbPurType.Items
                        .Add("All")
                        .Add("Fabric Purchase")
                        .Add("Accessories ")
                        .Add("Finish Purchase")
                        .Add("Other")
                    End With

                    ''CHANGE BY RAHUL ON 23/04/2019
                    cmbPurType.SelectedIndex = 0
                ElseIf rptType = ReportType.PurbillRegister_DateWise Then
                    With cmbPurType.Items
                        .Add("All")
                        .Add("Fabric Purchase")
                        .Add("Accessories & Packing Purchase")
                        .Add("Labour Bill")
                        .Add("Other")
                        .Add("Finish Purchase")               'Readymade Garments Purchase
                        .Add("Other Item")
                        .Add("Other Misc Purchase")
                    End With

                    cmbPurType.SelectedIndex = 0
                    ''END
                End If
                ''ankita 20042019 

                ''end ankita 20042019
                Query = "Select ITEMGRP_KEY, ITEMGRP_NAME " _
                    & " From ItemGrp " _
                    & " Where Status = '1' And ItemGrp_Name <> '' " _
                    & BranchFixFilter & FltrType _
                    & " Order By ItemGrp_Name"
                Common.FillCheckBoxCombo(Query, cmbProductGrp, "ITEMGRP_NAME", "ITEMGRP_KEY")

                'Query = "Select ITEMSUBGRP_KEY, ITEMSUBGRP_NAME " _
                '    & " From ItemSubGrp " _
                '    & " Where Status = '1' And ItemSubGrp_Name <> '' " _
                '    & BranchFilter _
                '    & " Order By ItemSubGrp_Name"
                'Common.FillCheckBoxCombo(Query, cmbProductSubGrp, "ITEMSUBGRP_NAME", "ITEMSUBGRP_KEY")

                'Query = "Select ITEM_KEY, ITEM_NAME " _
                '    & " From Item " _
                '    & " Where Status = '1' And Item_Name <> '' " _
                '    & BranchFilter _
                '    & " Order By Item_Name"
                'Common.FillCheckBoxCombo(Query, cmbProduct, "ITEM_NAME", "ITEM_KEY")

                'Query = "Select DISTINCT STYLE_CODE, STYLE_CODE " _
                '    & " From Style " _
                '    & " Where Style.Status = '1' And Style.CoBr_Id = '" & SelBranchId & "' And Style_Code <> '' " _
                '    & " Order By Style_Code"
                'Common.FillCheckBoxCombo(Query, cmbStyle, "STYLE_CODE", "STYLE_CODE")

                'Query = "Select TYPE_KEY, TYPE_NAME " _
                '    & " From Type " _
                '    & " Where Status = '1' And Type_Name <> '' " _
                '    & BranchFilter _
                '    & " Order By Type_Name"
                'Common.FillCheckBoxCombo(Query, cmbType, "TYPE_NAME", "TYPE_KEY")

                Query = "Select SHADE_KEY, SHADE_NAME " _
                    & " From Shade " _
                    & " Where Status = '1' And Shade_Name <> '' " _
                    & BranchFixFilter _
                    & " Order By Shade_Name"
                Common.FillCheckBoxCombo(Query, cmbShade, "SHADE_NAME", "SHADE_KEY")

                If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                    'If rptType = ReportType.ClosingStk_SubGroup'
                    'Rajashri-09-12-2021'
                    If rptType = ReportType.ClosingStk_SubGroup Or rptType = ReportType.ClosingStk_Product Or rptType = ReportType.OpeningStk_Product Or rptType = ReportType.ClosingStk_Brand Or rptType = ReportType.ClosingStockLocation Then
                        Query = "Select SHADE_KEY, SHADE_NAME " _
                           & " From Shade " _
                           & " Where Status = '1' And Shade_Name <> '' And use_For = 'I' " _
                           & BranchFixFilter _
                           & " Order By Shade_Name"
                        Common.FillCheckBoxCombo(Query, cmbShade, "SHADE_NAME", "SHADE_KEY")

                    ElseIf rptType = ReportType.OpeningStockSubGroup Or rptType = ReportType.ClosingStockProduct Or rptType = ReportType.OpeningStockProduct Or rptType = ReportType.OpeningStockLocation Or rptType = ReportType.OpeningStockBrand Or rptType = ReportType.SalesOrderRegister_PartyProdWise Then

                        Query = "Select SHADE_KEY, SHADE_NAME " _
                           & " From Shade " _
                           & " Where Status = '1' And Shade_Name <> '' And use_For = 'S' " _
                           & BranchFixFilter _
                           & " Order By Shade_Name"
                        Common.FillCheckBoxCombo(Query, cmbShade, "SHADE_NAME", "SHADE_KEY")

                    End If
                End If
                'itemssize
                'Query = "Select DISTINCT SIZE_NAME, SIZE_NAME " _
                '    & " From ItemSize " _
                '    & " Where Status = '1' And ItemSize.CoBr_Id = '" & SelBranchId & "' And Size_Name <> '' " _
                '    & " Order By Size_Name"
                'Common.FillCheckBoxCombo(Query, cmbSize, "SIZE_NAME", "SIZE_NAME")

                Query = "Select BRAND_KEY, BRAND_NAME " _
                    & " From Brand " _
                    & " Where Status = '1' And Brand_Name <> '' " _
                    & BranchFixFilter _
                    & " Order By Brand_Name"
                Common.FillCheckBoxCombo(Query, cmbBrand, "BRAND_NAME", "BRAND_KEY")

                Query = "Select QLTY_KEY, QLTY_NAME " _
                    & " From Quality " _
                    & " Where Status = '1' And Qlty_Name <> '' " _
                    & BranchFixFilter _
                    & " Order By Qlty_Name"
                Common.FillCheckBoxCombo(Query, cmbQuality, "QLTY_NAME", "QLTY_KEY")

                Query = "Select SEASON_KEY, SEASON_NAME " _
                    & " From Season " _
                    & " Where Status = '1' And Season_Name <> '' " _
                    & BranchFixFilter _
                    & " Order By Season_Name"
                Common.FillCheckBoxCombo(Query, cmbSeason, "SEASON_NAME", "SEASON_KEY")

                Query = "Select OCCN_KEY, OCCN_NAME " _
                    & " From Occassion " _
                    & " Where Status = '1' And Occn_Name <> '' " _
                    & BranchFixFilter _
                    & " Order By Occn_Name"
                Common.FillCheckBoxCombo(Query, cmbOccassion, "OCCN_NAME", "OCCN_KEY")

                Query = "Select LOC_KEY, LOC_NAME " _
                    & " From Location " _
                    & " Where Status = '1' And Loc_Name <> '' " _
                    & BranchLedFixFilter _
                    & " Order By Loc_Name"
                Common.FillCheckBoxCombo(Query, cmbLocation, "LOC_NAME", "LOC_KEY")


                Query = "Select 'M' multiRate_value, 'MRP' multiRate_name " _
                        & " union " _
                        & " Select 'W' multiRate_value, 'WSP' multiRate_name " _
                        & " union " _
                        & " Select 'P' multiRate_value, 'CP' multiRate_name " _
                        & " union " _
                        & " Select 'MV' multiRate_value, 'MRP Value' multiRate_name " _
                        & " union " _
                        & " Select 'WV' multiRate_value, 'WSP Value' multiRate_name " _
                        & " union " _
                        & " Select 'PV' multiRate_value, 'CP Value' multiRate_name "
                Common.FillCheckBoxCombo(Query, cmbrate, "multiRate_name", "multiRate_value")


                '''''Added by Pooja on 27-10-2017---------------------------

                If rptType = ReportType.PendSalesOrderCrossTab_PartyConsigneeWise Or rptType = ReportType.PendSalesOrderCrossTab_StylePartyConsigneeWise Or rptType = ReportType.SalesOrderCrossTab_StylePartyConsigneeWise Or rptType = ReportType.PendSalesOrderCrossTab_PartyConsigneeWiseStyle Or rptType = ReportType.SalesOrderCrossTab_PartyConsigneeStyleWise Then
                    Query = "Select LED_KEY, LED_NAME " _
                         & " From Ledger " _
                         & " Where Led_Cat In('C','D') And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                         & " Order By Led_Name"
                    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")

                End If

            '''Satyam 23042024
            ''' 
            If rptType = ReportType.StockReadyToDispatch Then
                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForTJS)) = 1 Then
                    Query = "Select LED_KEY, LED_NAME " _
                       & " From Ledger " _
                       & " Where Led_Cat In('C','D') And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                       & " Order By Led_Name"
                    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")
                    pnlProduct.Enabled = True
                    cmbOperator.Enabled = True
                    lblOperator.Text = "Consignee"



                End If
            End If

            If rptType = ReportType.JobWorkPPWise Then
                Query = "Select Doc_Id, Doc_No " _
                     & " From PRODNPLN " _
                     & " Where Status =  '1' And Doc_No <> '' " & BranchLedFixFilter _
                     & " Order By Doc_No"
                Common.FillCheckBoxCombo(Query, cmbrate, "Doc_No", "Doc_Id")

            ElseIf rptType = ReportType.PPStatus Then
                Query = "Select Doc_Id, Doc_No " _
                     & " From PRODNPLN " _
                     & " Where Status =  '1' AND Doc_Dt between '" & Format$(AccFromDt, "MM/dd/yyyy") & "' And  '" & Format$(AccToDt, "MM/dd/yyyy") & "' And Doc_No <> '' " & BranchLedFixFilter _
                     & " Order By Doc_No"
                Common.FillCheckBoxCombo(Query, cmbrate, "Doc_No", "Doc_Id")


            ElseIf rptType = ReportType.SoFabricIssueAgtJobWorkRpt Then
                Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from jobOrder  Where DOC_ID >0  AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' " _
               & BranchFixFilter _
                & " Order By DOCNO"
                Common.FillCheckBoxCombo(Query, cmbrate, "DOCNO", "DOCID")



            ElseIf rptType = ReportType.SalesOrderStatus Then
                Query = "Select Doc_Id,Doc_no+ '-->' +FCYR_id Doc_No " _
                    & " From Salesorder " _
                    & " Where Status =  '1' AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Doc_No <> '' " & BranchLedFixFilter _
                    & " Order By Doc_No"
                Common.FillCheckBoxCombo(Query, cmbrate, "Doc_No", "Doc_Id")
            End If
            If rptType = ReportType.GRNPendingAgainstPO Then
                Query = "Select 'AP' TRANS_value, 'Trims' TRANS_name " _
                     & " union " _
                     & " Select 'GP' TRANS_value, 'Fabric' TRANS_name " _
                     & " union " _
                     & " Select 'FP' TRANS_value, 'Finish' TRANS_name "
                Common.FillCombo2(Query, cmbSONo, "TRANS_name", "TRANS_value")
                If cmbSONo.Items.Count > 0 Then cmbSONo.SelectedIndex = 2

            End If

            ''CHANGE BY RAHUL ON 14/11/2019
            If rptType = ReportType.PPStatus Then
                Query = "Select 'A' TRANS_value, 'Trims' TRANS_name " _
                     & " union " _
                     & " Select 'G' TRANS_value, 'Fabric' TRANS_name "
                Common.FillCombo2(Query, cmbSONo, "TRANS_name", "TRANS_value")
                If cmbSONo.Items.Count > 0 Then cmbSONo.SelectedIndex = 2
            End If
            ''END

            If rptType = ReportType.SoFabricIssueAgtJobWorkRpt Then
                Query = "Select 'G' TRANS_value, 'Fabic' TRANS_name " _
                     & " union all " _
                     & " Select 'A' TRANS_value, 'Accessories' TRANS_name " _
                    & " union all " _
                     & " Select 'F' TRANS_value, 'Finish' TRANS_name "
                Common.FillCombo2(Query, cmbSONo, "TRANS_name", "TRANS_value")
                If cmbSONo.Items.Count > 0 Then cmbSONo.SelectedIndex = 0
            End If

        Catch sqlEx As SqlException
            Common.LogAndDisplayException(sqlEx)
        Catch ex As Exception
            Common.LogAndDisplayException(ex)
        Finally
            Me.Cursor = Cursors.Default
        End Try


    End Sub

    Private Sub frmReportFilters_Activated(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Activated
        If rptType = ReportType.NoStockReport Then
            pnlStock.Visible = False
            chkSize.Visible = False
            btnView_Click(btnView, Nothing)

        ElseIf rptType = ReportType.BirthdayList Or rptType = ReportType.AnniversaryList Then
            pnlDate.Enabled = False
            chkSize.Visible = False

            btnView_Click(btnView, Nothing)
        ElseIf rptType = ReportType.PurbillRegister_DateWise Then
            chkSize.Visible = True
            'btnView_Click(btnView, Nothing)
        End If
    End Sub

    Private Sub frmReportFilters_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Click

    End Sub

    Private Sub frmReportFilters_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles Me.KeyDown
        If e.KeyCode = Keys.Escape Then Me.Close()
    End Sub

    Private Sub frmReportFilters_KeyUp(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles Me.KeyUp
        
    End Sub

    Private Sub frmReportFilters_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        'SetFormCaption()
        ApprovePrint = True
        lblDesign.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseDesign)))
        lblShade.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseShade)))
        lblSize.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize)))
        lblType.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseType)))
        lblQuality.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseQuality)))
        lblSeason.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSeason)))
        lblOccassion.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseOccassion)))

        lblLocation.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiLocation)))
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        cmbStyle.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseDesign)))
        cmbShade.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseShade)))

        If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
            If rptType = ReportType.PPStatus Or rptType = ReportType.SoFabricIssueAgtJobWorkRpt Then

                chkSize.Visible = False
            Else
                chkSize.Visible = True
                chkSize.Text = "Pending For Approval"
            End If
           
        End If
        cmbType.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseType)))
        cmbQuality.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseQuality)))
        cmbSeason.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSeason)))
        cmbOccassion.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseOccassion)))

        cmbLocation.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiLocation)))

        'If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
        '    chkSize.Visible = True
        '    chkSize.Enabled = True
        'Else
        '    chkSize.Visible = False
        '    chkSize.Enabled = False
        'End If
        'Suraj 27 12 2023
        If rptType = ReportType.Ready_Stock_Multi Then
            pnlDate.Enabled = True
            lblProduct.Visible = True : cmbProduct.Visible = True

            lblShade.Visible = True : cmbShade.Visible = True
            pnlSummaryDetail.Visible = False : lblText.Visible = False : txtText.Visible = False
            pnlParty.Visible = False : lblOperator.Visible = False : cmbOperator.Visible = False
            lblTax.Visible = False : cmbTax.Visible = False
            If IsFinished Or IsFabric Then
                lblDesign.Visible = True : cmbStyle.Visible = True
                lblDesign.Enabled = True : cmbStyle.Enabled = True
            Else
                lblDesign.Visible = True : cmbStyle.Visible = True
                lblDesign.Enabled = False : cmbStyle.Enabled = False
            End If
            lblQuality.Visible = False : cmbQuality.Visible = False
            lblSeason.Visible = False : cmbSeason.Visible = False : lblOccassion.Visible = False : cmbOccassion.Visible = False
            lblLocation.Visible = False : cmbLocation.Visible = False
            Me.Text = "Stock Ledger Drill Down"
            DisplayProductSubGroup()
            DisplayProduct() : DisplayStyle() : DisplayType()
        End If

        If Val(GetSettingAsPerId(ApplnSettingsIdx.HetherGrey)) = 1 Then
            chkSize.Visible = True
            chkSize.Enabled = True
        End If

        btnUp.Enabled = True
        btnDown.Enabled = True

        FillPartyAttribCombos()
        FillProductAttribCombos()

        dtpFrom.Value = AccFromDt
        dtpTo.Value = AccToDt

        dtpFrom1.Value = AccFromDt '"01/04/2016"
        dtpTo1.Value = AccToDt '"31/03/2017"



       
        'ForCrystal = (rptType <> ReportType.StockReport)

        'If DispDetailSummary Then
        '    rdDetailed.Visible = True
        '    rdSummary.Visible = True
        'End If
        pnlSeries.Visible = IsUser
        txtStkFrom.Visible = False

        If Not IsUser Then
            rdA.Checked = True
        End If


        If Val(GetSettingAsPerId(ApplnSettingsIdx.NewSoftWare)) = 1 Then
            btnGstR1New.Visible = True
        End If

        If rptType = ReportType.ClosingStockProduct Then
            If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
                pnlSummaryDetail.Enabled = False
                pnlOtherOptions.Visible = True
                rdOthOption1.Text = "OC Wise"
                rdOthOption2.Text = "Free Stock"
                rdOthOption3.Text = "All Stock"

                'pnlSummaryDetail.Enabled = False
                'pnlOtherOptions.Visible = True
                'lblSaleOrder.Visible = True : lblQty.Visible = False
                'cmbSONo.Visible = True : cmbLocation.Enabled = True : cmbDisplay.Visible = False : txtStkFrom.Visible = False
                'chkDispRate.Checked = False : chkDispValue.Checked = False
                'chkDispRate.Visible = False : chkDispValue.Visible = False
                'pnlOtherOptions.Location = New Point(291, 430)
                'rdOthOption1.Text = "OC Wise"
                'rdOthOption2.Text = "Free Stock"
                'rdOthOption3.Text = "All Stock"

            End If
            Plnitemdetils.Visible = True
            Plnitemdetils.Enabled = True
        Else
            Plnitemdetils.Visible = False
        End If
        If rptType = ReportType.JobOrderStatus Then
            cmbOrderNo.Visible = True
            lblJobOrder.Visible = True
        Else
            cmbOrderNo.Visible = False
            lblJobOrder.Visible = False
            'Added By Vishnu On 11-11-2019
            If rptType = rptType.JobWorkOrderStatus Then
                Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from jobOrder  Where DOC_ID >0  AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' " _
                & BranchFixFilter _
                 & " Order By DOCNO"
                Common.FillCombo2(Query, cmbJOrderNo, "DOCNO", "DOCID")
                'End
            End If
            If rptType = rptType.JobWorkPOStatus_Billwise Or rptType = ReportType.GoodsRecvAgst_JobWorkPO Or rptType = ReportType.JobWorkPO_Status Then
                'If cmbParty.SelectedText = "" Then
                Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobWorkPO  Where DOC_ID >0  " _
                & BranchFixFilter _
                 & " Order By DOCNO"
                Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                'End If
            End If


            If rptType = rptType.JobWorkOrderStatus_Billwise Or rptType = ReportType.GoodsRecvAgst_JobWorkOrder Or rptType = ReportType.JobWorkOrder_Status Then
                'If cmbParty.SelectedText = "" Then
                Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobOrder  Where DOC_ID >0  " _
                & BranchFixFilter _
                 & " Order By DOCNO"
                Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                'End If
            End If
            If rptType = ReportType.FabricIsuReg_JobberWise Or rptType = ReportType.StoresIsuReg_JobberWise Or rptType = ReportType.JobCardReg_JobberWise Or rptType = ReportType.FabricRctReg_JobberWise Then ''SATYAM 29072022
                If chkData.Checked = True Then
                    Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobWOrkPO  Where DOC_ID >0  " _
                   & BranchFixFilter _
                    & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                Else
                    Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobOrder  Where DOC_ID >0  " _
                    & BranchFixFilter _
                     & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                    'End
                End If
            End If
            If rptType = rptType.PendPurOrderRegister_SupplierWise Or rptType = ReportType.PurOrderRegister_SupplierWise Or rptType = ReportType.PurchaseRegister_SupplierWise Or rptType = ReportType.PurRtnRegister_SupplierWise Then
                If IsFabric = True Then
                    Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from PurOrder  Where DOC_ID >0 And PO_Type='G' " _
                    & BranchFixFilter _
                     & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                ElseIf IsFinished = True Then
                    Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from Purorder  Where DOC_ID >0 And PO_Type = 'F' " _
                   & BranchFixFilter _
                    & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                ElseIf IsStores = True Then
                    Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from Purorder  Where DOC_ID >0 And PO_Type = 'S' " _
                  & BranchFixFilter _
                   & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                End If
            End If
        End If



        If rptType = ReportType.SalesOrderStatus Then  ''ankita 01122018
            cmbSONo.Visible = True
            lblSaleOrder.Visible = True
        Else
            cmbSONo.Visible = False
            lblSaleOrder.Visible = False
        End If
        ''ankita 20042019
        If rptType = ReportType.PurRegister_DateWise Or rptType = ReportType.PurbillRegister_DateWise Then  ''ankita 01122018
            cmbPurType.Visible = True
            lblPurchaseType.Visible = True
            ' rdDetailed.Enabled = False
            pnlStock.Visible = True
            chkDispRate.Visible = True
            chkDispValue.Visible = True
            If rptType = ReportType.PurRegister_DateWise Then
                chkDispRate.Text = "Against Purchase Bill"
                chkDispValue.Text = "Pending For Bill"
                rdDetailed.Enabled = False
            Else
                chkDispRate.Text = "Against Inward"
                chkDispValue.Text = "Without Inward"
                rdDetailed.Enabled = True
            End If

        Else
            cmbPurType.Visible = False
            lblPurchaseType.Visible = False
        End If
        ''end ankita 20042019
        If rptType = ReportType.JobWorkPPWise Then
            pnlRateType.Visible = True
            cmbrate.Visible = True
            cmbrate.Location = New System.Drawing.Point(100, 415)
            cmbrate.Size = New System.Drawing.Size(150, 30)
            pnlProduct.Visible = False
        End If

        If rptType = ReportType.GRNPendingAgainstPO Then  ''ankita 01122018
            cmbSONo.Visible = True
            lblSaleOrder.Visible = True
            lblSaleOrder.Text = "Trans Type"
            pnlProduct.Visible = False
            cmbSONo.DropDownStyle = Infragistics.Win.DropDownStyle.DropDownList

        Else
            cmbSONo.Visible = False
            lblSaleOrder.Visible = False
        End If
        If rptType = ReportType.SalesOrderReport Then ''ankita 18122018
            cmbSONo.Visible = True
            lblSaleOrder.Visible = True
            cmbCountry.Visible = True
            lblCountry.Visible = True



            If rptType = ReportType.SalesInvoiceReport Then
                cmbSalesType.Visible = True
                lblSalesType.Visible = True
                cmbSONo.Visible = True
                lblSaleOrder.Visible = True
                cmbCountry.Visible = True
                lblCountry.Visible = True
            Else

                cmbSalesType.Visible = False
                lblSalesType.Visible = False
            End If
        End If

        ''CHANGE BY RAHUL ON 14/11/2019


        If rptType = ReportType.PPStatus Then

            If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                'cmbSONo.Visible = True
                'lblSaleOrder.Visible = True
                'lblSaleOrder.Text = "Trans Type"
                pnlProduct.Visible = True
                pnlProduct.Enabled = True
                pnlParty.Enabled = True
                LBLPP.Visible = True
                LBLPP.Location = New System.Drawing.Point(135, 435)

            Else
                cmbSONo.Visible = True
                lblSaleOrder.Visible = True
                lblSaleOrder.Text = "Trans Type"
                pnlProduct.Visible = False
            End If

            'pnlOtherOptions.Visible = True
            'rdOthOption1.Text = "Pending"
            'rdOthOption2.Text = "Completed"
           
            cmbSONo.DropDownStyle = Infragistics.Win.DropDownStyle.DropDownList
            pnlRateType.Visible = True
            cmbrate.Visible = True
            cmbrate.Location = New System.Drawing.Point(190, 435)
            cmbrate.Size = New System.Drawing.Size(150, 30)
        End If
        ''END

        If DispDetailSummary = DetailSummary.No Then
            pnlSummaryDetail.Enabled = False
            ' Plnitemdetils.Enabled = False
        Else
            pnlSummaryDetail.Enabled = True
            rdSummary.Checked = True


        End If
        btnOption.Visible = DisplayOption


        If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
            If rptType = ReportType.SoFabricIssueAgtJobWorkRpt Then
                pnlProduct.Visible = True
                pnlProduct.Enabled = True
                pnlParty.Enabled = True
                LBLPP.Visible = True
                LBLPP.Location = New System.Drawing.Point(100, 435)
                LBLPP.Text = "JobWork Order"
                LBLPP.Size = New System.Drawing.Size(90, 18)


                cmbSONo.Visible = True
                lblSaleOrder.Visible = True
                lblSaleOrder.Text = "Product Type"
                cmbSONo.DropDownStyle = Infragistics.Win.DropDownStyle.DropDownList

                pnlOtherOptions.Visible = True
                rdOthOption1.Text = "Pending"
                rdOthOption2.Text = "Completed"
                pnlOtherOptions.Location = New System.Drawing.Point(291, 360) ''291,381
                rdOthOption3.Checked = True

                pnlSummaryDetail.Enabled = False
                Me.Text = "Process Ledger For Jobber"

                pnlRateType.Visible = True
                cmbrate.Visible = True
                cmbrate.Location = New System.Drawing.Point(190, 435)
                cmbrate.Size = New System.Drawing.Size(150, 30)

            End If



            If rptType = ReportType.SalesOrderStatus Then
                pnlProduct.Visible = True
                pnlProduct.Enabled = True
                pnlParty.Enabled = True
                LBLPP.Visible = True
                LBLPP.Location = New System.Drawing.Point(100, 435)
                LBLPP.Text = "Sales Order"
                LBLPP.Size = New System.Drawing.Size(90, 18)

                pnlOtherOptions.Visible = True
                rdOthOption1.Text = "Pending"
                rdOthOption2.Text = "Completed"
                rdOthOption3.Checked = True
             

                pnlSummaryDetail.Enabled = False


                pnlRateType.Visible = True
                cmbrate.Visible = True
                cmbrate.Location = New System.Drawing.Point(190, 435)
                cmbrate.Size = New System.Drawing.Size(150, 30)

            End If

            If rptType = ReportType.JobWorkOrderStatus Then
                'pnlOtherOptions.Visible = True
                'rdOthOption1.Text = "Pending"
                'rdOthOption2.Text = "Completed"
                'pnlOtherOptions.Location = New System.Drawing.Point(291, 340) ''291,381
                'rdOthOption3.Checked = True
                chkSize.Visible = False
            End If
        End If




        SetLabelCaption()

        'Suraj 27 12 2023
        If rptType <> ReportType.Ready_Stock_Multi Then
            Me.Text = ReportCaption
        End If


        cmbLocation.Enabled = False

        If CurrOptionType = OptionType.Location Then
            EnableFilters(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation), True)
        End If

        chkData.Checked = False
        chkChart.Checked = False

        If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
            If rptType = ReportType.SalesOrderRegister_PartyProdWise Then
                cmbSONo.Visible = True
                lblSaleOrder.Visible = True
                rdDetailed.Checked = True
                pnlSummaryDetail.Enabled = False
            End If
        End If

        If IsRegister Then
            ForRegister()
            Loading = False
            If DisplayOption Then
                btnOption.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenAllowOption)))
            End If

            OptionForFilter()


            ''Satyam 23042024
            If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForTJS)) = 1 Then
                If rptType = ReportType.StockReadyToDispatch Then
                    cmbOperator.Enabled = True
                End If

            End If

            If rptType = ReportType.FabricIsuReg_DateWise Or rptType = ReportType.FabricIsuReg_JobberWise Or rptType = ReportType.FabricIsuReg_ProcessWise Or rptType = ReportType.FabricIsuReg_SubGroupWise Or rptType = ReportType.FabricIsuReg_ProductWise Or rptType = ReportType.FabricIsuReg_BrandWise Or rptType = ReportType.FabricStk_JobberWise Or rptType = ReportType.FabricRctReg_JobberWise Then ''SATYAM 29072022
                rdDetailed.Checked = True
            End If
            If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForSagunReadymadeUdhyoug)) = 1 Then
                If rptType = ReportType.FabricStk_JobberWise Or rptType = ReportType.FabricIsuReg_JobberWise Or rptType = ReportType.FabricRctReg_JobberWise Then '''SATYAM 29072022
                    pnlProduct.Enabled = True
                    cmbBrand.Enabled = False
                    cmbType.Enabled = False
                    cmbSize.Enabled = False
                End If
            End If
            If rptType = ReportType.StoresIsuReg_DateWise Or rptType = ReportType.StoresIsuReg_JobberWise Or rptType = ReportType.StoresIsuReg_ProductWise Or rptType = ReportType.StoresIsuReg_SubGroupWise Or rptType = ReportType.FabricStk_JobberWise Or rptType = ReportType.StoresStk_JobberWise Then
                rdDetailed.Checked = True
            End If

            If rptType = ReportType.JobCardReg_DateWise Or rptType = ReportType.JobCardReg_JobberWise Or rptType = ReportType.JobCardReg_ProcessWise Or rptType = ReportType.JobCardReg_SubGroupWise Or rptType = ReportType.JobCardReg_ProductWise Or rptType = ReportType.JobCardReg_BrandWise Then
                rdDetailed.Checked = True
            End If

            If TransType = TransactionType.ProcessIssue Or TransType = TransactionType.ProcessReceipt Or TransType = TransactionType.ProcessStkWithParty Or TransType = TransactionType.StoresIssueBack Or TransType = TransactionType.SemiProcStkAtWarehouse Or TransType = TransactionType.ProcessProdnDelay Or TransType = TransactionType.ProcessShortage Or TransType = TransactionType.ProcessLedger Then
                rdDetailed.Checked = True
            End If

            If rptType = ReportType.FabricIsuBkReg_DateWise Or rptType = ReportType.FabricIsuBkReg_JobberWise Or rptType = ReportType.FabricIsuBkReg_ProcessWise Or rptType = ReportType.FabricIsuBkReg_SubGroupWise Or rptType = ReportType.FabricIsuBkReg_ProductWise Or rptType = ReportType.FabricIsuBkReg_BrandWise Or rptType = ReportType.StoresStk_JobberWise Then
                rdDetailed.Checked = True
            End If

            If pnlParty.Enabled Then
                DisplayParty()
                lblDistrict.Visible = False : cmbDistrict.Visible = False : lblCity.Visible = False : cmbCity.Visible = False
            End If

            If rptType = ReportType.Karigar_Salary Or rptType = ReportType.RetailerWiseSaleOrder Then
                pnlParty.Enabled = True
                DisplayParty()
            End If

            If rptType = ReportType.Karigar_Salary Then
                rdSummary.Checked = True
            End If

            If WithRtnOption Then
                chkSize.Visible = True
                chkSize.Text = "Include Return"
                'chkSize.Checked = True
            End If

            ''CHANGE BY RAHUL ON 03/05/2019
            If GetSettingAsPerId(ApplnSettingsIdx.HetherGrey) = "1" Then
                If rptType = ReportType.StockLedgerAtJobber Or rptType = ReportType.AccStockLedgerAtJobber Or rptType = ReportType.FabricStk_JobberWise Then
                    pnlProduct.Enabled = True
                    lblType.Enabled = False : cmbType.Enabled = False
                    lblSize.Enabled = False : cmbSize.Enabled = False
                    lblQuality.Enabled = False : cmbQuality.Enabled = False
                    lblSeason.Enabled = False : cmbSeason.Enabled = False
                    lblOccassion.Enabled = False : cmbOccassion.Enabled = False
                    lblLocation.Enabled = False : cmbLocation.Enabled = False
                    lblBrand.Enabled = False : cmbBrand.Enabled = False

                    If rptType = ReportType.AccStockLedgerAtJobber Then
                        lblDesign.Enabled = False : cmbStyle.Enabled = False
                    End If

                    If rptType = ReportType.StockLedgerAtJobber Then
                        chkSize.Visible = True : chkSize.Text = "Product Wise Summary"
                    End If

                End If
            End If
            ''END

            '' CHANGE BY RAHUL ON 29/07/2019
            If rptType = ReportType.JobOrderReg_Datewise Or rptType = ReportType.JobWorkOrderStatus Then
                pnlProduct.Enabled = True : pnlParty.Enabled = True

                lblDistrict.Enabled = False : cmbDistrict.Enabled = False
                lblCity.Enabled = False : cmbCity.Enabled = False

                lblSize.Enabled = False : cmbSize.Enabled = False
                lblQuality.Enabled = False : cmbQuality.Enabled = False
                lblSeason.Enabled = False : cmbSeason.Enabled = False
                lblOccassion.Enabled = False : cmbOccassion.Enabled = False
                lblLocation.Enabled = False : cmbLocation.Enabled = False
                lblBrand.Enabled = False : cmbBrand.Enabled = False
                DisplayParty()

                If rptType = ReportType.JobWorkOrderStatus Then
                    lblPurchaseType.Visible = True : cmbPurType.Visible = True : cmbPurType.DropDownStyle = Infragistics.Win.DropDownStyle.DropDownList
                    cmbPurType.Items.Clear()
                    cmbPurType.Items.Add("All")
                    cmbPurType.Items.Add("Finish")
                    cmbPurType.Items.Add("Fabric")
                    cmbPurType.Items.Add("Accessories")
                    cmbPurType.SelectedIndex = 0
                    cmbJOrderNo.Visible = True
                    Label5.Visible = True

                End If
            End If

            If rptType = ReportType.JobWorkPOStatus_Billwise Or rptType = ReportType.GoodsRecvAgst_JobWorkPO Or rptType = ReportType.JobWorkPO_Status Or rptType = ReportType.JobWorkOrder_Status Then
                pnlProduct.Enabled = False : pnlParty.Enabled = True
                rdDetailed.Checked = True
                lblDistrict.Enabled = False : cmbDistrict.Enabled = False
                lblCity.Enabled = False : cmbCity.Enabled = False
                pnlOtherOptions.Enabled = False
                lblSize.Enabled = False : cmbSize.Enabled = False
                lblQuality.Enabled = False : cmbQuality.Enabled = False
                lblSeason.Enabled = False : cmbSeason.Enabled = False
                lblOccassion.Enabled = False : cmbOccassion.Enabled = False
                lblLocation.Enabled = False : cmbLocation.Enabled = False
                lblBrand.Enabled = False : cmbBrand.Enabled = False
                lblJobOrder.Visible = True : lblJobOrder.Text = "JobWork PO No" : lblSaleOrder.Visible = True
                cmbSONo.Location = New Point(188, 430)
                lblSaleOrder.Location = New Point(95, 430)
                lblJobOrder.Location = New Point(375, 62)
                cmbSONo.Visible = True : cmbOrderNo.Visible = True
                cmbSONo.Enabled = True : cmbOrderNo.Enabled = True
                If rptType = ReportType.GoodsRecvAgst_JobWorkPO Then
                    pnlDate.Visible = False
                End If
                DisplayParty()

            End If

            If rptType = ReportType.JobWorkPO_Status Or rptType = ReportType.JobWorkOrder_Status Then
                lblPurchaseType.Visible = True : cmbPurType.Visible = True : cmbPurType.DropDownStyle = Infragistics.Win.DropDownStyle.DropDownList
                cmbPurType.Items.Clear()
                lblSalesType.Visible = True
                lblSalesType.Text = "OC Status"
                cmbSalesType.Visible = True
                If rptType = ReportType.JobWorkPO_Status Then
                    lblJobOrder.Text = "JobWork PO No"
                    cmbPurType.Items.Add("Finish")
                    cmbPurType.Items.Add("Fabric")
                    cmbPurType.Items.Add("Accessories")
                    Query = "Select SOStatus_Id, SOStatus_Name " _
                         & " From SOStatus where SOStatus_Id in (1,2,6,5) " _
                         & " Order By SOStatus_Id"
                    Common.FillCheckBoxCombo(Query, cmbSalesType, "SOStatus_Name", "SOStatus_Id") '''



                Else
                    Query = "Select SOStatus_Id, SOStatus_Name " _
                            & " From SOStatus where SOStatus_Id in (1,2,6,5) " _
                            & " Order By SOStatus_Id"
                    Common.FillCheckBoxCombo(Query, cmbSalesType, "SOStatus_Name", "SOStatus_Id") '''



                    lblJobOrder.Text = "JobOrder No"
                    cmbPurType.Items.Add("All")
                    cmbPurType.Items.Add("Finish")
                    cmbPurType.Items.Add("Fabric")
                    cmbPurType.Items.Add("Accessories")
                End If
                cmbPurType.SelectedIndex = 0
            End If


            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.PurOrderRegister_SupplierWise Or rptType = ReportType.PurchaseRegister_SupplierWise Then
                    chkDispRate.Visible = False
                    chkDispValue.Visible = False
                    cmbOrderNo.Visible = True
                    lblJobOrder.Visible = True
                    lblJobOrder.Text = "PO No"
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                    rdDetailed.Checked = True
                    pnlSummaryDetail.Enabled = False
                End If
            End If

            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.PurchaseRegister_BillWise Then
                    chkDispRate.Visible = False
                    chkDispValue.Visible = False
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                    rdSummary.Checked = True
                    pnlSummaryDetail.Enabled = False
                End If
            End If

            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.PurRtnRegister_BillWise Then
                    chkDispRate.Visible = False
                    chkDispValue.Visible = False
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                    rdSummary.Checked = True
                    pnlSummaryDetail.Enabled = False
                End If
            End If

            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.SalesBillRegister_BillWise Then
                    chkDispRate.Visible = False
                    chkDispValue.Visible = False
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                    rdSummary.Checked = True
                    pnlSummaryDetail.Enabled = False
                End If

            End If

            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.FabricIsuReg_JobberWise Or rptType = ReportType.StoresIsuReg_JobberWise Or rptType = ReportType.FabricRctReg_JobberWise Then ''SATYAM 29072022
                    'chkDispRate.Visible = False
                    'chkDispValue.Visible = False
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                    cmbOrderNo.Visible = True
                    lblJobOrder.Visible = True
                    chkData.Visible = True
                    chkData.Checked = False
                    chkData.Location = New Point(284, 62)
                    chkData.Text = "JobWork PO"
                    If chkData.Checked = True Then
                        lblJobOrder.Text = "JobWorkPO No"
                    Else
                        lblJobOrder.Text = lblJobOrder.Text
                    End If
                    'lblJobOrder.Text = "PO No"
                End If
            End If

            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.FabricStk_JobberWise Or rptType = ReportType.StoresStk_JobberWise Or rptType = ReportType.ProcessStkWithPartyReg_JobberWise Then
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                End If
            End If '
            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.FabricStk_ProductWise Then
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                End If
            End If

            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.StockLedgerAtJobber Then
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                End If
            End If


            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.JobCardReg_JobberWise Then
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                    cmbOrderNo.Visible = True
                    lblJobOrder.Visible = True
                    chkData.Visible = True
                    chkData.Checked = False
                    chkData.Location = New Point(284, 62)
                    chkData.Text = "JobWork PO"
                    If chkData.Checked = True Then
                        lblJobOrder.Text = "JobWorkPO No"
                    Else
                        lblJobOrder.Text = lblJobOrder.Text
                    End If
                End If
            End If


            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.SemiProcStkAtWHReg_JobberWise Then
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                End If
            End If

            '
            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.SalesOrderRegister_BillWise Then
                    chkDispValue.Visible = False
                End If
            End If
            '
            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.SalesOrderRegister_PartyWise Then
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                    rdDetailed.Checked = True
                    pnlSummaryDetail.Enabled = False
                    chkDispValue.Visible = False
                End If
            End If
            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                If rptType = ReportType.PurRtnRegister_SupplierWise Then
                    chkDispRate.Visible = False
                    chkDispValue.Visible = False
                    cmbOrderNo.Visible = True
                    lblJobOrder.Visible = True
                    lblJobOrder.Text = "PO No"
                    cmbSONo.Visible = True
                    lblSaleOrder.Visible = True
                    rdDetailed.Checked = True
                    pnlSummaryDetail.Enabled = False
                End If
            End If

            If rptType = ReportType.JobWorkOrderStatus_Billwise Or rptType = ReportType.GoodsRecvAgst_JobWorkOrder Then
                pnlProduct.Enabled = False : pnlParty.Enabled = True
                rdDetailed.Checked = True
                lblDistrict.Enabled = False : cmbDistrict.Enabled = False
                lblCity.Enabled = False : cmbCity.Enabled = False
                pnlOtherOptions.Enabled = False
                lblSize.Enabled = False : cmbSize.Enabled = False
                lblQuality.Enabled = False : cmbQuality.Enabled = False
                lblSeason.Enabled = False : cmbSeason.Enabled = False
                lblOccassion.Enabled = False : cmbOccassion.Enabled = False
                lblLocation.Enabled = False : cmbLocation.Enabled = False
                lblBrand.Enabled = False : cmbBrand.Enabled = False
                lblJobOrder.Visible = True : lblJobOrder.Text = "Job Order No" : lblSaleOrder.Visible = True
                cmbSONo.Location = New Point(188, 430)
                lblSaleOrder.Location = New Point(95, 430)
                lblJobOrder.Location = New Point(375, 62)
                cmbSONo.Visible = True : cmbOrderNo.Visible = True
                cmbSONo.Enabled = True : cmbOrderNo.Enabled = True
                If rptType = ReportType.GoodsRecvAgst_JobWorkOrder Then
                    pnlDate.Visible = False
                End If
                DisplayParty()

            End If
            '' END
            If rptType = ReportType.PendPurOrderRegister_SupplierWise Then
                pnlProduct.Enabled = False : pnlParty.Enabled = True
                rdDetailed.Checked = True
                lblDistrict.Enabled = False : cmbDistrict.Enabled = False
                lblCity.Enabled = False : cmbCity.Enabled = False
                pnlOtherOptions.Enabled = False
                lblSize.Enabled = False : cmbSize.Enabled = False
                lblQuality.Enabled = False : cmbQuality.Enabled = False
                lblSeason.Enabled = False : cmbSeason.Enabled = False
                lblOccassion.Enabled = False : cmbOccassion.Enabled = False
                lblLocation.Enabled = False : cmbLocation.Enabled = False
                lblBrand.Enabled = False : cmbBrand.Enabled = False
                lblJobOrder.Visible = True : lblJobOrder.Text = "PO No" : lblSaleOrder.Visible = True
                cmbSONo.Location = New Point(188, 430)
                lblSaleOrder.Location = New Point(95, 430)
                lblJobOrder.Location = New Point(382, 62)
                cmbSONo.Visible = True : cmbOrderNo.Visible = True
                cmbSONo.Enabled = True : cmbOrderNo.Enabled = True
                pnlSummaryDetail.Enabled = False
                rdDetailed.Checked = True
                chkDispValue.Visible = False
            End If
            If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForSagunReadymadeUdhyoug)) = 1 Then
                If rptType = ReportType.JobCardReg_JobberWise Or rptType = ReportType.ProcessIsuReg_JobberWise Or rptType = ReportType.ProcessRcptReg_JobberWise Then
                    pnlProduct.Enabled = True
                    cmbSize.Enabled = False
                End If
            End If

            If rptType = ReportType.OrderInHandMonthWise Or rptType = ReportType.OrderInHandPartyWise Then
                lblFrom.Text = "Date" : dtpTo.Enabled = False : dtpFrom.Value = Now.Date
            End If

            If rptType = ReportType.OrderInHandMonthWise Or rptType = ReportType.OrderInHandPartyWise Then ''Satyam 09082022
                chkDispRate.Visible = True
                chkDispRate.Text = "All Buyer"
            End If

            If rptType = ReportType.PreShipmentAnalysis Then  'jyoti 18-02-2022
                cmbSONo.Visible = True
                lblSaleOrder.Visible = True
            End If

            ''''SATYAM 29072022
            If rptType = ReportType.FabricRctReg_JobberWise Then
                pnlProduct.Enabled = True
                cmbBrand.Enabled = True
                cmbType.Enabled = True
                cmbSize.Enabled = False

            End If



            Exit Sub
        ElseIf ProdRegister Then
            ForProductRegister()
            Loading = False
            If DisplayOption Then
                btnOption.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenAllowOption)))
            End If

            If rptType = ReportType.PPStatus Or rptType = ReportType.SoFabricIssueAgtJobWorkRpt Or rptType = ReportType.SalesOrderStatus Then

                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                    pnlParty.Enabled = True
                    cmbSize.Enabled = False
                    cmbBrand.Enabled = False
                    chkSize.Visible = False

                    pnlSummaryDetail.Enabled = False
                End If
            End If



            If rptType = ReportType.PendSalesOrderRegister_BrandWise Or rptType = ReportType.PendSalesOrderRegister_ProductWise Or rptType = ReportType.PackingRegister_BrandWise Or rptType = ReportType.PackingRegister_ProductWise Or rptType = ReportType.SalesBillRegister_BrandWise Or rptType = ReportType.SalesBillRegister_ProductWise Or rptType = ReportType.PendServiceJobOrderRegister_ProductWise Or rptType = ReportType.ServiceChallanRegister_ProductWise Or rptType = ReportType.ServiceBillRegister_ProductWise Then
                pnlStock.Visible = True
                chkDispRate.Visible = True
                chkDispRate.Text = "With Details"
            End If

            If rptType = ReportType.MonthlySales_ProductWise Then
                lblSize.Visible = False : cmbSize.Visible = False
                lblBrand.Visible = False : cmbBrand.Visible = False
                lblShade.Visible = False : cmbShade.Visible = False
            End If

            '' CHANGE BY RAHUL ON 09/07/2019
            If rptType = ReportType.JobCardStatus_DateWise Then
                lblSize.Enabled = False : cmbSize.Enabled = False
                lblQuality.Enabled = False : cmbQuality.Enabled = False
                lblSeason.Enabled = False : cmbSeason.Enabled = False
                lblOccassion.Enabled = False : cmbOccassion.Enabled = False
                lblLocation.Enabled = False : cmbLocation.Enabled = False
                lblBrand.Enabled = False : cmbBrand.Enabled = False
                pnlJobCard.Visible = True
            End If
            '' END

            OptionForFilter()

            If pnlParty.Enabled Then
                DisplayParty()
                'If rptType = ReportType.SalesOrderReport Then ''ankita 15122018
                '    lblDistrict.Visible = True : cmbDistrict.Visible = True : lblCity.Visible = True : cmbCity.Visible = True
                '    cmbSONo.Visible = True
                '    lblSaleOrder.Visible = True

                'Else
                '    lblDistrict.Visible = False : cmbDistrict.Visible = False : lblCity.Visible = False : cmbCity.Visible = False
                'End If
                lblDistrict.Visible = False : cmbDistrict.Visible = False : lblCity.Visible = False : cmbCity.Visible = False
            End If

            If WithRtnOption Then
                chkSize.Visible = True
                chkSize.Text = "Include Return"
                'chkSize.Checked = True
            End If

            If rdSummary.Checked Then
                If ProdRegister Then
                    btnUp.Enabled = False
                    btnDown.Enabled = False
                    btnDetail.Enabled = False
                    btnDelDetail.Enabled = False
                    lstDetails.Enabled = False
                    lstDetails.Items.Clear()
                End If
            End If

            If TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseRtn Then
                cmbSize.Enabled = False
            End If

            If TransType = TransactionType.FabricIssue Or TransType = TransactionType.FabricIssueBack Or TransType = TransactionType.StoresIssue Or TransType = TransactionType.StoresIssueBack Or TransType = TransactionType.FabricStkWithParty Then
                cmbSize.Enabled = False
            End If

            If rptType = ReportType.FabricIsuReg_DateWise Or rptType = ReportType.FabricIsuReg_JobberWise Or rptType = ReportType.FabricIsuReg_ProcessWise Or rptType = ReportType.FabricIsuReg_SubGroupWise Or rptType = ReportType.FabricIsuReg_ProductWise Or rptType = ReportType.FabricIsuReg_BrandWise Or rptType = ReportType.FabricStk_ProductWise Or rptType = ReportType.StoresStk_ProductWise Or rptType = ReportType.FabricRctReg_JobberWise Then ''SATYAM 29072022
                rdDetailed.Checked = True
            End If

            If rptType = ReportType.StoresIsuReg_DateWise Or rptType = ReportType.StoresIsuReg_JobberWise Or rptType = ReportType.StoresIsuReg_ProductWise Or rptType = ReportType.StoresIsuReg_SubGroupWise Or rptType = ReportType.FabricStk_JobberWise Or rptType = ReportType.StoresStk_JobberWise Then
                rdDetailed.Checked = True
            End If

            If rptType = ReportType.JobCardReg_DateWise Or rptType = ReportType.JobCardReg_JobberWise Or rptType = ReportType.JobCardReg_ProcessWise Or rptType = ReportType.JobCardReg_SubGroupWise Or rptType = ReportType.JobCardReg_ProductWise Or rptType = ReportType.JobCardReg_BrandWise Then
                rdDetailed.Checked = True
            End If

            If TransType = TransactionType.ProcessIssue Or TransType = TransactionType.ProcessReceipt Or TransType = TransactionType.ProcessStkWithParty Or TransType = TransactionType.FabricIssueBack Or TransType = TransactionType.StoresIssueBack Or TransType = TransactionType.SemiProcStkAtWarehouse Or TransType = TransactionType.ProcessProdnDelay Or TransType = TransactionType.ProcessShortage Or TransType = TransactionType.ProcessLedger Then
                rdDetailed.Checked = True
            End If

            If rptType = ReportType.SalesOrderRegister_AllInOne Or rptType = ReportType.FabPurOrderRegister_AllInOne Then
                pnlDate2.Visible = True : pnlDate2.Enabled = False
                dtpFrom2.Value = AccFromDt '"01/04/2016"
                dtpTo2.Value = AccToDt '"31/03/2017"
                chkSize.Visible = True : chkSize.Text = "Value wise"
                lblRegion.Visible = True : cmbRegion.Visible = True
                lblCountry.Visible = True : cmbCountry.Visible = True
                lblSize.Visible = False : cmbSize.Visible = False : lblQuality.Visible = False : cmbQuality.Visible = False
                lblSeason.Visible = False : cmbSeason.Visible = False : lblOccassion.Visible = False : cmbOccassion.Visible = False

                lblTax.Visible = False : cmbTax.Visible = False

                If rptType = ReportType.SalesOrderRegister_AllInOne Then
                    lblParty.Text = "Buyer"
                End If

                If rptType = ReportType.FabPurOrderRegister_AllInOne Then
                    If AsPerUser = " Created_By <> 0 " Then
                        lblTax.Text = "User" : cmbTax.Enabled = True
                        Query = "Select Distinct PurOrder.Created_By, Login_Name " _
                          & " From PurOrder Left Join Users On Users.User_Id = PurOrder.Created_By" _
                          & " Where Login_Name <> '' And PurOrder.Cobr_Id ='" & SelBranchFixId & "' And PO_Type='G'" _
                          & " Order By Login_Name"
                        Common.FillCheckBoxCombo(Query, cmbTax, "Login_Name", "Created_By")
                    End If
                End If

            End If

            If rptType = ReportType.FabPurOrderRegister_AllInOne Then
                pnlParty.Enabled = True : lblOperator.Text = "Country" : cmbOperator.Enabled = True

                lblType.Visible = False : cmbType.Visible = False

                Query = "Select CONT_KEY, CONT_NAME " _
                  & " From Country " _
                  & " Where Status = '1' And Cont_Name <> '' " _
                  & BranchFixFilter _
                  & " Order By Cont_Name"
                Common.FillCheckBoxCombo(Query, cmbOperator, "CONT_NAME", "CONT_KEY")

            End If

            If rptType = ReportType.SalesOrderStatusANS Or rptType = ReportType.SalesOrderRegister_AllInOneANS Or rptType = ReportType.OCPendingStatus Or rptType = ReportType.BuyerProgressChart Or rptType = ReportType.CountryBuyerwiseOrderAnalysis Or rptType = ReportType.ProductCategorywiseBuyerwiseOrderAnal Or rptType = ReportType.TopStyle Then
                pnlDate1.Visible = True : pnlDate1.Enabled = False
                dtpFrom1.Value = AccFromDt '"01/04/2016"
                dtpTo1.Value = AccToDt '"31/03/2017"
                'chkSize.Visible = True : chkSize.Text = "Value wise"
                pnlParty.Enabled = True
                lblRegion.Visible = True : cmbRegion.Visible = True
                lblCountry.Visible = True : cmbCountry.Visible = True

                lblFrom.Text = "Del Date From" : lbldate1.Text = "Buyer Order Date From"
                pnlStock.Visible = True
                chkDispRate.Visible = True : chkDispValue.Visible = True

                chkDispRate.Text = "Month Wise" : chkDispValue.Text = "Month Product Wise"
                If chkDispRate.Checked = True Then
                    chkDispValue.Checked = False
                End If
                If chkDispValue.Checked = True Then
                    chkDispRate.Checked = False

                End If

                lblOperator.Text = "Handle By" : lblTax.Text = "ShipMode"
                cmbOperator.Enabled = True : cmbTax.Enabled = True

                lblSalesType.Visible = True : cmbSalesType.Visible = True
                lblSalesType.Text = "OCStatus"
                'lblRegion.Visible = True : cmbRegion.Visible = True
                'lblCountry.Visible = True : cmbCountry.Visible = True
                'lblSize.Visible = False : cmbSize.Visible = False : lblQuality.Visible = False : cmbQuality.Visible = False
                'lblSeason.Visible = False : cmbSeason.Visible = False : lblOccassion.Visible = False : cmbOccassion.Visible = False
                pnlProduct.Enabled = False

                pnlOtherOptions.Visible = True
                rdOthOption1.Checked = True : rdOthOption3.Visible = False

                rdOthOption1.Text = "Merchandiser Dept."
                rdOthOption2.Text = "Purchase Dept."

                pnlSummaryDetail.Visible = False

                Query = "Select LED_KEY, LED_NAME " _
                & " From Ledger Where (Led_Cat = 'S' ) And Status = '1' " _
                & " And (Cobr_Id ='" & SelBranchLedFixId & "' ) " _
                & " Order By Led_Name"
                Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")


                Query = "Select cast(0 as varchar(10)) SR_ID, '  ' CARRAGE " _
                      & " Union All " _
                      & " Select  cast(1 as varchar(10)) SR_ID, 'BY SEA' CARRAGE " _
                      & " Union All " _
                      & " Select cast(2 as varchar(10)) SR_ID, 'BY AIR' CARRAGE " _
                      & " Union All " _
                      & " Select cast(3 as varchar(10)) SR_ID, 'BY SURFACE' CARRAGE " _
                      & " Union All " _
                      & " Select cast(4 as varchar(10)) SR_ID, 'BY COURIER' CARRAGE "
                Common.FillCheckBoxCombo(Query, cmbTax, "CARRAGE", "SR_ID")


                Query = "Select SOStatus_Id, SOStatus_Name " _
                      & " From SOStatus where SOStatus_Id in (1,2,6,7,5)  " _
                      & " Order By SOStatus_Id"
                Common.FillCheckBoxCombo(Query, cmbSalesType, "SOStatus_Name", "SOStatus_Id") '''SOStatus_Name<>''  ''Satyam 05072022

                If rptType = ReportType.OCPendingStatus Then
                    cmbOperator.Enabled = False
                    cmbTax.Enabled = False
                    rdOthOption1.Text = "Buyerwise Summary"
                    rdOthOption2.Text = "Product Summary"
                    chkDispRate.Visible = False
                    chkDispValue.Visible = False
                    Me.Text = "OC Pending Status"
                    Query = "Select SOStatus_Id, SOStatus_Name " _
                            & " From SOStatus where SOStatus_Id in (1,2,6,7,5) " _
                            & " Order By SOStatus_Id"
                    Common.FillCheckBoxCombo(Query, cmbSalesType, "SOStatus_Name", "SOStatus_Id") '''SOStatus_Id in (1,2)''Satyam 05072022
                End If
                If rptType = ReportType.BuyerProgressChart Then
                    pnlDate1.Enabled = False
                    cmbTax.Enabled = False
                    cmbOperator.Enabled = False
                    cmbSalesType.Enabled = False
                    rdOthOption1.Text = "Order Shiped"
                    rdOthOption2.Text = "Open Order To Ship"
                    chkDispRate.Text = "OC Exchange Rate" : chkDispValue.Text = "Current Exchange Rate"
                    chkDispValue.Checked = True
                    chkDispRate.Visible = False
                End If
                DisplayParty()

                If rptType = ReportType.CountryBuyerwiseOrderAnalysis Then
                    pnlDate1.Enabled = False
                    cmbTax.Enabled = False
                    cmbOperator.Enabled = False
                    cmbSalesType.Enabled = False
                    cmbState.Enabled = False
                    cmbCity.Enabled = False
                    cmbParty.Enabled = False
                    cmbStation.Enabled = False
                    pnlDate1.Visible = False
                    'pnlOtherOptions.Location = New Point(251, 381)
                    rdOthOption1.Text = "OC Details "
                    rdOthOption2.Text = "Summary"
                    chkDispRate.Text = "OC Exchange Rate" : chkDispValue.Text = "Current Exchange Rate"
                    chkDispValue.Checked = True
                    chkDispRate.Visible = False
                End If
                '
                If rptType = ReportType.ProductCategorywiseBuyerwiseOrderAnal Then
                    pnlDate1.Enabled = False
                    cmbSalesType.Enabled = False
                    cmbOperator.Enabled = False
                    cmbTax.Enabled = False
                    pnlProduct.Enabled = True
                    cmbParty.Enabled = True
                    cmbStation.Enabled = True
                    cmbRegion.Enabled = True
                    cmbState.Enabled = True
                    cmbCountry.Enabled = True
                    cmbProductGrp.Enabled = True
                    cmbProductSubGrp.Enabled = True
                    cmbProduct.Enabled = True
                    cmbStyle.Enabled = True
                    cmbSize.Enabled = False
                    cmbShade.Enabled = False
                    cmbType.Enabled = False
                    cmbBrand.Enabled = False
                    cmbQuality.Enabled = False
                    cmbSeason.Enabled = False
                    cmbOccassion.Enabled = False
                    cmbLocation.Enabled = False
                    pnlDate1.Visible = False
                    'pnlOtherOptions.Location = New Point(251, 381)
                    rdOthOption1.Visible = False
                    rdOthOption2.Visible = False
                    pnlOtherOptions.Visible = False
                    chkDispValue.Visible = False
                    chkDispRate.Text = "Summary" : chkDispValue.Text = "Current Exchange Rate"
                    chkDispValue.Checked = True
                    chkDispRate.Checked = True
                    'chkDispRate.Visible = False
                End If

                If rptType = ReportType.TopStyle Then
                    pnlDate1.Enabled = False
                    cmbSalesType.Enabled = False
                    cmbOperator.Enabled = False
                    cmbTax.Enabled = False
                    pnlProduct.Enabled = True
                    cmbParty.Enabled = True
                    cmbStation.Enabled = False
                    cmbRegion.Enabled = False
                    cmbState.Enabled = False
                    cmbCountry.Enabled = False
                    cmbProductGrp.Enabled = True
                    cmbProductSubGrp.Enabled = True
                    cmbProduct.Enabled = True
                    cmbStyle.Enabled = True
                    cmbSize.Enabled = False
                    cmbShade.Enabled = False
                    cmbType.Enabled = False
                    cmbBrand.Enabled = False
                    cmbQuality.Enabled = False
                    cmbSeason.Enabled = False
                    cmbOccassion.Enabled = False
                    cmbLocation.Enabled = False
                    pnlDate1.Visible = False
                    'pnlOtherOptions.Location = New Point(251, 381)
                    rdOthOption1.Visible = False
                    rdOthOption2.Visible = False
                    pnlOtherOptions.Visible = False
                    chkDispValue.Visible = False
                    chkDispRate.Text = "Summary" : chkDispValue.Text = "Current Exchange Rate"
                    chkDispValue.Checked = True
                    chkDispRate.Checked = True
                    'chkDispRate.Visible = False
                End If




                If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
                    If rptType = ReportType.SalesOrderRegister_AllInOneANS Then
                        pnlOtherOptions.Visible = False
                        chkDispRate.Visible = False
                        chkDispValue.Visible = False
                        cmbSONo.Visible = True
                        lblSaleOrder.Visible = True
                        pnlDate.Enabled = False
                        'cmbRegion.Enabled = False
                        'cmbCountry.Enabled = False
                        'cmbCity.Enabled = False
                        'cmbState.Enabled = False
                        cmbSalesType.Enabled = False
                        pnlDate1.Enabled = False
                        'cmbStation.Enabled = False
                        cmbOperator.Enabled = False
                        cmbTax.Enabled = False
                        'Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from SalesOrder  Where DOC_ID >0  and cust_key= '" & cmbParty.Text & "' AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'  " _
                        '        & BranchFixFilter _
                        '        & " Order By DOCNO"
                        'Common.FillCombo2(Query, cmbSONo, "DOCNO", "DOCID")

                        Me.Text = "Buyer wise Grid"
                    End If
                End If
            End If
            '''========================Satyam 05082022
            ''' 
            If rptType = ReportType.DesignWiseNetSalesRegister Then
                pnlParty.Enabled = True

                'lblGroup.Enabled = False
                'lblSubGroup.Enabled = False
                'lblProduct.Enabled = False
                'lblDesign.Enabled = False



                cmbType.Enabled = False
                cmbSize.Enabled = False
                cmbBrand.Enabled = False

            End If
            Exit Sub

        ElseIf StockRegister Then
            ForStockRegister()
            Loading = False
            If DisplayOption Then
                btnOption.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenAllowOption)))
                'btnOption.Visible = True
            End If

            OptionForFilter()

            If pnlParty.Enabled Then
                DisplayParty()
            End If

            If rptType = ReportType.RetailerWiseSaleOrder Then
                pnlParty.Enabled = True
                DisplayParty()
                pnlProduct.Enabled = False
                pnlDate.Enabled = True
            End If

            If rptType = ReportType.OpeningStk_SubGroup Or rptType = ReportType.OpeningStk_Product Or rptType = ReportType.OpeningStk_Brand Or rptType = ReportType.OpeningStk_Location Or rptType = ReportType.ClosingStk_SubGroup Or rptType = ReportType.ClosingStk_Product Or rptType = ReportType.ClosingStk_Brand Or rptType = ReportType.ClosingStk_Location Or rptType = ReportType.ClosingStk_Supplier Then
                chkSize.Visible = True
                chkSize.Text = "Bale wise"
                If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
                    If rptType = ReportType.ClosingStk_SubGroup Or rptType = ReportType.ClosingStockSubGroup Then
                        pnlSummaryDetail.Enabled = False
                        rdDetailed.Checked = True
                        chkDispValue.Visible = False
                        lblSaleOrder.Location = New Point(200, 402) '
                        cmbSONo.Location = New Point(300, 399)
                        lblSaleOrder.Text = "OC No"
                        lblSaleOrder.Visible = True
                        cmbSONo.Visible = True
                        lblDesign.Visible = False
                        cmbStyle.Visible = False
                        lblType.Visible = False
                        cmbType.Visible = False
                        lblSize.Visible = False
                        cmbSize.Visible = False
                        lblBrand.Visible = False
                        cmbBrand.Visible = False
                        lblQuality.Visible = False
                        cmbQuality.Visible = False
                        lblSeason.Visible = False
                        cmbSeason.Visible = False
                        lblOccassion.Visible = False
                        cmbOccassion.Visible = False
                        lblLocation.Visible = False
                        cmbLocation.Visible = False
                        lblQty.Visible = False
                        txtStkFrom.Visible = False
                        cmbDisplay.Visible = False
                        chkSize.Visible = False
                        chkDispRate.Visible = False
                    End If
                End If
            End If

            If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
                If rptType = ReportType.ClosingStockSubGroup Then
                    pnlSummaryDetail.Enabled = False
                    rdDetailed.Checked = True
                    chkDispValue.Visible = False
                    lblSaleOrder.Location = New Point(200, 402) '
                    cmbSONo.Location = New Point(300, 399)
                    lblSaleOrder.Text = "OC No"
                    lblSaleOrder.Visible = True
                    cmbSONo.Visible = True
                    lblType.Visible = False
                    cmbType.Visible = False
                    lblSize.Visible = False
                    cmbSize.Visible = False
                    lblBrand.Visible = False
                    cmbBrand.Visible = False
                    lblQuality.Visible = False
                    cmbQuality.Visible = False
                    lblSeason.Visible = False
                    cmbSeason.Visible = False
                    lblOccassion.Visible = False
                    cmbOccassion.Visible = False
                    lblLocation.Visible = False
                    cmbLocation.Visible = False
                    lblQty.Visible = False
                    txtStkFrom.Visible = False
                    cmbDisplay.Visible = False
                    chkSize.Visible = False
                    chkDispRate.Visible = False
                End If
            End If


            'Added By Nitin
            If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
                If rptType = ReportType.ClosingStk_Product Or rptType = ReportType.ClosingStockProduct Then
                    pnlSummaryDetail.Enabled = False
                    pnlOtherOptions.Visible = True
                    lblSaleOrder.Visible = True : lblQty.Visible = False
                    cmbSONo.Visible = True : cmbLocation.Enabled = True : cmbDisplay.Visible = False : txtStkFrom.Visible = False
                    chkDispRate.Checked = False : chkDispValue.Checked = False
                    chkDispRate.Visible = False : chkDispValue.Visible = False
                    pnlOtherOptions.Location = New Point(291, 430)

                    If rptType = ReportType.ClosingStk_Product Or rptType = ReportType.ClosingStockProduct Then
                        pnlSummaryDetail.Enabled = True
                        chkDispRate.Visible = True
                        chkDispRate.Checked = False
                        rdDetailed.Checked = True
                        lblQty.Visible = True
                        cmbDisplay.Visible = True
                        txtStkFrom.Visible = True
                        lblQty.Location = New Point(3, 28)
                        cmbDisplay.Location = New Point(38, 28)
                        txtStkFrom.Location = New Point(120, 28)
                        chkDispRate.Location = New Point(8, 55)
                        'rdOthOption3.Visible = False
                    End If

                    rdOthOption1.Text = "OC Wise"
                    rdOthOption2.Text = "Free Stock"
                    rdOthOption3.Text = "All Stock"
                End If

            End If
            'End Nitin

            'If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
            '    If rptType = ReportType.ClosingStk_SubGroup Then
            '        pnlSummaryDetail.Enabled = False
            '        pnlOtherOptions.Visible = True
            '        lblSaleOrder.Visible = True : lblQty.Visible = False
            '        cmbSONo.Visible = True : cmbLocation.Enabled = True : cmbDisplay.Visible = False : txtStkFrom.Visible = False
            '        chkDispRate.Checked = False : chkDispValue.Checked = False
            '        chkDispRate.Visible = False : chkDispValue.Visible = False
            '        pnlOtherOptions.Location = New Point(291, 430)
            '        rdOthOption1.Text = "OC Wise"
            '        rdOthOption2.Text = "Free Stock"
            '        rdOthOption3.Text = "All Stock"
            '    End If

            'End If
            If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
                If rptType = ReportType.OpeningStk_Product Or rptType = ReportType.OpeningStockProduct Then
                    pnlSummaryDetail.Enabled = False
                    pnlOtherOptions.Visible = True
                    lblSaleOrder.Visible = False : lblQty.Visible = False
                    cmbSONo.Visible = False : cmbLocation.Enabled = True : cmbDisplay.Visible = False : txtStkFrom.Visible = False
                    chkDispRate.Checked = False : chkDispValue.Checked = False
                    chkDispRate.Visible = False : chkDispValue.Visible = False
                    pnlOtherOptions.Location = New Point(291, 430)
                    rdOthOption1.Text = "OC Wise"
                    rdOthOption2.Text = "Free Stock"
                    rdOthOption3.Text = "All Stock"
                    pnlOtherOptions.Enabled = False
                    rdOthOption3.Checked = True
                End If

            End If

            ''Satyam 29072022
            If rptType = ReportType.StockLedger Then
                pnlSummaryDetail.Enabled = True
                rdSummary.Checked = True
            End If

            If rptType = ReportType.SalesOrderpackingCrossTab_StylePartyConsigneeWise Then
                pnlDate1.Visible = True
                pnlDate1.Enabled = True
                dtpFrom1.Value = AccFromDt '"01/04/2016"
                dtpTo1.Value = AccToDt '"31/03/2017"
            End If

            If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForTJS)) = 1 Then
                If rptType = ReportType.SalesOrderRegister_PartyProdWise Or rptType = ReportType.PendSalesOrderCrossTab_PartyStyleWise Then  ''Satyam 30072022

                    Query = "Select LED_KEY, LED_NAME " _
                            & " From Ledger " _
                            & " Where Led_Cat = 'B' And Status =  '1' And Led_Name <> '' and cobr_id='" & SelBranchLedFixId & "'  " _
                            & " Order By Led_Name"
                    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")


                    lblOperator.Enabled = True
                    cmbOperator.Enabled = True
                End If
            End If



            cmbCity.Enabled = False
            cmbDistrict.Enabled = False
            Exit Sub
        ElseIf StockTransfer Then
            ForStockTfrRegister()
            Loading = False
            If DisplayOption Then
                btnOption.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenAllowOption)))
            End If

            OptionForFilter()

            Exit Sub
        Else
            pnlDate.Enabled = True
            cmbOperator.Enabled = False
            'cmbLocation.Enabled = False
            cmbTax.Enabled = False

            If rptType = ReportType.TopNSuppliers Or rptType = ReportType.TopNPurchase Or rptType = ReportType.TopSoldItems Or rptType = ReportType.BottomSoldItems Or rptType = ReportType.TopNCustomers Then
                pnlStock.Visible = True
                pnlAgingParam.Visible = True

                DisplayChartOption()
            End If

            If WithRtnOption Then
                chkSize.Visible = True
                chkSize.Text = "Include Return"
                'chkSize.Checked = True
            End If


            If CurrOptionType = OptionType.Tax Or CurrOptionType = WithTaxOption Then
                cmbOperator.Enabled = False
                cmbTax.Enabled = True

                Dim TaxFltr As String = ""

                If rptType <> ReportType.TaxComputation Then
                    If TransType = TransactionType.Sales Or TransType = TransactionType.SalesRtn Then
                        TaxFltr = " And ApplySalePur = 'S'"
                    Else
                        TaxFltr = " And ApplySalePur = 'P'"
                    End If
                End If

                If rptType = ReportType.TaxComputation Then
                    TaxFltr = " And TaxClass = 'VAT'"
                End If

                Query = "Select TXTMTDS_KEY, ABBR " _
                    & " From TaxTermsTDS " _
                    & " Where Status = '1' And TxTmTDS_Name <> '' " & TaxFltr _
                    & BranchLedFixFilter _
                    & " Order By Abbr"
                Common.FillCheckBoxCombo(Query, cmbTax, "ABBR", "TXTMTDS_KEY")
            End If

            pnlProduct.Enabled = False
            If ProductOptions = True Or CurrOptionType = OptionType.SubGroup Or CurrOptionType = OptionType.Group Or CurrOptionType = OptionType.Product Or CurrOptionType = OptionType.Style Or CurrOptionType = OptionType.Type Or CurrOptionType = OptionType.Shade Or CurrOptionType = OptionType.Size Or CurrOptionType = OptionType.Brand Or CurrOptionType = OptionType.Quality Or CurrOptionType = OptionType.Season Or CurrOptionType = OptionType.Occassion Then
                pnlProduct.Enabled = True
            End If

            If rptType = ReportType.TopSoldItems Or rptType = ReportType.BottomSoldItems Then
                pnlProduct.Enabled = False
            End If

            pnlParty.Enabled = False
            If CurrOptionType = OptionType.Supplier Or CurrOptionType = OptionType.Customer Then
                pnlParty.Enabled = True
            End If

            If rptType = ReportType.TopSoldItems Or rptType = ReportType.BottomSoldItems Then
                btnGrp1.Enabled = False
                btnDelGrp1.Enabled = False

                btnGrp2.Enabled = False
                btnDelGrp2.Enabled = False

                btnGrp3.Enabled = False
                btnDelGrp3.Enabled = False

                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
                'lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))
            End If
            If rptType = ReportType.GSTR3B Then
                If GetSettingAsPerId(ApplnSettingsIdx.DisplayStateinGSTR) = "1" And rptType = ReportType.GSTR3B Then
                    cmbStateGSTR.Visible = True
                    Label4.Visible = True
                    Label3.Visible = True
                    cmbStore.Visible = True
                    chkStatewise.Visible = True
                    chkStorewise.Visible = True
                    chkStatewise.Checked = True
                    Query = "Select State_Key, State_NAME " _
            & " From State" _
            & " Where Status='1' And State_NAME <> '' " _
            & " Order By State_NAME"
                    Common.FillCombo(Query, cmbStateGSTR, "State_NAME", "State_Key")

                    Query = " Select Led_Key, Led_NAME From Ledger Where Status='1' And Led_NAME <> ''  And Ledger.Franchisee_code<>''  Order By Led_NAME "
                    Common.FillCombo(Query, cmbStore, "Led_NAME", "Led_Key")
                Else
                    cmbStateGSTR.Visible = False
                    Label4.Visible = False
                    Label3.Visible = False
                    cmbStore.Visible = False
                    chkStatewise.Visible = False
                    chkStorewise.Visible = False
                End If
                If GetSettingAsPerId(ApplnSettingsIdx.CombineGSTR1ExcelFile) = "1" Then
                    btnGSTR3BExcel.Visible = True
                Else
                    btnGSTR3BExcel.Visible = False
                End If
                pnlSection.Visible = True
                pnlSection.BringToFront()
                cmbTax.Enabled = False
                lblTax.Enabled = False
                chkSize.Visible = False
                cmbSelection.Enabled = False
                pnlSeries.Visible = False
                btnView.Text = "Export"
            End If

            If rptType = ReportType.GSTSummaries Or rptType = ReportType.GSTR1 Or rptType = ReportType.GSTR2 Then
                If rptType = ReportType.GSTR1 Then
                    cmbSelection.Items.Add("B2B Invoices") '0
                    cmbSelection.Items.Add("B2C(Large)") '1
                    cmbSelection.Items.Add("B2C(Small)") '2
                    If GetSettingAsPerId(ApplnSettingsIdx.DisplayStateinGSTR) = "1" And rptType = ReportType.GSTR1 Then
                        cmbStateGSTR.Visible = True
                        Label4.Visible = True
                        chkStatewise.Visible = True
                        chkStorewise.Visible = True
                        Label3.Visible = True
                        cmbStore.Visible = True
                        chkStatewise.Checked = True
                        Query = "Select State_Key, State_NAME " _
                & " From State" _
                & " Where Status='1' And State_NAME <> '' " _
                & " Order By State_NAME"
                        Common.FillCombo(Query, cmbStateGSTR, "State_NAME", "State_Key")

                        Query = " Select Led_Key, Led_NAME From Ledger Where Status='1' And Led_NAME <> ''  And Ledger.Franchisee_code<>''  Order By Led_NAME "
                        Common.FillCombo(Query, cmbStore, "Led_NAME", "Led_Key")
                    Else
                        cmbStateGSTR.Visible = False
                        Label4.Visible = False
                        Label3.Visible = False
                        cmbStore.Visible = False
                        chkStatewise.Visible = False
                        chkStorewise.Visible = False
                    End If
                    If GetSettingAsPerId(ApplnSettingsIdx.CombineGSTR1ExcelFile) = "1" Then
                        btnGSTR1Excel.Visible = True
                    Else
                        btnGSTR1Excel.Visible = False
                    End If
                ElseIf rptType = ReportType.GSTR2 Then
                    cmbSelection.Items.Add("B2B Invoices Registered") '0
                    cmbSelection.Items.Add("B2B Invoices UnRegistered") '1
                End If
                cmbSelection.Items.Add("Credit Note(Registered)") '3
                cmbSelection.Items.Add("Credit Note(UnRegistered)") '4
                cmbSelection.Items.Add("Debit Note(Registered)") '5
                cmbSelection.Items.Add("Debit Note(UnRegistered)") '6
                If rptType = ReportType.GSTR1 Then
                    cmbSelection.Items.Add("HSN wise Summary of Outword Supplies") '7
                    cmbSelection.Items.Add("HSN-Item wise Summary of Outword Supplies") '8
                ElseIf rptType = ReportType.GSTR2 Then
                    cmbSelection.Items.Add("HSN wise Summary of Inword Supplies") '7
                    cmbSelection.Items.Add("HSN-Item wise Summary of Inword Supplies") '8
                End If

                pnlSection.Visible = True
                pnlSection.BringToFront()
                cmbTax.Enabled = False
                lblTax.Enabled = False
                chkSize.Visible = False
                pnlSeries.Visible = False
                btnView.Text = "Export"
            End If

            If WithMonthOption Then
                With cmbOperator.Properties.Items
                    .Add("January")
                    .Add("February")
                    .Add("March")
                    .Add("April")
                    .Add("May")
                    .Add("June")
                    .Add("July")
                    .Add("August")
                    .Add("September")
                    .Add("October")
                    .Add("November")
                    .Add("December")
                End With

                dtpFrom.Enabled = False
                dtpTo.Enabled = False

                lblOperator.Text = "Month"
                cmbOperator.Enabled = True

                If rptType = ReportType.MonthlySalesSaleperson Then
                    DisplayChartOption()
                End If

                If CurrOptionType = OptionType.SalePerson Then
                    Query = "Select LED_KEY, LED_NAME " _
                        & " From Ledger " _
                        & " Where Led_Cat = 'S' And Status =  '1' And Led_Name <> '' and cobr_id='" & SelBranchLedFixId & "' " _
                        & " Order By Led_Name"
                    Common.FillCheckBoxCombo(Query, cmbTax, "LED_NAME", "LED_KEY")

                    lblTax.Visible = True
                    lblTax.Text = "Salesperson"
                    cmbTax.Visible = True
                    cmbTax.Tag = "Salesperson"
                    cmbTax.Enabled = True

                    If DisplayOption Then
                        btnOption.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenAllowOption)))
                    End If


                    Exit Sub
                End If
            End If

            If rptType = ReportType.MOPAnalysis Then
                With cmbOperator.Properties.Items
                    .Add("Cash")
                    .Add("Credit Sale")
                    .Add("Credit Card")
                    .Add("CN Adj")
                    .Add("Redeem Point")
                    .Add("Cheque")
                    .Add("Coupon")
                    .Add("CN Isu")
                End With

                lblOperator.Visible = False
                lblOperator.Text = "MOP Type"
                cmbOperator.Visible = False
                cmbOperator.Enabled = True : chkSize.Visible = False
                pnlProduct.Visible = False : lblLocation.Visible = False : cmbLocation.Visible = False
                DisplayChartOption()
            End If
            If rptType = ReportType.retailsaleregister Or rptType = ReportType.taxregister Then
                chkSize.Visible = False : pnlProduct.Visible = False : lblLocation.Visible = False : cmbLocation.Visible = False : chkDispRate.Visible = True
            End If
            If rptType = ReportType.SalesRegister_SupplierWise Then
                DisplayChartOption()
                lstOption1.Items.Add("Supplier")

                'lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                'lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
                'lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
            End If

            If rptType = ReportType.SaleByTypeAnalysis Then
                lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefGroup))
                lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
                lstOption3.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

                lstDetails.Enabled = False
                btnDetail.Enabled = False
                btnDelDetail.Enabled = False
                btnUp.Enabled = False
                btnDown.Enabled = False

                DisplayChartOption()
            End If

            If rptType = ReportType.TopCustomersNotVisitedThisMonth Then
                cmbOperator.Enabled = False
            End If

            If rptType = ReportType.MarginSummary_SubGroupWise Or rptType = ReportType.Profitability Then
                lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))

                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))

                btnGrp3.Enabled = False
                btnDelGrp3.Enabled = False
                lstOption3.Enabled = False
            End If

            If rptType = ReportType.BusyDays Or rptType = ReportType.BusyHours Then
                pnlStock.Visible = True
                chkSize.Visible = False
                chkDispRate.Visible = False : chkDispValue.Visible = False
                pnlRateType.Visible = False
                pnlDate.Enabled = False

                If rptType = ReportType.BusyDays Then
                    pnlAgingParam.Visible = True
                    lblAgingOn.Text = "Based On"
                    rdAgeQty.Text = "Days"
                    rdAgeQty.Checked = True
                    rdAgeValue.Text = "Month"
                End If

                lblQty.Visible = False
                cmbDisplay.Visible = False
                txtStkFrom.Visible = False

                If rptType = ReportType.BusyDays Then
                    dtpFrom.Value = CDate("01/" & Now.Month & "/" & Now.Year)
                    dtpTo.Value = DateAdd(DateInterval.Day, -1, DateAdd(DateInterval.Month, 1, dtpFrom.Value))

                    pnlDate.Enabled = True
                End If
            End If

            If CurrOptionType = OptionType.SalePerson Then
                Query = "Select LED_KEY, LED_NAME " _
                    & " From Ledger " _
                    & " Where Led_Cat = 'S' And Status =  '1' And Led_Name <> '' and cobr_id='" & SelBranchLedFixId & "'  " _
                    & " Order By Led_Name"
                Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")

                lblOperator.Visible = True
                lblOperator.Text = "Salesperson"
                cmbOperator.Visible = True
                cmbOperator.Tag = "Salesperson"
                cmbOperator.Enabled = True

                lstOption1.Items.Add("Salesperson")
                btnGrp1.Enabled = False
                btnDelGrp1.Enabled = False

                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
            End If


            If rptType = ReportType.MRN Then
                If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
                    grpmrn.Visible = True
                    grpmrn.Enabled = True
                    grpmrn.BringToFront()
                    cmbMIN.Enabled = False
                    rdDetailed.Checked = True
                    pnlSummaryDetail.Enabled = False
                    Query = "Select '' DOCID , '' DOCNO Union All select Distinct cast(MRN.Doc_Id AS VARCHAR(10)) DOCID,MRN.Doc_no DOCNO from MRN  Where MRN.DOC_ID >0  " _
                     & BranchFixFilter _
                     & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbMRN, "DOCNO", "DOCID")
                    'If cmbMRN.Items.Count > 0 Then
                    '    cmbMRN.SelectedIndex = -1
                    'End If


                    Query = "Select '' DOCID , '' DOCNO Union All select Distinct cast(SalesOrder.Doc_Id AS VARCHAR(10)) DOCID,SalesOrder.Doc_no DOCNO from SalesOrder Left Join MRN On SalesOrder.DOc_Id = MRN.SODOC_ID  Where SalesOrder.Doc_id >0 And " _
                    & " MRN.COBR_ID = '" & SelBranchId & "'  " _
                    & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOCNO, "DOCNO", "DOCID")
                    'If cmbOCNO.Items.Count > 0 Then
                    '    cmbOCNO.SelectedIndex = -1
                    'End If

                    Query = "Select '' SampleCreation_ID , '' SampleCreationNO Union All select Distinct cast(SampleCreation.SampleCreation_ID AS VARCHAR(10)) SampleCreation_ID, SampleCreation.SampleCreationNumber SampleCreationNO From SampleCreation Left Join MRN On SampleCreation.SampleCreation_Id = MRN.SampleCreation_Id Where SampleCreation.SampleCreation_ID > 0 And " _
                    & " MRN.COBR_ID = '" & SelBranchId & "'" _
                    & " Order By SampleCreationNO"
                    Common.FillCombo2(Query, cmbCreationNo, "SampleCreationNO", "SampleCreation_ID")

                    'If cmbCreationNo.Items.Count > 0 Then
                    '    cmbCreationNo.SelectedIndex = -1
                    'End If

                    Query = "Select '' Dept_Key , '' Dept_name Union All select Distinct Dept.Dept_Key , Dept.Dept_name  From Dept Left Join MRN On Dept.Dept_Key = MRN.FromDept_Key Where MRN.FromDept_Key > 0 AND" _
                           & " MRN.COBR_ID = '" & SelBranchId & "'" _
                           & " Order By Dept_name"
                    Common.FillCombo2(Query, cmbFromDept, "Dept_name", "Dept_Key")
                    'If cmbFromDept.Items.Count > 0 Then
                    '    cmbFromDept.SelectedIndex = -1
                    'End If

                Else

                End If
            End If

            If rptType = ReportType.MIN Then
                If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
                    grpmrn.Visible = True
                    grpmrn.Enabled = True
                    grpmrn.BringToFront()

                    rdDetailed.Checked = True
                    pnlSummaryDetail.Enabled = False

                    cmbMIN.Enabled = True

                    Query = "Select '' DOCID , '' DOCNO Union All select Distinct cast(MIN.Doc_Id AS VARCHAR(10)) DOCID,MIN.Doc_no DOCNO from MIN  Where MIN.DOC_ID >0  " _
                     & BranchFixFilter _
                     & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbMIN, "DOCNO", "DOCID")
                    If cmbMIN.Items.Count > 0 Then
                        cmbMIN.SelectedIndex = -1
                    End If

                    Query = "Select '' DOCID , '' DOCNO Union All select Distinct cast(MRN.Doc_Id AS VARCHAR(10)) DOCID ,MRN.Doc_no DOCNO from MRN Left Join MIN on MRN.Doc_ID = MIN.MRNDOC_ID Where  MRN.DOC_ID > 0 And " _
                     & " MRN.COBR_ID = '" & SelBranchId & "'  " _
                     & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbMRN, "DOCNO", "DOCID")
                    If cmbMRN.Items.Count > 0 Then
                        cmbMRN.SelectedIndex = -1
                    End If


                    Query = "Select '' DOCID , '' DOCNO Union All select Distinct cast(SalesOrder.Doc_Id AS VARCHAR(10)) DOCID,SalesOrder.Doc_no DOCNO from SalesOrder Left Join MRN On SalesOrder.DOc_Id = MRN.SODOC_ID Left Join MIn On MRn.DOc_ID = MIN.MRNDOC_ID  Where  SalesOrder.Doc_id > 0 And " _
                    & " MRN.COBR_ID = '" & SelBranchId & "'  " _
                    & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOCNO, "DOCNO", "DOCID")
                    If cmbOCNO.Items.Count > 0 Then
                        cmbOCNO.SelectedIndex = -1
                    End If

                    Query = "Select '' SampleCreation_ID , '' SampleCreationNO Union All select Distinct cast(SampleCreation.SampleCreation_ID AS VARCHAR(10)) SampleCreation_ID, SampleCreation.SampleCreationNumber SampleCreationNO From SampleCreation Left Join MRN On SampleCreation.SampleCreation_Id = MRN.SampleCreation_Id Left Join MIn On MRn.DOc_ID = MIN.MRNDOC_ID Where SampleCreation.SampleCreation_ID > 0 And " _
                    & " MRN.COBR_ID = '" & SelBranchId & "'" _
                    & " Order By SampleCreationNO"
                    Common.FillCombo2(Query, cmbCreationNo, "SampleCreationNO", "SampleCreation_ID")

                    If cmbCreationNo.Items.Count > 0 Then
                        cmbCreationNo.SelectedIndex = -1
                    End If

                    lblDeptment.Text = "To Dept"
                    Query = "Select '' Dept_Key , '' Dept_name Union All select Distinct Dept.Dept_Key , Dept.Dept_name  From Dept Left Join MRN On Dept.Dept_Key = MRN.FromDept_Key Left Join MIn On MRn.DOc_ID = MIN.MRNDOC_ID Where MRN.FromDept_Key > 0 AND" _
                           & " MRN.COBR_ID = '" & SelBranchId & "'" _
                           & " Order By Dept_name"
                    Common.FillCombo2(Query, cmbFromDept, "Dept_name", "Dept_Key")
                    If cmbFromDept.Items.Count > 0 Then
                        cmbFromDept.SelectedIndex = -1
                    End If

                Else

                End If
            End If

            If rptType = ReportType.MRT Then
                If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
                    grpmrn.Visible = True
                    grpmrn.Enabled = True
                    grpmrn.BringToFront()

                    rdDetailed.Checked = True
                    pnlSummaryDetail.Enabled = False

                    cmbMIN.Enabled = True
                    lblMIN.Text = "MRT NO"
                    Query = "Select '' DOCID , '' DOCNO Union All select Distinct cast(MRT.Doc_Id AS VARCHAR(10)) DOCID,MRT.Doc_no DOCNO from MRT  Where MRT.DOC_ID >0  " _
                     & BranchFixFilter _
                     & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbMIN, "DOCNO", "DOCID")
                    If cmbMIN.Items.Count > 0 Then
                        cmbMIN.SelectedIndex = -1
                    End If

                    Label2.Text = "MIN No"
                    Query = "Select '' DOCID , '' DOCNO Union All select Distinct cast(MIN.Doc_Id AS VARCHAR(10)) DOCID,MIN.Doc_no DOCNO from MIN Left Join MRT on MIN.Doc_ID = MRT.MINDOC_ID Where  MRT.DOC_ID > 0 And " _
                     & " MRT.COBR_ID = '" & SelBranchId & "'  " _
                     & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbMRN, "DOCNO", "DOCID")
                    If cmbMRN.Items.Count > 0 Then
                        cmbMRN.SelectedIndex = -1
                    End If


                    Query = "Select '' DOCID , '' DOCNO Union All select Distinct cast(SalesOrder.Doc_Id AS VARCHAR(10)) DOCID,SalesOrder.Doc_no DOCNO from SalesOrder Left Join MRN On SalesOrder.DOc_Id = MRN.SODOC_ID Left Join MIn On MRn.DOc_ID = MIN.MRNDOC_ID Left Join MRT On MIN.DOc_id = MRT.MINDoc_ID  Where  MRT.Doc_id > 0 And " _
                    & " MRT.COBR_ID = '" & SelBranchId & "'  " _
                    & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOCNO, "DOCNO", "DOCID")
                    If cmbOCNO.Items.Count > 0 Then
                        cmbOCNO.SelectedIndex = -1
                    End If

                    Query = "Select '' SampleCreation_ID , '' SampleCreationNO Union All select Distinct cast(SampleCreation.SampleCreation_ID AS VARCHAR(10)) SampleCreation_ID, SampleCreation.SampleCreationNumber SampleCreationNO From SampleCreation Left Join MRN On SampleCreation.SampleCreation_Id = MRN.SampleCreation_Id Left Join MIn On MRn.DOc_ID = MIN.MRNDOC_ID Left Join MRT On MIN.DOc_id = MRT.MINDoc_ID Where MRT.Doc_ID > 0 AND MRN.SampleCreation_Id > 0 And " _
                    & " MRT.COBR_ID = '" & SelBranchId & "'" _
                    & " Order By SampleCreationNO"
                    Common.FillCombo2(Query, cmbCreationNo, "SampleCreationNO", "SampleCreation_ID")

                    If cmbCreationNo.Items.Count > 0 Then
                        cmbCreationNo.SelectedIndex = -1
                    End If

                    lblDeptment.Text = "From Dept"
                    Query = "Select '' Dept_Key , '' Dept_name Union All select Distinct Dept.Dept_Key , Dept.Dept_name  From Dept Left Join MRN On Dept.Dept_Key = MRN.FromDept_Key Left Join MIn On MRn.DOc_ID = MIN.MRNDOC_ID Left Join MRT On MIN.DOc_id = MRT.MINDoc_ID Where MRT.Doc_ID > 0 AND" _
                           & " MRT.COBR_ID = '" & SelBranchId & "'" _
                           & " Order By Dept_name"
                    Common.FillCombo2(Query, cmbFromDept, "Dept_name", "Dept_Key")
                    If cmbFromDept.Items.Count > 0 Then
                        cmbFromDept.SelectedIndex = -1
                    End If

                Else

                End If
            End If

            If rptType = ReportType.CustomerReport Then
                pnlDate.Enabled = False
                cmbTax.Enabled = False
            End If

            If rptType = ReportType.CustomerStmt Then
                pnlParty.Enabled = True
                cmbTax.Enabled = False
            End If

            If DisplayOption Then
                btnOption.Visible = CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenAllowOption)))
            End If

            If rptType = ReportType.BarcodeWisePurchase Then
                lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
            End If

            If rptType = ReportType.HourlySales Or rptType = ReportType.SalesVATRegister Then
                DisplayChartOption()
            End If

            OptionForFilter()

            If pnlParty.Enabled Then
                DisplayParty()
            End If
            If rptType = ReportType.SaleTaxRegister Then
                chkSize.Visible = False
                DisplayChartOption()
            End If

            Exit Sub
        End If


        Me.Text = ReportCaption

        'If GetSettingAsPerId(ApplnSettingsIdx.GenAllowCityDist).ToString = "A" Then
        '    lblDistrict.Visible = True : cmbDistrict.Visible = True
        '    lblCity.Visible = True : cmbCity.Visible = True
        'ElseIf GetSettingAsPerId(ApplnSettingsIdx.GenAllowCityDist).ToString = "D" Then
        '    lblDistrict.Visible = True : cmbDistrict.Visible = True
        '    lblCity.Visible = False : cmbCity.Visible = False
        'ElseIf GetSettingAsPerId(ApplnSettingsIdx.GenAllowCityDist).ToString = "C" Then
        '    lblDistrict.Visible = False : cmbDistrict.Visible = False
        '    lblCity.Visible = True : cmbCity.Visible = True
        'ElseIf GetSettingAsPerId(ApplnSettingsIdx.GenAllowCityDist).ToString = "N" Then
        '    lblDistrict.Visible = False : cmbDistrict.Visible = False
        '    lblCity.Visible = False : cmbCity.Visible = False
        'End If



    End Sub

    Private Sub ForProductRegister()
        Me.Text = ReportCaption
        If rptType = ReportType.ItemStockRpt Or rptType = ReportType.SoBalanceRpt Then
            pnlDate.Enabled = False
        Else
            pnlDate.Enabled = True
        End If

        pnlSummaryDetail.Enabled = False
        ' Plnitemdetils.Enabled = False  ''saurabh01082018
        pnlParty.Enabled = False
        cmbOperator.Enabled = False : cmbTax.Enabled = False
        'cmbLocation.Enabled = False

        If DispDetailSummary = DetailSummary.Yes Then
            pnlSummaryDetail.Enabled = True
            Plnitemdetils.Enabled = True  '''saurabh 01082018
           

        End If



        If CurrOptionType = OptionType.SubGroup Or CurrOptionType = OptionType.Product Or CurrOptionType = OptionType.Brand Then
            pnlProduct.Enabled = True
            btnOption.Visible = True
        End If

        If rptType = ReportType.PeriodicalPurchase Or rptType = ReportType.PeriodicalPurchaseRtn Or rptType = ReportType.PeriodicalSales Then
            lstOption1.Items.Add("Supplier")
            lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))
            lstOption3.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

            pnlParty.Enabled = True
            pnlProduct.Enabled = True
            btnOption.Visible = True

            DisplayChartOption()
        End If

        If WithDetails Then
            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
        End If

        If rptType = ReportType.MonthlyPurchase Or rptType = ReportType.MonthlyPurchaseDate Or rptType = ReportType.MonthlyPurchaseRtn Or rptType = ReportType.MonthlyPurchaseDateRtn Or rptType = ReportType.MonthlySales Or rptType = ReportType.MonthlySalesDate Or rptType = ReportType.MonthlySalesRtn Or rptType = ReportType.MonthlySalesRtnDate Then
            btnGrp2.Enabled = False
            btnDelGrp2.Enabled = False

            btnGrp3.Enabled = False
            btnDelGrp3.Enabled = False

            btnDetail.Enabled = False
            btnDelDetail.Enabled = False
            btnUp.Enabled = False
            btnDown.Enabled = False

            If rptType = ReportType.MonthlyPurchase Or rptType = ReportType.MonthlyPurchaseRtn Or rptType = ReportType.MonthlySales Or rptType = ReportType.MonthlySalesRtn Then
                DisplayChartOption()
            End If
        End If

        If CurrOptionType = OptionType.SubGroup Then
            lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
        ElseIf CurrOptionType = OptionType.Product Then
            lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
        ElseIf CurrOptionType = OptionType.Brand Then
            lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))
        End If

        If CurrOptionType = OptionType.SalePerson Then
            If rptType <> ReportType.MonthlySalesSaleperson Then
                Query = "Select LED_KEY, LED_NAME " _
                    & " From Ledger " _
                    & " Where Status = '1' And Led_Name <> '' " _
                    & " And Led_Cat = 'S' " & BranchLedFixFilter _
                    & " Order By Led_Name"
                Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")

                cmbOperator.Enabled = True
                lblOperator.Text = "Salesperson"
                cmbOperator.Tag = "Salesperson"
            Else
                Query = "Select LED_KEY, LED_NAME " _
                    & " From Ledger " _
                    & " Where Status = '1' And Led_Name <> '' " _
                    & " And Led_Cat = 'S' " & BranchLedFixFilter _
                    & " Order By Led_Name"
                Common.FillCheckBoxCombo(Query, cmbTax, "LED_NAME", "LED_KEY")

                cmbTax.Enabled = True
                lblTax.Text = "Salesperson"
                cmbTax.Tag = "Salesperson"
            End If
        End If

        If rptType = ReportType.PendPurOrderRegister_BillWise Or rptType = ReportType.PendPurOrderRegister_DateWise Or rptType = ReportType.PendPurOrderRegister_LocationWise Or rptType = ReportType.PendPurOrderRegister_SupplierWise Or rptType = ReportType.JobWorkPOStatus_Billwise Or rptType = ReportType.JobWorkOrderStatus_Billwise Or rptType = ReportType.PendPurOrderRegister_SubGroupWise Or rptType = ReportType.PendPurOrderRegister_ProductWise Or rptType = ReportType.PendPurOrderRegister_BrandWise Or rptType = ReportType.FabPurOrderRegister_AllInOne Then
            pnlOtherOptions.Visible = True

            If rptType = ReportType.FabPurOrderRegister_AllInOne Then
                rdOthOption3.Checked = True
            Else
                rdOthOption1.Checked = True
            End If

            rdOthOption1.Text = "Pending"
            rdOthOption2.Text = "Completed"
        End If

        If rptType = ReportType.PendSalesOrderRegister_BillWise Or rptType = ReportType.PendSalesOrderRegister_DateWise Or rptType = ReportType.PendSalesOrderRegister_PartyWise Or rptType = ReportType.PendSalesOrderRegister_PartyProdWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PendSalesOrderRegister_ProductWise Or rptType = ReportType.PendSalesOrderRegister_BrandWise Or rptType = ReportType.PendSalesOrderRegister_BrokerWise Or rptType = ReportType.PendServiceJobOrderRegister_DateWise Or rptType = ReportType.PendServiceJobOrderRegister_BillWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.PendServiceJobOrderRegister_ProductWise Or rptType = ReportType.SalesOrderRegister_AllInOne Then
            pnlOtherOptions.Visible = True
            'rdOthOption3.Checked = True
            'rdOthOption1.Checked = True

            If rptType = ReportType.SalesOrderRegister_AllInOne Then
                rdOthOption3.Checked = True
            Else
                rdOthOption1.Checked = True
            End If

            rdOthOption1.Text = "Pending"
            rdOthOption2.Text = "Completed"
        End If
        ''ankita 15122018
        If rptType = ReportType.SalesOrderReport Or rptType = ReportType.SalesInvoiceReport Then
            pnlOtherOptions.Visible = False
        End If
        ''end ankita 15122018
        If rptType = ReportType.PeriodicalPurchase Or rptType = ReportType.PeriodicalPurchaseRtn Or rptType = ReportType.PeriodicalSales Then
            lstDetails.Enabled = False
            btnDetail.Enabled = False
            btnDelDetail.Enabled = False
            btnUp.Enabled = False
            btnDown.Enabled = False

            DisplayChartOption()
        End If


        If WithMonthOption Then
            With cmbOperator.Properties.Items
                .Add("January")
                .Add("February")
                .Add("March")
                .Add("April")
                .Add("May")
                .Add("June")
                .Add("July")
                .Add("August")
                .Add("September")
                .Add("October")
                .Add("November")
                .Add("December")
            End With

            dtpFrom.Enabled = False
            dtpTo.Enabled = False

            lblOperator.Text = "Month"
            cmbOperator.Enabled = True
        End If

        '''''''''''''''Added by Pooja on 30-10-2017------------------
        If rptType = rptType.PendSalesOrderCrossTab_PartyConsigneeWise Or rptType = rptType.PendSalesOrderCrossTab_StylePartyConsigneeWise Or rptType = rptType.SalesOrderCrossTab_StylePartyConsigneeWise Then
            Query = "Select LED_KEY, LED_NAME " _
            & " From Ledger " _
            & " Where Led_Cat In('C','D') And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
            & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")

        End If
        ''''''''''''END Pooja------------------

        If rptType = ReportType.DiscountGiven_Product Then
            btnGrp2.Enabled = False
            btnDelGrp2.Enabled = False

            btnGrp3.Enabled = False
            btnDelGrp3.Enabled = False

            'lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
        End If


        If rptType = ReportType.FabPurOrderRegister_AllInOne Then
            DisplayParty()
        End If

        If rptType = ReportType.SalesRegister_CustProductWise Or rptType = ReportType.SalesOrderRegister_PartyProdWise Or rptType = ReportType.SalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PendSalesOrderRegister_PartyProdWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PackingRegister_PartyProdWise Or rptType = ReportType.PackingRegister_ConsigneeProdWise Or rptType = ReportType.SalesBillRegister_PartyProdWise Or rptType = ReportType.SalesBillRegister_ConsigneeProdWise Or rptType = ReportType.ServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.ServiceChallanRegister_PartyProdWise Or rptType = ReportType.ServiceBillRegister_PartyProdWise Or rptType = ReportType.SalesOrderReport Or rptType = ReportType.SalesInvoiceReport Or rptType = ReportType.SalesOrderRegister_AllInOne Or rptType = ReportType.DesignWiseNetSalesRegister Then '''Satyam 05082022
            lstOption1.Items.Clear()
            lstOption2.Items.Clear()


            If rptType = ReportType.SalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PackingRegister_ConsigneeProdWise Or rptType = ReportType.SalesBillRegister_ConsigneeProdWise Or rptType = ReportType.SalesOrderRegister_AllInOne Then
                lstOption1.Items.Add("Consignee")
                Query = "Select LED_KEY, LED_NAME " _
                   & " From Ledger " _
                   & " Where Led_Cat In('C','D') And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                   & " Order By Led_Name"
                Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")

                cmbOperator.Enabled = True
                lblOperator.Text = "Consignee"
                cmbOperator.Tag = "Consignee"

            Else
                lstOption1.Items.Add("Customer")
            End If

            lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))

            pnlParty.Enabled = True
            DisplayParty()
        End If



        If TransType = TransactionType.JobCard Or TransType = TransactionType.ProcessIssue Or TransType = TransactionType.ProcessReceipt Or TransType = TransactionType.ProcessLedger Or TransType = TransactionType.ProcessProdnDelay Or TransType = TransactionType.ProcessStkWithParty Or TransType = TransactionType.ProcessShortage Or TransType = TransactionType.SemiProcStkAtWarehouse Or TransType = TransactionType.FabricIssueBack Or TransType = TransactionType.StoresIssue Or TransType = TransactionType.StoresIssueBack Or TransType = TransactionType.FabricIssue Or TransType = TransactionType.FabricStkWithParty Or TransType = TransactionType.ProcessLedger Then

            If lstOption1.Items.Count > 0 Then lstOption1.Items.Clear()
            If lstOption2.Items.Count > 0 Then lstOption2.Items.Clear()

            

            If CurrOptionType = OptionType.SubGroup Then
                lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))

                If rptType <> ReportType.JobCardReg_SubGroupWise And rptType <> ReportType.ProcessLedReg_JobberWise Then
                    lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
                End If


            ElseIf CurrOptionType = OptionType.Product Then
                lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

                If rptType <> ReportType.JobCardReg_ProductWise And rptType <> ReportType.ProcessLedReg_ProductWise Then
                    lstOption2.Items.Add("Jobber")
                End If


            ElseIf CurrOptionType = OptionType.Brand Then
                lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))

                If rptType <> ReportType.JobCardReg_BrandWise Then
                    lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
                End If

            End If

            If TransType = TransactionType.ProcessProdnDelay Or TransType = TransactionType.ProcessStkWithParty Then
                dtpFrom.Enabled = False
                dtpTo.Enabled = False
            End If
        End If

        If rptType = ReportType.SalesOrderRegister_BillWise Or rptType = ReportType.SalesOrderRegister_DateWise Or rptType = ReportType.SalesOrderRegister_PartyWise Or rptType = ReportType.StockReadyToDispatch Or rptType = ReportType.SalesOrderRegister_ProductWise Or rptType = ReportType.SalesOrderRegister_PartyProdWise Or rptType = ReportType.SalesOrderRegister_ConsigneeWise Or rptType = ReportType.SalesOrderRegister_ConsigneeProdWise _
          Or rptType = ReportType.SalesOrderRegister_BrandWise Or rptType = ReportType.SalesOrderRegister_BrokerWise Or rptType = ReportType.PendSalesOrderRegister_BillWise Or rptType = ReportType.PendSalesOrderRegister_BrandWise Or rptType = ReportType.PendSalesOrderRegister_BrokerWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeWise _
           Or rptType = ReportType.PendSalesOrderRegister_DateWise Or rptType = ReportType.PendSalesOrderRegister_PartyProdWise Or rptType = ReportType.PendSalesOrderRegister_PartyWise Or rptType = ReportType.PendSalesOrderRegister_ProductWise Or rptType = ReportType.ServiceJobOrderRegister_DateWise Or rptType = ReportType.ServiceJobOrderRegister_BillWise Or rptType = ReportType.ServiceJobOrderRegister_PartyWise Or rptType = ReportType.ServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.ServiceJobOrderRegister_ProductWise Or rptType = ReportType.PendServiceJobOrderRegister_DateWise Or rptType = ReportType.PendServiceJobOrderRegister_BillWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.PendServiceJobOrderRegister_ProductWise Or rptType = ReportType.SalesOrderReport Or rptType = ReportType.SalesInvoiceReport Then
            If rdDetailed.Checked = True Then
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                    chkSize.Visible = True
                End If
            End If
        End If

        If rptType = ReportType.PurOrderRegister_DateWise Or rptType = ReportType.PurOrderRegister_BillWise Or rptType = ReportType.PurOrderRegister_BrandWise Or rptType = ReportType.PurOrderRegister_SupplierWise Or rptType = ReportType.PurOrderRegister_ProductWise Or rptType = ReportType.PurOrderRegister_SubGroupWise _
            Or rptType = ReportType.PendPurOrderRegister_DateWise Or rptType = ReportType.PendPurOrderRegister_BillWise Or rptType = ReportType.PendPurOrderRegister_BrandWise Or rptType = ReportType.PendPurOrderRegister_SupplierWise Or rptType = ReportType.JobWorkPOStatus_Billwise Or rptType = ReportType.JobWorkOrderStatus_Billwise Or rptType = ReportType.PendPurOrderRegister_ProductWise Or rptType = ReportType.PendPurOrderRegister_SubGroupWise Or rptType = ReportType.PurOrderRegisterAsPerPurchase_DateWise Then
            If rdDetailed.Checked = True Then
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                    chkSize.Visible = True
                End If

            End If
        End If

        If rptType = ReportType.PurchaseRegister_DateWise Or rptType = ReportType.PurchaseRegister_BillWise Or rptType = ReportType.PurchaseRegister_BrandWise Or rptType = ReportType.PurchaseRegister_LocationWise Or rptType = ReportType.PurchaseRegister_ProductWise Or rptType = ReportType.PurchaseRegister_SubGroupWise _
            Or rptType = ReportType.PurchaseRegister_SupplierWise Or rptType = ReportType.BarcodeWisePurchase Then
            If rdDetailed.Checked = True Then
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                    chkSize.Visible = True
                End If
            End If
        End If
        ''ankita 09052019
        If rptType = ReportType.PurOrderRegisterAsPerPurchase_DateWise Then ''ankita 18122018
            pnlDate.Enabled = True
            dtpFrom.Enabled = True
            dtpTo.Enabled = True
            rdDetailed.Enabled = False
        End If
        ''end ankita 09052019
        rdSummary.Checked = True
        If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
            If rptType = ReportType.SalesOrderRegister_PartyProdWise Then
                cmbSONo.Visible = True
                lblSaleOrder.Visible = True
                rdDetailed.Checked = True
                pnlSummaryDetail.Enabled = False
            End If
        End If

        If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForTJS)) = 1 Then
            If rptType = ReportType.SalesOrderRegister_PartyProdWise Or rptType = ReportType.PendSalesOrderCrossTab_PartyStyleWise Then  ''Satyam 22072022

                Query = "Select LED_KEY, LED_NAME " _
                        & " From Ledger " _
                        & " Where Led_Cat = 'B' And Status =  '1' And Led_Name <> '' and cobr_id='" & SelBranchLedFixId & "'  " _
                        & " Order By Led_Name"
                Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")


                lblOperator.Enabled = True
                cmbOperator.Enabled = True
            End If
        End If
        'pnlOptions.Visible = True
    End Sub

    Private Sub ForRegister()
        Me.Text = ReportCaption

        pnlDate.Enabled = True
        cmbTax.Enabled = False
        cmbOperator.Enabled = False
        pnlParty.Enabled = False

        'chkDispValue.Visible = True
        'chkDispRate.Text = "With Details"
        'chkDispValue.Text = "Date Wise(Grouping)"

        pnlStock.Visible = True

        If DispDetailSummary = DetailSummary.No Then
            pnlSummaryDetail.Enabled = False
            Plnitemdetils.Enabled = False '''saurabh 01082018
        Else
            pnlSummaryDetail.Enabled = True
            Plnitemdetils.Enabled = True '''saurabh 01082018
        End If

        If CurrOptionType = OptionType.Process Then
            Query = "Select PROSTG_ID, PROSTG_NAME From ProStg " _
                & " Where Status = '1' And ProStg_NAme <> '' " _
                & " Order By ProStg_NAme"
            Common.FillCheckBoxCombo(Query, cmbTax, "PROSTG_NAME", "PROSTG_ID")

            lblTax.Text = "Process"
            cmbTax.Enabled = True
        End If

        If DisplayRateValue Then
            chkDispRate.Visible = True
            chkDispValue.Visible = True

            chkDispRate.Text = "With Details"
            chkDispValue.Text = "Date Wise(Grouping)"

            DisplayDetailsCheck()
        End If
        If rptType = ReportType.PendingOrderReport Or rptType = ReportType.PPAccStatus Or rptType = ReportType.PPFABStatus Then
            chkDispRate.Visible = False
            chkDispValue.Visible = True
            chkDispRate.Checked = True
            chkDispValue.Text = "Branch"
        End If
        If rptType = ReportType.ProcessDateWise Then
            chkDispRate.Visible = False
            chkDispValue.Visible = True
            chkDispRate.Checked = True
            chkDispValue.Text = "Isu"
        End If
        lblQty.Visible = False
        cmbDisplay.Visible = False
        txtStkFrom.Visible = False

        If rptType = ReportType.ProcessIsuReg_DateWise Then
            chkSize.Visible = False : chkDispRate.Visible = False
        End If
        If rptType = ReportType.ProcessDateWise Then
            chkSize.Visible = False : chkDispRate.Visible = False
        End If
        If rptType = ReportType.PurOrderRegister_LocationWise Or rptType = ReportType.PendPurOrderRegister_LocationWise Or rptType = ReportType.PurchaseRegister_LocationWise Or rptType = ReportType.PurRtnRegister_LocationWise Or rptType = ReportType.SalesRegister_LocationWise Or rptType = ReportType.SalesRtnRegister_LocationWise Or rptType = ReportType.OpeningStockLocation Or rptType = ReportType.ClosingStockLocation Or rptType = ReportType.BarcodeStockLocation Or rptType = ReportType.StockAtAGlanceLocation Or rptType = ReportType.StockAgingLocation Or rptType = ReportType.ClosingStk_Location Then
            cmbLocation.Enabled = True
        Else
            cmbLocation.Enabled = False
        End If
        
        If rptType = ReportType.PurOrderRegister_DateWise Or rptType = ReportType.PendPurOrderRegister_DateWise Or rptType = ReportType.PurchaseRegister_DateWise Or rptType = ReportType.PurRtnRegister_DateWise Or rptType = ReportType.SalesRegister_DateWise Or rptType = ReportType.SalesRegisterWithRtn_DateWise Or rptType = ReportType.SalesRtnRegister_DateWise Or rptType = ReportType.SalesOrderRegister_DateWise Or rptType = ReportType.PendSalesOrderRegister_DateWise Or rptType = ReportType.PackingRegister_DateWise Or rptType = ReportType.SalesBillRegister_DateWise Or rptType = ReportType.ServiceJobOrderRegister_DateWise Or rptType = ReportType.PendServiceJobOrderRegister_DateWise Or rptType = ReportType.ServiceChallanRegister_DateWise Or rptType = ReportType.ServiceBillRegister_DateWise Then
            chkDispValue.Visible = False
        End If

        If rptType = ReportType.ProcessIsuReg_DateWise Or rptType = ReportType.RetailerWiseSaleOrder Or rptType = ReportType.ProcessDateWise Then
            chkDispValue.Visible = False
        End If
        If rptType = ReportType.FabricLedgerAtJobber Then
            lblText.Visible = True
            txtText.Visible = True
            lblText.Text = "Doc No."


            If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                pnlProduct.Enabled = True
                cmbTax.Enabled = False
                cmbSize.Enabled = False
                cmbType.Enabled = False
                cmbBrand.Enabled = False

            End If

        End If

        If rptType = ReportType.PurchaseRegister_CounterWise Or rptType = ReportType.PurRtnRegister_CounterWise Or rptType = ReportType.SalesRegister_CounterWise Or rptType = ReportType.SalesRtnRegister_CounterWise Then
            lblOperator.Text = "Counter"
            cmbOperator.Enabled = True

            Query = "Select CTR_KEY, ABBR From Counter " _
                & " Where Status = '1' And Abbr <> '' " _
                & BranchFixFilter _
                & " Order By Abbr"
            Common.FillCheckBoxCombo(Query, cmbOperator, "ABBR", "CTR_KEY")
        End If


        If rptType = ReportType.PurchaseRegister_OperatorWise Or rptType = ReportType.PurRtnRegister_OperatorWise Or rptType = ReportType.SalesRegister_OperatorWise Or rptType = ReportType.SalesRtnRegister_OperatorWise Then
            lblOperator.Text = "Operator"
            cmbOperator.Enabled = True

            Query = "Select USER_ID, LED_NAME " _
                & " From Users Inner Join Ledger On Users.Led_Key = Ledger.Led_Key " _
                & " Where Users.Status = '1' And Users.Login_Name <> '' " _
                & " Order By Ledger.Led_Name"
            Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "USER_ID")
        End If

        If rptType = ReportType.SalesOrderRegister_ConsigneeWise Or rptType = ReportType.SalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PackingRegister_ConsigneeWise Or rptType = ReportType.PackingRegister_ConsigneeProdWise Or rptType = ReportType.SalesBillRegister_ConsigneeWise Or rptType = ReportType.SalesBillRegister_ConsigneeProdWise Or rptType = ReportType.SalesOrderRegister_AllInOne Then
            lblOperator.Visible = True
            lblOperator.Text = "Consignee"
            cmbOperator.Visible = True
            cmbOperator.Tag = "Consignee"
            cmbOperator.Enabled = True

            Query = "Select LED_KEY, LED_NAME " _
                  & " From Ledger " _
                  & " Where Led_Cat In('C','D') And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                  & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")
        End If

        If rptType = ReportType.SalesOrderRegister_BrokerWise Or rptType = ReportType.PendSalesOrderRegister_BrokerWise Or rptType = ReportType.SalesBillRegister_BrokerWise Or rptType = ReportType.SalesRtnRegister_BrokerPartyWise Then
            lblOperator.Visible = True
            lblOperator.Text = "Broker"
            cmbOperator.Visible = True
            cmbOperator.Tag = "Broker"
            cmbOperator.Enabled = True

            Query = "Select LED_KEY, LED_NAME " _
                  & " From Ledger " _
                  & " Where Led_Cat = 'B' And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                  & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")
        End If
        If rptType = ReportType.SalesBillRegister_BrokerBrandWise Then
            lblOperator.Visible = True
            lblOperator.Text = "Broker"
            cmbOperator.Visible = True
            cmbOperator.Tag = "Broker"
            cmbOperator.Enabled = True
            cmbBrand.Enabled = True
            pnlProduct.Enabled = True
            lblGroup.Enabled = False : cmbProductGrp.Enabled = False
            lblSubGroup.Enabled = False : cmbProductSubGrp.Enabled = False
            lblProduct.Enabled = False : cmbProduct.Enabled = False
            lblDesign.Enabled = False : cmbStyle.Enabled = False
            lblType.Enabled = False : cmbType.Enabled = False
            lblShade.Enabled = False : cmbShade.Enabled = False
            lblSize.Enabled = False : cmbSize.Enabled = False
            lblQuality.Enabled = False : cmbQuality.Enabled = False
            lblSeason.Enabled = False : cmbSeason.Enabled = False
            lblOccassion.Enabled = False : cmbOccassion.Enabled = False
            lblLocation.Enabled = False : cmbLocation.Enabled = False
            lblBrand.Enabled = True : cmbBrand.Enabled = True
            rdDetailed.Enabled = False
            Query = "Select LED_KEY, LED_NAME " _
                  & " From Ledger " _
                  & " Where Led_Cat = 'B' And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                  & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")
        End If

        If CurrOptionType = OptionType.Customer Or CurrOptionType = OptionType.Supplier Or CurrOptionType = OptionType.Consignee Or CurrOptionType = OptionType.Broker Then
            pnlParty.Enabled = True
        End If


        ''Added by Pooja on 17-08-17
        If rptType = ReportType.PackingRegister_Brokerwise Then
            lblOperator.Visible = True
            lblOperator.Text = "Broker"
            cmbOperator.Visible = True
            cmbOperator.Tag = "Broker"
            cmbOperator.Enabled = True

            Query = "Select LED_KEY, LED_NAME " _
                  & " From Ledger " _
                  & " Where Led_Cat = 'B' And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                  & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")
        End If
        ''EBD
        If rptType = ReportType.SalesBillRegister_SalePersonWise Then
            lblOperator.Visible = True
            lblOperator.Text = "SalesPerson"
            cmbOperator.Visible = True
            cmbOperator.Tag = "SalesPerson"
            cmbOperator.Enabled = True

            Query = "Select LED_KEY, LED_NAME " _
                  & " From Ledger " _
                  & " Where Led_Cat = 'S' And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                  & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")
        End If
        If rptType = ReportType.SalesBillRegister_SalePersonPartyWise Then
            lblOperator.Visible = True
            lblOperator.Text = "SalesPerson"
            cmbOperator.Visible = True
            cmbOperator.Tag = "SalesPerson"
            cmbOperator.Enabled = True
            chkDispRate.Visible = False
            chkDispValue.Visible = False
            Query = "Select LED_KEY, LED_NAME " _
                  & " From Ledger " _
                  & " Where Led_Cat = 'S' And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                  & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")
        End If
        If rptType = ReportType.PendPurOrderRegister_BillWise Or rptType = ReportType.PendPurOrderRegister_DateWise Or rptType = ReportType.PendPurOrderRegister_LocationWise Or rptType = ReportType.PendPurOrderRegister_SupplierWise Or rptType = ReportType.JobWorkPOStatus_Billwise Or rptType = ReportType.JobWorkOrderStatus_Billwise Or rptType = ReportType.PendPurOrderRegister_SubGroupWise Or rptType = ReportType.PendPurOrderRegister_ProductWise Or rptType = ReportType.PendPurOrderRegister_BrandWise Or rptType = ReportType.FabPurOrderRegister_AllInOne Then
            pnlOtherOptions.Visible = True
            rdOthOption3.Checked = True

            rdOthOption1.Text = "Pending"
            rdOthOption2.Text = "Completed"
        End If

        If rptType = ReportType.PendSalesOrderRegister_BillWise Or rptType = ReportType.PendSalesOrderRegister_DateWise Or rptType = ReportType.PendSalesOrderRegister_PartyWise Or rptType = ReportType.PendSalesOrderRegister_PartyProdWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PendSalesOrderRegister_ProductWise Or rptType = ReportType.PendSalesOrderRegister_BrandWise Or rptType = ReportType.PendSalesOrderRegister_BrokerWise Or rptType = ReportType.PendServiceJobOrderRegister_DateWise Or rptType = ReportType.PendServiceJobOrderRegister_BillWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.PendServiceJobOrderRegister_ProductWise Or rptType = ReportType.SalesOrderRegister_AllInOne Then
            pnlOtherOptions.Visible = True
            rdOthOption1.Checked = True

            rdOthOption1.Text = "Pending"
            rdOthOption2.Text = "Completed"
        End If
        If TransType = TransactionType.ProcessDate Or TransType = TransactionType.ProcessDoc Or TransType = TransactionType.ProcessSum  Then
            pnlParty.Visible = False
            pnlHoney.Visible = True
            pnlHoney.Enabled = True
            Query = "Select CAST(PROSTG_ID AS VARCHAR(10))PROSTG_ID, PROSTG_NAME " _
                 & " From PROSTG " _
                 & " Where Status = '1' AND PROSTG_NAME <>''" _
                 & " Order By ProStg_Name"
            Common.FillCheckBoxCombo(Query, cmbProcessHoney, "PROSTG_NAME", "PROSTG_ID")

            Query = "Select LED_KEY, LED_NAME " _
        & " From Ledger Where Led_Cat In ('J','A') And Status = '1' " _
        & BranchFixFilter _
        & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbPartyHoney, "LED_NAME", "LED_KEY")



        End If

        If TransType = TransactionType.JobWorkPO Then
            Query = "Select LED_KEY, LED_NAME " _
                  & " From Ledger Where Led_Cat In ('J','A') And Status = '1' " _
                  & BranchFixFilter _
                  & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbParty, "LED_NAME", "LED_KEY")
        End If
        If TransType = TransactionType.JobWorkOrder Then
            Query = "Select LED_KEY, LED_NAME " _
                  & " From Ledger Where Led_Cat In ('J','A') And Status = '1' " _
                  & BranchFixFilter _
                  & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbParty, "LED_NAME", "LED_KEY")
        End If
        If TransType = TransactionType.StyleCol Or TransType = TransactionType.StyleColSum Then
            pnlParty.Visible = False
            pnlHoney.Visible = False
            pnlHoney.Enabled = False
            '    Query = "Select CAST(PROSTG_ID AS VARCHAR(10))PROSTG_ID, PROSTG_NAME " _
            '         & " From PROSTG " _
            '         & " Where Status = '1' AND PROSTG_NAME <>''" _
            '         & " Order By ProStg_Name"
            '    Common.FillCheckBoxCombo(Query, cmbProcessHoney, "PROSTG_NAME", "PROSTG_ID")

            '    Query = "Select LED_KEY, LED_NAME " _
            '& " From Ledger Where Led_Cat In ('J','A') And Status = '1' " _
            '& BranchFixFilter _
            '& " Order By Led_Name"
            '    Common.FillCheckBoxCombo(Query, cmbPartyHoney, "LED_NAME", "LED_KEY")


        End If
        If TransType = TransactionType.JobCard Or TransType = TransactionType.ProcessIssue Or TransType = TransactionType.ProcessReceipt Or TransType = TransactionType.ProcessLedger Or TransType = TransactionType.ProcessProdnDelay Or TransType = TransactionType.ProcessStkWithParty Or TransType = TransactionType.ProcessShortage Or TransType = TransactionType.SemiProcStkAtWarehouse Or TransType = TransactionType.FabricIssue Or TransType = TransactionType.FabricIssueBack Or TransType = TransactionType.StoresIssue Or TransType = TransactionType.StoresIssueBack Or TransType = TransactionType.FabricStkWithParty Or TransType = TransactionType.StoresStkWithParty Then
            If CurrOptionType = OptionType.DateWise Then
                lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

            ElseIf CurrOptionType = OptionType.Supplier Then
                lstOption1.Items.Add("Jobber")

                If rptType <> ReportType.FabricIsuReg_JobberWise And rptType <> ReportType.StoresIsuReg_JobberWise And rptType <> ReportType.JobCardReg_JobberWise And rptType <> ReportType.JobCardReg_ProcessWise And rptType <> ReportType.JobCardReg_ProductWise And rptType <> ReportType.JobCardReg_SubGroupWise And rptType <> ReportType.JobCardReg_BrandWise And rptType <> ReportType.FabricIsuBkReg_JobberWise And rptType <> ReportType.ProcessLedReg_JobberWise Or rptType = ReportType.FabricRctReg_JobberWise Then  'And rptType <> ReportType.FabricStk_JobberWise SATYAM 29072022
                    If rptType = ReportType.StoresStk_JobberWise Then
                        lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
                    Else
                        lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
                    End If

                End If

            ElseIf CurrOptionType = OptionType.Process Then
                lstOption1.Items.Add("Process")
                If rptType <> ReportType.JobCardReg_ProcessWise Then
                    lstOption2.Items.Add("Jobber")
                End If
            End If

            If TransType = TransactionType.ProcessProdnDelay Or TransType = TransactionType.ProcessStkWithParty Or TransType = TransactionType.FabricStkWithParty Or TransType = TransactionType.SemiProcStkAtWarehouse Or TransType = TransactionType.StoresStkWithParty Then
                ''CHANGE BY RAHUL ON 03/05/2019
                If GetSettingAsPerId(ApplnSettingsIdx.HetherGrey) = "1" And rptType = ReportType.StockLedgerAtJobber Then
                Else
                    dtpFrom.Enabled = False
                    dtpTo.Enabled = False
                End If
                ''END
            End If
        End If

        If rptType = ReportType.SalesOrderRegister_BillWise Or rptType = ReportType.SalesOrderRegister_DateWise Or rptType = ReportType.SalesOrderRegister_PartyWise Or rptType = ReportType.StockReadyToDispatch Or rptType = ReportType.SalesOrderRegister_ProductWise Or rptType = ReportType.SalesOrderRegister_PartyProdWise Or rptType = ReportType.SalesOrderRegister_ConsigneeWise Or rptType = ReportType.SalesOrderRegister_ConsigneeProdWise _
              Or rptType = ReportType.SalesOrderRegister_BrandWise Or rptType = ReportType.SalesOrderRegister_BrokerWise Or rptType = ReportType.PendSalesOrderRegister_BillWise Or rptType = ReportType.PendSalesOrderRegister_BrandWise Or rptType = ReportType.PendSalesOrderRegister_BrokerWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeWise _
               Or rptType = ReportType.PendSalesOrderRegister_DateWise Or rptType = ReportType.PendSalesOrderRegister_PartyProdWise Or rptType = ReportType.PendSalesOrderRegister_PartyWise Or rptType = ReportType.PendSalesOrderRegister_ProductWise Or rptType = ReportType.ServiceJobOrderRegister_DateWise Or rptType = ReportType.ServiceJobOrderRegister_BillWise Or rptType = ReportType.ServiceJobOrderRegister_PartyWise Or rptType = ReportType.ServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.ServiceJobOrderRegister_ProductWise Or rptType = ReportType.PendServiceJobOrderRegister_DateWise Or rptType = ReportType.PendServiceJobOrderRegister_BillWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.PendServiceJobOrderRegister_ProductWise Or rptType = ReportType.SalesOrderReport Or rptType = ReportType.SalesInvoiceReport Then
            If rdDetailed.Checked = True Then
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                    chkSize.Visible = True
                End If
            End If
        End If

        If rptType = ReportType.PurOrderRegister_DateWise Or rptType = ReportType.PurOrderRegister_BillWise Or rptType = ReportType.PurOrderRegister_BrandWise Or rptType = ReportType.PurOrderRegister_SupplierWise Or rptType = ReportType.PurOrderRegister_ProductWise Or rptType = ReportType.PurOrderRegister_SubGroupWise _
            Or rptType = ReportType.PendPurOrderRegister_DateWise Or rptType = ReportType.PendPurOrderRegister_BillWise Or rptType = ReportType.PendPurOrderRegister_BrandWise Or rptType = ReportType.PendPurOrderRegister_SupplierWise Or rptType = ReportType.JobWorkPOStatus_Billwise Or rptType = ReportType.JobWorkOrderStatus_Billwise Or rptType = ReportType.PendPurOrderRegister_ProductWise Or rptType = ReportType.PendPurOrderRegister_SubGroupWise Then
            If rdDetailed.Checked = True Then
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                    chkSize.Visible = True
                End If

                If IsFabric = True Then
                    chkSize.Text = "View Remark"
                End If
                If IsPacking = True Then
                    chkSize.Visible = False
                End If
            End If
        End If

        If rptType = ReportType.PurchaseRegister_DateWise Or rptType = ReportType.PurchaseRegister_BillWise Or rptType = ReportType.PurchaseRegister_BrandWise Or rptType = ReportType.PurchaseRegister_LocationWise Or rptType = ReportType.PurchaseRegister_ProductWise Or rptType = ReportType.PurchaseRegister_SubGroupWise _
            Or rptType = ReportType.PurchaseRegister_SupplierWise Or rptType = ReportType.BarcodeWisePurchase Then
            If rdDetailed.Checked = True Then
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                    chkSize.Visible = True
                End If
            End If
        End If

        rdSummary.Checked = True
        If rptType = ReportType.PendingOrderReport Or rptType = ReportType.PPAccStatus Or rptType = ReportType.PPFABStatus Then
            chkDispValue.Checked = True
        End If
        If rptType = ReportType.ProcessDateWise Then
            chkDispRate.Visible = False
            chkDispValue.Visible = True
            chkDispRate.Checked = False
            chkDispValue.Text = "Isu"
        End If
        If rptType = ReportType.JobOrderStatus Then
            chkDispRate.Visible = False
            chkDispValue.Visible = False
            chkDispRate.Checked = False
            pnlParty.Visible = False
            pnlDate.Enabled = False
            pnlSummaryDetail.Enabled = False
        End If
        'pnlOptions.Visible = True

    End Sub

    Private Sub ForStockRegister()
        pnlDate.Enabled = False
        cmbOperator.Enabled = False
        cmbTax.Enabled = False
        'cmbLocation.Enabled = False

        If rptType <> ReportType.DesignWiseStockWithImages Then
            lblQty.Visible = True
            cmbDisplay.Visible = True
            cmbDisplay.SelectedIndex = 2
            txtStkFrom.Visible = True

        End If

        txtStkFrom.Text = 0
        txtStkTo.Visible = False

        chkDispRate.Visible = True
        chkDispValue.Visible = True

        'pnlRateType.Visible = True
        'pnlRateType.Enabled = False

        If CurrOptionType = OptionType.Location Then
            EnableFilters(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation), True)
        End If

        If CurrOptionType = OptionType.SubGroup Then
            If rptType = ReportType.FastMovingSupplier Or rptType = ReportType.FastMovingSubGroup Or rptType = ReportType.FastMovingProduct Or _
                rptType = ReportType.SlowMovingSupplier Or rptType = ReportType.SlowMovingSubGroup Or rptType = ReportType.SlowMovingProduct Or rptType = ReportType.DeadStock Then
            Else
                lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
            End If

        ElseIf CurrOptionType = OptionType.Product Then
            If rptType = ReportType.FastMovingSupplier Or rptType = ReportType.FastMovingSubGroup Or rptType = ReportType.FastMovingProduct Or _
                rptType = ReportType.SlowMovingSupplier Or rptType = ReportType.SlowMovingSubGroup Or rptType = ReportType.SlowMovingProduct Or rptType = ReportType.DeadStock Then
            Else
                lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
            End If

        ElseIf CurrOptionType = OptionType.Brand Then
            lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))
        ElseIf CurrOptionType = OptionType.Location Then
            lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation))
        ElseIf CurrOptionType = OptionType.Supplier Then
            If rptType = ReportType.FastMovingSupplier Or rptType = ReportType.FastMovingSubGroup Or rptType = ReportType.FastMovingProduct Or _
                rptType = ReportType.SlowMovingSupplier Or rptType = ReportType.SlowMovingSubGroup Or rptType = ReportType.SlowMovingProduct Or rptType = ReportType.DeadStock Then
            Else
                lstOption1.Items.Add("Supplier")
            End If
        ElseIf CurrOptionType = OptionType.Customer Then
            lstOption1.Items.Add("Customer")
        End If

        'lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
        'lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
        'lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))

        pnlProduct.Enabled = False
        If ProductOptions = True Or CurrOptionType = OptionType.SubGroup Or CurrOptionType = OptionType.Group Or CurrOptionType = OptionType.Product Or CurrOptionType = OptionType.Style Or CurrOptionType = OptionType.Type Or CurrOptionType = OptionType.Shade Or CurrOptionType = OptionType.Size Or CurrOptionType = OptionType.Brand Or CurrOptionType = OptionType.Quality Or CurrOptionType = OptionType.Season Or CurrOptionType = OptionType.Occassion Then
            pnlProduct.Enabled = True
        End If

        pnlParty.Enabled = False
        If CurrOptionType = OptionType.Supplier Or CurrOptionType = OptionType.Customer Then
            pnlParty.Enabled = True
        End If

        pnlStock.Visible = True
        If IsFinished Then
            If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                chkSize.Visible = True
            End If
        End If

        If rptType = ReportType.BarcodeStockSubGroup Or rptType = ReportType.BarcodeStockProduct Or rptType = ReportType.BarcodeStockBrand Or rptType = ReportType.BarcodeStockSupplier Or rptType = ReportType.BarcodeStockLocation Or rptType = ReportType.JobWorkPPWise Then
            chkSize.Visible = False

            btnDetail.Enabled = False
            btnUp.Enabled = False
            btnDown.Enabled = False
            btnDelDetail.Enabled = False
            lstDetails.Enabled = False
            pnlRateType.Visible = True
            cmbrate.Visible = True

        End If

        If rptType = ReportType.StockAtAGlanceSubGroup Or rptType = ReportType.StockAtAGlanceProduct Or rptType = ReportType.StockAtAGlanceBrand Or rptType = ReportType.StockAtAGlanceSupplier Or rptType = ReportType.StockAtAGlanceLocation Or rptType = ReportType.StockAtAGlanceCustomer Then
            lstOption3.Enabled = False
            btnGrp3.Enabled = False
            btnDelGrp3.Enabled = False
            chkSize.Visible = True
            chkSize.Text = "Shade Wise"
            

            txtStkTo.Visible = False
            chkDispRate.Visible = False
            chkDispValue.Visible = False
            pnlRateType.Visible = False

            If rptType = ReportType.StockAtAGlanceSubGroup Then
                lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
            End If

            If rptType = ReportType.StockAtAGlanceProduct Then
                lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))
            End If

            If rptType = ReportType.StockAtAGlanceBrand Then
                lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
            End If

            If rptType = ReportType.StockAtAGlanceLocation Then
                lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
            End If

            If rptType = ReportType.StockAtAGlanceSupplier Then
                lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
            End If

            If rptType = ReportType.StockAtAGlanceCustomer Then
                lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
            End If

            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
        End If

        If rptType = ReportType.ClosingStockSubGroup Or rptType = ReportType.ClosingStockProduct Or rptType = ReportType.ClosingStockBrand Or rptType = ReportType.ClosingStockLocation Or rptType = ReportType.ClosingStockSupplier Then
            btnGrp3.Enabled = False
            btnDelGrp3.Enabled = False


            If rptType = ReportType.ClosingStockSubGroup Then
                '  DisplayChartOption()

            End If
        End If

        If rptType = ReportType.StockLedger Then
            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                pnlDate.Enabled = True

                lblQuality.Visible = False
                cmbQuality.Visible = False
                lblSeason.Visible = False
                cmbSeason.Visible = False
                lblOccassion.Visible = False
                cmbOccassion.Visible = False
                lblLocation.Visible = False
                cmbLocation.Visible = False

                lblText.Visible = True
                txtText.Visible = True

                txtStkFrom.Visible = False
                chkSize.Visible = False
                lblQty.Visible = False
                cmbDisplay.Visible = False
                txtStkTo.Visible = False
                chkDispRate.Visible = False
                chkDispValue.Visible = False
                pnlRateType.Visible = False
                lblSaleOrder.Visible = True
                cmbSONo.Visible = True
                rdDetailed.Checked = True
                pnlSummaryDetail.Enabled = False
            Else
                pnlDate.Enabled = True

                lblQuality.Visible = False
                cmbQuality.Visible = False
                lblSeason.Visible = False
                cmbSeason.Visible = False
                lblOccassion.Visible = False
                cmbOccassion.Visible = False
                lblLocation.Visible = False
                cmbLocation.Visible = False

                lblText.Visible = True
                txtText.Visible = True

                txtStkFrom.Visible = False
                chkSize.Visible = False
                lblQty.Visible = False
                cmbDisplay.Visible = False
                txtStkTo.Visible = False
                chkDispRate.Visible = False
                chkDispValue.Visible = False
                pnlRateType.Visible = False
                lblSaleOrder.Visible = False
                cmbSONo.Visible = False
                rdDetailed.Checked = True
                pnlSummaryDetail.Enabled = False
            End If
        End If
        If rptType = ReportType.stockledgerlocation Then

            pnlDate.Enabled = True
            lblLocation.Enabled = True : cmbLocation.Enabled = True

            lblQuality.Visible = False
            cmbQuality.Visible = False
            lblSeason.Visible = False
            cmbSeason.Visible = False
            lblOccassion.Visible = False
            cmbOccassion.Visible = False
            lblLocation.Visible = True
            cmbLocation.Visible = True

            lblText.Visible = True
            txtText.Visible = True

            txtStkFrom.Visible = False
            chkSize.Visible = False
            lblQty.Visible = False
            cmbDisplay.Visible = False
            txtStkTo.Visible = False
            chkDispRate.Visible = False
            chkDispValue.Visible = False
            pnlRateType.Visible = False


        End If

        If rptType = ReportType.StyleCosting Then
            pnlDate.Enabled = True

            lblQuality.Visible = False
            cmbQuality.Visible = False
            lblSeason.Visible = True
            cmbSeason.Visible = True
            lblOccassion.Visible = False
            cmbOccassion.Visible = False
            lblLocation.Visible = False
            cmbLocation.Visible = False

            lblText.Visible = False
            txtText.Visible = False
            cmbSize.Visible = False
            lblSize.Visible = False
            txtStkFrom.Visible = False
            chkSize.Visible = False
            lblQty.Visible = False
            cmbDisplay.Visible = False
            txtStkTo.Visible = False
            chkDispRate.Visible = False
            chkDispValue.Visible = False
            pnlRateType.Visible = False
            pnlSummaryDetail.Visible = False
            pnlSummaryDetail.Enabled = False


        End If

        If rptType = ReportType.Physical_Stock Or rptType = ReportType.Physical_StockShort Or rptType = ReportType.Physical_StockExcess Then
            pnlDate.Enabled = False

            lblQuality.Visible = False
            cmbQuality.Visible = False
            lblSeason.Visible = False
            cmbSeason.Visible = False
            lblOccassion.Visible = False
            cmbOccassion.Visible = False
            lblLocation.Visible = False
            cmbLocation.Visible = False

            txtStkFrom.Visible = False
            chkSize.Visible = False
            lblQty.Visible = False
            cmbDisplay.Visible = False
            txtStkTo.Visible = False
            chkDispRate.Visible = False
            chkDispValue.Visible = False
            pnlRateType.Visible = False
            lblBrand.Visible = False : cmbBrand.Visible = False

        End If

        If rptType = ReportType.StockAsOnPrevDate Then
            pnlDate.Enabled = True

            lblQuality.Visible = False
            cmbQuality.Visible = False
            lblSeason.Visible = False
            cmbSeason.Visible = False
            lblOccassion.Visible = False
            cmbOccassion.Visible = False
            lblLocation.Visible = False
            cmbLocation.Visible = False
            pnlRateType.Visible = True
            txtStkFrom.Visible = False
            chkSize.Visible = False
            lblQty.Visible = False
            cmbDisplay.Visible = False
            txtStkTo.Visible = False
            'chkDispValue.Visible = True
            chkDispRate.Visible = True

        End If

        If rptType = ReportType.FastMovingSupplier Or rptType = ReportType.RetailerWiseSaleOrder Or rptType = ReportType.FastMovingSubGroup Or rptType = ReportType.FastMovingProduct Or _
                rptType = ReportType.SlowMovingSupplier Or rptType = ReportType.SlowMovingSubGroup Or rptType = ReportType.SlowMovingProduct Or rptType = ReportType.DeadStock Then

            pnlStock.Visible = False
            chkSize.Visible = False

            btnGrp1.Enabled = False
            btnDelGrp1.Enabled = False
            lstOption1.Enabled = False

            btnGrp2.Enabled = False
            btnDelGrp2.Enabled = False
            lstOption2.Enabled = False

            btnGrp3.Enabled = False
            btnDelGrp3.Enabled = False
            lstOption3.Enabled = False
            pnlSummaryDetail.Enabled = True

            pnlParty.Enabled = False
            pnlProduct.Enabled = False
            If CurrOptionType = OptionType.Supplier Then
                pnlParty.Enabled = True
            Else
                pnlProduct.Enabled = True
            End If

            lstDetails.Items.Clear()
            If CurrOptionType = OptionType.Supplier Then
                lstDetails.Items.Add("Supplier")
            ElseIf CurrOptionType = OptionType.SubGroup Then
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
            ElseIf CurrOptionType = OptionType.Product Then
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
            End If
        End If

        If rptType = ReportType.StockAgingSubGroup Or rptType = ReportType.StockAgingProduct Or rptType = ReportType.StockAgingBrand Or rptType = ReportType.StockAgingSupplier Or rptType = ReportType.StockAgingBarcode Then
            btnGrp2.Enabled = False
            btnDelGrp2.Enabled = False

            btnGrp3.Enabled = False
            btnDelGrp3.Enabled = False

            pnlStock.Visible = True
            chkSize.Visible = False

            cmbDisplay.Visible = False
            lblQty.Visible = False
            txtStkFrom.Visible = False
            txtStkTo.Visible = False
            chkDispRate.Visible = False
            pnlAgingParam.Visible = True
            lblAgingOn.Visible = True

            pnlDate.Enabled = True
            dtpTo.Enabled = False
            dtpFrom.Value = Now.Date

            lstDetails.Items.Clear()
            'If rptType = ReportType.StockAgingSubGroup Then
            '    lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
            'End If

            If rptType = ReportType.StockAgingProduct Or rptType = ReportType.StockAgingSubGroup Or rptType = ReportType.StockAgingBrand Or rptType = ReportType.StockAgingSupplier Then
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
            End If

            'If rptType = ReportType.StockAgingBrand Then
            '    lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
            'End If

            'If rptType = ReportType.StockAgingSupplier Then
            '    lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
            'End If

            If rptType = ReportType.StockAgingBarcode Then
                lstOption1.Items.Clear()
                If rptType = ReportType.StockAgingBrand Then
                    lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))
                ElseIf rptType = ReportType.StockAgingSupplier Then
                    lstOption1.Items.Add("Supplier")
                Else
                    lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
                End If
                lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

                btnGrp2.Enabled = True
                btnDelGrp2.Enabled = True

                btnDetail.Enabled = False
                btnDelDetail.Enabled = False
                btnUp.Enabled = False
                btnDown.Enabled = False
            End If
        End If

        If rptType = ReportType.StockUnsold Then
            pnlDate.Enabled = True
            pnlStock.Visible = False
            chkSize.Visible = False
        End If

        If rptType = ReportType.StockNotYetSold Then
            pnlDate.Enabled = False
            pnlStock.Visible = False
            chkSize.Visible = False
        End If

        If rptType = ReportType.StockStatement Then
            pnlDate.Enabled = True
            pnlStock.Visible = True
            chkSize.Visible = False
            chkDispValue.Visible = True
            pnlRateType.Visible = True
            cmbDisplay.Visible = False
            txtStkFrom.Visible = False
            txtStkTo.Visible = False
            chkDispRate.Visible = False
            lblQty.Visible = False
        End If

        If rptType = ReportType.PendSalesOrderCrossTab_StyleWise Or rptType = ReportType.PendSalesOrderCrossTab_Stock Or rptType = ReportType.PendSalesOrderCrossTab_StylePartyWise Or rptType = ReportType.PendSalesOrderCrossTab_StylePartyConsigneeWise Or rptType = ReportType.PendSalesOrderCrossTab_PartyStyleWise _
                Or rptType = ReportType.PendSalesOrderCrossTab_PartySizeWise Or rptType = ReportType.PendSalesOrderCrossTab_PartyConsigneeWise _
                Or rptType = ReportType.SalesOrderCrossTab_StyleWise Or rptType = ReportType.RetailerWiseSaleOrder_design Or rptType = ReportType.SalesOrderCrossTab_StylePartyWise Or rptType = ReportType.SalesOrderCrossTab_StylePartyConsigneeWise Or rptType = ReportType.SalesOrderCrossTab_PartyStyleWise Or rptType = ReportType.SalesOrderCrossTab_PartySizeWise Or rptType = ReportType.SalesOrderpackingCrossTab_StylePartyConsigneeWise Or rptType = ReportType.PackingCrossTab_StyleWise Or rptType = ReportType.PackingCrossTab_StylePartyWise Or rptType = ReportType.PackingCrossTab_PartyStyleWise Or rptType = ReportType.PackingCrossTab_PartySizeWise Or rptType = ReportType.PendSalesOrderCrossTab_PartyConsigneeWiseStyle Or rptType = ReportType.SalesOrderCrossTab_PartyConsigneeStyleWise Then

            pnlDate.Enabled = True
            If rptType = ReportType.PendSalesOrderCrossTab_Stock Then
                pnlDate.Enabled = False
                pnlStock.Visible = False
            End If
            chkDispValue.Visible = False
            chkDispRate.Visible = False
        End If

        If rptType = ReportType.PendSalesOrderCrossTab_PartyConsigneeWise Or rptType = ReportType.PendSalesOrderCrossTab_StylePartyConsigneeWise Or rptType = ReportType.SalesOrderCrossTab_StylePartyConsigneeWise Or rptType = ReportType.PendSalesOrderCrossTab_PartyConsigneeWiseStyle Or rptType = ReportType.SalesOrderCrossTab_PartyConsigneeStyleWise Then
            cmbOperator.Enabled = True
            lblOperator.Text = "Consignee"
        End If


        If rptType = ReportType.SalesOrderRegister_BillWise Or rptType = ReportType.SalesOrderRegister_DateWise Or rptType = ReportType.SalesOrderRegister_PartyWise Or rptType = ReportType.StockReadyToDispatch Or rptType = ReportType.SalesOrderRegister_ProductWise Or rptType = ReportType.SalesOrderRegister_PartyProdWise Or rptType = ReportType.SalesOrderRegister_ConsigneeWise Or rptType = ReportType.SalesOrderRegister_ConsigneeProdWise _
          Or rptType = ReportType.SalesOrderRegister_BrandWise Or rptType = ReportType.SalesOrderRegister_BrokerWise Or rptType = ReportType.PendSalesOrderRegister_BillWise Or rptType = ReportType.PendSalesOrderRegister_BrandWise Or rptType = ReportType.PendSalesOrderRegister_BrokerWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeWise _
           Or rptType = ReportType.PendSalesOrderRegister_DateWise Or rptType = ReportType.PendSalesOrderRegister_PartyProdWise Or rptType = ReportType.PendSalesOrderRegister_PartyWise Or rptType = ReportType.PendSalesOrderRegister_ProductWise Or rptType = ReportType.ServiceJobOrderRegister_DateWise Or rptType = ReportType.ServiceJobOrderRegister_BillWise Or rptType = ReportType.ServiceJobOrderRegister_PartyWise Or rptType = ReportType.ServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.ServiceJobOrderRegister_ProductWise Or rptType = ReportType.PendServiceJobOrderRegister_DateWise Or rptType = ReportType.PendServiceJobOrderRegister_BillWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.PendServiceJobOrderRegister_ProductWise Then
            If rdDetailed.Checked = True Then
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                    chkSize.Visible = True
                End If
            End If
        End If

        If rptType = ReportType.PurOrderRegister_DateWise Or rptType = ReportType.PurOrderRegister_BillWise Or rptType = ReportType.PurOrderRegister_BrandWise Or rptType = ReportType.PurOrderRegister_SupplierWise Or rptType = ReportType.PurOrderRegister_ProductWise Or rptType = ReportType.PurOrderRegister_SubGroupWise _
            Or rptType = ReportType.PendPurOrderRegister_DateWise Or rptType = ReportType.PendPurOrderRegister_BillWise Or rptType = ReportType.PendPurOrderRegister_BrandWise Or rptType = ReportType.PendPurOrderRegister_SupplierWise Or rptType = ReportType.JobWorkPOStatus_Billwise Or rptType = ReportType.JobWorkOrderStatus_Billwise Or rptType = ReportType.PendPurOrderRegister_ProductWise Or rptType = ReportType.PendPurOrderRegister_SubGroupWise Or rptType = ReportType.PurOrderRegisterAsPerPurchase_DateWise Then
            If rdDetailed.Checked = True Then
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                    chkSize.Visible = True
                End If
            End If
        End If

        If rptType = ReportType.PurchaseRegister_DateWise Or rptType = ReportType.PurchaseRegister_BillWise Or rptType = ReportType.PurchaseRegister_BrandWise Or rptType = ReportType.PurchaseRegister_LocationWise Or rptType = ReportType.PurchaseRegister_ProductWise Or rptType = ReportType.PurchaseRegister_SubGroupWise _
            Or rptType = ReportType.PurchaseRegister_SupplierWise Or rptType = ReportType.BarcodeWisePurchase Then
            If rdDetailed.Checked = True Then
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                    chkSize.Visible = True
                End If
            End If
        End If

        ''ADDED BY RAHUL ON 11/02/2019
        If rptType = ReportType.StockLedgerFab Then
            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                pnlDate.Enabled = False
                lblQuality.Visible = False
                cmbQuality.Visible = False
                lblSeason.Visible = False
                cmbSeason.Visible = False
                lblType.Visible = False
                cmbType.Visible = False
                lblSize.Visible = False
                cmbSize.Visible = False
                lblBrand.Visible = False
                cmbBrand.Visible = False
                lblOccassion.Visible = False
                cmbOccassion.Visible = False
                lblLocation.Visible = False
                cmbLocation.Visible = False

                ''lblText.Visible = True
                ''txtText.Visible = True

                txtStkFrom.Visible = False
                chkSize.Visible = False
                lblQty.Visible = False
                cmbDisplay.Visible = False
                txtStkTo.Visible = False
                chkDispRate.Visible = False
                chkDispValue.Visible = False
                pnlRateType.Visible = False
                lblSaleOrder.Visible = True
                cmbSONo.Visible = True
                rdDetailed.Checked = True
                pnlSummaryDetail.Enabled = False
                pnlProduct.Enabled = False
            Else
                pnlDate.Enabled = True
                lblQuality.Visible = False
                cmbQuality.Visible = False
                lblSeason.Visible = False
                cmbSeason.Visible = False
                lblType.Visible = False
                cmbType.Visible = False
                lblSize.Visible = False
                cmbSize.Visible = False
                lblBrand.Visible = False
                cmbBrand.Visible = False
                lblOccassion.Visible = False
                cmbOccassion.Visible = False
                lblLocation.Visible = False
                cmbLocation.Visible = False

                ''lblText.Visible = True
                ''txtText.Visible = True

                txtStkFrom.Visible = False
                chkSize.Visible = False
                lblQty.Visible = False
                cmbDisplay.Visible = False
                txtStkTo.Visible = False
                chkDispRate.Visible = False
                chkDispValue.Visible = False
                pnlRateType.Visible = False
                lblSaleOrder.Visible = False
                cmbSONo.Visible = False
                rdDetailed.Checked = True
                pnlSummaryDetail.Enabled = False
            End If
        End If
        ''END

        ''ADDED BY RAHUL ON 18/07/2019
        If rptType = ReportType.StockLedgerAcc Then
            If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
                pnlDate.Enabled = True

                lblQuality.Visible = False
                cmbQuality.Visible = False
                lblSeason.Visible = False
                cmbSeason.Visible = False
                lblType.Visible = False
                cmbType.Visible = False
                lblSize.Visible = False
                cmbSize.Visible = False
                lblBrand.Visible = False
                cmbBrand.Visible = False
                lblOccassion.Visible = False
                cmbOccassion.Visible = False
                lblLocation.Visible = False
                cmbLocation.Visible = False

                ''lblText.Visible = True
                ''txtText.Visible = True

                txtStkFrom.Visible = False
                chkSize.Visible = False
                lblQty.Visible = False
                cmbDisplay.Visible = False
                txtStkTo.Visible = False
                chkDispRate.Visible = False
                chkDispValue.Visible = False
                pnlRateType.Visible = False
                lblSaleOrder.Visible = True
                cmbSONo.Visible = True
                rdDetailed.Checked = True
                pnlSummaryDetail.Enabled = False
            Else
                pnlDate.Enabled = True

                lblQuality.Visible = False
                cmbQuality.Visible = False
                lblSeason.Visible = False
                cmbSeason.Visible = False
                lblType.Visible = False
                cmbType.Visible = False
                lblSize.Visible = False
                cmbSize.Visible = False
                lblBrand.Visible = False
                cmbBrand.Visible = False
                lblOccassion.Visible = False
                cmbOccassion.Visible = False
                lblLocation.Visible = False
                cmbLocation.Visible = False

                ''lblText.Visible = True
                ''txtText.Visible = True

                txtStkFrom.Visible = False
                chkSize.Visible = False
                lblQty.Visible = False
                cmbDisplay.Visible = False
                txtStkTo.Visible = False
                chkDispRate.Visible = False
                chkDispValue.Visible = False
                pnlRateType.Visible = False
                lblSaleOrder.Visible = False
                cmbSONo.Visible = False
                rdDetailed.Checked = True
                pnlSummaryDetail.Enabled = False
            End If
        End If
        ''END

        If rptType = ReportType.DesignWiseStockWithImages Then
            chkSize.Visible = False
            chkDispRate.Text = "Small Image"
            chkDispValue.Text = "Large Image"
            chkSize.Text = "Without Stock"

            pnlOtherOptions.Visible = True



            rdOthOption2.Checked = True

            rdOthOption1.Text = "(Ready+WIP) Stock"
            rdOthOption2.Text = "Ready Stock"
            rdOthOption3.Text = "WIP Stock"
            chkDesignAsperStock.Visible = True
            If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForHoneyDew)) = 1 Then
                BtnStockExportToExcel.Visible = True
            Else
                BtnStockExportToExcel.Visible = False
            End If

        End If

        If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForBodysize)) = 1 Then
            If rptType = ReportType.StockAtAGlanceProduct Then
                chkDispRate.Visible = True
                chkDispRate.BringToFront()
                chkDispRate.Text = "Stock At Glance Size DozenWise"
                chkDispRate.Location = New Point(10, 49)
                chkDispRate.Checked = False
                lblQty.Visible = False : cmbDisplay.SelectedIndex = 0 : cmbDisplay.Visible = False
            End If
        End If
        'If rptType = ReportType.ClosingStk_Brand Then
        '    lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))

        'ElseIf rptType = ReportType.ClosingStk_Product Then
        '    lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

        'ElseIf rptType = ReportType.ClosingStk_SubGroup Then
        '    lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
        'End If
        'pnlOptions.Visible = True
    End Sub

    Private Sub ForStockTfrRegister()
        pnlDate.Enabled = True
        If ProductOptions Then
            pnlProduct.Enabled = True
        End If

        If rptType = ReportType.StockTransfer_TfrIn Or rptType = ReportType.StockTransfer_TfrOut Then
            cmbLocation.Enabled = True
        End If



        'If rptType = ReportType.StockTransfer_TfrOutSalesperson Or rptType = ReportType.StockTransfer_TfrInSalesperson Then
        '    Query = "Select LED_KEY, LED_NAME " _
        '       & " From Ledger " _
        '       & " Where Led_Cat = 'S' And Status =  '1' And Led_Name <> '' " _
        '       & " Order By Led_Name"
        '    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")

        '    cmbOperator.Enabled = True
        '    lblOperator.Text = "Saleperson"
        '    cmbOperator.Tag = "Saleperson"
        'End If
    End Sub

    Private Sub cmbState_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbState.Closed
        If cmbState.IsModified Then
            cmbDistrict.Properties.DataSource = Nothing
            cmbDistrict.SetEditValue("")
            ClearDropDown(cmbDistrict)

            cmbCity.Properties.DataSource = Nothing
            cmbCity.SetEditValue("")
            ClearDropDown(cmbCity)

            cmbStation.Properties.DataSource = Nothing
            cmbStation.SetEditValue("")
            ClearDropDown(cmbStation)

            cmbParty.Properties.DataSource = Nothing
            cmbParty.SetEditValue("")
            ClearDropDown(cmbParty)

            DisplayParty()
            If cmbState.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub

            DisplayDistrict()
            DisplayCity()
            DisplayStation()
            DisplayParty()

            If rptType = ReportType.SalesOrderRegister_AllInOne Then
                DisplayConsigneeHeather()
            End If
        End If

        If rptType = ReportType.SalesOrderReport Or rptType = ReportType.SalesInvoiceReport Then ''ankita 18122018
            If cmbState.IsModified Then


                cmbStation.Properties.DataSource = Nothing
                cmbStation.SetEditValue("")
                ClearDropDown(cmbStation)

                cmbParty.Properties.DataSource = Nothing
                cmbParty.SetEditValue("")
                ClearDropDown(cmbParty)

                If rptType = ReportType.SalesOrderRegister_AllInOne Then
                    cmbOperator.Properties.DataSource = Nothing
                    cmbOperator.SetEditValue("")
                    ClearDropDown(cmbOperator)
                End If

                'DisplayPartyHeather()

                'If cmbState.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub


                DisplayStation()
                DisplayPartyHeather()

                If rptType = ReportType.SalesOrderRegister_AllInOne Then
                    DisplayConsigneeHeather()
                End If
            End If
        End If

    End Sub

    Private Sub cmbDistrict_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbDistrict.Closed
        If cmbDistrict.IsModified Then
            cmbCity.Properties.DataSource = Nothing
            cmbCity.SetEditValue("")
            ClearDropDown(cmbCity)

            cmbStation.Properties.DataSource = Nothing
            cmbStation.SetEditValue("")
            ClearDropDown(cmbStation)

            cmbParty.Properties.DataSource = Nothing
            cmbParty.SetEditValue("")
            ClearDropDown(cmbParty)

            If cmbDistrict.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub

            DisplayCity()
            DisplayStation()
            DisplayParty()
        End If
    End Sub

    Private Sub cmbCity_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbCity.Closed
        If cmbCity.IsModified Then
            cmbStation.Properties.DataSource = Nothing
            cmbStation.SetEditValue("")
            ClearDropDown(cmbStation)

            cmbParty.Properties.DataSource = Nothing
            cmbParty.SetEditValue("")
            ClearDropDown(cmbParty)

            If cmbCity.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub

            DisplayStation()
            DisplayParty()
        End If
    End Sub

    Private Sub DisplayDistrict()
        Dim SelectedItems As String = cmbState.Properties.GetCheckedItems
        Dim AllItems As String = SelectedList(cmbState, SelectedItems)

        If AllItems <> "" Then
            SelectedItems = " And District.State_Key In (" & AllItems & ")"
        Else
            SelectedItems = ""
        End If

        Query = "Select DIST_KEY, DIST_NAME " _
            & " From District Left Join State On District.State_Key = State.State_Key " _
            & " Where District.Status = '1' And District.CoBr_Id = '" & SelBranchFixId & "' And Dist_Name <> '' " _
            & SelectedItems _
            & " Order By Dist_Name"
        Common.FillCheckBoxCombo(Query, cmbDistrict, "DIST_NAME", "DIST_KEY")
    End Sub

    Private Sub DisplayCity()
        Dim SelectedItems As String = cmbState.Properties.GetCheckedItems
        Dim AllState As String = SelectedList(cmbState, SelectedItems)

        If AllState <> "" Then
            AllState = " And District.State_Key In (" & AllState & ")"
        Else
            AllState = ""
        End If

        SelectedItems = cmbDistrict.Properties.GetCheckedItems
        Dim AllDist As String = SelectedList(cmbDistrict, SelectedItems)

        If AllDist <> "" Then
            AllDist = " And City.Dist_Key In (" & AllDist & ")"
        Else
            AllDist = ""
        End If

        Query = "Select CITY_KEY, CITY_NAME " _
            & " From City Left Join District On City.Dist_Key = District.Dist_Key " _
            & " Where City.Status = '1' And City.CoBr_Id = '" & SelBranchFixId & "' And City_Name <> '' " _
            & AllState & AllDist _
            & " Order By City_Name"
        Common.FillCheckBoxCombo(Query, cmbCity, "CITY_NAME", "CITY_KEY")
    End Sub

    Private Sub DisplayStation()

        Dim SelectedItems As String = cmbRegion.Properties.GetCheckedItems
        Dim AllRegion As String = SelectedList(cmbRegion, SelectedItems, True)

        If AllRegion <> "" Then
            AllRegion = " And Country.Regn_Id In (" & AllRegion & ")"
        Else
            AllRegion = ""
        End If

        SelectedItems = cmbCountry.Properties.GetCheckedItems
        Dim AllCont As String = SelectedList(cmbCountry, SelectedItems)

        If AllCont <> "" Then
            AllCont = " And State.Cont_Key In (" & AllCont & ")"
        Else
            AllCont = ""
        End If


        SelectedItems = cmbState.Properties.GetCheckedItems
        Dim AllState As String = SelectedList(cmbState, SelectedItems)

        If AllState <> "" Then
            AllState = " And Station.State_Key In (" & AllState & ")"
        Else
            AllState = ""
        End If

        SelectedItems = cmbDistrict.Properties.GetCheckedItems
        Dim AllDist As String = SelectedList(cmbDistrict, SelectedItems)

        If AllDist <> "" Then
            AllDist = " And City.Dist_Key In (" & AllDist & ")"
        Else
            AllDist = ""
        End If

        SelectedItems = cmbCity.Properties.GetCheckedItems
        Dim AllCity As String = SelectedList(cmbCity, SelectedItems)

        If AllCity <> "" Then
            AllCity = " And Station.City_Key In (" & AllCity & ")"
        Else
            AllCity = ""
        End If

        Query = "Select STN_KEY, STN_NAME " _
            & " From Station Left Join City On Station.City_Key = City.City_Key " _
            & " Left Join District On City.Dist_Key = District.Dist_Key " _
            & " Left Join State On State.State_Key = Station.State_Key " _
            & " Left Join Country On Country.Cont_Key = State.Cont_Key " _
            & " Where Station.Status = '1' And Station.CoBr_Id = '" & SelBranchFixId & "' And Stn_Name <> '' " _
            & AllRegion & AllCont & AllState & AllDist & AllCity _
            & " Order By Stn_Name"
        Common.FillCheckBoxCombo(Query, cmbStation, "STN_NAME", "STN_KEY")
    End Sub

    Private Sub DisplayParty()
        Dim SelectedItems As String = cmbState.Properties.GetCheckedItems
        Dim AllState As String = SelectedList(cmbState, SelectedItems)

        If AllState <> "" Then
            AllState = " And Station.State_Key In (" & AllState & ")"
        Else
            AllState = ""
        End If

        SelectedItems = cmbDistrict.Properties.GetCheckedItems
        Dim AllDist As String = SelectedList(cmbDistrict, SelectedItems)

        If AllDist <> "" Then
            AllDist = " And City.Dist_Key In (" & AllDist & ")"
        Else
            AllDist = ""
        End If

        SelectedItems = cmbCity.Properties.GetCheckedItems
        Dim AllCity As String = SelectedList(cmbCity, SelectedItems)

        If AllCity <> "" Then
            AllCity = " And Station.City_Key In (" & AllCity & ")"
        Else
            AllCity = ""
        End If

        SelectedItems = cmbStation.Properties.GetCheckedItems
        Dim AllStation As String = SelectedList(cmbStation, SelectedItems)

        If AllStation <> "" Then
            AllStation = " And (Ledger.OStn_Key In (" & AllStation & ") Or Ledger.RStn_Key In (" & AllStation & "))"
        Else
            AllStation = ""
        End If


    


        Dim LedgerFltr As String = ""
        Dim StnFltr As String = " From Ledger Left Join Station On Ledger.OStn_Key = Station.Stn_Key "

        'If rptType = ReportType.SalesRegister_SupplierWise Then
        '    LedgerFltr = " And Led_Cat In ('V', 'J', 'O', 'A')"
        'ElseIf TransType = TransactionType.Sales Or TransType = TransactionType.SalesRtn Or rptType = ReportType.CustomerStmt Then
        '    LedgerFltr = " And Led_Cat In ('R', 'W', 'D')"
        '    StnFltr = " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key "
        'ElseIf TransType = TransactionType.Stock Or TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseRtn Or rptType = ReportType.TopNPurchase Or rptType = ReportType.TopSoldItems Then
        '    LedgerFltr = " And Led_Cat In ('V', 'J', 'O', 'A')"
        'End If

        If TransType = TransactionType.StoresIssue Or TransType = TransactionType.StoresIssueBack Or TransType = TransactionType.FabricIssue Or TransType = TransactionType.FabricReceive Or TransType = TransactionType.FabricIssueBack Or TransType = TransactionType.JobCard Or TransType = TransactionType.ProcessIssue Or TransType = TransactionType.ProcessReceipt Or TransType = TransactionType.ProcessLedger Or TransType = TransactionType.ProcessShortage Or TransType = TransactionType.ProcessProdnDelay Or TransType = TransactionType.ProcessStkWithParty Or TransType = TransactionType.SemiProcStkAtWarehouse Or TransType = TransactionType.StoresStkWithParty Or TransType = TransactionType.FabricStkWithParty Or TransType = TransactionType.JobOrder Then
            LedgerFltr = " And Led_Cat In ('J', 'A')"
            StnFltr = " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key  Or Ledger.OStn_Key = Station.Stn_Key  "
        ElseIf rptType = ReportType.StockAtAGlanceCustomer Then
            LedgerFltr = " And Led_Cat In ('R', 'W', 'D')"
            StnFltr = " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key  Or Ledger.OStn_Key = Station.Stn_Key  "
        ElseIf IsSupplier Or TransType = TransactionType.Stock Or TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseRtn Or rptType = ReportType.TopNPurchase Or rptType = ReportType.TopSoldItems Or TransType = TransactionType.PurchaseBill Then ''ankita 24042019

            If rptType = ReportType.FabPurOrderRegister_AllInOne Then
                LedgerFltr = " And Led_Cat In ('V', 'A')"
            Else
                LedgerFltr = " And Led_Cat In ('V', 'J', 'A')"
            End If
        Else
            LedgerFltr = " And Led_Cat In ('R', 'W', 'D')"
            StnFltr = " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key  Or Ledger.OStn_Key = Station.Stn_Key  "
        End If
            'IsSupplier = False

            Query = "Select Distinct LED_KEY, LED_NAME " _
                & StnFltr _
                & " Inner Join City On Station.City_Key = City.City_Key " _
                & " Inner Join District On City.Dist_Key = DIstrict.Dist_Key " _
                & " Where Ledger.Status = '1' And Ledger.CoBr_Id = '" & SelBranchLedFixId & "' And Led_Name <> '' " _
                & AllState & AllDist & AllCity & AllStation & LedgerFltr _
                & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbParty, "LED_NAME", "LED_KEY")
            If rptType = ReportType.ReverseMechanism1 Then

                Query = "Select LED_KEY, LED_NAME " _
                     & " From Ledger " _
                     & " Where Led_Cat IN('T') And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                     & " Order By Led_Name"
                Common.FillCheckBoxCombo(Query, cmbParty, "LED_NAME", "LED_KEY")
        End If

        If rptType = ReportType.JobWorkPOStatus_Billwise Or rptType = ReportType.GoodsRecvAgst_JobWorkPO Or rptType = ReportType.JobWorkOrderStatus_Billwise Or rptType = ReportType.GoodsRecvAgst_JobWorkOrder Or rptType = ReportType.SoFabricIssueAgtJobWorkRpt Or rptType = ReportType.PPStatus Then

            Query = "Select LED_KEY, LED_NAME " _
                & " From Ledger Where Led_Cat In ('J','A') And Status = '1' " _
                & BranchFilter _
                & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbParty, "LED_NAME", "LED_KEY")
        End If
    End Sub
    Private Sub DisplayPartyHeather() ''ankita 18122018

        Dim SelectedItems As String = cmbState.Properties.GetCheckedItems
        Dim AllState As String = SelectedList(cmbState, SelectedItems)

        If AllState <> "" Then
            AllState = " And Station.State_Key In (" & AllState & ")"
        Else
            AllState = ""
        End If

        SelectedItems = cmbCountry.Properties.GetCheckedItems
        Dim AllCountry As String = SelectedList(cmbCountry, SelectedItems)

        If AllCountry <> "" Then
            AllCountry = " And State.Cont_Key In (" & AllCountry & ")"
        Else
            AllCountry = ""
        End If

        SelectedItems = cmbRegion.Properties.GetCheckedItems
        Dim AllRegion As String = SelectedList(cmbRegion, SelectedItems, True)

        If AllRegion <> "" Then
            AllRegion = " And Country.Regn_Id In (" & AllRegion & ")"
        Else
            AllRegion = ""
        End If


        SelectedItems = cmbStation.Properties.GetCheckedItems
        Dim AllStation As String = SelectedList(cmbStation, SelectedItems)

        If AllStation <> "" Then
            AllStation = " And (Ledger.OStn_Key In (" & AllStation & ") Or Ledger.RStn_Key In (" & AllStation & "))"
        Else
            AllStation = ""
        End If

        Dim LedgerFltr As String = ""
        Dim StnFltr As String = " From Ledger Left Join Station On Ledger.OStn_Key = Station.Stn_Key "

        'If rptType = ReportType.SalesRegister_SupplierWise Then
        '    LedgerFltr = " And Led_Cat In ('V', 'J', 'O', 'A')"
        'ElseIf TransType = TransactionType.Sales Or TransType = TransactionType.SalesRtn Or rptType = ReportType.CustomerStmt Then
        '    LedgerFltr = " And Led_Cat In ('R', 'W', 'D')"
        '    StnFltr = " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key "
        'ElseIf TransType = TransactionType.Stock Or TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseRtn Or rptType = ReportType.TopNPurchase Or rptType = ReportType.TopSoldItems Then
        '    LedgerFltr = " And Led_Cat In ('V', 'J', 'O', 'A')"
        'End If

        If TransType = TransactionType.StoresIssue Or TransType = TransactionType.StoresIssueBack Or TransType = TransactionType.FabricIssue Or TransType = TransactionType.FabricIssueBack Or TransType = TransactionType.JobCard Or TransType = TransactionType.ProcessIssue Or TransType = TransactionType.ProcessReceipt Or TransType = TransactionType.ProcessLedger Or TransType = TransactionType.ProcessShortage Or TransType = TransactionType.ProcessProdnDelay Or TransType = TransactionType.ProcessStkWithParty Or TransType = TransactionType.SemiProcStkAtWarehouse Or TransType = TransactionType.StoresStkWithParty Or TransType = TransactionType.FabricStkWithParty Then
            LedgerFltr = " And Led_Cat In ('J', 'A')"
            StnFltr = " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key  Or Ledger.OStn_Key = Station.Stn_Key  "
        ElseIf rptType = ReportType.StockAtAGlanceCustomer Then
            LedgerFltr = " And Led_Cat In ('R', 'W', 'D')"
            StnFltr = " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key  Or Ledger.OStn_Key = Station.Stn_Key  "
        ElseIf IsSupplier Or TransType = TransactionType.Stock Or TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseRtn Or rptType = ReportType.TopNPurchase Or rptType = ReportType.TopSoldItems Then

            If rptType = ReportType.FabPurOrderRegister_AllInOne Then
                LedgerFltr = " And Led_Cat In ('V', 'A')"
            Else
                LedgerFltr = " And Led_Cat In ('V', 'J', 'A')"
            End If

        Else
            LedgerFltr = " And Led_Cat In ('R', 'W', 'D')"
            StnFltr = " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key  Or Ledger.OStn_Key = Station.Stn_Key  "
        End If
        'IsSupplier = False

        Query = "Select Distinct LED_KEY, LED_NAME " _
            & StnFltr _
            & " inner join state on station.state_key  = state.state_key " _
            & " inner join Country on country.cont_key = state.cont_key " _
            & " Where Ledger.Status = '1' And Ledger.CoBr_Id = '" & SelBranchLedFixId & "' And Led_Name <> '' " _
            & AllRegion & AllCountry & AllState & AllStation & LedgerFltr _
            & " Order By Led_Name"
        Common.FillCheckBoxCombo(Query, cmbParty, "LED_NAME", "LED_KEY")

        If rptType = ReportType.ReverseMechanism1 Then

            Query = "Select LED_KEY, LED_NAME " _
                 & " From Ledger " _
                 & " Where Led_Cat IN('T') And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                 & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbParty, "LED_NAME", "LED_KEY")
        End If
    End Sub
    Private Sub DisplayPartyHoney()
        Dim SelectedItems As String = cmbProcessHoney.Properties.GetCheckedItems
        Dim AllProcess As String = SelectedList(cmbProcessHoney, SelectedItems)
        Dim stnFltr As String = ""
        If AllProcess <> "" Then
            AllProcess = " And ProcWiseJobr.PROSTG_ID In (" & AllProcess & ")"
        Else
            AllProcess = ""
        End If
        Query = "Select Ledger.LED_KEY,Ledger.LED_NAME " _
                    & " from ProcWiseJobr  Left Join Ledger on Ledger.Led_key=ProcWiseJobr.Led_key " _
                    & " where(ProcWiseJobr.ProStg_Id <>'0'  " & AllProcess & ")" _
                    & " Order BY ProcJobr_Id"

        Common.FillCheckBoxCombo(Query, cmbPartyHoney, "LED_NAME", "LED_KEY")
    End Sub
    'Private Sub DisplayPartyAsPerOption(ByVal IsSupplier As Boolean)
    '    Dim SelectedItems As String = cmbState.Properties.GetCheckedItems
    '    Dim AllState As String = SelectedList(cmbState, SelectedItems)

    '    If AllState <> "" Then
    '        AllState = " And District.State_Key In (" & AllState & ")"
    '    Else
    '        AllState = ""
    '    End If

    '    SelectedItems = cmbDistrict.Properties.GetCheckedItems
    '    Dim AllDist As String = SelectedList(cmbDistrict, SelectedItems)

    '    If AllDist <> "" Then
    '        AllDist = " And City.Dist_Key In (" & AllDist & ")"
    '    Else
    '        AllDist = ""
    '    End If

    '    SelectedItems = cmbCity.Properties.GetCheckedItems
    '    Dim AllCity As String = SelectedList(cmbCity, SelectedItems)

    '    If AllCity <> "" Then
    '        AllCity = " And Station.City_Key In (" & AllCity & ")"
    '    Else
    '        AllCity = ""
    '    End If

    '    SelectedItems = cmbStation.Properties.GetCheckedItems
    '    Dim AllStation As String = SelectedList(cmbStation, SelectedItems)

    '    If AllStation <> "" Then
    '        AllStation = " And (Ledger.OStn_Key In (" & AllStation & ") Or Ledger.RStn_Key In (" & AllStation & "))"
    '    Else
    '        AllStation = ""
    '    End If

    '    Dim LedgerFltr As String = ""
    '    Dim StnFltr As String = " From Ledger Left Join Station On Ledger.OStn_Key = Station.Stn_Key "

    '    'If  Then
    '    '    LedgerFltr = " And Led_Cat In ('V', 'J', 'O', 'A')"

    '    If IsSupplier Or rptType = ReportType.SalesRegister_SupplierWise Or TransType = TransactionType.Stock Or TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseRtn Or rptType = ReportType.TopNPurchase Or rptType = ReportType.TopSoldItems Then
    '        LedgerFltr = " And Led_Cat In ('V', 'J', 'O', 'A')"
    '    Else 'If TransType = TransactionType.Sales Or TransType = TransactionType.SalesRtn Or rptType = ReportType.CustomerStmt Then
    '        LedgerFltr = " And Led_Cat In ('R', 'W', 'D')"
    '        StnFltr = " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key "
    '    End If

    '    Query = "Select Distinct LED_KEY, LED_NAME " _
    '        & StnFltr _
    '        & " Inner Join City On Station.City_Key = City.City_Key " _
    '        & " Inner Join District On City.Dist_Key = DIstrict.Dist_Key " _
    '        & " Where Ledger.Status = '1' And Ledger.CoBr_Id = '" & SelBranchId & "' And Led_Name <> '' " _
    '        & AllState & AllDist & AllCity & AllStation & LedgerFltr _
    '        & " Order By Led_Name"
    '    Common.FillCheckBoxCombo(Query, cmbParty, "LED_NAME", "LED_KEY")
    'End Sub

    Private Sub DisplayProductSubGroup()
        Dim SelectedItems As String = cmbProductGrp.Properties.GetCheckedItems
        Dim AllItems As String = SelectedList(cmbProductGrp, SelectedItems)

        If AllItems <> "" Then
            SelectedItems = " And ItemSubGrp.ItemGrp_Key In (" & AllItems & ")"
        Else
            SelectedItems = ""
        End If

        Dim FltrType As String = ""
        If IsFabric Then
            FltrType = " And ItemSubGrp_Type = 'G'"
        ElseIf IsFinished Then
            FltrType = " And ItemSubGrp_Type = 'F'"
        ElseIf IsStores Then
            If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" And rptType = ReportType.ClosingStk_Product Then
                FltrType = " And ItemSubGrp_Type In ('P', 'A', 'L')"
            Else
                FltrType = " And ItemSubGrp_Type In ('P', 'A')"
            End If
        End If

            Query = "Select ITEMSUBGRP_KEY, ITEMSUBGRP_NAME " _
                & " From ItemSubGrp Left Join ItemGrp On ItemSubGrp.ItemGrp_Key = ItemGrp.ItemGrp_Key " _
                & " Where ItemSubGrp.Status = '1' And ItemSubGrp.CoBr_Id = '" & SelBranchFixId & "' And ItemSubGrp_Name <> '' " _
                & SelectedItems & FltrType _
                & " Order By ItemSubGrp_Name"
            Common.FillCheckBoxCombo(Query, cmbProductSubGrp, "ITEMSUBGRP_NAME", "ITEMSUBGRP_KEY")
    End Sub

    Private Sub DisplayProduct()
        Dim SelectedItems As String = cmbProductGrp.Properties.GetCheckedItems
        Dim GrpItems As String = SelectedList(cmbProductGrp, SelectedItems)

        If GrpItems <> "" Then
            GrpItems = " And ItemSubGrp.ItemGrp_Key In (" & GrpItems & ")"
        Else
            GrpItems = ""
        End If

        SelectedItems = cmbProductSubGrp.Properties.GetCheckedItems
        Dim AllItems As String = SelectedList(cmbProductSubGrp, SelectedItems)

        If AllItems <> "" Then
            AllItems = " And Item.ItemSubGrp_Key In (" & AllItems & ")"
        Else
            AllItems = ""
        End If

        Dim FltrType As String = ""
        If IsFabric Then
            FltrType = " And Item_Type = 'G'"
        ElseIf IsFinished Then
            FltrType = " And Item_Type = 'F'"
        ElseIf IsStores Then
            If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" And rptType = ReportType.ClosingStk_Product Then
                FltrType = " And Item_Type In ('P', 'A', 'L')"
            Else
                FltrType = " And Item_Type In ('P', 'A')"
            End If
        End If

            Query = "Select ITEM_KEY, ITEM_NAME " _
                & " From Item Left Join ItemSubGrp On Item.ItemSubGrp_Key = ItemSubGrp.ItemSubGrp_Key " _
                & " Where Item.Status = '1' And Item.CoBr_Id = '" & SelBranchFixId & "' And Item_Name <> '' " _
                & GrpItems & AllItems & FltrType _
                & " Order By Item_Name"
            Common.FillCheckBoxCombo(Query, cmbProduct, "ITEM_NAME", "ITEM_KEY")


    End Sub

    Private Sub DisplayBrand()
        Dim SelectedItems As String = cmbProductGrp.Properties.GetCheckedItems
        Dim GrpItems As String = SelectedList(cmbProductGrp, SelectedItems)

        If GrpItems <> "" Then
            GrpItems = " And ItemSubGrp.ItemGrp_Key In (" & GrpItems & ")"
        Else
            GrpItems = ""
        End If


        Query = "Select DISTINCT BRAND.BRAND_KEY BRAND_KEY, BRAND_NAME " _
            & " From Brand Left Join Style On Style.Brand_Key = Brand.Brand_Key Left Join Item On Style.Item_Key = Item.Item_Key " _
            & " Inner Join ItemSubGrp On Item.ItemSubGrp_Key = ItemSubGrp.ItemSubGrp_Key " _
            & " Where Brand.Status = '1' And Brand.CoBr_Id = '" & SelBranchFixId & "' And Brand_Name <> '' " _
            & GrpItems _
            & " Order By BRAND_NAME"
        Common.FillCheckBoxCombo(Query, cmbBrand, "BRAND_NAME", "BRAND_KEY")

    End Sub

    Private Sub DisplayStyle()
        Dim SelectedItems As String = cmbProductGrp.Properties.GetCheckedItems
        Dim GrpItems As String = SelectedList(cmbProductGrp, SelectedItems)

        If GrpItems <> "" Then
            GrpItems = " And ItemSubGrp.ItemGrp_Key In (" & GrpItems & ")"
        Else
            GrpItems = ""
        End If

        SelectedItems = cmbProductSubGrp.Properties.GetCheckedItems
        Dim SubGrpItems As String = SelectedList(cmbProductSubGrp, SelectedItems)

        If SubGrpItems <> "" Then
            SubGrpItems = " And Item.ItemSubGrp_Key In (" & SubGrpItems & ")"
        Else
            SubGrpItems = ""
        End If

        SelectedItems = cmbProduct.Properties.GetCheckedItems
        Dim AllItems As String = SelectedList(cmbProduct, SelectedItems)

        If AllItems <> "" Then
            If rptType = ReportType.DesignWiseStockWithImages And chkDesignAsperStock.Checked = True Then
                SelectedItems = " And vw_DesignWiseStockWithImage.Item_Key In (" & AllItems & ")"
            Else
                SelectedItems = " And Style.Item_Key In (" & AllItems & ")"
            End If
        Else
            SelectedItems = ""
        End If

        'Query = "Select STYLE_KEY, STYLE_CODE + ' - ' + TYPE_NAME STYLE_CODE " _
        '    & " From Style Left Join Item On Style.Item_Key = Item.Item_Key " _
        '    & " Inner Join Type On Style.Type_Key = Type.Type_Key " _
        '    & " Where Style.Status = '1' And Style.CoBr_Id = '" & SelBranchId & "' And Style_Code <> '' " _
        '    & SelectedItems _
        '    & " Order By Style_Code"

        If rptType = ReportType.DesignWiseStockWithImages And chkDesignAsperStock.Checked = True Then
            Query = "Select  CAST((Select MAX(0) From vw_DesignWiseStockWithImage)+ ROW_NUMBER() OVER (ORDER BY S) AS VARCHAR(5)) + '--'+S  STYLE_CODE1, " _
                  & " STYLE_CODE " _
                  & " From (Select DISTINCT vw_DesignWiseStockWithImage.STYLE_CODE S, vw_DesignWiseStockWithImage.STYLE_CODE " _
                  & " From vw_DesignWiseStockWithImage Left Join Item On vw_DesignWiseStockWithImage.Item_Key = Item.Item_Key " _
                  & " Inner Join ItemSubGrp On Item.ItemSubGrp_Key = ItemSubGrp.ItemSubGrp_Key " _
                  & " Where vw_DesignWiseStockWithImage.CoBr_Id = '" & SelBranchFixId & "' And vw_DesignWiseStockWithImage.Style_Code <> '' " _
                  & GrpItems & SubGrpItems & SelectedItems _
                  & " ) AS A Order By S"
            Common.FillCheckBoxCombo(Query, cmbStyle, "STYLE_CODE1", "STYLE_CODE")
        Else
            Query = "Select DISTINCT Style.STYLE_CODE, Style.STYLE_CODE " _
                & " From Style Left Join Item On Style.Item_Key = Item.Item_Key " _
                & " Inner Join ItemSubGrp On Item.ItemSubGrp_Key = ItemSubGrp.ItemSubGrp_Key " _
                & " Where Style.Status = '1' And Style.CoBr_Id = '" & SelBranchFixId & "' And Style.Style_Code <> '' " _
                & GrpItems & SubGrpItems & SelectedItems _
                & " Order By Style.Style_Code"
            Common.FillCheckBoxCombo(Query, cmbStyle, "STYLE_CODE", "STYLE_CODE")
        End If




    End Sub

    Private Sub DisplaySize()
        cmbSize.Properties.DataSource = Nothing
        cmbSize.SetEditValue("")
        ClearDropDown(cmbSize)

        Dim SelectedItems As String = cmbProductGrp.Properties.GetCheckedItems
        Dim GrpItems As String = SelectedList(cmbProductGrp, SelectedItems)

        If GrpItems <> "" Then
            GrpItems = " And ItemSubGrp.ItemGrp_Key In (" & GrpItems & ")"
        Else
            GrpItems = ""
        End If

        SelectedItems = cmbProductSubGrp.Properties.GetCheckedItems
        Dim SubGrpItems As String = SelectedList(cmbProductSubGrp, SelectedItems)

        If SubGrpItems <> "" Then
            SubGrpItems = " And Item.ItemSubGrp_Key In (" & SubGrpItems & ")"
        Else
            SubGrpItems = ""
        End If

        SelectedItems = cmbProduct.Properties.GetCheckedItems
        Dim AllItems As String = SelectedList(cmbProduct, SelectedItems)

        If AllItems <> "" Then
            If rptType = ReportType.OpeningStockSubGroup Or rptType = ReportType.OpeningStockProduct Or rptType = ReportType.OpeningStockBrand Or rptType = ReportType.OpeningStockLocation Or rptType = ReportType.ClosingStockSubGroup Or rptType = ReportType.ClosingStockProduct Or rptType = ReportType.ClosingStockBrand Or rptType = ReportType.ClosingStockSupplier Or rptType = ReportType.ClosingStockLocation Or rptType = ReportType.StockAsOnPrevDate Or rptType = ReportType.StockLedger Or rptType = ReportType.StyleCosting Or _
                rptType = ReportType.BarcodeStockSubGroup Or rptType = ReportType.BarcodeStockProduct Or rptType = ReportType.BarcodeStockBrand Or rptType = ReportType.BarcodeStockSupplier Or rptType = ReportType.BarcodeStockLocation Or rptType = ReportType.StockAtAGlanceSubGroup Or rptType = ReportType.StockAtAGlanceProduct Or rptType = ReportType.StockAtAGlanceBrand Or rptType = ReportType.StockAtAGlanceSupplier Or rptType = ReportType.StockAtAGlanceCustomer Or rptType = ReportType.StockAtAGlanceLocation Or _
                rptType = ReportType.stockledgerlocation Then  'add by pratibha
                SelectedItems = " And Stylesize.Item_Key In (" & AllItems & ")"

            Else
                SelectedItems = " And ItemSize.Item_Key In (" & AllItems & ")"
            End If
        Else
            SelectedItems = ""
        End If

        'If SelectedItems.Trim.Length = 0 Then
        '    'Query = "Select ITEMSIZE_KEY, ITEM_NAME + '-' + SIZE_NAME SIZE_NAME " _
        '    '    & " From ItemSize Inner Join Item On ItemSize.Item_Key = Item.Item_Key " _
        '    '    & " Where ItemSize.Status = '1' And ItemSize.CoBr_Id = '" & SelBranchId & "' And Size_Name <> '' " _
        '    '    & " Order By Size_Name"

        '    Query = "Select DISTINCT SIZE_NAME, SIZE_NAME " _
        '        & " From ItemSize Inner Join Item On ItemSize.Item_Key = Item.Item_Key " _
        '        & " Where ItemSize.Status = '1' And ItemSize.CoBr_Id = '" & SelBranchId & "' And Size_Name <> '' " _
        '        & SelectedItems _
        '        & " Order By Size_Name"
        '    Common.FillCheckBoxCombo(Query, cmbSize, "SIZE_NAME", "ITEMSIZE_KEY")
        'Else

        If rptType = ReportType.OpeningStockSubGroup Or rptType = ReportType.OpeningStockProduct Or rptType = ReportType.OpeningStockBrand Or rptType = ReportType.OpeningStockLocation Or rptType = ReportType.ClosingStockSubGroup Or rptType = ReportType.ClosingStockProduct Or rptType = ReportType.ClosingStockBrand Or rptType = ReportType.ClosingStockSupplier Or rptType = ReportType.ClosingStockLocation Or rptType = ReportType.StockAsOnPrevDate Or rptType = ReportType.StockLedger Or rptType = ReportType.StyleCosting Or _
                rptType = ReportType.BarcodeStockSubGroup Or rptType = ReportType.BarcodeStockProduct Or rptType = ReportType.BarcodeStockBrand Or rptType = ReportType.BarcodeStockSupplier Or rptType = ReportType.BarcodeStockLocation Or rptType = ReportType.StockAtAGlanceSubGroup Or rptType = ReportType.StockAtAGlanceProduct Or rptType = ReportType.StockAtAGlanceBrand Or rptType = ReportType.StockAtAGlanceSupplier Or rptType = ReportType.StockAtAGlanceCustomer Or rptType = ReportType.StockAtAGlanceLocation Or _
                rptType = ReportType.stockledgerlocation Then 'add by pratibha 01-03-2020
            Query = " Select DISTINCT SIZE_NAME, SIZE_NAME " _
                & " From Stylesize Inner Join Item On Stylesize.Item_Key = Item.Item_Key " _
                & " Inner Join ItemSubGrp On Item.ItemSubGrp_Key = ItemSubGrp.ItemSubGrp_Key " _
                & " Inner Join Style On Stylesize.Style_Key = Style.Style_Key " _
                & " Where stylesize.Status = '1' And Size_Name <> '' " _
                & GrpItems & SubGrpItems & SelectedItems _
                & " Order By Stylesize.Size_Name"
            Common.FillCheckBoxCombo(Query, cmbSize, "SIZE_NAME", "SIZE_NAME")
        Else
            Query = "Select DISTINCT SIZE_NAME, SIZE_NAME " _
            & " From ItemSize Inner Join Item On ItemSize.Item_Key = Item.Item_Key " _
            & " Inner Join ItemSubGrp On Item.ItemSubGrp_Key = ItemSubGrp.ItemSubGrp_Key " _
            & " Where ItemSize.Status = '1' And ItemSize.CoBr_Id = '" & SelBranchFixId & "' And Size_Name <> '' " _
            & GrpItems & SubGrpItems & SelectedItems _
            & " Order By ItemSize.Size_Name"
            Common.FillCheckBoxCombo(Query, cmbSize, "SIZE_NAME", "SIZE_NAME")
        End If

        'End If
    End Sub

    Private Sub DisplayType()
        Dim SelectedItems As String = cmbProductGrp.Properties.GetCheckedItems
        Dim GrpItems As String = SelectedList(cmbProductGrp, SelectedItems)

        If GrpItems <> "" Then
            GrpItems = " And ItemSubGrp.ItemGrp_Key In (" & GrpItems & ")"
        Else
            GrpItems = ""
        End If

        SelectedItems = cmbProductSubGrp.Properties.GetCheckedItems
        Dim SubGrpItems As String = SelectedList(cmbProductSubGrp, SelectedItems)

        If SubGrpItems <> "" Then
            SubGrpItems = " And Item.ItemSubGrp_Key In (" & SubGrpItems & ")"
        Else
            SubGrpItems = ""
        End If

        SelectedItems = cmbProduct.Properties.GetCheckedItems
        Dim AllProduct As String = SelectedList(cmbProduct, SelectedItems)

        If AllProduct <> "" Then
            AllProduct = " And Item.Item_Key In (" & AllProduct & ")"
        Else
            AllProduct = ""
        End If


        SelectedItems = cmbStyle.Properties.GetCheckedItems
        Dim AllItems As String = SelectedList(cmbStyle, SelectedItems)

        If AllItems <> "" Then
            AllItems = " And Style_Code In (" & AllItems & ")"
        Else
            AllItems = ""
        End If

        Query = "Select DISTINCT STYLE.TYPE_KEY, TYPE_NAME " _
            & " From STYLE Inner Join Type On Style.Type_Key = Type.Type_Key " _
            & " Inner Join Item On Style.Item_Key = Item.Item_Key " _
            & " Inner Join ItemSubGrp On Item.ItemSubGrp_Key = ItemSubGrp.ItemSubGrp_Key " _
            & " Where Type.Status = '1' And Type.CoBr_Id = '" & SelBranchFixId & "' And Type_Name <> '' " _
            & GrpItems & SubGrpItems & AllProduct & AllItems _
            & " Order By Type_Name"
        Common.FillCheckBoxCombo(Query, cmbType, "TYPE_NAME", "TYPE_KEY")
    End Sub

    Private Function SelectedList(ByVal Combo As Object, ByVal SelectedItems As String, Optional ByVal IsNumber As Boolean = False) As String
        Dim AllItems() As String = Split(SelectedItems, ",")

        If SelectedItems = "" Then Return ""

        Dim NewItemList As String = ""
        Dim obj As Object

        For Each obj In AllItems
            If IsNumber Then
                NewItemList &= Trim(obj) & ","
            Else
                NewItemList &= Trim(obj) & "','"
            End If
        Next obj

        If NewItemList.Trim.Length > 0 Then
            If IsNumber Then
                NewItemList = Mid$(NewItemList, 1, Len(NewItemList) - 1)
                NewItemList = NewItemList
            Else
                NewItemList = Mid$(NewItemList, 1, Len(NewItemList) - 2)
                NewItemList = "'" & NewItemList
            End If
        End If

        Return NewItemList
    End Function

    Private Sub ClearDropDown(ByVal Combo As Object)
        Dim i As Short

        If Combo.Properties.Items.Count > 0 Then
            For i = Combo.Properties.Items.Count - 1 To 0 Step -1
                Combo.Properties.Items.Remove(Combo.Properties.Items(i))
            Next i
        End If
    End Sub

    Private Sub cmbStation_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbStation.Closed
        If cmbStation.IsModified Then

            cmbParty.Properties.DataSource = Nothing
            cmbParty.SetEditValue("")
            ClearDropDown(cmbParty)

            If rptType = ReportType.SalesOrderRegister_AllInOne Then
                cmbOperator.Properties.DataSource = Nothing
                cmbOperator.SetEditValue("")
                ClearDropDown(cmbOperator)
            End If

            'If cmbStation.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub

            DisplayParty()
            If rptType = ReportType.SalesInvoiceReport Or rptType = ReportType.SalesOrderRegister_AllInOne Then
                DisplayPartyHeather()
                DisplayConsigneeHeather()
            End If

            If rptType = ReportType.SalesOrderStatusANS Or rptType = ReportType.SalesOrderRegister_AllInOneANS Or rptType = ReportType.OCPendingStatus Or rptType = ReportType.BuyerProgressChart Then
                DisplayPartyHeather()
            End If

            If rptType = ReportType.FabPurOrderRegister_AllInOne Then
                DisplayPartyHeather()
            End If
        End If
    End Sub

    Private Sub btnView_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles btnView.Click
        Dim frmView As Form
        Dim FromToDt1 As String = ""
        Try
            ''ROhit 01092017
            If rptType = ReportType.GSTR1 Then
                Dim Trans As SqlTransaction
                Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
                Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
                Query = "Select GSTNo from cobr where cobr_id=  " & SelBranchLedFixId
                Dim GST As String = Common.ExecuteScalar(Query, Trans)
                Query = "Select Left(GSTNo,2) from cobr where cobr_id=  " & SelBranchLedFixId
                Dim GSTDigit As String = Common.ExecuteScalar(Query, Trans)

                Dim xlApp As New Excel.Application
                'MessageBox.Show("First")
                Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
                Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
                Dim Reg As String = ""
                If cmbSelection.SelectedIndex = 1 Or cmbSelection.SelectedIndex = 2 Then
                    xlSheet.Cells(1, 1) = "Sr No."
                    xlSheet.Cells(1, 2) = "Place of Supply"
                    xlSheet.Cells(1, 3) = "Taxable" & vbLf & "Value"
                    xlSheet.Cells(1, 4) = "Taxable" & vbLf & "5%"
                    xlSheet.Cells(1, 5) = "CGST" & vbLf & " 2.5%"
                    xlSheet.Cells(1, 6) = "SGST" & vbLf & " 2.5%"
                    xlSheet.Cells(1, 7) = "IGST " & vbLf & "5%"
                    xlSheet.Cells(1, 8) = "Taxable" & vbLf & " 12%"
                    xlSheet.Cells(1, 9) = "CGST" & vbLf & " 6%"
                    xlSheet.Cells(1, 10) = "SGST" & vbLf & " 6%"
                    xlSheet.Cells(1, 11) = "IGST " & vbLf & "12%"
                    xlSheet.Cells(1, 12) = "Taxable" & vbLf & " 18%"
                    xlSheet.Cells(1, 13) = "CGST" & vbLf & " 9%"
                    xlSheet.Cells(1, 14) = "SGST" & vbLf & " 9%"
                    xlSheet.Cells(1, 15) = "IGST " & vbLf & "18%"
                    xlSheet.Cells(1, 16) = "Taxable" & vbLf & " 28%"
                    xlSheet.Cells(1, 17) = "CGST" & vbLf & " 14%"
                    xlSheet.Cells(1, 18) = "SGST" & vbLf & " 14%"
                    xlSheet.Cells(1, 19) = "IGST " & vbLf & "28%"
                    xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 19)).Font.Bold = True
                    If cmbSelection.SelectedIndex = 2 Then
                        Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_B2CSmall]')) " _
                             & " Drop View [dbo].[vw_B2CSmall]"
                    Else
                        Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_B2CLarge]')) " _
                             & " Drop View [dbo].[vw_B2CLarge]"
                    End If

                    Common.ExecuteQuery(Query)

                    Dim strSrch As String = ""
                    If chkSize.Checked = True Then
                        strSrch = "  UNION ALL " _
                          & " Select Salesrtn.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,Salesrtn.Doc_no AS InvoiceNo,Salesrtn.Taxable_Amt+Salesrtn.Tax_Amt+Salesrtn.OthChgs_Amt Gross_Total,Salesrtn.Doc_Dt ," _
                                & "-(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST5," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST5," _
                                & "-(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST12," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST6," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST6," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST12," _
                                & "-(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST18," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST9," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST9," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST18," _
                                & "-(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST28," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST14," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST14," _
                                & "-(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST28" _
                                & " from Salesrtn Left Join Ledger on Ledger.Led_Key=Salesrtn.Cust_Key  " _
                                & " LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                & " Where Salesrtn.Status = '1' and  Direct_CN=1 And  Ledger.GSTNo='' " _
                                & " AND Salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Salesrtn.COBR_ID ='" & SelBranchId & "' " _
                                & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,Salesrtn.Doc_no  ,Salesrtn.Doc_Dt ,Ledger.GSTNo ,Salesrtn.Doc_Id,Salesrtn.Taxable_Amt,Salesrtn.Tax_Amt,Salesrtn.OthChgs_Amt" _
                                & "  UNION ALL " _
                                & " Select CN.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,CN.Doc_no AS InvoiceNo,CN.Taxable_Amt+CN.Tax_Amt+CN.OthChgs_Amt Gross_Total,CN.Doc_Dt ,-(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST5,-(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST,-(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST,-(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST5,-(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST12,-(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST6,-(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST6,-(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST12,-(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST18," _
                                & " -(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST9," _
                                & " -(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST9," _
                                & " -(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST18," _
                                & " -(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST28," _
                                & " -(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST14," _
                                & " -(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST14," _
                                & " -(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST28 " _
                                & " from CN Left Join Ledger on Ledger.Led_Key=CN.Cust_Key   LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY   " _
                                & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY   Where CN.Status = '1' And  Ledger.GSTNo='' " _
                                & " AND CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' " _
                                & "	Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,CN.Doc_no  ,CN.Doc_Dt ,Ledger.GSTNo ," _
                                & "	CN.Doc_Id,CN.Taxable_Amt,CN.Tax_Amt,CN.OthChgs_Amt"
                    End If
                    If cmbSelection.SelectedIndex = 2 Then
                        Query = "Create View vw_B2CSmall As  " _
                                & " Select SaleBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Taxable_Amt+salebill.Tax_Amt+salebill.OthChgs_Amt Gross_Total,salebill.Doc_Dt ," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                                & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                                & "LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                & " Where SaleBill.Status = '1' and State.Alt_Code='" & GSTDigit & "' And  Ledger.GSTNo='' " _
                                & " AND SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' " _
                                & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt" _
                                & " Union All  " _
                                & " Select SaleBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Taxable_Amt+salebill.Tax_Amt+salebill.OthChgs_Amt Gross_Total,salebill.Doc_Dt ," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                                & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                                & "LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                & " Where SaleBill.Status = '1' and State.Alt_Code<>'" & GSTDigit & "' And Salebill.Taxable_Amt<=250000 And  Ledger.GSTNo='' " _
                                & " AND SaleBill.Doc_Type='A' And SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' " _
                                & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt" _
                                & strSrch
                    Else
                        Query = "Create View vw_B2CLarge As  " _
                                & " Select SaleBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Taxable_Amt+salebill.Tax_Amt+salebill.OthChgs_Amt Gross_Total,salebill.Doc_Dt ," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                                & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                                & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                                & "LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                & " Where SaleBill.Status = '1' and State.Alt_Code<>'" & GSTDigit & "' And Ledger.GSTNo='' And Salebill.Taxable_Amt>250000  " _
                                & " AND SaleBill.Doc_Type='A' and SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' " _
                                & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt"
                    End If
                    Common.ExecuteQuery(Query)
                    If cmbSelection.SelectedIndex = 2 Then
                        Query = "SELECT PlaceofSupply,Sum(GST5)GST5,Sum(CGST)CGST,Sum(SGST)SGST,sum(IGST5)IGST5,Sum(GST12)GST12,Sum(CGST6)CGST6,Sum(SGST6)SGST6,Sum(IGST12)IGST12,Sum(GST18)GST18,Sum(CGST9)CGST9,Sum(SGST9)SGST9,Sum(IGST18)IGST18,Sum(GST28)GST28,Sum(CGST14)CGST14,Sum(SGST14)SGST14,Sum(IGST28)IGST28 FROM vw_B2CSmall " _
                  & " Group By PlaceofSupply"
                    Else
                        Query = "SELECT PlaceofSupply,Sum(GST5)GST5,Sum(CGST)CGST,Sum(SGST)SGST,sum(IGST5)IGST5,Sum(GST12)GST12,Sum(CGST6)CGST6,Sum(SGST6)SGST6,Sum(IGST12)IGST12,Sum(GST18)GST18,Sum(CGST9)CGST9,Sum(SGST9)SGST9,Sum(IGST18)IGST18,Sum(GST28)GST28,Sum(CGST14)CGST14,Sum(SGST14)SGST14,Sum(IGST28)IGST28 FROM vw_B2CLarge " _
                  & " Group By PlaceofSupply"
                    End If

                    Dim dtb2CSmall As DataTable = Common.GetDataTable(Query)
                    Dim recrow As DataRow
                    If dtb2CSmall.Rows.Count > 0 Then
                        Dim i As Integer = 2
                        Dim j As Integer = 2
                        Dim k As Integer = 1
                        For Each recrow In dtb2CSmall.Rows
                            xlSheet.Cells(j, 1) = k
                            xlSheet.Cells(i, 2) = recrow("PLACEOFSUPPLY")
                            xlSheet.Cells(i, 3) = recrow("GST5") + recrow("CGST") + recrow("SGST") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18") + recrow("GST28") + recrow("CGST14") + recrow("SGST14") + recrow("IGST28")
                            xlSheet.Cells(i, 4) = recrow("GST5")
                            xlSheet.Cells(i, 5) = recrow("CGST")
                            xlSheet.Cells(i, 6) = recrow("SGST")
                            xlSheet.Cells(i, 7) = recrow("IGST5")
                            xlSheet.Cells(i, 8) = recrow("GST12")
                            xlSheet.Cells(i, 9) = recrow("CGST6")
                            xlSheet.Cells(i, 10) = recrow("SGST6")
                            xlSheet.Cells(i, 11) = recrow("IGST12")
                            xlSheet.Cells(i, 12) = recrow("GST18")
                            xlSheet.Cells(i, 13) = recrow("CGST9")
                            xlSheet.Cells(i, 14) = recrow("SGST9")
                            xlSheet.Cells(i, 15) = recrow("IGST18")
                            xlSheet.Cells(i, 16) = recrow("GST28")
                            xlSheet.Cells(i, 17) = recrow("CGST14")
                            xlSheet.Cells(i, 18) = recrow("SGST14")
                            xlSheet.Cells(i, 19) = recrow("IGST28")
                            i += 1
                            j += 1
                            k += 1
                        Next recrow
                        If cmbSelection.SelectedIndex = 2 Then
                            Query = "SELECT Sum(GST5)GST5,Sum(CGST)CGST,Sum(SGST)SGST,Sum(IGST5)IGST5,Sum(GST12)GST12,Sum(CGST6)CGST6,Sum(SGST6)SGST6,Sum(IGST12)IGST12,Sum(GST18)GST18,Sum(CGST9)CGST9,Sum(SGST9)SGST9,Sum(IGST18)IGST18,Sum(GST28)GST28,Sum(CGST14)CGST14,Sum(SGST14)SGST14,Sum(IGST28)IGST28 FROM vw_B2CSmall "
                        Else
                            Query = "SELECT Sum(GST5)GST5,Sum(CGST)CGST,Sum(SGST)SGST,Sum(IGST5)IGST5,Sum(GST12)GST12,Sum(CGST6)CGST6,Sum(SGST6)SGST6,Sum(IGST12)IGST12,Sum(GST18)GST18,Sum(CGST9)CGST9,Sum(SGST9)SGST9,Sum(IGST18)IGST18,Sum(GST28)GST28,Sum(CGST14)CGST14,Sum(SGST14)SGST14,Sum(IGST28)IGST28 FROM vw_B2CLarge "
                        End If
                        Dim dtb2CSum As DataTable = Common.GetDataTable(Query)
                        Dim recSum As DataRow
                        If dtb2CSum.Rows.Count > 0 Then
                            For Each recSum In dtb2CSum.Rows
                                'xlSheet.Cells(i + 3, 1) = "GRAND TOTAL"
                                xlSheet.Cells(i + 3, 3) = recSum("GST5") + recSum("CGST") + recSum("SGST") + recSum("IGST5") + recSum("GST12") + recSum("CGST6") + recSum("SGST6") + recSum("IGST12") + recSum("GST18") + recSum("CGST9") + recSum("SGST9") + recSum("IGST18") + recSum("GST28") + recSum("CGST14") + recSum("SGST14") + recSum("IGST28")
                                xlSheet.Cells(i + 3, 4) = recSum("GST5")
                                xlSheet.Cells(i + 3, 5) = recSum("CGST")
                                xlSheet.Cells(i + 3, 6) = recSum("SGST")
                                xlSheet.Cells(i + 3, 7) = recSum("IGST5")
                                xlSheet.Cells(i + 3, 8) = recSum("GST12")
                                xlSheet.Cells(i + 3, 9) = recSum("CGST6")
                                xlSheet.Cells(i + 3, 10) = recSum("SGST6")
                                xlSheet.Cells(i + 3, 11) = recSum("IGST12")
                                xlSheet.Cells(i + 3, 12) = recSum("GST18")
                                xlSheet.Cells(i + 3, 13) = recSum("CGST9")
                                xlSheet.Cells(i + 3, 14) = recSum("SGST9")
                                xlSheet.Cells(i + 3, 15) = recSum("IGST18")
                                xlSheet.Cells(i + 3, 16) = recSum("GST28")
                                xlSheet.Cells(i + 3, 17) = recSum("CGST14")
                                xlSheet.Cells(i + 3, 18) = recSum("SGST14")
                                xlSheet.Cells(i + 3, 19) = recSum("IGST28")
                            Next
                        End If

                        xlSheet.Range("D1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                        xlSheet.Cells(i + 3, 2) = "GRAND TOTAL"
                        xlSheet.Range(xlSheet.Cells(i + 3, 2), xlSheet.Cells(i + 3, 19)).Font.Bold = True
                    End If

                    xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter

                    xlSheet.Columns.AutoFit()


                    Try
                        If cmbSelection.SelectedIndex = 1 Then

                            xlSheet.SaveAs(Application.StartupPath & "GSTR1-" & GST & "(B2CLarge)" & "-" & Today & ".xlsx")
                        Else
                            xlSheet.SaveAs(Application.StartupPath & "GSTR1-" & GST & "(B2CSmall)" & "-" & Today & ".xlsx")
                        End If
                    Catch ex As Exception
                        'MessageBox.Show(ex.Message)
                        Exit Sub
                    End Try

                    xlApp.Visible = True

                ElseIf cmbSelection.SelectedIndex = 0 Then

                    xlSheet.Cells(1, 1) = "Sr No."
                    xlSheet.Cells(1, 2) = "GSTIN"
                    xlSheet.Cells(1, 3) = "Party"
                    xlSheet.Cells(1, 4) = "Invoice No"
                    xlSheet.Cells(1, 5) = "Invoice Date"
                    xlSheet.Cells(1, 6) = "Place Of Supply"
                    xlSheet.Cells(1, 7) = "Total Invoice Value"

                    ''5%
                    xlSheet.Cells(1, 8) = "Taxable" & vbLf & " 5%"
                    xlSheet.Cells(1, 9) = "CGST" & vbLf & " 2.5%"
                    xlSheet.Cells(1, 10) = "SGST" & vbLf & " 2.5%"
                    xlSheet.Cells(1, 11) = "IGST" & vbLf & " 5%"
                    ''12%
                    xlSheet.Cells(1, 12) = "Taxable" & vbLf & " 12%"
                    xlSheet.Cells(1, 13) = "CGST" & vbLf & " 6%"
                    xlSheet.Cells(1, 14) = "SGST" & vbLf & " 6%"
                    xlSheet.Cells(1, 15) = "IGST" & vbLf & " 12%"
                    ''18%
                    xlSheet.Cells(1, 16) = "Taxable" & vbLf & " 18%"
                    xlSheet.Cells(1, 17) = "CGST" & vbLf & " 9%"
                    xlSheet.Cells(1, 18) = "SGST" & vbLf & " 9%"
                    xlSheet.Cells(1, 19) = "IGST" & vbLf & " 18%"
                    ''28%
                    xlSheet.Cells(1, 20) = "Taxable" & vbLf & " 28%"
                    xlSheet.Cells(1, 21) = "CGST" & vbLf & " 14%"
                    xlSheet.Cells(1, 22) = "SGST" & vbLf & " 14%"
                    xlSheet.Cells(1, 23) = "IGST" & vbLf & " 28%"
                    xlSheet.Cells(1, 24) = "Taxable" & vbLf & " 0%"  ''ankita 23042019
                    xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 24)).Font.Bold = True
                    'xlSheet.Cells.Font.Bold = True


                    Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_B2BInvoices]')) " _
                              & " Drop View [dbo].[vw_B2BInvoices]"
                    Common.ExecuteQuery(Query)

                    Dim strSrch As String = ""

                    ''CHANGE BY RAHUL ON 17/06/2019
                    Dim strLedgerGstNoFltr As String = ""
                    If Val(GetSettingAsPerId(ApplnSettingsIdx.HetherGrey)) = 0 Then
                        strLedgerGstNoFltr = " And Ledger.GSTNo<>''"
                    End If
                    ''END


                    'Query = "Create View vw_B2BInvoices As  " _
                    '        & " Select SaleBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Doc_Dt ," _
                    '        & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm INNER JOIN TaxTermsTDS ON TaxTerm_Key=TxTmTDS_Key WHere salebilltxtm.AddSubTract='+' and TaxTerm_Perc in (2.5,5,0.00) AND TaxTermsTDS.TxTmTDS_Flag ='X' And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                    '        & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                    '        & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                    '        & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (0.05,0.1)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                    '        & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.1 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                    '        & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                    '        & "LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                    '        & " Where SaleBill.Status = '1' And Ledger.GSTNo<>'' " _
                    '        & " AND SaleBill.Doc_Type='A' and SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' " _
                    '        & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt" _
                    '        & strSrch

                    ''ankita adding Gst0 23042019

                    Query = "Create View vw_B2BInvoices As  " _
                            & " Select SaleBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Doc_Dt ,SaleBill.Net_Amt," _
                            & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm INNER JOIN TaxTermsTDS ON TaxTerm_Key=TxTmTDS_Key WHere salebilltxtm.AddSubTract='+' and TaxTerm_Perc in (0.00) AND TaxTermsTDS.TxTmTDS_Flag ='X' And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST0," _
                            & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm INNER JOIN TaxTermsTDS ON TaxTerm_Key=TxTmTDS_Key WHere salebilltxtm.AddSubTract='+' and TaxTerm_Perc in (2.5,5) AND TaxTermsTDS.TxTmTDS_Flag ='X' And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                            & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                            & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                            & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (0.05,0.1)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                            & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.1 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                            & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                            & "LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                            & " Where SaleBill.Status = '1' " & strLedgerGstNoFltr & "  " _
                            & " AND SaleBill.Doc_Type='A' and SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' " _
                            & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt,SaleBill.Net_Amt" _
                            & strSrch

                    Common.ExecuteQuery(Query)

                    '  Query = "SELECT GSTNo,Party,InvoiceNo,Doc_Dt,PlaceofSupply,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28 FROM vw_B2BInvoices " _
                    '& " Group By GSTNo,Party,InvoiceNo,Doc_Dt,PlaceofSupply,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28 Order by  InvoiceNo Asc"
                    ''ankita 23042019
                    Query = "SELECT GSTNo,Party,InvoiceNo,Doc_Dt,Net_Amt,PlaceofSupply,GST0,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28 FROM vw_B2BInvoices " _
                & " Group By GSTNo,Party,InvoiceNo,Doc_Dt,Net_Amt,PlaceofSupply,GST0,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28 Order by  InvoiceNo Asc"
                    Dim dtb2CSmall As DataTable = Common.GetDataTable(Query)
                    Dim recrow As DataRow
                    If dtb2CSmall.Rows.Count > 0 Then
                        Dim i As Integer = 2
                        Dim j As Integer = 2
                        Dim k As Integer = 1
                        For Each recrow In dtb2CSmall.Rows
                            xlSheet.Cells(j, 1) = k
                            xlSheet.Cells(i, 2) = recrow("GSTNo")
                            xlSheet.Cells(i, 3) = recrow("Party")
                            xlSheet.Cells(i, 4) = recrow("InvoiceNo")
                            xlSheet.Cells(i, 5) = recrow("Doc_Dt")
                            xlSheet.Cells(i, 6) = recrow("PlaceofSupply")
                            'xlSheet.Cells(i, 7) = recrow("GST5") + recrow("CGST") + recrow("SGST") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18") + recrow("GST28") + recrow("CGST14") + recrow("SGST14") + recrow("IGST28")

                            ''5%
                            If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                                xlSheet.Cells(i, 7) = recrow("Net_Amt")
                            Else

                                xlSheet.Cells(i, 7) = recrow("GST0") + recrow("GST5") + recrow("CGST") + recrow("SGST") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18") + recrow("GST28") + recrow("CGST14") + recrow("SGST14") + recrow("IGST28") ''ankita 23042019
                            End If
                            xlSheet.Cells(i, 8) = recrow("GST5")
                            xlSheet.Cells(i, 9) = recrow("CGST")
                            xlSheet.Cells(i, 10) = recrow("SGST")
                            xlSheet.Cells(i, 11) = recrow("IGST5")
                            ''12%
                            xlSheet.Cells(i, 12) = recrow("GST12")
                            xlSheet.Cells(i, 13) = recrow("CGST6")
                            xlSheet.Cells(i, 14) = recrow("SGST6")
                            xlSheet.Cells(i, 15) = recrow("IGST12")
                            '''18%
                            xlSheet.Cells(i, 16) = recrow("GST18")
                            xlSheet.Cells(i, 17) = recrow("CGST9")
                            xlSheet.Cells(i, 18) = recrow("SGST9")
                            xlSheet.Cells(i, 19) = recrow("IGST18")
                            ''28%
                            xlSheet.Cells(i, 20) = recrow("GST28")
                            xlSheet.Cells(i, 21) = recrow("CGST14")
                            xlSheet.Cells(i, 22) = recrow("SGST14")
                            xlSheet.Cells(i, 23) = recrow("IGST28")
                            xlSheet.Cells(i, 24) = recrow("GST0") ''ankita 23042019
                            i += 1
                            j += 1
                            k += 1
                        Next recrow

                        Query = "SELECT Sum(GST0)GST0,Sum(GST5)GST5,Sum(CGST)CGST,Sum(SGST)SGST,Sum(IGST5)IGST5,Sum(GST12)GST12,Sum(CGST6)CGST6,Sum(SGST6)SGST6,Sum(IGST12)IGST12,Sum(GST18)GST18,Sum(CGST9)CGST9,Sum(SGST9)SGST9,Sum(IGST18)IGST18,Sum(GST28)GST28,Sum(CGST14)CGST14,Sum(SGST14)SGST14,Sum(IGST28)IGST28 FROM vw_B2BInvoices "
                        ''& " Group By GSTNo,Party,InvoiceNo,Doc_Dt,Gross_Total,PlaceofSupply,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28 Order by  InvoiceNo Asc"
                        Dim dtb2CSum As DataTable = Common.GetDataTable(Query)
                        Dim recSum As DataRow
                        If dtb2CSum.Rows.Count > 0 Then
                            For Each recSum In dtb2CSum.Rows

                                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                                Else
                                    xlSheet.Cells(i + 3, 7) = recSum("GST0") + recSum("GST5") + recSum("CGST") + recSum("SGST") + recSum("IGST5") + recSum("GST12") + recSum("CGST6") + recSum("SGST6") + recSum("IGST12") + recSum("GST18") + recSum("CGST9") + recSum("SGST9") + recSum("IGST18") + recSum("GST28") + recSum("CGST14") + recSum("SGST14") + recSum("IGST28")
                                End If


                                xlSheet.Cells(i + 3, 8) = recSum("GST5")
                                xlSheet.Cells(i + 3, 9) = recSum("CGST")
                                xlSheet.Cells(i + 3, 10) = recSum("SGST")
                                xlSheet.Cells(i + 3, 11) = recSum("IGST5")
                                xlSheet.Cells(i + 3, 12) = recSum("GST12")
                                xlSheet.Cells(i + 3, 13) = recSum("CGST6")
                                xlSheet.Cells(i + 3, 14) = recSum("SGST6")
                                xlSheet.Cells(i + 3, 15) = recSum("IGST12")
                                xlSheet.Cells(i + 3, 16) = recSum("GST18")
                                xlSheet.Cells(i + 3, 17) = recSum("CGST9")
                                xlSheet.Cells(i + 3, 18) = recSum("SGST9")
                                xlSheet.Cells(i + 3, 19) = recSum("IGST18")
                                xlSheet.Cells(i + 3, 20) = recSum("GST28")
                                xlSheet.Cells(i + 3, 21) = recSum("CGST14")
                                xlSheet.Cells(i + 3, 22) = recSum("SGST14")
                                xlSheet.Cells(i + 3, 23) = recSum("IGST28")
                                xlSheet.Cells(i + 3, 24) = recSum("GST0")

                            Next
                        End If
                        xlSheet.Range("D1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                        xlSheet.Cells(i + 3, 2) = "GRAND TOTAL"
                        xlSheet.Range(xlSheet.Cells(i + 3, 2), xlSheet.Cells(i + 3, 24)).Font.Bold = True
                    End If
                    xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                    'MessageBox.Show("Second")
                    xlSheet.Columns.AutoFit()
                    Try
                        'MessageBox.Show("Third")
                        xlSheet.SaveAs(Application.StartupPath & "GSTR1-" & GST & "(B2B Invoices)" & "-" & Today & ".xlsx")
                        xlApp.Visible = True
                    Catch ex As Exception
                        'MessageBox.Show(ex.Message)
                        Exit Sub
                    End Try
                ElseIf cmbSelection.SelectedIndex = 3 Or cmbSelection.SelectedIndex = 4 Then 'Credit Note(Registered)/Credit Note(Un-Registered)
                    If cmbSelection.SelectedIndex = 3 Then
                        Reg = "And  Ledger.GSTNo<>''"
                    Else
                        Reg = "And  Ledger.GSTNo=''"
                    End If
                    xlSheet.Cells(1, 1) = "Sr No."
                    xlSheet.Cells(1, 2) = "GSTIN"
                    xlSheet.Cells(1, 3) = "Party"
                    xlSheet.Cells(1, 4) = "CN No."
                    xlSheet.Cells(1, 5) = "CN Date"
                    xlSheet.Cells(1, 6) = "Invoice No"
                    xlSheet.Cells(1, 7) = "Invoice Date"
                    xlSheet.Cells(1, 8) = "Document Type"
                    xlSheet.Cells(1, 9) = "Place of Supply"
                    xlSheet.Cells(1, 10) = "Supply Type"
                    xlSheet.Cells(1, 11) = "CN Value"
                    ''5%
                    xlSheet.Cells(1, 12) = "Taxable" & vbLf & "5%"
                    xlSheet.Cells(1, 13) = "CGST" & vbLf & "2.5%"
                    xlSheet.Cells(1, 14) = "SGST" & vbLf & "2.5%"
                    xlSheet.Cells(1, 15) = "IGST" & vbLf & "5%"
                    ''12%
                    xlSheet.Cells(1, 16) = "Taxable" & vbLf & "12%"
                    xlSheet.Cells(1, 17) = "CGST" & vbLf & "6%"
                    xlSheet.Cells(1, 18) = "SGST" & vbLf & "6%"
                    xlSheet.Cells(1, 19) = "IGST" & vbLf & "12%"

                    ''18%
                    xlSheet.Cells(1, 20) = "Taxable" & vbLf & "18%"
                    xlSheet.Cells(1, 21) = "CGST" & vbLf & "9%"
                    xlSheet.Cells(1, 22) = "SGST" & vbLf & "9%"
                    xlSheet.Cells(1, 23) = "IGST" & vbLf & "18%"
                    ''28%
                    xlSheet.Cells(1, 24) = "Taxable" & vbLf & "28%"
                    xlSheet.Cells(1, 25) = "CGST" & vbLf & "14%"
                    xlSheet.Cells(1, 26) = "SGST" & vbLf & "14%"
                    xlSheet.Cells(1, 27) = "IGST" & vbLf & "28%"
                    xlSheet.Cells(1, 28) = "TotQty"
                    xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 28)).Font.Bold = True ''RAJASHEI-05-02-2022-ADD TOTQTY
                    Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_CNRegistered]')) " _
                        & " Drop View [dbo].[vw_CNRegistered]"
                    Common.ExecuteQuery(Query)
                    Query = " Create View [vw_CNRegistered] as Select State.Alt_code,Salesrtn.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,Salesrtn.Doc_no AS InvoiceNo,Salesrtn.Taxable_Amt+Salesrtn.Tax_Amt+Salesrtn.OthChgs_Amt Gross_Total,Salesrtn.Doc_Dt ,Salesrtn.Party_RefNo,Salesrtn.Party_RefDt," _
                                & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST5," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST5," _
                                & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST12," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST12," _
                                & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST18," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST18," _
                                & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST28," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST28,0 As TotQty" _
                                & " from Salesrtn Left Join Ledger on Ledger.Led_Key=Salesrtn.Cust_Key  " _
                                & " LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                & " Where Salesrtn.Status = '1' and  Direct_CN=1 " _
                                & " AND Salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Salesrtn.COBR_ID ='" & SelBranchId & "' " _
                                & Reg _
                                & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,Salesrtn.Doc_no  ,Salesrtn.Doc_Dt ,Ledger.GSTNo ,Salesrtn.Doc_Id,Salesrtn.Taxable_Amt,Salesrtn.Tax_Amt,Salesrtn.OthChgs_Amt,Salesrtn.Party_RefNo,Salesrtn.Party_RefDt" _
                                & "  UNION ALL " _
                                & " Select State.Alt_code,CN.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,CN.Doc_no AS InvoiceNo,CN.Taxable_Amt+CN.Tax_Amt+CN.OthChgs_Amt Gross_Total,CN.Doc_Dt ,'' Party_RefNo,'' Party_RefDt,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST5,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST5,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST12,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST12,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST18," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST9," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST9," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST18," _
                                & " (Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST28," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST14," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST14," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST28,max(CN.TotQty)As TotQty " _
                                & " from CN Left Join Ledger on Ledger.Led_Key=CN.Cust_Key   LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY   " _
                                & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY   Where CN.Status = '1' " _
                                & " AND CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' " _
                                & Reg _
                                & "	Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,CN.Doc_no  ,CN.Doc_Dt ,Ledger.GSTNo ," _
                                & "	CN.Doc_Id,CN.Taxable_Amt,CN.Tax_Amt,CN.OthChgs_Amt" _
                   & " union all " _
                    & " select  (select Top 1  State.Alt_code  from Vchrdtl Inner join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  Inner join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key Inner JOIN STATION ON STATION.STN_key = Ledger.OSTN_Key  Inner JOIN STATE ON STATE.STATE_key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0 )as Alt_Code " _
                    & " ,Vchr.Doc_Id, " _
                    & " (select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id)) as GSTNo, " _
                    & " (select Top 1  State.Alt_code+'-' +STATE.State_Name  from Vchrdtl Inner join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  Inner join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key Inner JOIN STATION ON STATION.STN_Key = Ledger.OSTN_Key  Inner JOIN STATE ON STATE.STATE_Key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0 )as PlaceofSupply , " _
                    & " (select Top 1 Ledger.Led_Name from Vchrdtl left join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key JOIN STATION ON STATION.STN_key = Ledger.OSTN_Key  LEFT JOIN STATE ON STATE.STATE_key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0  And Vchrdtl.AmtFlag = 'C')as Led_Name,Vchr.PDoc_No as InvoiceNo,Vchr.Amount as Gross_Total,( Vchr.Doc_Dt) as Doc_Dt, " _
                    & " ( select top 1 VchrdtlRef.Doc_No from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id) as  Party_RefNo, " _
                    & " ( select top 1 ( VchrdtlRef.Doc_Dt)  from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id) as Party_RefDt," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5  or LEDGER.Tax_Perc=5 THEN GST_ON_AMT ELSE 0 END )  as Gst5," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS Sgst," _
& " (CASE WHEN LEDGER.Tax_Perc=5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END    ) AS igst5," _
& " (CASE WHEN LEDGER.Tax_Perc=6 or LEDGER.Tax_Perc=12 THEN GST_ON_AMT ELSE 0 END )  as Gst12," _
& " (CASE WHEN LEDGER.Tax_Perc=6 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst6," _
& " (CASE WHEN LEDGER.Tax_Perc=6 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst6," _
& " (CASE WHEN LEDGER.Tax_Perc=12 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS igst12," _
& " (CASE WHEN LEDGER.Tax_Perc=9 or LEDGER.Tax_Perc=18 THEN GST_ON_AMT ELSE 0 END )  as gst18," _
& " (CASE WHEN LEDGER.Tax_Perc=9 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst9," _
& " (CASE WHEN LEDGER.Tax_Perc=9 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst9," _
& " (CASE WHEN LEDGER.Tax_Perc=18 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END    ) AS igst18," _
& " (CASE WHEN LEDGER.Tax_Perc=14  or LEDGER.Tax_Perc=28 THEN GST_ON_AMT ELSE 0 END )  as gst28, " _
& " (CASE WHEN LEDGER.Tax_Perc=14 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst14, " _
& " (CASE WHEN LEDGER.Tax_Perc=14 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst14," _
& " (CASE WHEN LEDGER.Tax_Perc=28 THEN GST_ON_AMT ELSE 0 END   ) AS igst28, " _
& " 99999  TotQty " _
                     & "  from Vchrdtl " _
                    & " left join Vchr on Vchr.Doc_Id=Vchrdtl.Doc_Id " _
                    & " left join VchrdtlRef on VchrdtlRef.Doc_Id=Vchrdtl.Doc_Id " _
                    & " left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key " _
                    & "    where   Ledger.Tax_Perc > 0 And Vchr.Doc_Dt BETWEEN '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'    and Vchrdtl.GST_On_Amt<> 0 " _
                & " And  Vchr.PDoc_No <> '' AND Vchr.Cobr_Id='" & SelBranchId & "'   And VchrType ='CN'   and " & IIf(cmbSelection.SelectedIndex = 3, " (select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id)) <>''", "(select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id))=''") & " " _
                & "  group by  VchrdtlRef.Doc_Dt, Ledger.Tax_Perc,Vchrdtl.AmtFlag,Vchr.Doc_Id,Vchr.Doc_Dt,Vchr.PDoc_No,Vchr.VchrRefNo ,Vchr.Amount ,Vchrdtl.GST_On_Amt,Vchrdtl.AMOUNT " _
                     & " union all " _
                    & " select Distinct (select Top 1  State.Alt_code  from Vchrdtl Inner join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  Inner join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key Inner JOIN STATION ON STATION.STN_key = Ledger.OSTN_Key  Inner JOIN STATE ON STATE.STATE_key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0 )as Alt_Code " _
                    & " ,Vchr.Doc_Id, " _
                    & " (select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id)) as GSTNo, " _
                    & " (select Top 1  State.Alt_code+'-' +STATE.State_Name  from Vchrdtl Inner join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  Inner join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key Inner JOIN STATION ON STATION.STN_Key = Ledger.OSTN_Key  Inner JOIN STATE ON STATE.STATE_Key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0 )as PlaceofSupply , " _
                    & " (select Top 1 Ledger.Led_Name from Vchrdtl left join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key JOIN STATION ON STATION.STN_key = Ledger.OSTN_Key  LEFT JOIN STATE ON STATE.STATE_key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0  And Vchrdtl.AmtFlag = 'C')as Led_Name,Vchr.PDoc_No as InvoiceNo,Vchr.Amount as Gross_Total,( Vchr.Doc_Dt) as Doc_Dt, " _
                    & " ( select top 1 VchrdtlRef.Doc_No from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id) as  Party_RefNo, " _
                    & " ( select top 1 ( VchrdtlRef.Doc_Dt)  from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id) as Party_RefDt," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5 or LEDGER.Tax_Perc=5 THEN GST_ON_AMT ELSE 0 END )  as Gst5," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS Sgst," _
& " (CASE WHEN LEDGER.Tax_Perc=5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END    ) AS igst5," _
& " (CASE WHEN LEDGER.Tax_Perc=6 or LEDGER.Tax_Perc=12 THEN GST_ON_AMT ELSE 0 END )  as Gst12," _
& " (CASE WHEN LEDGER.Tax_Perc=6 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst6," _
& " (CASE WHEN LEDGER.Tax_Perc=6 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst6," _
& " (CASE WHEN LEDGER.Tax_Perc=12  AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END    ) AS igst12," _
& " (CASE WHEN LEDGER.Tax_Perc=9  or LEDGER.Tax_Perc=18 THEN GST_ON_AMT ELSE 0 END )  as gst18," _
& " (CASE WHEN LEDGER.Tax_Perc=9 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst9," _
& " (CASE WHEN LEDGER.Tax_Perc=9 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst9," _
& " (CASE WHEN LEDGER.Tax_Perc=18  AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END    ) AS igst18," _
& " (CASE WHEN LEDGER.Tax_Perc=14 or LEDGER.Tax_Perc=28 THEN GST_ON_AMT ELSE 0 END )  as gst28, " _
& " (CASE WHEN LEDGER.Tax_Perc=14 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst14, " _
& " (CASE WHEN LEDGER.Tax_Perc=14 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst14," _
& " Vchr.Amount AS igst28, " _
& " 0  TotQty " _
                     & "  from Vchrdtl " _
                    & " left join Vchr on Vchr.Doc_Id=Vchrdtl.Doc_Id " _
                    & " left join VchrdtlRef on VchrdtlRef.Doc_Id=Vchrdtl.Doc_Id " _
                    & " left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key " _
                    & "    where   Ledger.Tax_Perc <= 0 And Vchr.Doc_Dt BETWEEN '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'    and Vchrdtl.GST_On_Amt= 0  " _
                & " And  Vchr.PDoc_No <> '' AND Vchr.Cobr_Id='" & SelBranchId & "'  And VchrType ='CN'  and Vchrdtl.AmtFlag='d' and  (select sum(Vchrdtl.gst_on_amt)  from vchrdtl where doc_id=Vchr.Doc_Id)=0 and " & IIf(cmbSelection.SelectedIndex = 3, " (select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id)) <>''", "(select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id))=''") & " " _
                & "  group by  VchrdtlRef.Doc_Dt, Ledger.Tax_Perc,Vchrdtl.AmtFlag,Vchr.Doc_Id,Vchr.Doc_Dt,Vchr.PDoc_No,Vchr.VchrRefNo ,Vchr.Amount ,Vchrdtl.GST_On_Amt,Vchrdtl.AMOUNT "




                    Common.ExecuteQuery(Query)
                    Query = "SELECT GSTNo,Party,InvoiceNo,Alt_code StateCode,Doc_Dt,Party_RefNo,Party_RefDt,sum(Gross_Total)Gross_Total,PlaceofSupply,sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28,Max(TotQty)TotQty FROM vw_CNRegistered " _
                & " Group By GSTNo,Alt_code,Party,InvoiceNo,Doc_Dt,Party_RefNo,Party_RefDt,PlaceofSupply Order by  InvoiceNo Asc"
                    Dim dtCNRegistered As DataTable = Common.GetDataTable(Query)
                    Dim recrow As DataRow
                    Dim GrsTot As Double = 0

                    If dtCNRegistered.Rows.Count > 0 Then
                        Dim i As Integer = 2
                        Dim j As Integer = 2
                        Dim k As Integer = 1
                        For Each recrow In dtCNRegistered.Rows
                            xlSheet.Cells(j, 1) = k
                            xlSheet.Cells(i, 2) = recrow("GSTNO")
                            xlSheet.Cells(i, 3) = recrow("Party")
                            xlSheet.Cells(i, 4) = recrow("InvoiceNo")
                            xlSheet.Cells(i, 5) = recrow("DOC_DT")
                            xlSheet.Cells(i, 6) = recrow("Party_RefNo")
                            xlSheet.Cells(i, 7) = recrow("Party_RefDt")
                            xlSheet.Cells(i, 8) = "C   "
                            xlSheet.Cells(i, 9) = recrow("PLACEOFSUPPLY")
                            xlSheet.Cells(i, 10) = IIf(GSTDigit = recrow("StateCode"), "Intra-State", "Inter-State")

                            If Val(recrow("IGST28")) > 0 Then
                                xlSheet.Cells(i, 11) = recrow("Gross_Total")


                                xlSheet.Cells(i, 12) = recrow("GST5")
                                xlSheet.Cells(i, 13) = recrow("CGST")
                                xlSheet.Cells(i, 14) = recrow("SGST")
                                xlSheet.Cells(i, 15) = recrow("IGST5")
                                xlSheet.Cells(i, 16) = recrow("GST12")
                                xlSheet.Cells(i, 17) = recrow("CGST6")
                                xlSheet.Cells(i, 18) = recrow("SGST6")
                                xlSheet.Cells(i, 19) = recrow("IGST12")
                                xlSheet.Cells(i, 20) = recrow("GST18")
                                xlSheet.Cells(i, 21) = recrow("CGST9")
                                xlSheet.Cells(i, 22) = recrow("SGST9")
                                xlSheet.Cells(i, 23) = recrow("IGST18")
                                xlSheet.Cells(i, 24) = recrow("GST28")
                                xlSheet.Cells(i, 25) = recrow("CGST14")
                                xlSheet.Cells(i, 26) = recrow("SGST14")

                            Else

                                If recrow("GST5") + recrow("CGST") + recrow("SGST") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("GST28") + recrow("CGST14") + recrow("SGST14") + recrow("IGST5") + recrow("IGST12") + recrow("IGST18") + recrow("IGST28") > recrow("Gross_Total") Then
                                    xlSheet.Cells(i, 11) = recrow("Gross_Total")
                                    GrsTot += recrow("Gross_Total")
                                    xlSheet.Cells(i, 12) = 0.0
                                    xlSheet.Cells(i, 13) = 0.0
                                    xlSheet.Cells(i, 14) = 0.0
                                    xlSheet.Cells(i, 15) = 0.0
                                    xlSheet.Cells(i, 16) = 0.0
                                    xlSheet.Cells(i, 17) = 0.0
                                    xlSheet.Cells(i, 18) = 0.0
                                    xlSheet.Cells(i, 19) = 0.0
                                    xlSheet.Cells(i, 20) = 0.0
                                    xlSheet.Cells(i, 21) = 0.0
                                    xlSheet.Cells(i, 22) = 0.0
                                    xlSheet.Cells(i, 23) = 0.0
                                    xlSheet.Cells(i, 24) = 0.0
                                    xlSheet.Cells(i, 25) = 0.0
                                    xlSheet.Cells(i, 26) = 0.0
                                Else
                                    xlSheet.Cells(i, 11) = recrow("GST5") + recrow("CGST") + recrow("SGST") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("GST28") + recrow("CGST14") + recrow("SGST14") + recrow("IGST5") + recrow("IGST12") + recrow("IGST18") + recrow("IGST28")
                                    xlSheet.Cells(i, 12) = recrow("GST5")
                                    xlSheet.Cells(i, 13) = recrow("CGST")
                                    xlSheet.Cells(i, 14) = recrow("SGST")
                                    xlSheet.Cells(i, 15) = recrow("IGST5")
                                    xlSheet.Cells(i, 16) = recrow("GST12")
                                    xlSheet.Cells(i, 17) = recrow("CGST6")
                                    xlSheet.Cells(i, 18) = recrow("SGST6")
                                    xlSheet.Cells(i, 19) = recrow("IGST12")
                                    xlSheet.Cells(i, 20) = recrow("GST18")
                                    xlSheet.Cells(i, 21) = recrow("CGST9")
                                    xlSheet.Cells(i, 22) = recrow("SGST9")
                                    xlSheet.Cells(i, 23) = recrow("IGST18")
                                    xlSheet.Cells(i, 24) = recrow("GST28")
                                    xlSheet.Cells(i, 25) = recrow("CGST14")
                                    xlSheet.Cells(i, 26) = recrow("SGST14")
                                End If

                            End If



                        
                            xlSheet.Cells(i, 27) = IIf(recrow("IGST28") > 0, 0, recrow("IGST28"))
                            xlSheet.Cells(i, 28) = IIf(recrow("TotQty") > 0, 0, recrow("TotQty"))



                            i += 1
                            j += 1
                            k += 1
                        Next recrow
                        Query = "SELECT sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28,sum(Gross_Total) GrossTotal " _
                                & " FROM vw_CNRegistered "
                        Dim dtb2CSmallSum As DataTable = Common.GetDataTable(Query)
                        Dim recrowsum As DataRow
                        For Each recrowsum In dtb2CSmallSum.Rows
                            xlSheet.Cells(i + 1, 2) = "GRAND TOTAL"

                            If recrowsum("GST5") + recrowsum("CGST") + recrowsum("SGST") + recrowsum("GST12") + recrowsum("CGST6") + recrowsum("SGST6") + recrowsum("GST18") + recrowsum("CGST9") + recrowsum("SGST9") + recrowsum("GST28") + recrowsum("CGST14") + recrowsum("SGST14") + recrowsum("IGST5") + recrowsum("IGST12") + recrowsum("IGST18") + recrowsum("IGST28") > recrowsum("GrossTotal") Then



                                If GrsTot > 0 Then
                                    xlSheet.Cells(i + 1, 11) = recrowsum("GrossTotal") 'recrowsum("GST5") + recrowsum("CGST") + recrowsum("SGST") + recrowsum("GST12") + recrowsum("CGST6") + recrowsum("SGST6") + recrowsum("GST18") + recrowsum("CGST9") + recrowsum("SGST9") + recrowsum("GST28") + recrowsum("CGST14") + recrowsum("SGST14") + recrowsum("IGST5") + recrowsum("IGST12") + recrowsum("IGST18") + recrowsum("IGST28")

                                Else
                                    xlSheet.Cells(i + 1, 11) = recrowsum("GST5") + recrowsum("CGST") + recrowsum("SGST") + recrowsum("GST12") + recrowsum("CGST6") + recrowsum("SGST6") + recrowsum("GST18") + recrowsum("CGST9") + recrowsum("SGST9") + recrowsum("GST28") + recrowsum("CGST14") + recrowsum("SGST14") + recrowsum("IGST5") + recrowsum("IGST12") + recrowsum("IGST18") + recrowsum("IGST28")
                                End If





                                xlSheet.Cells(i + 1, 12) = recrowsum("GST5")
                                xlSheet.Cells(i + 1, 13) = recrowsum("CGST")
                                xlSheet.Cells(i + 1, 14) = recrowsum("SGST")
                                xlSheet.Cells(i + 1, 15) = recrowsum("IGST5")
                                xlSheet.Cells(i + 1, 16) = recrowsum("GST12")
                                xlSheet.Cells(i + 1, 17) = recrowsum("CGST6")
                                xlSheet.Cells(i + 1, 18) = recrowsum("SGST6")
                                xlSheet.Cells(i + 1, 19) = recrowsum("IGST12")
                                xlSheet.Cells(i + 1, 20) = recrowsum("GST18")
                                xlSheet.Cells(i + 1, 21) = recrowsum("CGST9")
                                xlSheet.Cells(i + 1, 22) = recrowsum("SGST9")
                                xlSheet.Cells(i + 1, 23) = recrowsum("IGST18")
                                xlSheet.Cells(i + 1, 24) = recrowsum("GST28")
                                xlSheet.Cells(i + 1, 25) = recrowsum("CGST14")
                                xlSheet.Cells(i + 1, 26) = recrowsum("SGST14")

                                xlSheet.Cells(i + 1, 27) = IIf(recrowsum("IGST28") > 0, 0, recrowsum("IGST28"))

                            Else
                                
                                xlSheet.Cells(i + 1, 11) = recrowsum("GST5") + recrowsum("CGST") + recrowsum("SGST") + recrowsum("GST12") + recrowsum("CGST6") + recrowsum("SGST6") + recrowsum("GST18") + recrowsum("CGST9") + recrowsum("SGST9") + recrowsum("GST28") + recrowsum("CGST14") + recrowsum("SGST14") + recrowsum("IGST5") + recrowsum("IGST12") + recrowsum("IGST18") + recrowsum("IGST28")
                            




                                xlSheet.Cells(i + 1, 12) = recrowsum("GST5")
                                xlSheet.Cells(i + 1, 13) = recrowsum("CGST")
                                xlSheet.Cells(i + 1, 14) = recrowsum("SGST")
                                xlSheet.Cells(i + 1, 15) = recrowsum("IGST5")
                                xlSheet.Cells(i + 1, 16) = recrowsum("GST12")
                                xlSheet.Cells(i + 1, 17) = recrowsum("CGST6")
                                xlSheet.Cells(i + 1, 18) = recrowsum("SGST6")
                                xlSheet.Cells(i + 1, 19) = recrowsum("IGST12")
                                xlSheet.Cells(i + 1, 20) = recrowsum("GST18")
                                xlSheet.Cells(i + 1, 21) = recrowsum("CGST9")
                                xlSheet.Cells(i + 1, 22) = recrowsum("SGST9")
                                xlSheet.Cells(i + 1, 23) = recrowsum("IGST18")
                                xlSheet.Cells(i + 1, 24) = recrowsum("GST28")
                                xlSheet.Cells(i + 1, 25) = recrowsum("CGST14")
                                xlSheet.Cells(i + 1, 26) = recrowsum("SGST14")

                                xlSheet.Cells(i + 1, 27) = IIf(recrowsum("IGST28") > 0, 0, recrowsum("IGST28"))

                            End If
                        Next
                        xlSheet.Range("D1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                        xlSheet.Range(xlSheet.Cells(i + 1, 2), xlSheet.Cells(i + 1, 27)).Font.Bold = True
                    End If
                    xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                    xlSheet.Columns.AutoFit()



                    '--------------CNVCHR------Doc--14052024---------------------------------

                    ''---------------------------------




                    'Dim CNVCHRSheet As Excel.Worksheet = xlBook.Worksheets("CNVCHR")

                    'Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_CNRegisteredSAT]')) " _
                    '          & " Drop View [dbo].[vw_CNRegisteredSAT]"
                    'Common.ExecuteQuery(Query)

                    ''---for CDNR Vchr------------------------------
                    'Query = "Create View [vw_CNRegisteredSAT] as " _
                    '& " select ( select top 1 VchrdtlRef.Doc_No from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id) as  billNo,( select top 1 convert(varchar, VchrdtlRef.Doc_Dt,103)  from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id)as BillDt,Ledger.Tax_Perc,Vchrdtl.AmtFlag,Vchr.Doc_Id,convert(varchar, Vchr.Doc_Dt, 6) as Doc_Dt,Vchr.PDoc_No as Doc_No,Vchr.VchrRefNo ,Vchr.Amount as Net_Amt,Vchrdtl.GST_On_Amt ,(select Top 1 Vchrdtl.Amount from Vchrdtl  " _
                    '& " left join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key  where V.Doc_Id=Vchr.Doc_Id And Vchrdtl.AmtFlag = 'D' ) as TaxableAmt,     " _
                    '& " (select Top 1 Ledger.Led_Name from Vchrdtl left join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key JOIN STATION ON STATION.STN_Id = Ledger.OSTN_Key  LEFT JOIN STATE ON STATE.STATE_Id = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0  And Vchrdtl.AmtFlag = 'C')as Led_Name, " _
                    '& " (select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id)) as GSTNo, " _
                    '& " (select Top 1  State.Alt_code+'-' +STATE.State_Name  from Vchrdtl Inner join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  Inner join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key Inner JOIN STATION ON STATION.STN_Id = Ledger.OSTN_Key  Inner JOIN STATE ON STATE.STATE_Id = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0 )as PlaceofSupply " _
                    '& " from Vchrdtl " _
                    '& " left join Vchr on Vchr.Doc_Id=Vchrdtl.Doc_Id " _
                    '& " left join VchrdtlRef on VchrdtlRef.Doc_Id=Vchrdtl.Doc_Id " _
                    '& " left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key " _
                    '& " where   Ledger.Tax_Perc > 0 And Vchr.Doc_Dt BETWEEN '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'    and Vchrdtl.GST_On_Amt<> 0 " _
                    '& " And  Vchr.PDoc_No <> '' AND Vchr.Cobr_Id='" & SelBranchId & "'  And FcYr_Id = '" & SelYearId & "' And VchrType ='CN' " _
                    '& "  group by  VchrdtlRef.Doc_Dt, Ledger.Tax_Perc,Vchrdtl.AmtFlag,Vchr.Doc_Id,Vchr.Doc_Dt,Vchr.PDoc_No,Vchr.VchrRefNo ,Vchr.Amount ,Vchrdtl.GST_On_Amt "

                    'Common.ExecuteQuery(Query)

                    'Query = "select * from vw_CNRegisteredSAT"

                    'dtCNRegistered = Common.GetDataTable(Query)

                    'If dtCNRegistered.Rows.Count > 0 Then
                    '    Dim ExpCount As Integer = 5
                    '    For Each recrow In dtCNRegistered.Rows


                    '        CNVCHRSheet.Cells(ExpCount, 1) = recrow("GSTNO")





                    '        CNVCHRSheet.Cells(ExpCount, 2) = recrow("BillNo")
                    '        CNVCHRSheet.Cells(ExpCount, 3) = recrow("BillDt")


                    '        CNVCHRSheet.Cells(ExpCount, 4) = recrow("Doc_No")
                    '        CNVCHRSheet.Cells(ExpCount, 5) = recrow("Doc_Dt")

                    '        CNVCHRSheet.Cells(ExpCount, 6) = ""

                    '        CNVCHRSheet.Cells(ExpCount, 7) = "C"

                    '        CNVCHRSheet.Cells(ExpCount, 8) = recrow("PlaceofSupply")
                    '        CNVCHRSheet.Cells(ExpCount, 9) = recrow("Net_Amt") 'recrow("GST5") + recrow("CGST25") + recrow("SGST25") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18")
                    '        CNVCHRSheet.Cells(ExpCount, 10) = ""
                    '        'If perc > 1 And perc < 6 Then
                    '        CNVCHRSheet.Cells(ExpCount, 11) = Val(recrow("Tax_Perc"))
                    '        'ElseIf perc > 6 And perc < 13 Then
                    '        '    CDNRSheet.Cells(countcdnr, 10) = Val(12)
                    '        'ElseIf perc > 13 And perc < 19 Then
                    '        '    CDNRSheet.Cells(countcdnr, 10) = Val(18)
                    '        'ElseIf perc > 19 And perc < 29 Then
                    '        '    B2CSSheet.Cells(countcdnr, 10) = 28
                    '        'Else
                    '        '    CDNRSheet.Cells(countcdnr, 10) = Val(0)
                    '        'End If

                    '        CNVCHRSheet.Cells(ExpCount, 12) = Val(recrow("GST_On_Amt") & "") 'Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18")))
                    '        CNVCHRSheet.Cells(ExpCount, 13) = "" '0
                    '        CNVCHRSheet.Cells(ExpCount, 14) = ""


                    '        CNVCHRSheet.Cells(ExpCount, 15) = "" '0
                    '        CNVCHRSheet.Cells(ExpCount, 16) = ""

                    '        ExpCount += 1

                    '        ' DocCDNR += 1
                    '    Next recrow

                    'End If




                    ' ------------
                    ' End If





                    Try
                        If cmbSelection.SelectedIndex = 3 Then
                            xlSheet.SaveAs(Application.StartupPath & "GSTR1-" & GST & "(CNR)" & "-" & Today & ".xlsx")
                        Else
                            xlSheet.SaveAs(Application.StartupPath & "GSTR1-" & GST & "(CNUR)" & "-" & Today & ".xlsx")
                        End If
                        xlApp.Visible = True
                    Catch ex As Exception
                        Exit Sub
                    End Try
                ElseIf cmbSelection.SelectedIndex = 5 Or cmbSelection.SelectedIndex = 6 Then 'Debit Note(Registered)/Debit Note(Un-Registered)
                    If cmbSelection.SelectedIndex = 5 Then
                        Reg = "And  Ledger.GSTNo<>''"
                    Else
                        Reg = "And  Ledger.GSTNo=''"
                    End If
                    xlSheet.Cells(1, 1) = "Sr No."
                    xlSheet.Cells(1, 2) = "GSTIN"
                    xlSheet.Cells(1, 3) = "Party"
                    xlSheet.Cells(1, 4) = "DN No."
                    xlSheet.Cells(1, 5) = "DN Date"
                    xlSheet.Cells(1, 6) = "Invoice No"
                    xlSheet.Cells(1, 7) = "Invoice Date"
                    xlSheet.Cells(1, 8) = "Document Type"
                    xlSheet.Cells(1, 9) = "Place of Supply"
                    xlSheet.Cells(1, 10) = "Supply Type"
                    xlSheet.Cells(1, 11) = "DN Value"
                    ''5%
                    xlSheet.Cells(1, 12) = "Taxable" & vbLf & "5%"
                    xlSheet.Cells(1, 13) = "CGST" & vbLf & "2.5%"
                    xlSheet.Cells(1, 14) = "SGST" & vbLf & "2.5%"
                    xlSheet.Cells(1, 15) = "IGST" & vbLf & "5%"
                    ''12%
                    xlSheet.Cells(1, 16) = "Taxable" & vbLf & "12%"
                    xlSheet.Cells(1, 17) = "CGST" & vbLf & "6%"
                    xlSheet.Cells(1, 18) = "SGST" & vbLf & "6%"
                    xlSheet.Cells(1, 19) = "IGST" & vbLf & "12%"

                    ''18%
                    xlSheet.Cells(1, 20) = "Taxable" & vbLf & "18%"
                    xlSheet.Cells(1, 21) = "CGST" & vbLf & "9%"
                    xlSheet.Cells(1, 22) = "SGST" & vbLf & "9%"
                    xlSheet.Cells(1, 23) = "IGST" & vbLf & "18%"
                    ''28%
                    xlSheet.Cells(1, 24) = "Taxable" & vbLf & "28%"
                    xlSheet.Cells(1, 25) = "CGST" & vbLf & "14%"
                    xlSheet.Cells(1, 26) = "SGST" & vbLf & "14%"
                    xlSheet.Cells(1, 27) = "IGST" & vbLf & "28%"

                    xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 27)).Font.Bold = True
                    Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_DNRegistered]')) " _
                        & " Drop View [dbo].[vw_DNRegistered]"
                    Common.ExecuteQuery(Query)
                    Query = " Create View [vw_DNRegistered] as Select State.Alt_code,PurchaseRtn.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,PurchaseRtn.Doc_no AS InvoiceNo,PurchaseRtn.Taxable_Amt+PurchaseRtn.Tax_Amt+PurchaseRtn.OthChgs_Amt Gross_Total,PurchaseRtn.Doc_Dt ," _
 & " '' as  Party_RefNo, " _
                    & " '' as Party_RefDt," _
                                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST5," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST5," _
                                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST12," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST12," _
                                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST18," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST18," _
                                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST28," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST28" _
                                & " from PurchaseRtn Left Join Ledger on Ledger.Led_Key=PurchaseRtn.Supl_Key  " _
                                & " LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                & " Where PurchaseRtn.Status = '1'  " _
                                & " AND PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' " _
                                & Reg _
                                & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,PurchaseRtn.Doc_no  ,PurchaseRtn.Doc_Dt ,Ledger.GSTNo ,PurchaseRtn.Doc_Id,PurchaseRtn.Taxable_Amt,PurchaseRtn.Tax_Amt,PurchaseRtn.OthChgs_Amt " _
  






                    Common.ExecuteQuery(Query)
                    Query = "SELECT GSTNo,Party,InvoiceNo,Alt_code StateCode,Doc_Dt,Party_RefNo,Party_RefDt,sum(Gross_Total)Gross_Total,PlaceofSupply,sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28 FROM vw_DNRegistered " _
                & " Group By GSTNo,Alt_code,Party,InvoiceNo,Doc_Dt,PlaceofSupply,Party_RefNo,Party_RefDt Order by  InvoiceNo Asc"
                    Dim dtCNRegistered As DataTable = Common.GetDataTable(Query)
                    Dim recrow As DataRow
                    If dtCNRegistered.Rows.Count > 0 Then
                        Dim i As Integer = 2
                        Dim j As Integer = 2
                        Dim k As Integer = 1
                        For Each recrow In dtCNRegistered.Rows
                            xlSheet.Cells(j, 1) = k
                            xlSheet.Cells(i, 2) = recrow("GSTNO")
                            xlSheet.Cells(i, 3) = recrow("Party")
                            xlSheet.Cells(i, 4) = recrow("InvoiceNo")
                            xlSheet.Cells(i, 5) = recrow("DOC_DT")

                            xlSheet.Cells(i, 6) = recrow("Party_RefNo")
                            xlSheet.Cells(i, 7) = recrow("Party_RefDt")

                            xlSheet.Cells(i, 8) = "D "
                            xlSheet.Cells(i, 9) = recrow("PLACEOFSUPPLY")
                            xlSheet.Cells(i, 10) = IIf(GSTDigit = recrow("StateCode"), "Intra-State", "Inter-State")

                            If Val(recrow("IGST28")) > 0 Then
                                xlSheet.Cells(i, 11) = recrow("Gross_Total")

                                xlSheet.Cells(i, 12) = recrow("GST5")
                                xlSheet.Cells(i, 13) = recrow("CGST")
                                xlSheet.Cells(i, 14) = recrow("SGST")
                                xlSheet.Cells(i, 15) = recrow("IGST5")
                                xlSheet.Cells(i, 16) = recrow("GST12")
                                xlSheet.Cells(i, 17) = recrow("CGST6")
                                xlSheet.Cells(i, 18) = recrow("SGST6")
                                xlSheet.Cells(i, 19) = recrow("IGST12")
                                xlSheet.Cells(i, 20) = recrow("GST18")
                                xlSheet.Cells(i, 21) = recrow("CGST9")
                                xlSheet.Cells(i, 22) = recrow("SGST9")
                                xlSheet.Cells(i, 23) = recrow("IGST18")
                                xlSheet.Cells(i, 24) = recrow("GST28")
                                xlSheet.Cells(i, 25) = recrow("CGST14")
                                xlSheet.Cells(i, 26) = recrow("SGST14")
                            Else

                                



                                xlSheet.Cells(i, 11) = recrow("GST5") + recrow("CGST") + recrow("SGST") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("GST28") + recrow("CGST14") + recrow("SGST14") + recrow("IGST5") + recrow("IGST12") + recrow("IGST18") + recrow("IGST28")
                                xlSheet.Cells(i, 12) = recrow("GST5")
                                xlSheet.Cells(i, 13) = recrow("CGST")
                                xlSheet.Cells(i, 14) = recrow("SGST")
                                xlSheet.Cells(i, 15) = recrow("IGST5")
                                xlSheet.Cells(i, 16) = recrow("GST12")
                                xlSheet.Cells(i, 17) = recrow("CGST6")
                                xlSheet.Cells(i, 18) = recrow("SGST6")
                                xlSheet.Cells(i, 19) = recrow("IGST12")
                                xlSheet.Cells(i, 20) = recrow("GST18")
                                xlSheet.Cells(i, 21) = recrow("CGST9")
                                xlSheet.Cells(i, 22) = recrow("SGST9")
                                xlSheet.Cells(i, 23) = recrow("IGST18")
                                xlSheet.Cells(i, 24) = recrow("GST28")
                                xlSheet.Cells(i, 25) = recrow("CGST14")
                                xlSheet.Cells(i, 26) = recrow("SGST14")
                            End If





                            xlSheet.Cells(i, 27) = IIf(recrow("IGST28") > 0, 0, recrow("IGST28"))


                            i += 1
                            j += 1
                            k += 1
                        Next recrow
                        Query = "SELECT sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28 " _
                                & " FROM vw_DNRegistered "
                        Dim dtb2CSmallSum As DataTable = Common.GetDataTable(Query)
                        Dim recrowsum As DataRow
                        For Each recrowsum In dtb2CSmallSum.Rows
                            xlSheet.Cells(i + 1, 2) = "GRAND TOTAL"

                            ' If Val(recrowsum("IGST28")) > 0 Then
                            'xlSheet.Cells(i + 1, 11) = recrowsum("IGST28")
                            ' Else
                            xlSheet.Cells(i + 1, 11) = recrowsum("GST5") + recrowsum("CGST") + recrowsum("SGST") + recrowsum("GST12") + recrowsum("CGST6") + recrowsum("SGST6") + recrowsum("GST18") + recrowsum("CGST9") + recrowsum("SGST9") + recrowsum("GST28") + recrowsum("CGST14") + recrowsum("SGST14") + recrowsum("IGST5") + recrowsum("IGST12") + recrowsum("IGST18") + recrowsum("IGST28")
                            ' End If

                            xlSheet.Cells(i + 1, 12) = recrowsum("GST5")
                            xlSheet.Cells(i + 1, 13) = recrowsum("CGST")
                            xlSheet.Cells(i + 1, 14) = recrowsum("SGST")
                            xlSheet.Cells(i + 1, 15) = recrowsum("IGST5")
                            xlSheet.Cells(i + 1, 16) = recrowsum("GST12")
                            xlSheet.Cells(i + 1, 17) = recrowsum("CGST6")
                            xlSheet.Cells(i + 1, 18) = recrowsum("SGST6")
                            xlSheet.Cells(i + 1, 19) = recrowsum("IGST12")
                            xlSheet.Cells(i + 1, 20) = recrowsum("GST18")
                            xlSheet.Cells(i + 1, 21) = recrowsum("CGST9")
                            xlSheet.Cells(i + 1, 22) = recrowsum("SGST9")
                            xlSheet.Cells(i + 1, 23) = recrowsum("IGST18")
                            xlSheet.Cells(i + 1, 24) = recrowsum("GST28")
                            xlSheet.Cells(i + 1, 25) = recrowsum("CGST14")
                            xlSheet.Cells(i + 1, 26) = recrowsum("SGST14")
                            xlSheet.Cells(i + 1, 27) = IIf(recrowsum("IGST28") > 0, 0, recrowsum("IGST28"))
                        Next
                        xlSheet.Range("D1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                        xlSheet.Range(xlSheet.Cells(i + 1, 2), xlSheet.Cells(i + 1, 27)).Font.Bold = True
                    End If
                    xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                    xlSheet.Columns.AutoFit()
                    Try
                        If cmbSelection.SelectedIndex = 5 Then
                            xlSheet.SaveAs(Application.StartupPath & "GSTR1-" & GST & "(DNR)" & "-" & Today & ".xlsx")
                        Else
                            xlSheet.SaveAs(Application.StartupPath & "GSTR1-" & GST & "(DNUR)" & "-" & Today & ".xlsx")
                        End If
                        xlApp.Visible = True
                    Catch ex As Exception
                        Exit Sub
                    End Try
                ElseIf cmbSelection.SelectedIndex = 7 Or cmbSelection.SelectedIndex = 8 Then

                    If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForSandDune)) = 1 Then

                        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                        ''-====================================================================


                        xlSheet.Cells(1, 1) = "Sr No."
                        xlSheet.Cells(1, 2) = "HSN Code"

                        xlSheet.Cells(1, 3) = "GST(%)"

                        xlSheet.Cells(1, 4) = "Discription"
                        xlSheet.Cells(1, 5) = "Unit"
                        xlSheet.Cells(1, 6) = "Total Qty"
                        xlSheet.Cells(1, 7) = "Total value"
                        xlSheet.Cells(1, 8) = "Taxable value"
                        xlSheet.Cells(1, 9) = "CGST"
                        xlSheet.Cells(1, 10) = "SGST"
                        xlSheet.Cells(1, 11) = "IGST"


                        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 15)).Font.Bold = True

                        If cmbSelection.SelectedIndex = 8 Then
                            Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_HSNItem]')) " _
                               & " Drop View [dbo].[vw_HSNItem]"
                        ElseIf cmbSelection.SelectedIndex = 7 Then
                            Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_HSN]')) " _
                               & " Drop View [dbo].[vw_HSN]"
                        End If
                        Common.ExecuteQuery(Query)
                        If cmbSelection.SelectedIndex = 7 Then
                            If GetSettingAsPerId(ApplnSettingsIdx.GenUseSize) = "1" Then
                                ''CHANGE BY RAHUL ON 26/09/2019

                                ''    Query = "Create View [vw_HSN] as " _
                                ''        & " Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                ''        & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt " _
                                ''        & "  from salebilldtl" _
                                ''        & " Inner Join Style On Style.Style_Key=salebilldtl.Style_Key " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' Group by HsnCode,UNIT_NAME " _
                                ''        & " Union All " _
                                ''        & " Select HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(Taxable)Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                ''        & " -Sum(salesrtndtl.Tax1_Amt)CGSTAmt,-Sum(salesrtndtl.Tax2_Amt)SGSTAmt,-Sum(salesrtndtl.Tax3_Amt)IGSTAmt " _
                                ''        & " from salesrtndtl  " _
                                ''        & " Inner Join Style On Style.Style_Key=salesrtndtl.Style_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY   " _
                                ''        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by HsnCode,UNIT_NAME " _
                                ''        & " Union All " _
                                ''        & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                ''        & " -Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt,-Sum(Tax3_Amt)IGSTAmt   from cndtl Inner Join Style On Style.Style_Key=cndtl.Style_Key   " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id   " _
                                ''       & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by HsnCode,UNIT_NAME" _
                                ''        & " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                                ''& " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                                ''& " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                                ''& " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve  "

                                Query = "Create View [vw_HSN] as " _
                                    & " Select salebilldtl.TaxPerc ,Item.Item_name,Style.HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                    & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt " _
                                    & "  from salebilldtl" _
                                    & " Inner Join Style On Style.Style_Key=salebilldtl.Style_Key " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY  Left Join ITEm on Item.Item_Key=   salebilldtl.Item_Key Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                    & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME,salebilldtl.TaxPerc,Item.Item_name " _
                                    & " Union All " _
                                    & " Select salesrtndtl.TaxPerc,Item.Item_name,Style.HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(Taxable)Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                    & " -Sum(salesrtndtl.Tax1_Amt)CGSTAmt,-Sum(salesrtndtl.Tax2_Amt)SGSTAmt,-Sum(salesrtndtl.Tax3_Amt)IGSTAmt " _
                                    & " from salesrtndtl  " _
                                    & " Inner Join Style On Style.Style_Key=salesrtndtl.Style_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY   Left Join ITEm on Item.Item_Key=   salesrtndtl.Item_Key  " _
                                    & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME ,salesrtndtl.TaxPerc,Item.Item_name " _
                                    & " Union All " _
                                    & " Select cndtl.TaxPerc,Item.Item_name,Style.HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                    & " -Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt,-Sum(Tax3_Amt)IGSTAmt   from cndtl Inner Join Style On Style.Style_Key=cndtl.Style_Key   " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id Left Join ITEm on Item.Item_Key=   cndtl.Item_Key   " _
                                   & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME ,cndtl.TaxPerc,Item.Item_name " _
                                    & " Union All " _
                            & "  Select (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ) TaxPerc, " _
                            & " TaxTermsTds.TxTmTDS_Name ITEM_NAME,TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SaleBill.Led_Key Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                            & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve,TaxTermsTds.TxTmTDS_Name   " _
                            & " Union All " _
                            & "  Select (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ) TaxPerc," _
                            & " TaxTermsTds.TxTmTDS_Name ITEM_NAME,TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                            & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve,TaxTermsTds.TxTmTDS_Name   " _
                            & " Union All " _
                            & " Select (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ) TaxPerc , " _
                            & " TaxTermsTds.TxTmTDS_Name ITEM_NAME,TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                            & " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve,TaxTermsTds.TxTmTDS_Name   "
                            Else
                                ''    Query = "Create View [vw_HSN] as " _
                                ''        & " Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100 Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((Sum(salebilldtl.TotAmtAftDisc)-(Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt " _
                                ''        & "  from salebilldtl Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''        & " Inner Join Item On Item.Item_Key=salebilldtl.Item_Key Inner join Ledger on Ledger.Led_key=SaleBill.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key" _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY  " _
                                ''        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME,LedType.Type_Inve,Item.GSTPerc " _
                                ''        & " Union All " _
                                ''        & " Select HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100 Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(salesrtndtl.TotAmtAftDisc)-(Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt  " _
                                ''        & " from salesrtndtl  " _
                                ''        & " Inner Join Item On Item.Item_Key=salesrtndtl.Item_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join Ledger on Ledger.Led_key=salesrtn.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key  " _
                                ''        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve ,Item.GSTPerc" _
                                ''        & " Union All " _
                                ''        & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100 Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(cndtl.TotAmtAftDisc)-(Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt   from cndtl Inner Join Item On Item.Item_Key=cndtl.Item_Key   " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  Inner join Ledger on Ledger.Led_key=CN.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                ''       & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve,Item.GSTPerc " _
                                ''        & " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                                ''& " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                                ''& " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve  " _
                                '' & " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                                ''& " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve  "

                                Query = "Create View [vw_HSN] as " _
                                    & " Select  salebilldtl.TaxPerc,HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100 Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((Sum(salebilldtl.TotAmtAftDisc)-(Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt " _
                                    & "  from salebilldtl Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                    & " Inner Join Item On Item.Item_Key=salebilldtl.Item_Key Inner join Ledger on Ledger.Led_key=SaleBill.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key" _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY  " _
                                    & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME,LedType.Type_Inve,Item.GSTPerc, salebilldtl.TaxPerc " _
                                    & " Union All " _
                                    & " Select  salertndtl.TaxPerc,HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100 Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(salesrtndtl.TotAmtAftDisc)-(Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt  " _
                                    & " from salesrtndtl  " _
                                    & " Inner Join Item On Item.Item_Key=salesrtndtl.Item_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join Ledger on Ledger.Led_key=salesrtn.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key  " _
                                    & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve ,Item.GSTPerc, salesrtndtl.TaxPerc " _
                                    & " Union All " _
                                    & " Select  cndtl.TaxPerc,HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100 Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(cndtl.TotAmtAftDisc)-(Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt   from cndtl Inner Join Item On Item.Item_Key=cndtl.Item_Key   " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  Inner join Ledger on Ledger.Led_key=CN.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                   & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve,Item.GSTPerc,cndtl.TaxPerc " _
                                    & " Union All " _
                            & "  Select 0 TaxPerc, TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SaleBill.Led_Key Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                            & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve  " _
                            & " Union All " _
                            & "  Select 0 TaxPerc, TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                            & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve  " _
                             & " Union All " _
                            & "  Select 0 TaxPerc,TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                            & " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve  "
                                ''END
                            End If


                        ElseIf cmbSelection.SelectedIndex = 8 Then
                            If GetSettingAsPerId(ApplnSettingsIdx.GenUseSize) = "1" Then
                                ''CHANGE BY RAHUL ON 26/09/2019

                                ''    Query = "Create View [vw_HSNItem] as  " _
                                ''        & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                ''        & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                ''        & " from salebilldtl  " _
                                ''        & " Inner Join Style On Style.Style_Key=salebilldtl.Style_Key " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY " _
                                ''        & " Left Join ITEm on Item.Item_Key=   salebilldtl.Item_Key Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id" _
                                ''        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "'  Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name  " _
                                ''        & " Union All " _
                                ''        & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                ''        & " -Sum(salesrtndtl.Tax1_Amt)CGSTAmt,-Sum(salesrtndtl.Tax2_Amt)SGSTAmt,-Sum(salesrtndtl.Tax3_Amt)IGSTAmt" _
                                ''        & " from salesrtndtl " _
                                ''        & " Inner Join Style On Style.Style_Key=salesrtndtl.Style_Key " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                ''        & " Left Join ITEm on Item.Item_Key=   salesrtndtl.Item_Key " _
                                ''        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name " _
                                ''        & " Union All " _
                                ''        & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                ''        & " -Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt,-Sum(Tax3_Amt)IGSTAmt   from cndtl Inner Join Style On Style.Style_Key=cndtl.Style_Key Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY     Left Join ITEm on Item.Item_Key= cndtl.Item_Key Where  cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME  ,ITEM.ITEM_Name  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                                ''& " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, Salebill.Doc_id,Type_Inve  " _
                                '' & " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                                ''& " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, CN.Doc_id,Type_Inve  " _
                                ''  & " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key  Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                                ''& " where SalesRtn.Doc_Type='A' ANd  Direct_CN=1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, SalesRtn.Doc_id,Type_Inve  "

                                Query = "Create View [vw_HSNItem] as  " _
                                    & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                    & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                    & " from salebilldtl  " _
                                    & " Inner Join Style On Style.Style_Key=salebilldtl.Style_Key " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY " _
                                    & " Left Join ITEm on Item.Item_Key=   salebilldtl.Item_Key Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id" _
                                    & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "'  Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name  " _
                                    & " Union All " _
                                    & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                    & " -Sum(salesrtndtl.Tax1_Amt)CGSTAmt,-Sum(salesrtndtl.Tax2_Amt)SGSTAmt,-Sum(salesrtndtl.Tax3_Amt)IGSTAmt" _
                                    & " from salesrtndtl " _
                                    & " Inner Join Style On Style.Style_Key=salesrtndtl.Style_Key " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                    & " Left Join ITEm on Item.Item_Key=   salesrtndtl.Item_Key " _
                                    & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name " _
                                    & " Union All " _
                                    & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                    & " -Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt,-Sum(Tax3_Amt)IGSTAmt   from cndtl Inner Join Style On Style.Style_Key=cndtl.Style_Key Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY     Left Join ITEm on Item.Item_Key= cndtl.Item_Key Where  cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME  ,ITEM.ITEM_Name  " _
                            & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SaleBill.Led_Key Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                            & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, Salebill.Doc_id,Type_Inve  " _
                             & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key= CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                            & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, CN.Doc_id,Type_Inve  " _
                              & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key  Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                            & " where SalesRtn.Doc_Type='A' ANd  Direct_CN=1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, SalesRtn.Doc_id,Type_Inve  "

                            Else
                                ''    Query = "Create View [vw_HSNItem] as  " _
                                ''        & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(Qty)Qty,Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100 Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((Sum(salebilldtl.TotAmtAftDisc)-(Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt " _
                                ''        & " from salebilldtl Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY Inner join Ledger on Ledger.Led_key=SaleBill.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                ''        & " Left Join ITEm on Item.Item_Key=   salebilldtl.Item_Key " _
                                ''        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "'  Group by Salebill.BillDisc_Perc,Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc  " _
                                ''        & " Union All " _
                                ''        & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100 Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(salesrtndtl.TotAmtAftDisc)-(Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt  " _
                                ''        & " from salesrtndtl " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                ''        & " Left Join ITEm on Item.Item_Key=   salesrtndtl.Item_Key Inner join Ledger on Ledger.Led_key=salesrtn.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                ''        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by salesrtn.BillDisc_Perc,Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc  " _
                                ''        & " Union All " _
                                ''        & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100 Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(cndtl.TotAmtAftDisc)-(Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt     from cndtl Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  Inner join Ledger on Ledger.Led_key=CN.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY     Left Join ITEm on Item.Item_Key= cndtl.Item_Key Where  cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by cn.BillDisc_Perc,Item.HsnCode,UNIT_NAME  ,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc   " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                                ''& " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, Salebill.Doc_id,Type_Inve  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                                ''& " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, CN.Doc_id,Type_Inve  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key  Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                                ''& " where SalesRtn.Doc_Type='A' ANd  Direct_CN=1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, SalesRtn.Doc_id,Type_Inve  "

                                Query = "Create View [vw_HSNItem] as  " _
                                    & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(Qty)Qty,Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100 Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((Sum(salebilldtl.TotAmtAftDisc)-(Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt " _
                                    & " from salebilldtl Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY Inner join Ledger on Ledger.Led_key=SaleBill.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                    & " Left Join ITEm on Item.Item_Key=   salebilldtl.Item_Key " _
                                    & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "'  Group by Salebill.BillDisc_Perc,Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc  " _
                                    & " Union All " _
                                    & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100 Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(salesrtndtl.TotAmtAftDisc)-(Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt  " _
                                    & " from salesrtndtl " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                    & " Left Join ITEm on Item.Item_Key=   salesrtndtl.Item_Key Inner join Ledger on Ledger.Led_key=salesrtn.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                    & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by salesrtn.BillDisc_Perc,Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc  " _
                                    & " Union All " _
                                    & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100 Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(cndtl.TotAmtAftDisc)-(Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt     from cndtl Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  Inner join Ledger on Ledger.Led_key=CN.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY     Left Join ITEm on Item.Item_Key= cndtl.Item_Key Where  cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by cn.BillDisc_Perc,Item.HsnCode,UNIT_NAME  ,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc   " _
                            & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SaleBill.Led_Key Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                            & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, Salebill.Doc_id,Type_Inve  " _
                            & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key= CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                            & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, CN.Doc_id,Type_Inve  " _
                            & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key  Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                            & " where SalesRtn.Doc_Type='A' ANd  Direct_CN=1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, SalesRtn.Doc_id,Type_Inve  "
                            End If

                        End If
                        Common.ExecuteQuery(Query)
                        If cmbSelection.SelectedIndex = 8 Then
                            Query = "SELECT HSNCODE,ITEM_NAME,UNIT_NAME,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                       & " FROM vw_HSNItem " _
                                       & " Group By HSNCODE,UNIT_NAME,ITEM_NAME "
                        Else
                            Query = "SELECT TaxPerc,ITEM_NAME, HSNCODE,UNIT_NAME,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                       & " FROM vw_HSN " _
                                       & " Group By HSNCODE,UNIT_NAME,TaxPerc,ITEM_NAME "
                        End If
                        Dim dtHSNWise As DataTable = Common.GetDataTable(Query)
                        Dim recrow As DataRow
                        If dtHSNWise.Rows.Count > 0 Then
                            Dim i As Integer = 2
                            Dim j As Integer = 2
                            Dim k As Integer = 1
                            For Each recrow In dtHSNWise.Rows
                                xlSheet.Cells(j, 1) = k
                                xlSheet.Cells(i, 2) = recrow("HSNCODE")
                                If cmbSelection.SelectedIndex = 8 Then
                                    xlSheet.Cells(i, 3) = ""
                                Else
                                    xlSheet.Cells(i, 3) = recrow("TaxPerc")
                                End If

                                If cmbSelection.SelectedIndex = 8 Then
                                    xlSheet.Cells(i, 4) = recrow("ITEM_NAME")
                                Else
                                    xlSheet.Cells(i, 4) = recrow("ITEM_NAME")
                                End If
                                xlSheet.Cells(i, 5) = recrow("UNIT_NAME")
                                xlSheet.Cells(i, 6) = recrow("Qty")
                                xlSheet.Cells(i, 7) = recrow("TAXABLE") + recrow("IGST") + recrow("SGST") + recrow("CGST")
                                xlSheet.Cells(i, 8) = recrow("TAXABLE")
                                xlSheet.Cells(i, 9) = recrow("CGST")
                                xlSheet.Cells(i, 10) = recrow("SGST")
                                xlSheet.Cells(i, 11) = recrow("IGST")

                                i += 1
                                j += 1
                                k += 1
                            Next recrow
                            If cmbSelection.SelectedIndex = 8 Then
                                Query = "SELECT SUM(TAXABLE) TAXABLE,sum(Qty) Qty,sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                   & "  FROM vw_HSNItem "
                            Else
                                Query = "SELECT SUM(TAXABLE) TAXABLE, sum(Qty) Qty,sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                            & "  FROM vw_HSN "
                            End If

                            Dim dtHSNWiseSum As DataTable = Common.GetDataTable(Query)
                            Dim recrowsum As DataRow
                            For Each recrowsum In dtHSNWiseSum.Rows
                                xlSheet.Cells(i + 1, 3) = "GRAND TOTAL"
                                xlSheet.Cells(i + 1, 6) = recrowsum("Qty")
                                xlSheet.Cells(i + 1, 7) = recrowsum("TAXABLE") + recrowsum("IGST") + recrowsum("SGST") + recrowsum("CGST")
                                xlSheet.Cells(i + 1, 8) = recrowsum("TAXABLE")
                                xlSheet.Cells(i + 1, 9) = recrowsum("CGST")
                                xlSheet.Cells(i + 1, 10) = recrowsum("SGST")
                                xlSheet.Cells(i + 1, 11) = recrowsum("IGST")
                            Next
                            xlSheet.Range("D1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                            xlSheet.Range(xlSheet.Cells(i + 3, 3), xlSheet.Cells(i + 3, 11)).Font.Bold = True
                        End If
                        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                        xlSheet.Columns.AutoFit()
                        Try
                            If cmbSelection.SelectedIndex = 8 Then
                                xlSheet.SaveAs(Application.StartupPath & "GSTR1-" & GST & "(HSNItemWise)" & "-" & Today & ".xlsx")
                            Else
                                xlSheet.SaveAs(Application.StartupPath & "GSTR1-" & GST & "(HSNWise)" & "-" & Today & ".xlsx")
                            End If
                            xlApp.Visible = True
                        Catch ex As Exception
                            Exit Sub
                        End Try


                        '==============================================================================

                    Else

                        xlSheet.Cells(1, 1) = "Sr No."
                        xlSheet.Cells(1, 2) = "HSN Code"
                        xlSheet.Cells(1, 3) = "Discription"
                        xlSheet.Cells(1, 4) = "Unit"
                        xlSheet.Cells(1, 5) = "Total Qty"
                        xlSheet.Cells(1, 6) = "Total value"
                        xlSheet.Cells(1, 7) = "Taxable value"
                        xlSheet.Cells(1, 8) = "CGST"
                        xlSheet.Cells(1, 9) = "SGST"
                        xlSheet.Cells(1, 10) = "IGST"


                        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 15)).Font.Bold = True

                        If cmbSelection.SelectedIndex = 8 Then
                            Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_HSNItem]')) " _
                               & " Drop View [dbo].[vw_HSNItem]"
                        ElseIf cmbSelection.SelectedIndex = 7 Then
                            Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_HSN]')) " _
                               & " Drop View [dbo].[vw_HSN]"
                        End If
                        Common.ExecuteQuery(Query)
                        If cmbSelection.SelectedIndex = 7 Then
                            If GetSettingAsPerId(ApplnSettingsIdx.GenUseSize) = "1" Then
                                ''CHANGE BY RAHUL ON 26/09/2019

                                ''    Query = "Create View [vw_HSN] as " _
                                ''        & " Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                ''        & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt " _
                                ''        & "  from salebilldtl" _
                                ''        & " Inner Join Style On Style.Style_Key=salebilldtl.Style_Key " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' Group by HsnCode,UNIT_NAME " _
                                ''        & " Union All " _
                                ''        & " Select HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(Taxable)Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                ''        & " -Sum(salesrtndtl.Tax1_Amt)CGSTAmt,-Sum(salesrtndtl.Tax2_Amt)SGSTAmt,-Sum(salesrtndtl.Tax3_Amt)IGSTAmt " _
                                ''        & " from salesrtndtl  " _
                                ''        & " Inner Join Style On Style.Style_Key=salesrtndtl.Style_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY   " _
                                ''        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by HsnCode,UNIT_NAME " _
                                ''        & " Union All " _
                                ''        & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                ''        & " -Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt,-Sum(Tax3_Amt)IGSTAmt   from cndtl Inner Join Style On Style.Style_Key=cndtl.Style_Key   " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id   " _
                                ''       & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by HsnCode,UNIT_NAME" _
                                ''        & " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                                ''& " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                                ''& " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                                ''& " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve  "

                                Query = "Create View [vw_HSN] as " _
                                    & " Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                    & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt " _
                                    & "  from salebilldtl" _
                                    & " Inner Join Style On Style.Style_Key=salebilldtl.Style_Key " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                    & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' Group by HsnCode,UNIT_NAME " _
                                    & " Union All " _
                                    & " Select HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(Taxable)Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                    & " -Sum(salesrtndtl.Tax1_Amt)CGSTAmt,-Sum(salesrtndtl.Tax2_Amt)SGSTAmt,-Sum(salesrtndtl.Tax3_Amt)IGSTAmt " _
                                    & " from salesrtndtl  " _
                                    & " Inner Join Style On Style.Style_Key=salesrtndtl.Style_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY   " _
                                    & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by HsnCode,UNIT_NAME " _
                                    & " Union All " _
                                    & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                    & " -Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt,-Sum(Tax3_Amt)IGSTAmt   from cndtl Inner Join Style On Style.Style_Key=cndtl.Style_Key   " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id   " _
                                   & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by HsnCode,UNIT_NAME" _
                                    & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SaleBill.Led_Key Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                            & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve  " _
                            & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                            & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve  " _
                            & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                            & " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve  "
                            Else
                                ''    Query = "Create View [vw_HSN] as " _
                                ''        & " Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100 Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((Sum(salebilldtl.TotAmtAftDisc)-(Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt " _
                                ''        & "  from salebilldtl Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''        & " Inner Join Item On Item.Item_Key=salebilldtl.Item_Key Inner join Ledger on Ledger.Led_key=SaleBill.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key" _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY  " _
                                ''        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME,LedType.Type_Inve,Item.GSTPerc " _
                                ''        & " Union All " _
                                ''        & " Select HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100 Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(salesrtndtl.TotAmtAftDisc)-(Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt  " _
                                ''        & " from salesrtndtl  " _
                                ''        & " Inner Join Item On Item.Item_Key=salesrtndtl.Item_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join Ledger on Ledger.Led_key=salesrtn.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key  " _
                                ''        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve ,Item.GSTPerc" _
                                ''        & " Union All " _
                                ''        & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100 Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(cndtl.TotAmtAftDisc)-(Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt   from cndtl Inner Join Item On Item.Item_Key=cndtl.Item_Key   " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  Inner join Ledger on Ledger.Led_key=CN.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                ''       & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve,Item.GSTPerc " _
                                ''        & " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                                ''& " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                                ''& " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve  " _
                                '' & " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                                ''& " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve  "

                                Query = "Create View [vw_HSN] as " _
                                    & " Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100 Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((Sum(salebilldtl.TotAmtAftDisc)-(Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt " _
                                    & "  from salebilldtl Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                    & " Inner Join Item On Item.Item_Key=salebilldtl.Item_Key Inner join Ledger on Ledger.Led_key=SaleBill.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key" _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY  " _
                                    & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME,LedType.Type_Inve,Item.GSTPerc " _
                                    & " Union All " _
                                    & " Select HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100 Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(salesrtndtl.TotAmtAftDisc)-(Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt  " _
                                    & " from salesrtndtl  " _
                                    & " Inner Join Item On Item.Item_Key=salesrtndtl.Item_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join Ledger on Ledger.Led_key=salesrtn.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key  " _
                                    & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve ,Item.GSTPerc" _
                                    & " Union All " _
                                    & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100 Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(cndtl.TotAmtAftDisc)-(Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt   from cndtl Inner Join Item On Item.Item_Key=cndtl.Item_Key   " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  Inner join Ledger on Ledger.Led_key=CN.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                   & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve,Item.GSTPerc " _
                                    & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SaleBill.Led_Key Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                            & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve  " _
                            & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                            & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve  " _
                             & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                            & " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve  "
                                ''END
                            End If


                        ElseIf cmbSelection.SelectedIndex = 8 Then
                            If GetSettingAsPerId(ApplnSettingsIdx.GenUseSize) = "1" Then
                                ''CHANGE BY RAHUL ON 26/09/2019

                                ''    Query = "Create View [vw_HSNItem] as  " _
                                ''        & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                ''        & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                ''        & " from salebilldtl  " _
                                ''        & " Inner Join Style On Style.Style_Key=salebilldtl.Style_Key " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY " _
                                ''        & " Left Join ITEm on Item.Item_Key=   salebilldtl.Item_Key Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id" _
                                ''        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "'  Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name  " _
                                ''        & " Union All " _
                                ''        & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                ''        & " -Sum(salesrtndtl.Tax1_Amt)CGSTAmt,-Sum(salesrtndtl.Tax2_Amt)SGSTAmt,-Sum(salesrtndtl.Tax3_Amt)IGSTAmt" _
                                ''        & " from salesrtndtl " _
                                ''        & " Inner Join Style On Style.Style_Key=salesrtndtl.Style_Key " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                ''        & " Left Join ITEm on Item.Item_Key=   salesrtndtl.Item_Key " _
                                ''        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name " _
                                ''        & " Union All " _
                                ''        & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                ''        & " -Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt,-Sum(Tax3_Amt)IGSTAmt   from cndtl Inner Join Style On Style.Style_Key=cndtl.Style_Key Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY     Left Join ITEm on Item.Item_Key= cndtl.Item_Key Where  cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME  ,ITEM.ITEM_Name  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                                ''& " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, Salebill.Doc_id,Type_Inve  " _
                                '' & " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                                ''& " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, CN.Doc_id,Type_Inve  " _
                                ''  & " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key  Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                                ''& " where SalesRtn.Doc_Type='A' ANd  Direct_CN=1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, SalesRtn.Doc_id,Type_Inve  "

                                Query = "Create View [vw_HSNItem] as  " _
                                    & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                    & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                    & " from salebilldtl  " _
                                    & " Inner Join Style On Style.Style_Key=salebilldtl.Style_Key " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY " _
                                    & " Left Join ITEm on Item.Item_Key=   salebilldtl.Item_Key Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id" _
                                    & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "'  Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name  " _
                                    & " Union All " _
                                    & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                    & " -Sum(salesrtndtl.Tax1_Amt)CGSTAmt,-Sum(salesrtndtl.Tax2_Amt)SGSTAmt,-Sum(salesrtndtl.Tax3_Amt)IGSTAmt" _
                                    & " from salesrtndtl " _
                                    & " Inner Join Style On Style.Style_Key=salesrtndtl.Style_Key " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                    & " Left Join ITEm on Item.Item_Key=   salesrtndtl.Item_Key " _
                                    & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name " _
                                    & " Union All " _
                                    & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                    & " -Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt,-Sum(Tax3_Amt)IGSTAmt   from cndtl Inner Join Style On Style.Style_Key=cndtl.Style_Key Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY     Left Join ITEm on Item.Item_Key= cndtl.Item_Key Where  cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME  ,ITEM.ITEM_Name  " _
                            & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SaleBill.Led_Key Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                            & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, Salebill.Doc_id,Type_Inve  " _
                             & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key= CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                            & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, CN.Doc_id,Type_Inve  " _
                              & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key  Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                            & " where SalesRtn.Doc_Type='A' ANd  Direct_CN=1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, SalesRtn.Doc_id,Type_Inve  "

                            Else
                                ''    Query = "Create View [vw_HSNItem] as  " _
                                ''        & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(Qty)Qty,Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100 Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((Sum(salebilldtl.TotAmtAftDisc)-(Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt " _
                                ''        & " from salebilldtl Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY Inner join Ledger on Ledger.Led_key=SaleBill.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                ''        & " Left Join ITEm on Item.Item_Key=   salebilldtl.Item_Key " _
                                ''        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "'  Group by Salebill.BillDisc_Perc,Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc  " _
                                ''        & " Union All " _
                                ''        & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100 Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(salesrtndtl.TotAmtAftDisc)-(Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt  " _
                                ''        & " from salesrtndtl " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                ''        & " Left Join ITEm on Item.Item_Key=   salesrtndtl.Item_Key Inner join Ledger on Ledger.Led_key=salesrtn.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                ''        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by salesrtn.BillDisc_Perc,Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc  " _
                                ''        & " Union All " _
                                ''        & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100 Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                ''        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(cndtl.TotAmtAftDisc)-(Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt     from cndtl Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  Inner join Ledger on Ledger.Led_key=CN.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                ''        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY     Left Join ITEm on Item.Item_Key= cndtl.Item_Key Where  cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by cn.BillDisc_Perc,Item.HsnCode,UNIT_NAME  ,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc   " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                                ''& " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, Salebill.Doc_id,Type_Inve  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key= CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                                ''& " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, CN.Doc_id,Type_Inve  " _
                                ''& " Union All " _
                                ''& "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                ''& " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                ''& "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                                ''& " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                ''& " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                                ''& " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key  Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                                ''& " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                                ''& " where SalesRtn.Doc_Type='A' ANd  Direct_CN=1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, SalesRtn.Doc_id,Type_Inve  "

                                Query = "Create View [vw_HSNItem] as  " _
                                    & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(Qty)Qty,Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100 Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((Sum(salebilldtl.TotAmtAftDisc)-(Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt " _
                                    & " from salebilldtl Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY Inner join Ledger on Ledger.Led_key=SaleBill.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                    & " Left Join ITEm on Item.Item_Key=   salebilldtl.Item_Key " _
                                    & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "'  Group by Salebill.BillDisc_Perc,Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc  " _
                                    & " Union All " _
                                    & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100 Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(salesrtndtl.TotAmtAftDisc)-(Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt  " _
                                    & " from salesrtndtl " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                                    & " Left Join ITEm on Item.Item_Key=   salesrtndtl.Item_Key Inner join Ledger on Ledger.Led_key=salesrtn.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                    & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' Group by salesrtn.BillDisc_Perc,Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc  " _
                                    & " Union All " _
                                    & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100 Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                                    & " case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(cndtl.TotAmtAftDisc)-(Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt     from cndtl Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  Inner join Ledger on Ledger.Led_key=CN.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                                    & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY     Left Join ITEm on Item.Item_Key= cndtl.Item_Key Where  cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by cn.BillDisc_Perc,Item.HsnCode,UNIT_NAME  ,ITEM.ITEM_Name,LedType.Type_Inve,Item.GSTPerc   " _
                            & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SaleBill.Led_Key Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                            & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, Salebill.Doc_id,Type_Inve  " _
                            & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key= CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                            & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, CN.Doc_id,Type_Inve  " _
                            & " Union All " _
                            & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                            & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                            & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                            & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                            & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                            & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key  Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                            & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                            & " where SalesRtn.Doc_Type='A' ANd  Direct_CN=1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, SalesRtn.Doc_id,Type_Inve  "
                            End If

                        End If
                        Common.ExecuteQuery(Query)
                        If cmbSelection.SelectedIndex = 8 Then
                            Query = "SELECT HSNCODE,ITEM_NAME,UNIT_NAME,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                       & " FROM vw_HSNItem " _
                                       & " Group By HSNCODE,UNIT_NAME,ITEM_NAME "
                        Else
                            Query = "SELECT HSNCODE,UNIT_NAME,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                       & " FROM vw_HSN " _
                                       & " Group By HSNCODE,UNIT_NAME "
                        End If
                        Dim dtHSNWise As DataTable = Common.GetDataTable(Query)
                        Dim recrow As DataRow
                        If dtHSNWise.Rows.Count > 0 Then
                            Dim i As Integer = 2
                            Dim j As Integer = 2
                            Dim k As Integer = 1
                            For Each recrow In dtHSNWise.Rows
                                xlSheet.Cells(j, 1) = k
                                xlSheet.Cells(i, 2) = recrow("HSNCODE")
                                If cmbSelection.SelectedIndex = 8 Then
                                    xlSheet.Cells(i, 3) = recrow("ITEM_NAME")
                                End If
                                xlSheet.Cells(i, 4) = recrow("UNIT_NAME")
                                xlSheet.Cells(i, 5) = recrow("Qty")
                                xlSheet.Cells(i, 6) = recrow("TAXABLE") + recrow("IGST") + recrow("SGST") + recrow("CGST")
                                xlSheet.Cells(i, 7) = recrow("TAXABLE")
                                xlSheet.Cells(i, 8) = recrow("CGST")
                                xlSheet.Cells(i, 9) = recrow("SGST")
                                xlSheet.Cells(i, 10) = recrow("IGST")

                                i += 1
                                j += 1
                                k += 1
                            Next recrow
                            If cmbSelection.SelectedIndex = 8 Then
                                Query = "SELECT SUM(TAXABLE) TAXABLE,sum(Qty) Qty,sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                   & "  FROM vw_HSNItem "
                            Else
                                Query = "SELECT SUM(TAXABLE) TAXABLE, sum(Qty) Qty,sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                            & "  FROM vw_HSN "
                            End If

                            Dim dtHSNWiseSum As DataTable = Common.GetDataTable(Query)
                            Dim recrowsum As DataRow
                            For Each recrowsum In dtHSNWiseSum.Rows
                                xlSheet.Cells(i + 1, 2) = "GRAND TOTAL"
                                xlSheet.Cells(i + 1, 5) = recrowsum("Qty")
                                xlSheet.Cells(i + 1, 6) = recrowsum("TAXABLE") + recrowsum("IGST") + recrowsum("SGST") + recrowsum("CGST")
                                xlSheet.Cells(i + 1, 7) = recrowsum("TAXABLE")
                                xlSheet.Cells(i + 1, 8) = recrowsum("CGST")
                                xlSheet.Cells(i + 1, 9) = recrowsum("SGST")
                                xlSheet.Cells(i + 1, 10) = recrowsum("IGST")
                            Next
                            xlSheet.Range("D1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                            xlSheet.Range(xlSheet.Cells(i + 3, 2), xlSheet.Cells(i + 3, 10)).Font.Bold = True
                        End If
                        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                        xlSheet.Columns.AutoFit()
                        Try
                            If cmbSelection.SelectedIndex = 8 Then
                                xlSheet.SaveAs(Application.StartupPath & "GSTR1-" & GST & "(HSNItemWise)" & "-" & Today & ".xlsx")
                            Else
                                xlSheet.SaveAs(Application.StartupPath & "GSTR1-" & GST & "(HSNWise)" & "-" & Today & ".xlsx")
                            End If
                            xlApp.Visible = True
                        Catch ex As Exception
                            Exit Sub
                        End Try





                    End If




                End If
                Exit Sub
            End If
            '''GSTR-2
            If rptType = ReportType.GSTR2 Then
                Dim Trans As SqlTransaction
                Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
                Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
                Query = "Select GSTNo from cobr where cobr_id=  " & SelBranchLedFixId
                Dim GST As String = Common.ExecuteScalar(Query, Trans)
                Query = "Select Left(GSTNo,2) from cobr where cobr_id=  " & SelBranchLedFixId
                Dim GSTDigit As String = Common.ExecuteScalar(Query, Trans)
                Dim xlApp As New Excel.Application
                Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
                Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
                Dim Reg As String = ""
                Dim HSNSummery As String = ""
                If GetSettingAsPerId(ApplnSettingsIdx.PurchaseHSNSummeryFrom) = "P" Then
                    HSNSummery = "P"
                ElseIf GetSettingAsPerId(ApplnSettingsIdx.PurchaseHSNSummeryFrom) = "B" Then
                    HSNSummery = "B"
                End If

                If cmbSelection.SelectedIndex = 0 Or cmbSelection.SelectedIndex = 1 Then
                    If cmbSelection.SelectedIndex = 0 Then
                        Reg = "And  Ledger.GSTNo<>''"
                    Else
                        Reg = "And  Ledger.GSTNo=''"
                    End If

                    xlSheet.Cells(1, 1) = "Sr No."
                    xlSheet.Cells(1, 2) = "GSTIN"
                    xlSheet.Cells(1, 3) = "Party"
                    xlSheet.Cells(1, 4) = "Invoice No"
                    xlSheet.Cells(1, 5) = "Invoice Date"
                    xlSheet.Cells(1, 6) = "Place Of Supply"
                    xlSheet.Cells(1, 7) = "Total Invoice Value"
                    ''5%
                    xlSheet.Cells(1, 8) = "Taxable" & vbLf & " 5%"
                    xlSheet.Cells(1, 9) = "CGST" & vbLf & " 2.5%"
                    xlSheet.Cells(1, 10) = "SGST" & vbLf & " 2.5%"
                    xlSheet.Cells(1, 11) = "IGST" & vbLf & " 5%"
                    ''12%
                    xlSheet.Cells(1, 12) = "Taxable" & vbLf & " 12%"
                    xlSheet.Cells(1, 13) = "CGST" & vbLf & " 6%"
                    xlSheet.Cells(1, 14) = "SGST" & vbLf & " 6%"
                    xlSheet.Cells(1, 15) = "IGST" & vbLf & " 12%"
                    ''18%
                    xlSheet.Cells(1, 16) = "Taxable" & vbLf & " 18%"
                    xlSheet.Cells(1, 17) = "CGST" & vbLf & " 9%"
                    xlSheet.Cells(1, 18) = "SGST" & vbLf & " 9%"
                    xlSheet.Cells(1, 19) = "IGST" & vbLf & " 18%"
                    ''28%
                    xlSheet.Cells(1, 20) = "Taxable" & vbLf & " 28%"
                    xlSheet.Cells(1, 21) = "CGST" & vbLf & " 14%"
                    xlSheet.Cells(1, 22) = "SGST" & vbLf & " 14%"
                    xlSheet.Cells(1, 23) = "IGST" & vbLf & " 28%"
                    ''28%
                    xlSheet.Cells(1, 24) = "Taxable" & vbLf & " 0%"
                    xlSheet.Cells(1, 25) = "InvoiceNo"
                    xlSheet.Cells(1, 26) = "InvoiceDt"

                    xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 26)).Font.Bold = True
                    'xlSheet.Cells.Font.Bold = True


                    Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_B2BInvoices]')) " _
                              & " Drop View [dbo].[vw_B2BInvoices]"
                    Common.ExecuteQuery(Query)

                    Dim strSrch As String = ""
                    If HSNSummery = "B" Then
                        Query = "Create View vw_B2BInvoices As  " _
                            & " Select Isnull(PurchaseBill.Chln_No,'')Chln_No,Isnull(PurchaseBill.Chln_Dt,'')Chln_Dt,PurchaseBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,PurchaseBill.Doc_no AS InvoiceNo,PurchaseBill.Doc_Dt ," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseBilltxtm inner join taxtermsTDS on PurchaseBilltxTm.TaxTerm_Key=TaxTermsTDS.TxTmTDS_Key where TxTmTDS_Flag='X' and  PurchaseBilltxTm.AddSubTract='+' and TaxTerm_Perc in (0)  And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as GST0," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as GST5," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as CGST," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as SGST," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as IGST5," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as GST12," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as CGST6," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as SGST6," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as IGST12," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as GST18," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as CGST9," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as SGST9," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as IGST18," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as GST28," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as CGST14," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as SGST14," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseBilltxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And PurchaseBilltxTm.Doc_Id=PurchaseBill.Doc_Id) as IGST28" _
                            & " from PurchaseBill Left Join Ledger on Ledger.Led_Key=PurchaseBill.Party_Id  " _
                            & "LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                            & " Where PurchaseBill.Status = '1' " _
                            & Reg _
                            & " AND PurchaseBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND PurchaseBill.COBR_ID ='" & SelBranchId & "' " _
                            & " Group by PurchaseBill.Chln_No,PurchaseBill.Chln_Dt,State.Alt_Code,STATE.State_Name,Ledger.Abbr,PurchaseBill.Doc_no  ,PurchaseBill.Doc_Dt ,Ledger.GSTNo ,PurchaseBill.Doc_Id,PurchaseBill.Taxable_Amt,PurchaseBill.Tax_Amt,PurchaseBill.OthChgs_Amt"
                    ElseIf HSNSummery = "P" Then
                        Query = "Create View vw_B2BInvoices As  " _
                            & " Select Isnull(Purchase.Chln_No,'')Chln_No,Isnull(Purchase.Chln_Dt,'')Chln_Dt,Purchase.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,Purchase.Doc_no AS InvoiceNo,Purchase.Doc_Dt ," _
                            & "(Select Isnull(max(Taxable_Amt),0)from Purchasetxtm inner join taxtermsTDS on PurchasetxTm.TaxTerm_Key=TaxTermsTDS.TxTmTDS_Key where TxTmTDS_Flag='X' and  PurchasetxTm.AddSubTract='+' and PurchasetxTm.TaxTerm_Perc in (0)  And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as GST0," _
                            & "(Select Isnull(max(Taxable_Amt),0)from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as GST5," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as CGST," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as SGST," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as IGST5," _
                            & "(Select Isnull(max(Taxable_Amt),0)from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as GST12," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as CGST6," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as SGST6," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as IGST12," _
                            & "(Select Isnull(max(Taxable_Amt),0)from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as GST18," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as CGST9," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as SGST9," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as IGST18," _
                            & "(Select Isnull(max(Taxable_Amt),0)from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as GST28," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as CGST14," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as SGST14," _
                            & "(Select Isnull(max(Tax_Amt),0) from Purchasetxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And PurchasetxTm.Doc_Id=Purchase.Doc_Id) as IGST28" _
                            & " from Purchase Left Join Ledger on Ledger.Led_Key=Purchase.Supl_Key  " _
                            & "LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                            & " Where Purchase.Status = '1' " _
                            & Reg _
                            & " AND Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Purchase.COBR_ID ='" & SelBranchId & "' " _
                            & " Group by Purchase.Chln_No,Purchase.Chln_Dt,State.Alt_Code,STATE.State_Name,Ledger.Abbr,Purchase.Doc_no  ,Purchase.Doc_Dt ,Ledger.GSTNo ,Purchase.Doc_Id,Purchase.Taxable_Amt,Purchase.Tax_Amt,Purchase.OthChgs_Amt"
                    Else
                        MsgBox("Please Check Value Of AppSett_value 368")
                        Exit Sub
                    End If

                    Common.ExecuteQuery(Query)

                    Query = "SELECT Chln_No,Chln_Dt,GSTNo,Party,InvoiceNo,Doc_Dt,PlaceofSupply,GST0,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28 FROM vw_B2BInvoices " _
                  & " Group By Chln_No,Chln_Dt,GSTNo,Party,InvoiceNo,Doc_Dt,PlaceofSupply,GST0,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28 Order by  InvoiceNo Asc"
                    Dim dtb2CSmall As DataTable = Common.GetDataTable(Query)
                    Dim recrow As DataRow
                    If dtb2CSmall.Rows.Count > 0 Then
                        Dim i As Integer = 2
                        Dim j As Integer = 2
                        Dim k As Integer = 1
                        For Each recrow In dtb2CSmall.Rows
                            xlSheet.Cells(j, 1) = k
                            xlSheet.Cells(i, 2) = recrow("GSTNo")
                            xlSheet.Cells(i, 3) = recrow("Party")
                            xlSheet.Cells(i, 4) = recrow("InvoiceNo")
                            xlSheet.Cells(i, 5) = recrow("Doc_Dt")
                            xlSheet.Cells(i, 6) = recrow("PlaceofSupply")
                            xlSheet.Cells(i, 7) = recrow("GST0") + recrow("GST5") + recrow("CGST") + recrow("SGST") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18") + recrow("GST28") + recrow("CGST14") + recrow("SGST14") + recrow("IGST28")
                            ''5%
                            xlSheet.Cells(i, 8) = recrow("GST5")
                            xlSheet.Cells(i, 9) = recrow("CGST")
                            xlSheet.Cells(i, 10) = recrow("SGST")
                            xlSheet.Cells(i, 11) = recrow("IGST5")
                            ''12%
                            xlSheet.Cells(i, 12) = recrow("GST12")
                            xlSheet.Cells(i, 13) = recrow("CGST6")
                            xlSheet.Cells(i, 14) = recrow("SGST6")
                            xlSheet.Cells(i, 15) = recrow("IGST12")
                            '''18%
                            xlSheet.Cells(i, 16) = recrow("GST18")
                            xlSheet.Cells(i, 17) = recrow("CGST9")
                            xlSheet.Cells(i, 18) = recrow("SGST9")
                            xlSheet.Cells(i, 19) = recrow("IGST18")
                            ''28%
                            xlSheet.Cells(i, 20) = recrow("GST28")
                            xlSheet.Cells(i, 21) = recrow("CGST14")
                            xlSheet.Cells(i, 22) = recrow("SGST14")
                            xlSheet.Cells(i, 23) = recrow("IGST28")
                            xlSheet.Cells(i, 24) = recrow("GST0")
                            xlSheet.Cells(i, 25) = recrow("Chln_No")
                            xlSheet.Cells(i, 26) = recrow("Chln_Dt")
                            i += 1
                            j += 1
                            k += 1
                        Next recrow

                        Query = "SELECT Sum(GST0)GST0,Sum(GST5)GST5,Sum(CGST)CGST,Sum(SGST)SGST,Sum(IGST5)IGST5,Sum(GST12)GST12,Sum(CGST6)CGST6,Sum(SGST6)SGST6,Sum(IGST12)IGST12,Sum(GST18)GST18,Sum(CGST9)CGST9,Sum(SGST9)SGST9,Sum(IGST18)IGST18,Sum(GST28)GST28,Sum(CGST14)CGST14,Sum(SGST14)SGST14,Sum(IGST28)IGST28 FROM vw_B2BInvoices "
                        ''& " Group By GSTNo,Party,InvoiceNo,Doc_Dt,Gross_Total,PlaceofSupply,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28 Order by  InvoiceNo Asc"
                        Dim dtb2CSum As DataTable = Common.GetDataTable(Query)
                        Dim recSum As DataRow
                        If dtb2CSum.Rows.Count > 0 Then
                            For Each recSum In dtb2CSum.Rows
                                'xlSheet.Cells(i + 3, 4) = "GRAND TOTAL"
                                xlSheet.Cells(i + 3, 7) = recSum("GST0") + recSum("GST5") + recSum("CGST") + recSum("SGST") + recSum("IGST5") + recSum("GST12") + recSum("CGST6") + recSum("SGST6") + recSum("IGST12") + recSum("GST18") + recSum("CGST9") + recSum("SGST9") + recSum("IGST18") + recSum("GST28") + recSum("CGST14") + recSum("SGST14") + recSum("IGST28")
                                xlSheet.Cells(i + 3, 8) = recSum("GST5")
                                xlSheet.Cells(i + 3, 9) = recSum("CGST")
                                xlSheet.Cells(i + 3, 10) = recSum("SGST")
                                xlSheet.Cells(i + 3, 11) = recSum("IGST5")
                                xlSheet.Cells(i + 3, 12) = recSum("GST12")
                                xlSheet.Cells(i + 3, 13) = recSum("CGST6")
                                xlSheet.Cells(i + 3, 14) = recSum("SGST6")
                                xlSheet.Cells(i + 3, 15) = recSum("IGST12")
                                xlSheet.Cells(i + 3, 16) = recSum("GST18")
                                xlSheet.Cells(i + 3, 17) = recSum("CGST9")
                                xlSheet.Cells(i + 3, 18) = recSum("SGST9")
                                xlSheet.Cells(i + 3, 19) = recSum("IGST18")
                                xlSheet.Cells(i + 3, 20) = recSum("GST28")
                                xlSheet.Cells(i + 3, 21) = recSum("CGST14")
                                xlSheet.Cells(i + 3, 22) = recSum("SGST14")
                                xlSheet.Cells(i + 3, 23) = recSum("IGST28")
                                xlSheet.Cells(i + 3, 24) = recSum("GST0")
                            Next
                        End If
                        xlSheet.Range("D1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                        xlSheet.Cells(i + 3, 2) = "GRAND TOTAL"
                        xlSheet.Range(xlSheet.Cells(i + 3, 2), xlSheet.Cells(i + 3, 24)).Font.Bold = True
                    End If
                    xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                    xlSheet.Columns.AutoFit()
                    Try
                        If cmbSelection.SelectedIndex = 0 Then
                            xlSheet.SaveAs(Application.StartupPath & "GSTR2-" & GST & "(B2B Invoices Registered )" & "-" & Today & ".xlsx")
                        Else
                            xlSheet.SaveAs(Application.StartupPath & "GSTR2-" & GST & "(B2B Invoices UnRegistered )" & "-" & Today & ".xlsx")
                        End If
                        xlApp.Visible = True
                    Catch ex As Exception
                        Exit Sub
                    End Try
                ElseIf cmbSelection.SelectedIndex = 2 Or cmbSelection.SelectedIndex = 3 Then 'Credit Note(Registered)/Credit Note(Un-Registered)
                    If cmbSelection.SelectedIndex = 2 Then
                        Reg = "And  Ledger.GSTNo<>''"
                    Else
                        Reg = "And  Ledger.GSTNo=''"
                    End If
                    xlSheet.Cells(1, 1) = "Sr No."
                    xlSheet.Cells(1, 2) = "GSTIN"
                    xlSheet.Cells(1, 3) = "Party"
                    xlSheet.Cells(1, 4) = "CN No."
                    xlSheet.Cells(1, 5) = "CN Date"
                    xlSheet.Cells(1, 6) = "Invoice No"
                    xlSheet.Cells(1, 7) = "Invoice Date"
                    xlSheet.Cells(1, 8) = "Document Type"
                    xlSheet.Cells(1, 9) = "Place of Supply"
                    xlSheet.Cells(1, 10) = "Supply Type"
                    xlSheet.Cells(1, 11) = "CN Value"
                    ''5%
                    xlSheet.Cells(1, 12) = "Taxable" & vbLf & "5%"
                    xlSheet.Cells(1, 13) = "CGST" & vbLf & "2.5%"
                    xlSheet.Cells(1, 14) = "SGST" & vbLf & "2.5%"
                    xlSheet.Cells(1, 15) = "IGST" & vbLf & "5%"
                    ''12%
                    xlSheet.Cells(1, 16) = "Taxable" & vbLf & "12%"
                    xlSheet.Cells(1, 17) = "CGST" & vbLf & "6%"
                    xlSheet.Cells(1, 18) = "SGST" & vbLf & "6%"
                    xlSheet.Cells(1, 19) = "IGST" & vbLf & "12%"

                    ''18%
                    xlSheet.Cells(1, 20) = "Taxable" & vbLf & "18%"
                    xlSheet.Cells(1, 21) = "CGST" & vbLf & "9%"
                    xlSheet.Cells(1, 22) = "SGST" & vbLf & "9%"
                    xlSheet.Cells(1, 23) = "IGST" & vbLf & "18%"
                    ''28%
                    xlSheet.Cells(1, 24) = "Taxable" & vbLf & "28%"
                    xlSheet.Cells(1, 25) = "CGST" & vbLf & "14%"
                    xlSheet.Cells(1, 26) = "SGST" & vbLf & "14%"
                    xlSheet.Cells(1, 27) = "IGST" & vbLf & "28%"

                    xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 27)).Font.Bold = True
                    Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_CNRegistered]')) " _
                        & " Drop View [dbo].[vw_CNRegistered]"
                    Common.ExecuteQuery(Query)
                    Query = " Create View [vw_CNRegistered] as Select State.Alt_code,Salesrtn.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,Salesrtn.Doc_no AS InvoiceNo,Salesrtn.Taxable_Amt+Salesrtn.Tax_Amt+Salesrtn.OthChgs_Amt Gross_Total,Salesrtn.Doc_Dt ," _
                                & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST5," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST5," _
                                & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST12," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST12," _
                                & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST18," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST18," _
                                & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST28," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST28" _
                                & " from Salesrtn Left Join Ledger on Ledger.Led_Key=Salesrtn.Cust_Key  " _
                                & " LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                & " Where Salesrtn.Status = '1' and  Direct_CN=1 " _
                                & " AND Salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Salesrtn.COBR_ID ='" & SelBranchId & "' " _
                                & Reg _
                                & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,Salesrtn.Doc_no  ,Salesrtn.Doc_Dt ,Ledger.GSTNo ,Salesrtn.Doc_Id,Salesrtn.Taxable_Amt,Salesrtn.Tax_Amt,Salesrtn.OthChgs_Amt" _
                                & "  UNION ALL " _
                                & " Select State.Alt_code,CN.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,CN.Doc_no AS InvoiceNo,CN.Taxable_Amt+CN.Tax_Amt+CN.OthChgs_Amt Gross_Total,CN.Doc_Dt ,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST5,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST5,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST12,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST12,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST18," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST9," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST9," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST18," _
                                & " (Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST28," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST14," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST14," _
                                & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST28 " _
                                & " from CN Left Join Ledger on Ledger.Led_Key=CN.Cust_Key   LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY   " _
                                & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY   Where CN.Status = '1' " _
                                & " AND CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' " _
                                & Reg _
                                & "	Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,CN.Doc_no  ,CN.Doc_Dt ,Ledger.GSTNo ," _
                                & "	CN.Doc_Id,CN.Taxable_Amt,CN.Tax_Amt,CN.OthChgs_Amt"
                    Common.ExecuteQuery(Query)
                    Query = "SELECT GSTNo,Party,InvoiceNo,Alt_code StateCode,Doc_Dt,sum(Gross_Total)Gross_Total,PlaceofSupply,sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28 FROM vw_CNRegistered " _
                & " Group By GSTNo,Alt_code,Party,InvoiceNo,Doc_Dt,PlaceofSupply Order by  InvoiceNo Asc"
                    Dim dtCNRegistered As DataTable = Common.GetDataTable(Query)
                    Dim recrow As DataRow
                    If dtCNRegistered.Rows.Count > 0 Then
                        Dim i As Integer = 2
                        Dim j As Integer = 2
                        Dim k As Integer = 1
                        For Each recrow In dtCNRegistered.Rows
                            xlSheet.Cells(j, 1) = k
                            xlSheet.Cells(i, 2) = recrow("GSTNO")
                            xlSheet.Cells(i, 3) = recrow("Party")
                            xlSheet.Cells(i, 4) = recrow("InvoiceNo")
                            xlSheet.Cells(i, 5) = recrow("DOC_DT")
                            xlSheet.Cells(i, 8) = "C   "
                            xlSheet.Cells(i, 9) = recrow("PLACEOFSUPPLY")
                            xlSheet.Cells(i, 10) = IIf(GSTDigit = recrow("StateCode"), "Intra-State", "Inter-State")
                            xlSheet.Cells(i, 11) = recrow("GST5") + recrow("CGST") + recrow("SGST") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("GST28") + recrow("CGST14") + recrow("SGST14") + recrow("IGST5") + recrow("IGST12") + recrow("IGST18") + recrow("IGST28")
                            xlSheet.Cells(i, 12) = recrow("GST5")
                            xlSheet.Cells(i, 13) = recrow("CGST")
                            xlSheet.Cells(i, 14) = recrow("SGST")
                            xlSheet.Cells(i, 15) = recrow("IGST5")
                            xlSheet.Cells(i, 16) = recrow("GST12")
                            xlSheet.Cells(i, 17) = recrow("CGST6")
                            xlSheet.Cells(i, 18) = recrow("SGST6")
                            xlSheet.Cells(i, 19) = recrow("IGST12")
                            xlSheet.Cells(i, 20) = recrow("GST18")
                            xlSheet.Cells(i, 21) = recrow("CGST9")
                            xlSheet.Cells(i, 22) = recrow("SGST9")
                            xlSheet.Cells(i, 23) = recrow("IGST18")
                            xlSheet.Cells(i, 24) = recrow("GST28")
                            xlSheet.Cells(i, 25) = recrow("CGST14")
                            xlSheet.Cells(i, 26) = recrow("SGST14")
                            xlSheet.Cells(i, 27) = recrow("IGST28")


                            i += 1
                            j += 1
                            k += 1
                        Next recrow
                        Query = "SELECT sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28 " _
                                & " FROM vw_CNRegistered "
                        Dim dtb2CSmallSum As DataTable = Common.GetDataTable(Query)
                        Dim recrowsum As DataRow
                        For Each recrowsum In dtb2CSmallSum.Rows
                            xlSheet.Cells(i + 1, 2) = "GRAND TOTAL"
                            xlSheet.Cells(i + 1, 11) = recrowsum("GST5") + recrowsum("CGST") + recrowsum("SGST") + recrowsum("GST12") + recrowsum("CGST6") + recrowsum("SGST6") + recrowsum("GST18") + recrowsum("CGST9") + recrowsum("SGST9") + recrowsum("GST28") + recrowsum("CGST14") + recrowsum("SGST14") + recrowsum("IGST5") + recrowsum("IGST12") + recrowsum("IGST18") + recrowsum("IGST28")
                            xlSheet.Cells(i + 1, 12) = recrowsum("GST5")
                            xlSheet.Cells(i + 1, 13) = recrowsum("CGST")
                            xlSheet.Cells(i + 1, 14) = recrowsum("SGST")
                            xlSheet.Cells(i + 1, 15) = recrowsum("IGST5")
                            xlSheet.Cells(i + 1, 16) = recrowsum("GST12")
                            xlSheet.Cells(i + 1, 17) = recrowsum("CGST6")
                            xlSheet.Cells(i + 1, 18) = recrowsum("SGST6")
                            xlSheet.Cells(i + 1, 19) = recrowsum("IGST12")
                            xlSheet.Cells(i + 1, 20) = recrowsum("GST18")
                            xlSheet.Cells(i + 1, 21) = recrowsum("CGST9")
                            xlSheet.Cells(i + 1, 22) = recrowsum("SGST9")
                            xlSheet.Cells(i + 1, 23) = recrowsum("IGST18")
                            xlSheet.Cells(i + 1, 24) = recrowsum("GST28")
                            xlSheet.Cells(i + 1, 25) = recrowsum("CGST14")
                            xlSheet.Cells(i + 1, 26) = recrowsum("SGST14")
                            xlSheet.Cells(i + 1, 27) = recrowsum("IGST28")
                        Next
                        xlSheet.Range("D1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                        xlSheet.Range(xlSheet.Cells(i + 1, 2), xlSheet.Cells(i + 1, 27)).Font.Bold = True
                    End If
                    xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                    xlSheet.Columns.AutoFit()
                    Try
                        If cmbSelection.SelectedIndex = 2 Then
                            xlSheet.SaveAs(Application.StartupPath & "GSTR2-" & GST & "(CNR)" & "-" & Today & ".xlsx")
                        Else
                            xlSheet.SaveAs(Application.StartupPath & "GSTR2-" & GST & "(CNUR)" & "-" & Today & ".xlsx")
                        End If
                        xlApp.Visible = True
                    Catch ex As Exception
                        Exit Sub
                    End Try
                ElseIf cmbSelection.SelectedIndex = 4 Or cmbSelection.SelectedIndex = 5 Then 'Debit Note(Registered)/Debit Note(Un-Registered)
                    If cmbSelection.SelectedIndex = 4 Then
                        Reg = "And  Ledger.GSTNo<>''"
                    Else
                        Reg = "And  Ledger.GSTNo=''"
                    End If
                    xlSheet.Cells(1, 1) = "Sr No."
                    xlSheet.Cells(1, 2) = "GSTIN"
                    xlSheet.Cells(1, 3) = "Party"
                    xlSheet.Cells(1, 4) = "DN No."
                    xlSheet.Cells(1, 5) = "DN Date"
                    xlSheet.Cells(1, 6) = "Invoice No"
                    xlSheet.Cells(1, 7) = "Invoice Date"
                    xlSheet.Cells(1, 8) = "Document Type"
                    xlSheet.Cells(1, 9) = "Place of Supply"
                    xlSheet.Cells(1, 10) = "Supply Type"
                    xlSheet.Cells(1, 11) = "DN Value"
                    ''5%
                    xlSheet.Cells(1, 12) = "Taxable" & vbLf & "5%"
                    xlSheet.Cells(1, 13) = "CGST" & vbLf & "2.5%"
                    xlSheet.Cells(1, 14) = "SGST" & vbLf & "2.5%"
                    xlSheet.Cells(1, 15) = "IGST" & vbLf & "5%"
                    ''12%
                    xlSheet.Cells(1, 16) = "Taxable" & vbLf & "12%"
                    xlSheet.Cells(1, 17) = "CGST" & vbLf & "6%"
                    xlSheet.Cells(1, 18) = "SGST" & vbLf & "6%"
                    xlSheet.Cells(1, 19) = "IGST" & vbLf & "12%"

                    ''18%
                    xlSheet.Cells(1, 20) = "Taxable" & vbLf & "18%"
                    xlSheet.Cells(1, 21) = "CGST" & vbLf & "9%"
                    xlSheet.Cells(1, 22) = "SGST" & vbLf & "9%"
                    xlSheet.Cells(1, 23) = "IGST" & vbLf & "18%"
                    ''28%
                    xlSheet.Cells(1, 24) = "Taxable" & vbLf & "28%"
                    xlSheet.Cells(1, 25) = "CGST" & vbLf & "14%"
                    xlSheet.Cells(1, 26) = "SGST" & vbLf & "14%"
                    xlSheet.Cells(1, 27) = "IGST" & vbLf & "28%"

                    xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 27)).Font.Bold = True
                    Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_DNRegistered]')) " _
                        & " Drop View [dbo].[vw_DNRegistered]"
                    Common.ExecuteQuery(Query)
                    Query = " Create View [vw_DNRegistered] as Select State.Alt_code,PurchaseRtn.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,PurchaseRtn.Doc_no AS InvoiceNo,PurchaseRtn.Taxable_Amt+PurchaseRtn.Tax_Amt+PurchaseRtn.OthChgs_Amt Gross_Total,PurchaseRtn.Doc_Dt ,'' Party_RefNo,'' Party_RefDt, " _
                                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST5," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST5," _
                                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST12," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST6," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST12," _
                                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST18," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST9," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST18," _
                                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST28," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST14," _
                                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST28" _
                                & " from PurchaseRtn Left Join Ledger on Ledger.Led_Key=PurchaseRtn.Supl_Key  " _
                                & " LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                & " Where PurchaseRtn.Status = '1'  " _
                                & " AND PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' " _
                                & Reg _
                                & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,PurchaseRtn.Doc_no  ,PurchaseRtn.Doc_Dt ,Ledger.GSTNo ,PurchaseRtn.Doc_Id,PurchaseRtn.Taxable_Amt,PurchaseRtn.Tax_Amt,PurchaseRtn.OthChgs_Amt " _
                      & " union all " _
                    & " select  (select Top 1  State.Alt_code  from Vchrdtl Inner join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  Inner join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key Inner JOIN STATION ON STATION.STN_key = Ledger.OSTN_Key  Inner JOIN STATE ON STATE.STATE_key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0 )as Alt_Code " _
                    & " ,Vchr.Doc_Id, " _
                    & " (select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id)) as GSTNo, " _
                    & " (select Top 1  State.Alt_code+'-' +STATE.State_Name  from Vchrdtl Inner join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  Inner join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key Inner JOIN STATION ON STATION.STN_Key = Ledger.OSTN_Key  Inner JOIN STATE ON STATE.STATE_Key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0 )as PlaceofSupply , " _
                    & " (select Top 1 Ledger.Led_Name from Vchrdtl left join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key JOIN STATION ON STATION.STN_key = Ledger.OSTN_Key  LEFT JOIN STATE ON STATE.STATE_key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0  And Vchrdtl.AmtFlag = 'D')as Led_Name,Vchr.PDoc_No as InvoiceNo,Vchr.Amount as Gross_Total,( Vchr.Doc_Dt) as Doc_Dt, " _
                     & " ( select top 1 VchrdtlRef.Doc_No from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id) as  Party_RefNo, " _
                    & " ( select top 1 ( VchrdtlRef.Doc_Dt)  from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id) as Party_RefDt," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5 or LEDGER.Tax_Perc=5 THEN GST_ON_AMT ELSE 0 END )  as Gst5," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS Sgst," _
& " (CASE WHEN LEDGER.Tax_Perc=5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS igst5," _
& " (CASE WHEN LEDGER.Tax_Perc=6  or LEDGER.Tax_Perc=12 THEN GST_ON_AMT ELSE 0 END )  as Gst12," _
& " (CASE WHEN LEDGER.Tax_Perc=6 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst6," _
& " (CASE WHEN LEDGER.Tax_Perc=6 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst6," _
& " (CASE WHEN LEDGER.Tax_Perc=12 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS igst12," _
& " (CASE WHEN LEDGER.Tax_Perc=9  or LEDGER.Tax_Perc=18 THEN GST_ON_AMT ELSE 0 END )  as gst18," _
& " (CASE WHEN LEDGER.Tax_Perc=9 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst9," _
& " (CASE WHEN LEDGER.Tax_Perc=9 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst9," _
& " (CASE WHEN LEDGER.Tax_Perc=18 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS igst18," _
& " (CASE WHEN LEDGER.Tax_Perc=14 or LEDGER.Tax_Perc=28 THEN GST_ON_AMT ELSE 0 END )  as gst28, " _
& " (CASE WHEN LEDGER.Tax_Perc=14 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst14, " _
& " (CASE WHEN LEDGER.Tax_Perc=14 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst14," _
& " (CASE WHEN LEDGER.Tax_Perc=28 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS igst28 " _
& "  " _
                     & "  from Vchrdtl " _
                    & " left join Vchr on Vchr.Doc_Id=Vchrdtl.Doc_Id " _
                    & " left join VchrdtlRef on VchrdtlRef.Doc_Id=Vchrdtl.Doc_Id " _
                    & " left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key " _
                    & "    where   Ledger.Tax_Perc > 0 And Vchr.Doc_Dt BETWEEN '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'    and Vchrdtl.GST_On_Amt<> 0 " _
                & " And  Vchr.PDoc_No <> '' AND Vchr.Cobr_Id='" & SelBranchId & "'  And VchrType ='DN' and " & IIf(cmbSelection.SelectedIndex = 4, " (select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id)) <>''", "(select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id))=''") & " " _
                & "  group by  VchrdtlRef.Doc_Dt, Ledger.Tax_Perc,Vchrdtl.AmtFlag,Vchr.Doc_Id,Vchr.Doc_Dt,Vchr.PDoc_No,Vchr.VchrRefNo ,Vchr.Amount ,Vchrdtl.GST_On_Amt,Vchrdtl.AMOUNT " _
                     & " union all " _
                    & " select Distinct (select Top 1  State.Alt_code  from Vchrdtl Inner join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  Inner join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key Inner JOIN STATION ON STATION.STN_key = Ledger.OSTN_Key  Inner JOIN STATE ON STATE.STATE_key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0 )as Alt_Code " _
                    & " ,Vchr.Doc_Id, " _
                    & " (select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id)) as GSTNo, " _
                    & " (select Top 1  State.Alt_code+'-' +STATE.State_Name  from Vchrdtl Inner join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  Inner join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key Inner JOIN STATION ON STATION.STN_Key = Ledger.OSTN_Key  Inner JOIN STATE ON STATE.STATE_Key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0 )as PlaceofSupply , " _
                    & " (select Top 1 Ledger.Led_Name from Vchrdtl left join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key JOIN STATION ON STATION.STN_key = Ledger.OSTN_Key  LEFT JOIN STATE ON STATE.STATE_key = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0  And Vchrdtl.AmtFlag = 'D')as Led_Name,Vchr.PDoc_No as InvoiceNo,Vchr.Amount as Gross_Total,( Vchr.Doc_Dt) as Doc_Dt, " _
                     & " ( select top 1 VchrdtlRef.Doc_No from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id) as  Party_RefNo, " _
                    & " ( select top 1 ( VchrdtlRef.Doc_Dt)  from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id) as Party_RefDt," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5 or LEDGER.Tax_Perc=5 THEN GST_ON_AMT ELSE 0 END )  as Gst5," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst," _
& " (CASE WHEN LEDGER.Tax_Perc=2.5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS Sgst," _
& " (CASE WHEN LEDGER.Tax_Perc=5 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END    ) AS igst5," _
& " (CASE WHEN LEDGER.Tax_Perc=6  or LEDGER.Tax_Perc=12 THEN GST_ON_AMT ELSE 0 END )  as Gst12," _
& " (CASE WHEN LEDGER.Tax_Perc=6 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst6," _
& " (CASE WHEN LEDGER.Tax_Perc=6 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst6," _
& " (CASE WHEN LEDGER.Tax_Perc=12 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END    ) AS igst12," _
& " (CASE WHEN LEDGER.Tax_Perc=9 or LEDGER.Tax_Perc=18 THEN GST_ON_AMT ELSE 0 END )  as gst18," _
& " (CASE WHEN LEDGER.Tax_Perc=9 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst9," _
& " (CASE WHEN LEDGER.Tax_Perc=9 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst9," _
& " (CASE WHEN LEDGER.Tax_Perc=18 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END    ) AS igst18," _
& " (CASE WHEN LEDGER.Tax_Perc=14 or LEDGER.Tax_Perc=28 THEN GST_ON_AMT ELSE 0 END )  as gst28, " _
& " (CASE WHEN LEDGER.Tax_Perc=14 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS cgst14, " _
& " (CASE WHEN LEDGER.Tax_Perc=14 AND GST_ON_AMT<>0  THEN (Vchrdtl.AMOUNT)  ELSE  0.00 END   ) AS sgst14," _
& " Vchr.Amount AS igst28 " _
& "  " _
                     & "  from Vchrdtl " _
                    & " left join Vchr on Vchr.Doc_Id=Vchrdtl.Doc_Id " _
                    & " left join VchrdtlRef on VchrdtlRef.Doc_Id=Vchrdtl.Doc_Id " _
                    & " left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key " _
                    & "    where   Ledger.Tax_Perc <= 0 And Vchr.Doc_Dt BETWEEN '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'    and Vchrdtl.GST_On_Amt= 0  " _
                & " And  Vchr.PDoc_No <> '' AND Vchr.Cobr_Id='" & SelBranchId & "'   And VchrType ='DN'  and Vchrdtl.AmtFlag='D' and  (select sum(Vchrdtl.gst_on_amt)  from vchrdtl where doc_id=Vchr.Doc_Id)=0 and " & IIf(cmbSelection.SelectedIndex = 4, " (select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id)) <>''", "(select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id))=''") & " " _
                & "  group by  VchrdtlRef.Doc_Dt, Ledger.Tax_Perc,Vchrdtl.AmtFlag,Vchr.Doc_Id,Vchr.Doc_Dt,Vchr.PDoc_No,Vchr.VchrRefNo ,Vchr.Amount ,Vchrdtl.GST_On_Amt,Vchrdtl.AMOUNT "




                    Common.ExecuteQuery(Query)
                    Query = "SELECT GSTNo,Party,InvoiceNo,Alt_code StateCode,Doc_Dt,Party_RefNo,Party_RefDt,sum(Gross_Total)Gross_Total,PlaceofSupply,sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28 FROM vw_DNRegistered " _
                & " Group By GSTNo,Alt_code,Party,InvoiceNo,Doc_Dt,Party_RefNo,Party_RefDt,PlaceofSupply Order by  InvoiceNo Asc"
                    Dim dtCNRegistered As DataTable = Common.GetDataTable(Query)
                    Dim recrow As DataRow
                    If dtCNRegistered.Rows.Count > 0 Then
                        Dim i As Integer = 2
                        Dim j As Integer = 2
                        Dim k As Integer = 1
                        For Each recrow In dtCNRegistered.Rows
                            xlSheet.Cells(j, 1) = k
                            xlSheet.Cells(i, 2) = recrow("GSTNO")
                            xlSheet.Cells(i, 3) = recrow("Party")
                            xlSheet.Cells(i, 4) = recrow("InvoiceNo")
                            xlSheet.Cells(i, 5) = recrow("DOC_DT")

                            xlSheet.Cells(i, 6) = recrow("Party_RefNo")
                            xlSheet.Cells(i, 7) = recrow("Party_RefDt")

                            xlSheet.Cells(i, 8) = "D "
                            xlSheet.Cells(i, 9) = recrow("PLACEOFSUPPLY")
                            xlSheet.Cells(i, 10) = IIf(GSTDigit = recrow("StateCode"), "Intra-State", "Inter-State")
                            'xlSheet.Cells(i, 11) = recrow("GST5") + recrow("CGST") + recrow("SGST") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("GST28") + recrow("CGST14") + recrow("SGST14") + recrow("IGST5") + recrow("IGST12") + recrow("IGST18") + recrow("IGST28")
                            'xlSheet.Cells(i, 12) = recrow("GST5")
                            'xlSheet.Cells(i, 13) = recrow("CGST")
                            'xlSheet.Cells(i, 14) = recrow("SGST")
                            'xlSheet.Cells(i, 15) = recrow("IGST5")
                            'xlSheet.Cells(i, 16) = recrow("GST12")
                            'xlSheet.Cells(i, 17) = recrow("CGST6")
                            'xlSheet.Cells(i, 18) = recrow("SGST6")
                            'xlSheet.Cells(i, 19) = recrow("IGST12")
                            'xlSheet.Cells(i, 20) = recrow("GST18")
                            'xlSheet.Cells(i, 21) = recrow("CGST9")
                            'xlSheet.Cells(i, 22) = recrow("SGST9")
                            'xlSheet.Cells(i, 23) = recrow("IGST18")
                            'xlSheet.Cells(i, 24) = recrow("GST28")
                            'xlSheet.Cells(i, 25) = recrow("CGST14")
                            'xlSheet.Cells(i, 26) = recrow("SGST14")


                            If Val(recrow("IGST28")) > 0 Then
                                xlSheet.Cells(i, 11) = recrow("Gross_Total")

                                xlSheet.Cells(i, 12) = recrow("GST5")
                                xlSheet.Cells(i, 13) = recrow("CGST")
                                xlSheet.Cells(i, 14) = recrow("SGST")
                                xlSheet.Cells(i, 15) = recrow("IGST5")
                                xlSheet.Cells(i, 16) = recrow("GST12")
                                xlSheet.Cells(i, 17) = recrow("CGST6")
                                xlSheet.Cells(i, 18) = recrow("SGST6")
                                xlSheet.Cells(i, 19) = recrow("IGST12")
                                xlSheet.Cells(i, 20) = recrow("GST18")
                                xlSheet.Cells(i, 21) = recrow("CGST9")
                                xlSheet.Cells(i, 22) = recrow("SGST9")
                                xlSheet.Cells(i, 23) = recrow("IGST18")
                                xlSheet.Cells(i, 24) = recrow("GST28")
                                xlSheet.Cells(i, 25) = recrow("CGST14")
                                xlSheet.Cells(i, 26) = recrow("SGST14")
                            Else





                                xlSheet.Cells(i, 11) = recrow("GST5") + recrow("CGST") + recrow("SGST") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("GST28") + recrow("CGST14") + recrow("SGST14") + recrow("IGST5") + recrow("IGST12") + recrow("IGST18") + recrow("IGST28")
                                xlSheet.Cells(i, 12) = recrow("GST5")
                                xlSheet.Cells(i, 13) = recrow("CGST")
                                xlSheet.Cells(i, 14) = recrow("SGST")
                                xlSheet.Cells(i, 15) = recrow("IGST5")
                                xlSheet.Cells(i, 16) = recrow("GST12")
                                xlSheet.Cells(i, 17) = recrow("CGST6")
                                xlSheet.Cells(i, 18) = recrow("SGST6")
                                xlSheet.Cells(i, 19) = recrow("IGST12")
                                xlSheet.Cells(i, 20) = recrow("GST18")
                                xlSheet.Cells(i, 21) = recrow("CGST9")
                                xlSheet.Cells(i, 22) = recrow("SGST9")
                                xlSheet.Cells(i, 23) = recrow("IGST18")
                                xlSheet.Cells(i, 24) = recrow("GST28")
                                xlSheet.Cells(i, 25) = recrow("CGST14")
                                xlSheet.Cells(i, 26) = recrow("SGST14")
                            End If

                            xlSheet.Cells(i, 27) = recrow("IGST28")


                            i += 1
                            j += 1
                            k += 1
                        Next recrow
                        Query = "SELECT sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28 " _
                                & " FROM vw_DNRegistered "
                        Dim dtb2CSmallSum As DataTable = Common.GetDataTable(Query)
                        Dim recrowsum As DataRow
                        For Each recrowsum In dtb2CSmallSum.Rows
                            xlSheet.Cells(i + 1, 2) = "GRAND TOTAL"
                            xlSheet.Cells(i + 1, 11) = recrowsum("GST5") + recrowsum("CGST") + recrowsum("SGST") + recrowsum("GST12") + recrowsum("CGST6") + recrowsum("SGST6") + recrowsum("GST18") + recrowsum("CGST9") + recrowsum("SGST9") + recrowsum("GST28") + recrowsum("CGST14") + recrowsum("SGST14") + recrowsum("IGST5") + recrowsum("IGST12") + recrowsum("IGST18") + recrowsum("IGST28")
                            xlSheet.Cells(i + 1, 12) = recrowsum("GST5")
                            xlSheet.Cells(i + 1, 13) = recrowsum("CGST")
                            xlSheet.Cells(i + 1, 14) = recrowsum("SGST")
                            xlSheet.Cells(i + 1, 15) = recrowsum("IGST5")
                            xlSheet.Cells(i + 1, 16) = recrowsum("GST12")
                            xlSheet.Cells(i + 1, 17) = recrowsum("CGST6")
                            xlSheet.Cells(i + 1, 18) = recrowsum("SGST6")
                            xlSheet.Cells(i + 1, 19) = recrowsum("IGST12")
                            xlSheet.Cells(i + 1, 20) = recrowsum("GST18")
                            xlSheet.Cells(i + 1, 21) = recrowsum("CGST9")
                            xlSheet.Cells(i + 1, 22) = recrowsum("SGST9")
                            xlSheet.Cells(i + 1, 23) = recrowsum("IGST18")
                            xlSheet.Cells(i + 1, 24) = recrowsum("GST28")
                            xlSheet.Cells(i + 1, 25) = recrowsum("CGST14")
                            xlSheet.Cells(i + 1, 26) = recrowsum("SGST14")
                            xlSheet.Cells(i + 1, 27) = IIf(recrowsum("IGST28") > 0, 0, recrowsum("IGST28"))
                        Next
                        xlSheet.Range("D1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                        xlSheet.Range(xlSheet.Cells(i + 1, 2), xlSheet.Cells(i + 1, 27)).Font.Bold = True
                    End If
                    xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                    xlSheet.Columns.AutoFit()
                    Try
                        If cmbSelection.SelectedIndex = 4 Then
                            xlSheet.SaveAs(Application.StartupPath & "GSTR2-" & GST & "(DNR)" & "-" & Today & ".xlsx")
                        Else
                            xlSheet.SaveAs(Application.StartupPath & "GSTR2-" & GST & "(DNUR)" & "-" & Today & ".xlsx")
                        End If
                        xlApp.Visible = True
                    Catch ex As Exception
                        Exit Sub
                    End Try
                ElseIf cmbSelection.SelectedIndex = 6 Or cmbSelection.SelectedIndex = 7 Then
                    xlSheet.Cells(1, 1) = "Sr No."
                    xlSheet.Cells(1, 2) = "HSN Code"
                    xlSheet.Cells(1, 3) = "Discription"
                    xlSheet.Cells(1, 4) = "Unit"
                    xlSheet.Cells(1, 5) = "Total Qty"
                    xlSheet.Cells(1, 6) = "Total value"
                    xlSheet.Cells(1, 7) = "Taxable value"
                    xlSheet.Cells(1, 8) = "CGST"
                    xlSheet.Cells(1, 9) = "SGST"
                    xlSheet.Cells(1, 10) = "IGST"


                    xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 15)).Font.Bold = True

                    If cmbSelection.SelectedIndex = 7 Then
                        Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_HSNItem]')) " _
                           & " Drop View [dbo].[vw_HSNItem]"
                    ElseIf cmbSelection.SelectedIndex = 6 Then
                        Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_HSN]')) " _
                           & " Drop View [dbo].[vw_HSN]"
                    End If
                    Common.ExecuteQuery(Query)
                    If cmbSelection.SelectedIndex = 6 Then
                        If HSNSummery = "P" Then
                            Query = "Create View [vw_HSN] as  " _
                                & " Select Style.HsnCode,UNIT_NAME,Sum(ActQty)Qty,Sum(Taxable)Taxable,Sum(Purchasedtl.Tax_Amt)TaxAmt, " _
                                & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                & " from Purchasedtl  " _
                                & " Inner Join Style On Style.Style_Key=Purchasedtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = Purchasedtl.UNIT_KEY " _
                                & " Left Join ITEm on Item.Item_Key=   Purchasedtl.Item_Key Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id" _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type<>'A' AND Purchase.COBR_ID ='" & SelBranchId & "'  Group by Style.HsnCode,UNIT_NAME  " _
                                & " Union All " _
                                & " Select Style.HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(PurchaseRtndtl.Tax_Amt)TaxAmt, " _
                                & " -Sum(PurchaseRtndtl.Tax1_Amt)CGSTAmt,-Sum(PurchaseRtndtl.Tax2_Amt)SGSTAmt,-Sum(PurchaseRtndtl.Tax3_Amt)IGSTAmt" _
                                & " from PurchaseRtndtl " _
                                & " Inner Join Style On Style.Style_Key=PurchaseRtndtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = PurchaseRtndtl.UNIT_KEY  Inner join PurchaseRtn on PurchaseRtndtl.DOc_id=PurchaseRtn.doc_id" _
                                & " Left Join ITEm on Item.Item_Key=   PurchaseRtndtl.Item_Key " _
                                & " where PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type<>'A' AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME " _
                                & " Union All  " _
                                & " Select Item.HsnCode,UNIT_NAME,Sum(ActQty)Qty,Sum(Taxable)Taxable,Sum(Purchasedtl.Tax_Amt)TaxAmt, " _
                                & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                & " from Purchasedtl  " _
                                & " Inner Join Style On Style.Style_Key=Purchasedtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = Purchasedtl.UNIT_KEY " _
                                & " Left Join ITEm on Item.Item_Key=   Purchasedtl.Item_Key Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id" _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type='A' AND Purchase.COBR_ID ='" & SelBranchId & "'  Group by Item.HsnCode,UNIT_NAME  " _
                                & " Union All " _
                                & " Select Item.HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(PurchaseRtndtl.Tax_Amt)TaxAmt, " _
                                & " -Sum(PurchaseRtndtl.Tax1_Amt)CGSTAmt,-Sum(PurchaseRtndtl.Tax2_Amt)SGSTAmt,-Sum(PurchaseRtndtl.Tax3_Amt)IGSTAmt" _
                                & " from PurchaseRtndtl " _
                                & " Inner Join Style On Style.Style_Key=PurchaseRtndtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = PurchaseRtndtl.UNIT_KEY  Inner join PurchaseRtn on PurchaseRtndtl.DOc_id=PurchaseRtn.doc_id" _
                                & " Left Join ITEm on Item.Item_Key=   PurchaseRtndtl.Item_Key " _
                                & " where PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type='A' AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' Group by Item.HsnCode,UNIT_NAME " _
                                & " Union All " _
                                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else (Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )ENd Taxable, " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else (Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id ) End TaxAmt,  " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                & " from Purchasedtl  Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id " _
                                & " Inner Join Ledger on Ledger.Led_Key=  Purchase.Supl_Key  Inner Join Purchasetxtm on Purchasetxtm.Doc_Id=Purchase.DOc_id " _
                                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key " _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Purchase.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Purchase.Doc_id,Type_Inve  "
                        ElseIf HSNSummery = "B" Then
                            Query = "Create View [vw_HSN] as  " _
                                & " Select Style.HsnCode,UNIT_NAME,Sum(ActQty)Qty,Sum(Taxable)Taxable,Sum(Purchasedtl.Tax_Amt)TaxAmt, " _
                                & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                & " from Purchasedtl  " _
                                & " Inner Join Style On Style.Style_Key=Purchasedtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = Purchasedtl.UNIT_KEY " _
                                & " Left Join ITEm on Item.Item_Key=   Purchasedtl.Item_Key Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id" _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type<>'A' AND Purchase.COBR_ID ='" & SelBranchId & "'  Group by Style.HsnCode,UNIT_NAME  " _
                                & " Union All " _
                                & " Select Style.HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(PurchaseRtndtl.Tax_Amt)TaxAmt, " _
                                & " -Sum(PurchaseRtndtl.Tax1_Amt)CGSTAmt,-Sum(PurchaseRtndtl.Tax2_Amt)SGSTAmt,-Sum(PurchaseRtndtl.Tax3_Amt)IGSTAmt" _
                                & " from PurchaseRtndtl " _
                                & " Inner Join Style On Style.Style_Key=PurchaseRtndtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = PurchaseRtndtl.UNIT_KEY  Inner join PurchaseRtn on PurchaseRtndtl.DOc_id=PurchaseRtn.doc_id" _
                                & " Left Join ITEm on Item.Item_Key=   PurchaseRtndtl.Item_Key " _
                                & " where PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type<>'A' AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME " _
                                & " Union All  " _
                                & " Select Item.HsnCode,UNIT_NAME,Sum(ActQty)Qty,Sum(Taxable)Taxable,Sum(Purchasedtl.Tax_Amt)TaxAmt, " _
                                & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                & " from Purchasedtl  " _
                                & " Inner Join Style On Style.Style_Key=Purchasedtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = Purchasedtl.UNIT_KEY " _
                                & " Left Join ITEm on Item.Item_Key=   Purchasedtl.Item_Key Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id" _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type='A' AND Purchase.COBR_ID ='" & SelBranchId & "'  Group by Item.HsnCode,UNIT_NAME  " _
                                & " Union All " _
                                & " Select Item.HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(PurchaseRtndtl.Tax_Amt)TaxAmt, " _
                                & " -Sum(PurchaseRtndtl.Tax1_Amt)CGSTAmt,-Sum(PurchaseRtndtl.Tax2_Amt)SGSTAmt,-Sum(PurchaseRtndtl.Tax3_Amt)IGSTAmt" _
                                & " from PurchaseRtndtl " _
                                & " Inner Join Style On Style.Style_Key=PurchaseRtndtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = PurchaseRtndtl.UNIT_KEY  Inner join PurchaseRtn on PurchaseRtndtl.DOc_id=PurchaseRtn.doc_id" _
                                & " Left Join ITEm on Item.Item_Key=   PurchaseRtndtl.Item_Key " _
                                & " where PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type='A' AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' Group by Item.HsnCode,UNIT_NAME " _
                                & " Union All " _
                                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else (Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )ENd Taxable, " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else (Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id ) End TaxAmt,  " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                & " from Purchasedtl  Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id " _
                                & " Inner Join Ledger on Ledger.Led_Key=  Purchase.Supl_Key  Inner Join Purchasetxtm on Purchasetxtm.Doc_Id=Purchase.DOc_id " _
                                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key " _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Purchase.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Purchase.Doc_id,Type_Inve  "

                        End If
                    ElseIf cmbSelection.SelectedIndex = 7 Then
                        If HSNSummery = "P" Then
                            Query = "Create View [vw_HSNItem] as  " _
                                & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(ActQty)Qty,Sum(Taxable)Taxable,Sum(Purchasedtl.Tax_Amt)TaxAmt, " _
                                & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                & " from Purchasedtl  " _
                                & " Inner Join Style On Style.Style_Key=Purchasedtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = Purchasedtl.UNIT_KEY " _
                                & " Left Join ITEm on Item.Item_Key=   Purchasedtl.Item_Key Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id" _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type<>'A' AND Purchase.COBR_ID ='" & SelBranchId & "'  Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name  " _
                                & " Union All " _
                                & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(PurchaseRtndtl.Tax_Amt)TaxAmt, " _
                                & " -Sum(PurchaseRtndtl.Tax1_Amt)CGSTAmt,-Sum(PurchaseRtndtl.Tax2_Amt)SGSTAmt,-Sum(PurchaseRtndtl.Tax3_Amt)IGSTAmt" _
                                & " from PurchaseRtndtl " _
                                & " Inner Join Style On Style.Style_Key=PurchaseRtndtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = PurchaseRtndtl.UNIT_KEY  Inner join PurchaseRtn on PurchaseRtndtl.DOc_id=PurchaseRtn.doc_id" _
                                & " Left Join ITEm on Item.Item_Key=   PurchaseRtndtl.Item_Key " _
                                & " where PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type<>'A' AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name " _
                                & " Union All  " _
                                & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(ActQty)Qty,Sum(Taxable)Taxable,Sum(Purchasedtl.Tax_Amt)TaxAmt, " _
                                & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                & " from Purchasedtl  " _
                                & " Inner Join Style On Style.Style_Key=Purchasedtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = Purchasedtl.UNIT_KEY " _
                                & " Left Join ITEm on Item.Item_Key=   Purchasedtl.Item_Key Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id" _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type='A' AND Purchase.COBR_ID ='" & SelBranchId & "'  Group by Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name  " _
                                & " Union All " _
                                & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(PurchaseRtndtl.Tax_Amt)TaxAmt, " _
                                & " -Sum(PurchaseRtndtl.Tax1_Amt)CGSTAmt,-Sum(PurchaseRtndtl.Tax2_Amt)SGSTAmt,-Sum(PurchaseRtndtl.Tax3_Amt)IGSTAmt" _
                                & " from PurchaseRtndtl " _
                                & " Inner Join Style On Style.Style_Key=PurchaseRtndtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = PurchaseRtndtl.UNIT_KEY  Inner join PurchaseRtn on PurchaseRtndtl.DOc_id=PurchaseRtn.doc_id" _
                                & " Left Join ITEm on Item.Item_Key=   PurchaseRtndtl.Item_Key " _
                                & " where PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type='A' AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' Group by Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name " _
                                & " Union All " _
                                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else (Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )ENd Taxable, " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else (Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id ) End TaxAmt,  " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                & " from Purchasedtl  Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id " _
                                & " Inner Join Ledger on Ledger.Led_Key=  Purchase.Supl_Key  Inner Join Purchasetxtm on Purchasetxtm.Doc_Id=Purchase.DOc_id " _
                                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key " _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Purchase.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, Purchase.Doc_id,Type_Inve  "
                        ElseIf HSNSummery = "B" Then
                            Query = "Create View [vw_HSNItem] as  " _
                                & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(ActQty)Qty,Sum(Taxable)Taxable,Sum(Purchasedtl.Tax_Amt)TaxAmt, " _
                                & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                & " from Purchasedtl  " _
                                & " Inner Join Style On Style.Style_Key=Purchasedtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = Purchasedtl.UNIT_KEY " _
                                & " Left Join ITEm on Item.Item_Key=   Purchasedtl.Item_Key Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id" _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type not in('A','M')AND Purchase.COBR_ID ='" & SelBranchId & "'  Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name  " _
                                & " Union All " _
                                & " Select Style.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(PurchaseRtndtl.Tax_Amt)TaxAmt, " _
                                & " -Sum(PurchaseRtndtl.Tax1_Amt)CGSTAmt,-Sum(PurchaseRtndtl.Tax2_Amt)SGSTAmt,-Sum(PurchaseRtndtl.Tax3_Amt)IGSTAmt" _
                                & " from PurchaseRtndtl " _
                                & " Inner Join Style On Style.Style_Key=PurchaseRtndtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = PurchaseRtndtl.UNIT_KEY  Inner join PurchaseRtn on PurchaseRtndtl.DOc_id=PurchaseRtn.doc_id" _
                                & " Left Join ITEm on Item.Item_Key=   PurchaseRtndtl.Item_Key " _
                                & " where PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type not in('A','M') AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' Group by Style.HsnCode,UNIT_NAME,ITEM.ITEM_Name " _
                                & " Union All  " _
                                & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,Sum(ActQty)Qty,Sum(Taxable)Taxable,Sum(Purchasedtl.Tax_Amt)TaxAmt, " _
                                & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt" _
                                & " from Purchasedtl  " _
                                & " Inner Join Style On Style.Style_Key=Purchasedtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = Purchasedtl.UNIT_KEY " _
                                & " Left Join ITEm on Item.Item_Key=   Purchasedtl.Item_Key Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id" _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type in('A','M') AND Purchase.COBR_ID ='" & SelBranchId & "'  Group by Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name  " _
                                & " Union All " _
                                & " Select Item.HsnCode,UNIT_NAME,ITEM.ITEM_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(PurchaseRtndtl.Tax_Amt)TaxAmt, " _
                                & " -Sum(PurchaseRtndtl.Tax1_Amt)CGSTAmt,-Sum(PurchaseRtndtl.Tax2_Amt)SGSTAmt,-Sum(PurchaseRtndtl.Tax3_Amt)IGSTAmt" _
                                & " from PurchaseRtndtl " _
                                & " Inner Join Style On Style.Style_Key=PurchaseRtndtl.Style_Key " _
                                & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = PurchaseRtndtl.UNIT_KEY  Inner join PurchaseRtn on PurchaseRtndtl.DOc_id=PurchaseRtn.doc_id" _
                                & " Left Join ITEm on Item.Item_Key=   PurchaseRtndtl.Item_Key " _
                                & " where PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Item.Item_Type  in('A','M') AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' Group by Item.HsnCode,UNIT_NAME,ITEM.ITEM_Name " _
                                & " Union All " _
                                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,TaxTermsTds.TxTmTDS_Name ITEM_NAME,0 Qty," _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else (Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )ENd Taxable, " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else (Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id ) End TaxAmt,  " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And Purchasetxtm.Doc_id=Purchase.Doc_id)< (Select DocTxTm_Id from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=Purchasetxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and Purchasetxtm.Doc_id=Purchase.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where HSNCode<>'' and Purchasetxtm.doc_id=Purchase.Doc_id )* " _
                                & " (Select Max(TaxTerm_Perc) from Purchasetxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key Where  Purchasetxtm.doc_id=Purchase.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                                & " from Purchasedtl  Inner Join Purchase on Purchase.DOc_id=PurchaseDtl.DOc_id " _
                                & " Inner Join Ledger on Ledger.Led_Key=  Purchase.Supl_Key  Inner Join Purchasetxtm on Purchasetxtm.Doc_Id=Purchase.DOc_id " _
                                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=Purchasetxtm.TaxTerm_Key " _
                                & " where Purchase.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Purchase.COBR_ID ='" & SelBranchId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode,TxTmTDS_Name, Purchase.Doc_id,Type_Inve  "

                        End If
                    End If
                    Common.ExecuteQuery(Query)
                    If cmbSelection.SelectedIndex = 7 Then
                        Query = "SELECT HSNCODE,ITEM_NAME,UNIT_NAME,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                   & " FROM vw_HSNItem " _
                                   & " Group By HSNCODE,UNIT_NAME,ITEM_NAME "
                    Else
                        Query = "SELECT HSNCODE,UNIT_NAME,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                   & " FROM vw_HSN " _
                                   & " Group By HSNCODE,UNIT_NAME "
                    End If
                    Dim dtHSNWise As DataTable = Common.GetDataTable(Query)
                    Dim recrow As DataRow
                    If dtHSNWise.Rows.Count > 0 Then
                        Dim i As Integer = 2
                        Dim j As Integer = 2
                        Dim k As Integer = 1
                        For Each recrow In dtHSNWise.Rows
                            xlSheet.Cells(j, 1) = k
                            xlSheet.Cells(i, 2) = recrow("HSNCODE")
                            If cmbSelection.SelectedIndex = 7 Then
                                xlSheet.Cells(i, 3) = recrow("ITEM_NAME")
                            End If
                            xlSheet.Cells(i, 4) = recrow("UNIT_NAME")
                            xlSheet.Cells(i, 5) = recrow("Qty")
                            xlSheet.Cells(i, 6) = recrow("TAXABLE") + recrow("IGST") + recrow("SGST") + recrow("CGST")
                            xlSheet.Cells(i, 7) = recrow("TAXABLE")
                            xlSheet.Cells(i, 8) = recrow("CGST")
                            xlSheet.Cells(i, 9) = recrow("SGST")
                            xlSheet.Cells(i, 10) = recrow("IGST")

                            i += 1
                            j += 1
                            k += 1
                        Next recrow
                        If cmbSelection.SelectedIndex = 7 Then
                            Query = "SELECT SUM(TAXABLE) TAXABLE,sum(Qty) Qty,sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                               & "  FROM vw_HSNItem "
                        Else
                            Query = "SELECT SUM(TAXABLE) TAXABLE, sum(Qty) Qty,sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                        & "  FROM vw_HSN "
                        End If

                        Dim dtHSNWiseSum As DataTable = Common.GetDataTable(Query)
                        Dim recrowsum As DataRow
                        For Each recrowsum In dtHSNWiseSum.Rows
                            xlSheet.Cells(i + 1, 2) = "GRAND TOTAL"
                            xlSheet.Cells(i + 1, 5) = recrowsum("Qty")
                            xlSheet.Cells(i + 1, 6) = recrowsum("TAXABLE") + recrowsum("IGST") + recrowsum("SGST") + recrowsum("CGST")
                            xlSheet.Cells(i + 1, 7) = recrowsum("TAXABLE")
                            xlSheet.Cells(i + 1, 8) = recrowsum("CGST")
                            xlSheet.Cells(i + 1, 9) = recrowsum("SGST")
                            xlSheet.Cells(i + 1, 10) = recrowsum("IGST")
                        Next
                        xlSheet.Range("D1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                        xlSheet.Range(xlSheet.Cells(i + 3, 2), xlSheet.Cells(i + 3, 10)).Font.Bold = True
                    End If
                    xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                    xlSheet.Columns.AutoFit()
                    Try
                        If cmbSelection.SelectedIndex = 7 Then
                            xlSheet.SaveAs(Application.StartupPath & "GSTR2-" & GST & "(HSNItemWise)" & "-" & Today & ".xlsx")
                        Else
                            xlSheet.SaveAs(Application.StartupPath & "GSTR2-" & GST & "(HSNWise)" & "-" & Today & ".xlsx")
                        End If
                        xlApp.Visible = True
                    Catch ex As Exception
                        Exit Sub
                    End Try
                End If
                Exit Sub
            End If
            ''' End
            ''End Rohit


            If rptType = ReportType.FastMovingSupplier Or rptType = ReportType.FastMovingSubGroup Or rptType = ReportType.FastMovingProduct Or _
                rptType = ReportType.SlowMovingSupplier Or rptType = ReportType.SlowMovingSubGroup Or rptType = ReportType.SlowMovingProduct Or rptType = ReportType.DeadStock Then

                Dim Dtl As String = ""
                Dim GroupBy As String = ""
                Dim GrpBy As String = ""
                Dim GrpDtlBy As String = ""

                'If lstOption1.Items.Count > 0 Then
                '    Dtl &= "," & GetSelectFields(lstOption1.Items(0), GroupBy)
                '    If GroupBy.Trim.Length > 0 Then
                '        GrpBy = GroupBy
                '    End If
                'End If

                'If lstOption2.Items.Count > 0 Then
                '    Dtl &= "," & GetSelectFields(lstOption2.Items(0), GroupBy)
                '    If GroupBy.Trim.Length > 0 Then
                '        GrpBy &= "," & GroupBy
                '    End If
                'End If

                'If lstOption3.Items.Count > 0 Then
                '    Dtl &= "," & GetSelectFields(lstOption3.Items(0), GroupBy)
                '    If GroupBy.Trim.Length > 0 Then
                '        GrpBy &= "," & GroupBy
                '    End If
                'End If

                'If lstDetails.Items.Count > 0 Then
                '    Dtl &= "," & GetSelectFields(lstDetails.Items(0), GroupBy)
                '    If GroupBy.Trim.Length > 0 Then
                '        GrpBy &= "," & GroupBy
                '    End If

                '    If lstDetails.Items.Count = 2 Then
                '        Dtl &= "," & GetSelectFields(lstDetails.Items(1), GroupBy)
                '        If GroupBy.Trim.Length > 0 Then
                '            GrpBy &= "," & GroupBy
                '        End If
                '    End If

                '    If lstDetails.Items.Count = 3 Then
                '        Dtl &= "," & GetSelectFields(lstDetails.Items(1), GroupBy)
                '        If GroupBy.Trim.Length > 0 Then
                '            GrpBy &= "," & GroupBy
                '        End If

                '        Dtl &= "," & GetSelectFields(lstDetails.Items(2), GroupBy)
                '        If GroupBy.Trim.Length > 0 Then
                '            GrpBy &= "," & GroupBy
                '        End If
                '    End If
                'End If

                If rdSummary.Checked = True Then

                    If lstDetails.Items.Count = 0 Then
                        If CurrOptionType = OptionType.Supplier Then
                            lstDetails.Items.Add("Supplier")
                        ElseIf CurrOptionType = OptionType.SubGroup Then
                            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
                        ElseIf CurrOptionType = OptionType.Product Then
                            lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
                        End If
                    End If

                    If lstOption1.Items.Count > 0 Then
                        Dtl &= "," & GetSelectFields(lstOption1.Items(0), GroupBy)
                        If GroupBy.Trim.Length > 0 Then
                            GrpBy = GroupBy
                        End If
                    End If

                    If lstOption2.Items.Count > 0 Then
                        Dtl &= "," & GetSelectFields(lstOption2.Items(0), GroupBy)
                        If GroupBy.Trim.Length > 0 Then
                            GrpBy &= "," & GroupBy
                        End If
                    End If

                    If lstOption3.Items.Count > 0 Then
                        Dtl &= "," & GetSelectFields(lstOption3.Items(0), GroupBy)
                        If GroupBy.Trim.Length > 0 Then
                            GrpBy &= "," & GroupBy
                        End If
                    End If

                    If lstDetails.Items.Count > 0 Then
                        Dtl &= "," & GetSelectFields(lstDetails.Items(0), GroupBy)
                        If GroupBy.Trim.Length > 0 Then
                            GrpBy &= "," & GroupBy
                        End If

                        If lstDetails.Items.Count = 2 Then
                            Dtl &= "," & GetSelectFields(lstDetails.Items(1), GroupBy)
                            If GroupBy.Trim.Length > 0 Then
                                GrpBy &= "," & GroupBy
                            End If
                        End If

                        If lstDetails.Items.Count = 3 Then
                            Dtl &= "," & GetSelectFields(lstDetails.Items(1), GroupBy)
                            If GroupBy.Trim.Length > 0 Then
                                GrpBy &= "," & GroupBy
                            End If

                            Dtl &= "," & GetSelectFields(lstDetails.Items(2), GroupBy)
                            If GroupBy.Trim.Length > 0 Then
                                GrpBy &= "," & GroupBy
                            End If
                        End If
                    End If

                Else

                    If rptType = ReportType.FastMovingSupplier Or rptType = ReportType.SlowMovingSupplier Then
                        GroupBy = "Supplier.Abbr [Supplier]"
                        GrpDtlBy = "Supplier.Abbr"
                        Dtl &= "," & GroupBy
                        GrpBy &= "," & GrpDtlBy
                    End If

                    If rptType = ReportType.FastMovingSubGroup Or rptType = ReportType.SlowMovingSubGroup Then
                        GroupBy = "ItemSubGrp.Abbr" & "[" & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & "]"
                        GrpDtlBy = "ItemSubGrp.Abbr"
                        Dtl &= "," & GroupBy
                        GrpBy &= "," & GrpDtlBy
                    End If

                    GroupBy = "Item.Abbr" & "[" & GetSystemCaption(SystemCaptionIdx.DefProduct) & "]"
                    GrpDtlBy = "Item.Abbr"
                    Dtl &= "," & GroupBy
                    GrpBy &= "," & GrpDtlBy

                    If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseDesign))) Then
                        GroupBy = "Style.Abbr" & "[" & GetSystemCaption(SystemCaptionIdx.DefArticle) & "]"
                        GrpDtlBy = "Style.Abbr"
                        Dtl &= "," & GroupBy
                        GrpBy &= "," & GrpDtlBy
                    End If

                    If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseType))) Then
                        GroupBy = "Type.Abbr" & "[" & GetSystemCaption(SystemCaptionIdx.DefType) & "]"
                        GrpDtlBy = "Type.Abbr"
                        Dtl &= "," & GroupBy
                        GrpBy &= "," & GrpDtlBy
                    End If

                    If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseShade))) Then
                        GroupBy = "Shade.Abbr" & "[" & GetSystemCaption(SystemCaptionIdx.DefShade) & "]"
                        GrpDtlBy = "Shade.Abbr"
                        Dtl &= "," & GroupBy
                        GrpBy &= "," & GrpDtlBy
                    End If

                    If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) Then
                        GroupBy = "ItemSize.Size_Name" & "[" & GetSystemCaption(SystemCaptionIdx.DefSize) & "]"
                        GrpDtlBy = "ItemSize.Size_Name"
                        Dtl &= "," & GroupBy
                        GrpBy &= "," & GrpDtlBy
                    End If

                End If
                'If rptType = ReportType.retailsaleregister Then
                '    'LocFilter = ""


                '    If rdDetailed.Checked Then
                '        'Formulas.Item("DisplayDetails#N") = 1

                '        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                '        ' FromToDt = GetFromToDateSeriesFilter("{Vw_SaleBillRpt.Doc_Dt}", "{vw_SaleWithRtnSum.Doc_Type}")
                '        ReportParameters.rptCaption = "Sales Register (" & lstMain.Text & ")"
                '        ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterBillSum.rpt"
                '        ReportParameters.rptFilter = "{vw_SaleWithRtnSum.CoBr_Id} = '" & SelBranchId & "'" '&' FromToDt '& PartyFltr & LocFilter

                '    End If
                'End If
                If Mid$(Dtl, 1, 1) = "," Then
                    Dtl = Mid$(Dtl, 2)
                End If

                If Mid$(GrpBy, 1, 1) = "," Then
                    GrpBy = Mid$(GrpBy, 2)
                End If

                Dim StockFltr As String = GetStockFilterForQuery("", True, True)
                Dim RngFilter As String = ""

                If cmbDisplay.SelectedIndex = 1 Then    ''=
                    RngFilter = " Having Case When Sum(vw_StockStmt.OpQty + PurQty + SalRtnQty) > 0 Then (Sum(PRQty + SalQty) * 100) / (Sum(vw_StockStmt.OpQty) + Sum(PurQty + SalRtnQty)) Else 0 End = " & txtStkFrom.EditValue
                ElseIf cmbDisplay.SelectedIndex = 2 Then    ''>
                    RngFilter = " Having Case When Sum(vw_StockStmt.OpQty + PurQty + SalRtnQty) > 0 Then (Sum(PRQty + SalQty) * 100) / (Sum(vw_StockStmt.OpQty) + Sum(PurQty + SalRtnQty)) Else 0 End > " & txtStkFrom.EditValue
                ElseIf cmbDisplay.SelectedIndex = 3 Then    ''<
                    RngFilter = " Having Case When Sum(vw_StockStmt.OpQty + PurQty + SalRtnQty) > 0 Then (Sum(PRQty + SalQty) * 100) / (Sum(vw_StockStmt.OpQty) + Sum(PurQty + SalRtnQty)) Else 0 End < " & txtStkFrom.EditValue
                ElseIf cmbDisplay.SelectedIndex = 4 Then    ''range
                    RngFilter = " Having Case When Sum(vw_StockStmt.OpQty + PurQty + SalRtnQty) > 0 Then (Sum(PRQty + SalQty) * 100) / (Sum(vw_StockStmt.OpQty) + Sum(PurQty + SalRtnQty)) Else 0 End >= " & txtStkFrom.EditValue _
                        & " And Case When Sum(vw_StockStmt.OpQty + PurQty + SalRtnQty) > 0 Then (Sum(PRQty + SalQty) * 100) / (Sum(vw_StockStmt.OpQty) + Sum(PurQty + SalRtnQty)) Else 0 End <= " & txtStkTo.EditValue
                End If

                Dim frmrpt As frmrptABCAnalysis = Nothing

                If rptType = ReportType.FastMovingSupplier Or rptType = ReportType.FastMovingSubGroup Or rptType = ReportType.FastMovingProduct Then
                    frmrpt = New frmrptABCAnalysis(frmrptABCAnalysis.MoveType.FastMoving, Dtl, GrpBy, StockFltr, RngFilter)
                ElseIf rptType = ReportType.SlowMovingSupplier Or rptType = ReportType.SlowMovingSubGroup Or rptType = ReportType.SlowMovingProduct Then
                    frmrpt = New frmrptABCAnalysis(frmrptABCAnalysis.MoveType.SlowMoving, Dtl, GrpBy, StockFltr, RngFilter)
                ElseIf rptType = ReportType.DeadStock Then
                    frmrpt = New frmrptABCAnalysis(frmrptABCAnalysis.MoveType.DeadStock, Dtl, GrpBy, StockFltr, RngFilter)
                End If

                frmrpt.MdiParent = Me.MdiParent
                frmrpt.Show()
            End If

            If lstOption1.Visible And btnGrp1.Enabled Then
                If lstOption1.Items.Count = 0 Then
                    MsgBox("One or more options not specified !", MsgBoxStyle.Exclamation)
                    Exit Sub
                End If
            End If

            If rptType = ReportType.PeriodicalSales Or rptType = ReportType.PeriodicalPurchase Or rptType = ReportType.PeriodicalPurchaseRtn Then
                'If dtpTo.Value.Month <> dtpFrom.Value.Month Then
                '    MsgBox("From and To month should be same !", MsgBoxStyle.Exclamation)
                '    dtpTo.Focus()
                '    Exit Sub
                'End If

                If lstOption1.Items.Count = 0 Or lstOption2.Items.Count = 0 Or lstOption3.Items.Count = 0 Then
                    MsgBox("One or more options not specified !", MsgBoxStyle.Exclamation)
                    Exit Sub
                End If
            End If

            If rptType = ReportType.CustomerStmt Then
                If InStr(cmbParty.EditValue, ",", CompareMethod.Text) > 0 Then
                    MsgBox("You can view only one customer statement at a time !", MsgBoxStyle.Exclamation)
                    cmbParty.Focus()
                    Exit Sub
                End If
            End If

            If rptType = ReportType.StockAtAGlanceSubGroup Or rptType = ReportType.StockAtAGlanceProduct Or rptType = ReportType.StockAtAGlanceBrand Or rptType = ReportType.StockAtAGlanceSupplier Or rptType = ReportType.StockAtAGlanceLocation Or rptType = ReportType.StockAtAGlanceCustomer Then
                If lstOption1.Items.Count = 0 Or lstOption2.Items.Count = 0 Or lstDetails.Items.Count = 0 Then
                    MsgBox("One or more options not specified !", MsgBoxStyle.Exclamation)
                    Exit Sub
                End If
            End If

            ''saurabh08092018
            'If rdDetailed.Checked = True Then
            '    If lstDetails.Items.Count = 0 Then
            '        MsgBox("One or more options not specified in detail section!", MsgBoxStyle.Exclamation)
            '        Exit Sub
            '    End If
            'End If

            'If pnlSelectOption.Visible Then
            '    If lstOption1.Enabled And lstOption2.Enabled And lstOption3.Enabled Then
            '        If lstOption1.Items.Count > 0 And lstOption2.Items.Count > 0 Then
            '            If UCase(lstOption1.Items(0)) = UCase(lstOption2.Items(0)) Then
            '                MsgBox("Cannot select duplicate options !", MsgBoxStyle.Exclamation)
            '                Exit Sub
            '            End If

            '        ElseIf lstOption1.Items.Count > 0 And lstOption3.Items.Count > 0 Then
            '            If UCase(lstOption1.Items(0)) = UCase(lstOption3.Items(0)) Then
            '                MsgBox("Cannot select duplicate options !", MsgBoxStyle.Exclamation)
            '                Exit Sub
            '            End If

            '        ElseIf lstOption2.Items.Count > 0 And lstOption3.Items.Count > 0 Then
            '            If UCase(lstOption2.Items(0)) = UCase(lstOption3.Items(0)) Then
            '                MsgBox("Cannot select duplicate options !", MsgBoxStyle.Exclamation)
            '                Exit Sub
            '            End If
            '        End If

            '    ElseIf lstOption1.Enabled And lstOption2.Enabled Then
            '        If lstOption1.Items.Count > 0 And lstOption2.Items.Count > 0 Then
            '            If UCase(lstOption1.Items(0)) = UCase(lstOption2.Items(0)) Then
            '                MsgBox("Cannot select duplicate options !", MsgBoxStyle.Exclamation)
            '                Exit Sub
            '            End If
            '        End If

            '    ElseIf lstOption1.Enabled And lstOption3.Enabled Then
            '        If lstOption1.Items.Count > 0 And lstOption3.Items.Count > 0 Then
            '            If UCase(lstOption1.Items(0)) = UCase(lstOption3.Items(0)) Then
            '                MsgBox("Cannot select duplicate options !", MsgBoxStyle.Exclamation)
            '                Exit Sub
            '            End If
            '        End If

            '    ElseIf lstOption2.Enabled And lstOption3.Enabled Then
            '        If lstOption2.Items.Count > 0 And lstOption3.Items.Count > 0 Then
            '            If UCase(lstOption2.Items(0)) = UCase(lstOption3.Items(0)) Then
            '                MsgBox("Cannot select duplicate options !", MsgBoxStyle.Exclamation)
            '                Exit Sub
            '            End If
            '        End If
            '    End If
            'End If

            '''saurabh 11092018

            '''' end 


            'Suraj 27 12 2023
            If rptType = ReportType.Ready_Stock_Multi Then
                StockDrillDown()
                Exit Sub
            End If

            Me.Cursor = Cursors.WaitCursor
            Series = ""

            Formulas = Nothing
            If TransType = TransactionType.Stock Or TransType = TransactionType.StyleCosting Then
                SetStockReportParameters()
            Else
                SetOtherReportParameters()
            End If


            If IsNothing(ReportParameters.rptFile) Then Exit Sub
            If ReportParameters.rptFile.Trim.Length = 0 Then Exit Sub

            ReportParameters.rptCaption = Me.Text
            frmView = New frmViewReports(Formulas)
            frmView.Show()

            Formulas = Nothing

            ''''''
            If rptType = ReportType.OrderInHandMonthWise Then
                Dim i As Integer = 1
                Dim j As Integer = 2
                Dim k As Integer = 1
                Dim SOPartyWise As DataTable
                Dim DtOrder As DataTable
                Dim DtSales As DataTable
                Dim OrderAmt As Decimal
                Dim SalesAmt As Decimal

                Query = "Delete from TmpSalesSOStatusBuyerwise Where Cobr_id ='" & SelBranchId & "' "
                Common.ExecuteQuery(Query)

                Dim strmonth As String = Format$(Month(dtpFrom.Value), "00")
                Dim StrDate As String = ""

                Dim CurrentYr As Integer
                Dim CurrentYear As Integer

                If strmonth = "01" Or strmonth = "02" Or strmonth = "03" Then
                    CurrentYr = Mid$(Year(dtpFrom.Value) - 1, 3)
                    CurrentYear = Year(dtpFrom.Value) - 1
                Else
                    CurrentYr = Mid$(Year(dtpFrom.Value), 3)
                    CurrentYear = Year(dtpFrom.Value)
                End If

                Dim Year1, Year2, Year3 As String

                Year3 = CurrentYear & "-" & CurrentYr + 1
                Year2 = CurrentYear - 1 & "-" & CurrentYr
                Year1 = CurrentYear - 2 & "-" & CurrentYr - 1

                Query = "Insert Into TmpSalesSOStatusBuyerwise values(0,'NAME OF THE BUYERS','','" & Year1 & "','" & Year2 & "',0,0,0,'','" & Year3 & "','" & SelBranchId & "','0')"
                Common.ExecuteQuery(Query)

                If strmonth = "04" Then
                    StrDate = "04/30/" & CurrentYear
                ElseIf strmonth = "05" Then
                    StrDate = "05/31/" & CurrentYear
                ElseIf strmonth = "06" Then
                    StrDate = "06/30/" & CurrentYear
                ElseIf strmonth = "07" Then
                    StrDate = "07/31/" & CurrentYear
                ElseIf strmonth = "08" Then
                    StrDate = "08/31/" & CurrentYear
                ElseIf strmonth = "09" Then
                    StrDate = "09/30/" & CurrentYear
                ElseIf strmonth = "10" Then
                    StrDate = "10/31/" & CurrentYear
                ElseIf strmonth = "11" Then
                    StrDate = "11/30/" & CurrentYear
                ElseIf strmonth = "12" Then
                    StrDate = "12/31/" & CurrentYear
                ElseIf strmonth = "01" Then
                    StrDate = "01/31/" & CurrentYear + 1
                ElseIf strmonth = "02" Then
                    StrDate = "02/28/" & CurrentYear + 1
                ElseIf strmonth = "03" Then
                    StrDate = "03/31/" & CurrentYear + 1
                End If

                'SalesOrder.DlvDate >= '04/01/" & CurrentYear & "'  And 
                Query = "Select round(sum(a.amount),2) Amount, a.Led_Name,a.led_key From " _
                       & " (SELECT SUM (PendingRs )/100000 Amount,Led_Name,ledger.led_key " _
                       & " FROM vw_SalesOrderCurrencyWise " _
                       & " left join SalesOrder on vw_SalesOrderCurrencyWise.Doc_Id=SalesOrder.Doc_Id " _
                       & " left join ledger on ledger.Led_Key=SalesOrder.Cust_Key " _
                       & " WHERE  SalesOrder.DlvDate <= '03/31/" & CurrentYear + 1 & "' And SalesOrder.SOStatus_Id in(1,2) " _
                       & " group by Led_Name,ledger.led_key " _
                       & " union all " _
                       & " SELECT SUM (PendingRs )/100000 Amount,Led_Name,ledger.led_key " _
                       & " FROM vw_SalesOrderShipped " _
                       & " left join ledger on ledger.Led_Key=vw_SalesOrderShipped.Cust_Key " _
                       & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '04/01/" & CurrentYear & "'  And vw_SalesOrderShipped.Doc_Dt <= '" & StrDate & "' " _
                       & " group by Led_Name,ledger.led_key  " _
                       & ") as a  " _
                       & " group by  a.Led_Name,a.led_key " _
                       & " order by amount desc"

                'Query = "Select sum(a.amount) Amount, a.Led_Name,a.led_key From " _
                '       & " (SELECT round(SUM (PendingRs )/100000,0) Amount,Led_Name,ledger.led_key " _
                '       & " FROM vw_SalesOrderShipped " _
                '       & " left join ledger on ledger.Led_Key=vw_SalesOrderShipped.Cust_Key " _
                '       & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "'  And vw_SalesOrderShipped.Doc_Dt <= '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' " _
                '       & " group by Led_Name,ledger.led_key  " _
                '       & ") as a  " _
                '       & " group by  a.Led_Name,a.led_key " _
                '       & " order by amount desc"
                SOPartyWise = Common.GetDataTable(Query)

                Dim recrow As DataRow
                If SOPartyWise.Rows.Count > 0 Then

                    For Each recrow In SOPartyWise.Rows
                        OrderAmt = 0 : SalesAmt = 0

                        'SalesOrder.DlvDate >= '04/01/" & CurrentYear & "'  And 
                        Query = "SELECT isnull(SUM (PendingRs )/100000,0) Amount" _
                                   & " FROM vw_SalesOrderCurrencyWise " _
                                   & " left join SalesOrder on vw_SalesOrderCurrencyWise.Doc_Id=SalesOrder.Doc_Id " _
                                   & " WHERE  SalesOrder.DlvDate <= '03/31/" & CurrentYear + 1 & "' And SalesOrder.SOStatus_Id in(1,2) " _
                                   & " AND  SalesOrder.Cust_Key = '" & recrow("Led_Key") & "'"
                        DtOrder = Common.GetDataTable(Query)
                        If DtOrder.Rows.Count > 0 Then
                            OrderAmt = DtOrder.Rows(0)(0)
                        End If

                        Query = "SELECT isnull(SUM (PendingRs )/100000,0) Amount" _
                                  & " FROM vw_SalesOrderShipped " _
                                  & " left join ledger on ledger.Led_Key=vw_SalesOrderShipped.Cust_Key " _
                                  & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '04/01/" & CurrentYear & "'  And vw_SalesOrderShipped.Doc_Dt <= '" & StrDate & "' " _
                                  & " AND  vw_SalesOrderShipped.Cust_Key = '" & recrow("Led_Key") & "'"
                        DtSales = Common.GetDataTable(Query)
                        If DtSales.Rows.Count > 0 Then
                            SalesAmt = DtSales.Rows(0)(0)
                        End If


                        If chkDispRate.Checked = False Then ''Satyam 09082022

                            If i <= 25 Then
                                Query = "Insert Into TmpSalesSOStatusBuyerwise values(" & i & ",'" & recrow("Led_Name") & "','" & recrow("Led_Key") & "','',''," & SalesAmt & "," & OrderAmt & "," & recrow("Amount") & ",'','','" & SelBranchId & "','0')"
                                Common.ExecuteQuery(Query)
                            ElseIf i = 26 Then
                                Query = "Insert Into TmpSalesSOStatusBuyerwise values(" & i & ",'OTHER BUYERS','','',''," & SalesAmt & "," & OrderAmt & "," & recrow("Amount") & ",'','','" & SelBranchId & "','0')"
                                Common.ExecuteQuery(Query)
                            Else
                                Query = "Update TmpSalesSOStatusBuyerwise Set Sales = Sales + " & SalesAmt & ", OrderInHand = OrderInHand + " & OrderAmt & ", TotalTurnover = TotalTurnover + " & recrow("Amount") & "  Where Sr_No=26"
                                Common.ExecuteQuery(Query)
                            End If
                        Else
                            Query = "Insert Into TmpSalesSOStatusBuyerwise values(" & i & ",'" & recrow("Led_Name") & "','" & recrow("Led_Key") & "','',''," & SalesAmt & "," & OrderAmt & "," & recrow("Amount") & ",'','','" & SelBranchId & "','0')"
                            Common.ExecuteQuery(Query)
                        End If

                        i = i + 1
                    Next recrow
                End If

                ''''  10/04/2022

                Dim recrow1 As DataRow
                Query = "Select Led_key From TmpSalesSOStatusBuyerwise Where Sr_No<>'0' "

                SOPartyWise = Common.GetDataTable(Query)

                If SOPartyWise.Rows.Count > 0 Then

                    For Each recrow1 In SOPartyWise.Rows
                        SalesAmt = 0

                        If recrow1("Led_Key") <> "" Then
                            Query = "SELECT isnull(SUM (PendingRs )/100000,0) Amount" _
                                      & " FROM vw_SalesOrderShipped " _
                                      & " left join ledger on ledger.Led_Key=vw_SalesOrderShipped.Cust_Key " _
                                      & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '04/01/" & CurrentYear - 1 & "'  And vw_SalesOrderShipped.Doc_Dt <= '03/31/" & CurrentYear & "' " _
                                      & " AND  vw_SalesOrderShipped.Cust_Key = '" & recrow1("Led_Key") & "'"
                        Else
                            Query = "SELECT isnull(SUM (PendingRs )/100000,0) Amount" _
                                      & " FROM vw_SalesOrderShipped " _
                                      & " left join ledger on ledger.Led_Key=vw_SalesOrderShipped.Cust_Key " _
                                      & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '04/01/" & CurrentYear - 1 & "'  And vw_SalesOrderShipped.Doc_Dt <= '03/31/" & CurrentYear & "' " _
                                      & " AND  vw_SalesOrderShipped.Cust_Key Not In(Select Led_Key From TmpSalesSOStatusBuyerwise) "
                        End If

                        DtSales = Common.GetDataTable(Query)
                        If DtSales.Rows.Count > 0 Then
                            SalesAmt = DtSales.Rows(0)(0)
                        End If

                        Query = "Update TmpSalesSOStatusBuyerwise Set Year_2 = '" & Format(SalesAmt, "0") & "'  Where Led_Key = '" & recrow1("Led_Key") & "' And Sr_No <>'0' "
                        Common.ExecuteQuery(Query)

                        If recrow1("Led_Key") <> "" Then
                            Query = "SELECT isnull(SUM (PendingRs )/100000,0) Amount" _
                                      & " FROM vw_SalesOrderShipped " _
                                      & " left join ledger on ledger.Led_Key=vw_SalesOrderShipped.Cust_Key " _
                                      & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '04/01/" & CurrentYear - 2 & "'  And vw_SalesOrderShipped.Doc_Dt <= '03/31/" & CurrentYear - 1 & "' " _
                                      & " AND  vw_SalesOrderShipped.Cust_Key = '" & recrow1("Led_Key") & "'"
                        Else
                            Query = "SELECT isnull(SUM (PendingRs )/100000,0) Amount" _
                                      & " FROM vw_SalesOrderShipped " _
                                      & " left join ledger on ledger.Led_Key=vw_SalesOrderShipped.Cust_Key " _
                                      & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '04/01/" & CurrentYear - 2 & "'  And vw_SalesOrderShipped.Doc_Dt <= '03/31/" & CurrentYear - 1 & "' " _
                                      & " AND  vw_SalesOrderShipped.Cust_Key Not In(Select Led_Key From TmpSalesSOStatusBuyerwise) "
                        End If


                        DtSales = Common.GetDataTable(Query)
                        If DtSales.Rows.Count > 0 Then
                            SalesAmt = DtSales.Rows(0)(0)
                        End If

                        Query = "Update TmpSalesSOStatusBuyerwise Set Year_1 = '" & Format(SalesAmt, "0") & "'  Where Led_Key = '" & recrow1("Led_Key") & "' And Sr_No <>'0' "
                        Common.ExecuteQuery(Query)

                    Next recrow1
                End If

                Formulas = New Hashtable
                Formulas.Add("Allbuyer#S", IIf(chkDispRate.Checked, 0, 1)) ''Satyam 09082022
                ReportParameters.rptFile = ReportPath & "\Reports\MISOrderInHandPartyWise.rpt"
                ReportParameters.rptFilter = "{TmpSalesSOStatusBuyerwise.CoBr_Id} = '" & SelBranchId & "'"
                ReportParameters.rptCaption = "Sales / Orders In Hand (Buyer Wise)"

                ReportParameters.rptCaption = Me.Text


                frmView = New frmViewReports(Formulas)
                frmView.Show()
                Formulas = Nothing

                Formulas = New Hashtable
                Formulas.Add("Allbuyer#S", IIf(chkDispRate.Checked, 0, 1)) ''Satyam 09082022
                ReportParameters.rptFile = ReportPath & "\Reports\MISOrderInHandPartyWiseDetail.rpt"
                ReportParameters.rptFilter = "{TmpSalesSOStatusBuyerwise.CoBr_Id} = '" & SelBranchId & "'"
                ReportParameters.rptCaption = "Sales / Orders In Hand (Buyer Wise)"


                ReportParameters.rptCaption = Me.Text
                
                frmView = New frmViewReports(Formulas)
                frmView.Show()
                Formulas = Nothing

            End If

            If rptType = ReportType.PreShipmentAnalysis Then
                Dim FromToDt As String = ""
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\OCPreShipSumm.rpt"
                ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & strSOFilter1
                ReportParameters.rptCaption = "Pre Shipment Analysis"

                ReportParameters.rptCaption = Me.Text
                frmView = New frmViewReports(Formulas)
                frmView.Show()
            End If


        Catch sqlEx As SqlException
            Common.LogAndDisplayException(sqlEx)
        Catch ex As Exception
            Common.LogAndDisplayException(ex)
        Finally
            Me.Cursor = Cursors.Default
        End Try
    End Sub

    Private Sub cmbProductGrp_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbProductGrp.Closed
        If cmbProductGrp.IsModified Then
            cmbProductSubGrp.Properties.DataSource = Nothing
            cmbProductSubGrp.SetEditValue("")
            ClearDropDown(cmbProductSubGrp)

            cmbProduct.Properties.DataSource = Nothing
            cmbProduct.SetEditValue("")
            ClearDropDown(cmbProduct)

            cmbStyle.Properties.DataSource = Nothing
            cmbStyle.SetEditValue("")
            ClearDropDown(cmbStyle)

            cmbSize.Properties.DataSource = Nothing
            cmbSize.SetEditValue("")
            ClearDropDown(cmbSize)

            cmbType.Properties.DataSource = Nothing
            cmbType.SetEditValue("")
            ClearDropDown(cmbType)

            If cmbProductGrp.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub

            DisplayProductSubGroup()
            DisplayProduct()
            DisplayStyle()
            DisplaySize()
            DisplayType()

            If rptType = ReportType.SalesOrderRegister_AllInOne Then
                DisplayBrand()
            End If

        End If
    End Sub

    Private Sub cmbProductSubGrp_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbProductSubGrp.Closed
        If cmbProductSubGrp.IsModified Then
            cmbProduct.Properties.DataSource = Nothing
            cmbProduct.SetEditValue("")
            ClearDropDown(cmbProduct)

            cmbStyle.Properties.DataSource = Nothing
            cmbStyle.SetEditValue("")
            ClearDropDown(cmbStyle)

            cmbSize.Properties.DataSource = Nothing
            cmbSize.SetEditValue("")
            ClearDropDown(cmbSize)

            cmbType.Properties.DataSource = Nothing
            cmbType.SetEditValue("")
            ClearDropDown(cmbType)

            If cmbProductSubGrp.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub

            DisplayProduct()
            DisplayStyle()
            DisplaySize()
            DisplayType()
        End If
    End Sub

    Private Sub cmbProduct_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbProduct.Closed
        If cmbProduct.IsModified Then
            cmbStyle.Properties.DataSource = Nothing
            cmbStyle.SetEditValue("")
            ClearDropDown(cmbStyle)

            cmbType.Properties.DataSource = Nothing
            cmbType.SetEditValue("")
            ClearDropDown(cmbType)

            If cmbProduct.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub

            DisplayStyle()
            DisplaySize()
            DisplayType()
        End If
    End Sub

    Private Function GetSelectedAttributes(ByVal Combo As Object, ByVal FieldName As String)
        Dim SelectedItems As String = ""
        Dim AllItems As String = ""
        Dim SelValues As String = ""

        SelectedItems = Combo.Properties.GetCheckedItems
        AllItems = SelectedList(Combo, SelectedItems)

        If AllItems <> "" Then
            SelValues = " {" & FieldName & "} In [" & AllItems & "]"
        Else
            SelValues = ""
        End If

        Return SelValues
    End Function
    Private Function GetSelectedAttributes1(ByVal Combo As Object, ByVal FieldName As String)
        Dim SelectedItems As String = ""
        Dim AllItems As String = ""
        Dim SelValues As String = ""

        SelectedItems = Combo.Properties.GetCheckedItems
        AllItems = SelectedList(Combo, SelectedItems)

        If AllItems <> "" Then
            SelValues = " " & FieldName & " In (" & AllItems & ")"
        Else
            SelValues = ""
        End If

        Return SelValues
    End Function
    Private Function GetSelectedAttributesNumeric(ByVal Combo As Object, ByVal FieldName As String)
        Dim SelectedItems As String = ""
        Dim AllItems As String = ""
        Dim SelValues As String = ""

        SelectedItems = Combo.Properties.GetCheckedItems
        AllItems = SelectedList(Combo, SelectedItems, True)

        If AllItems <> "" Then
            SelValues = " {" & FieldName & "} In [" & AllItems & "]"
        Else
            SelValues = ""
        End If

        Return SelValues
    End Function

    Private Function GetSelectedAttributesForQuery(ByVal Combo As Object, ByVal FieldName As String)
        Dim SelectedItems As String = ""
        Dim AllItems As String = ""
        Dim SelValues As String = ""

        SelectedItems = Combo.Properties.GetCheckedItems
        AllItems = SelectedList(Combo, SelectedItems)

        If AllItems <> "" Then
            SelValues = FieldName & " In (" & AllItems & ")"
        Else
            SelValues = ""
        End If

        Return SelValues
    End Function

    Private Function GetSelectedAttributesForStock(ByVal Combo As Object, ByVal FieldName As String)
        Dim SelectedItems As String = ""
        Dim AllItems As String = ""
        Dim SelValues As String = ""

        SelectedItems = Combo.Properties.GetCheckedItems
        AllItems = SelectedList(Combo, SelectedItems)

        If AllItems <> "" Then
            SelValues = FieldName & " In [" & AllItems & "]"
        Else
            SelValues = ""
        End If

        Return SelValues
    End Function
    Private Function GetSelectedAttributesForStock1(ByVal Combo As Object, ByVal FieldName As String)
        Dim SelectedItems As String = ""
        Dim AllItems As String = ""
        Dim SelValues As String = ""

        SelectedItems = Combo.Properties.GetCheckedItems
        AllItems = SelectedList(Combo, SelectedItems)

        If AllItems <> "" Then
            SelValues = FieldName & " In (" & AllItems & ")"
        Else
            SelValues = ""
        End If

        Return SelValues
    End Function
    Private Function GetSelectedAttributesForUsers(ByVal Combo As Object, ByVal FieldName As String)
        Dim SelectedItems As String = ""
        Dim AllItems As String = ""
        Dim SelValues As String = ""

        SelectedItems = Combo.Properties.GetCheckedItems
        AllItems = SelectedList(Combo, SelectedItems, True)

        If AllItems <> "" Then
            SelValues = FieldName & " In [" & AllItems & "]"
        Else
            SelValues = ""
        End If

        Return SelValues
    End Function

    Private Sub SetOtherReportParameters()
        Dim SelUsers As String = ""
        Dim SelCounter As String = ""
        Dim SelUserCtr As String = ""
        Dim SelTax As String = ""
        Dim SelProStg As String = ""
        Dim StockFltr As String = ""
        Dim PartyFltr As String = ""
        Dim LocFilter As String = ""
        Dim TaxFilter As String = ""
        Dim FromToDt As String = ""
        Dim FromToDt1 As String = ""
        Dim TmpField As String = ""
        Dim OthOptions As String = ""
        Dim Param As String = ""
        Dim POTypeFltr As String = ""
        Dim StockParam As String = ""
        Dim QtyFilter As String = ""
        Dim PurType As String = ""
        Dim StatusType
     
        If rptType = ReportType.PurchaseRegister_OperatorWise Or rptType = ReportType.SalesRegister_OperatorWise Then
            SelUsers = GetSelectedAttributesForUsers(cmbOperator, "{Users.User_Id}")
            If SelUsers.Trim.Length > 0 Then
                SelUserCtr &= " And " & SelUsers
            End If
        End If

        If rptType = ReportType.PurchaseRegister_CounterWise Or rptType = ReportType.SalesRegister_CounterWise Then
            SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Counter.Ctr_Key}")
            If SelCounter.Trim.Length > 0 Then
                SelUserCtr &= " And " & SelCounter
            End If
        End If

        If rptType = ReportType.SaleTaxRegister Then
            TmpField = "{vw_SaleWithRtn.TAXTERM_KEY}"
            SelTax = GetSelectedAttributesForStock(cmbTax, TmpField)
            If SelTax.Trim.Length > 0 Then
                SelTax = " And " & SelTax
            End If
        End If

        If rptType = ReportType.PurTaxRegister_DateWise Or rptType = ReportType.PurTaxRegister_DocWise Or rptType = ReportType.PurTaxRegister_Summary Or rptType = ReportType.PurTaxRegister_ProductWise Or rptType = ReportType.PurTaxRegister_SupplierWise Then
            If rptType = ReportType.PurTaxRegister_Summary Then
                TmpField = "{vw_SalePurTax.Tax_Key}"
            Else
                TmpField = "{vw_PurchaseWithRtn.Tax_Key}"
            End If

            SelTax = GetSelectedAttributesForStock(cmbTax, TmpField)
            If SelTax.Trim.Length > 0 Then
                SelTax = " And " & SelTax
            End If
        End If

        If rptType = ReportType.SalesVATRegister Or rptType = ReportType.SalesTaxRegister_DateWise Or rptType = ReportType.SalesTaxRegister_DocWise Or rptType = ReportType.SalesTaxRegister_Summary Or rptType = ReportType.TaxComputation Or rptType = ReportType.SalesTaxRegister_ProductWise Or rptType = ReportType.SalesTaxRegister_SubGroupWise Then
            If rptType = ReportType.SalesTaxRegister_Summary Or rptType = ReportType.TaxComputation Then
                TmpField = "{vw_SalePurTax.Tax_Key}"
            Else
                TmpField = "{vw_SaleWithRtn.Tax_Key}"
            End If

            SelTax = GetSelectedAttributesForStock(cmbTax, TmpField)
            If SelTax.Trim.Length > 0 Then
                SelTax = " And " & SelTax
            End If
        End If

        If rptType = ReportType.SalesRtnVATRegister Or rptType = ReportType.SalesRtnTaxRegister_DateWise Or rptType = ReportType.SalesRtnTaxRegister_DocWise Or rptType = ReportType.SalesRtnTaxRegister_Summary Or rptType = ReportType.SalesRtnTaxRegister_ProductWise Or rptType = ReportType.SalesRtnTaxRegister_SubGroupWise Then
            If rptType = ReportType.SalesRtnTaxRegister_Summary Then
                TmpField = "{vw_SalePurTax.Tax_Key}"
            Else
                TmpField = "{vw_SaleWithRtn.Tax_Key}"
            End If

            SelTax = GetSelectedAttributesForStock(cmbTax, TmpField)
            If SelTax.Trim.Length > 0 Then
                SelTax = " And " & SelTax
            End If
        End If


        Formulas = New Hashtable

        Select Case rptType
            '' CHANGE BY RAHUL ON 29/07/2019
            Case ReportType.JobOrderReg_Datewise
                FromToDt = GetFromToDateSeriesFilter("{JobOrder.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("JobOrder", True)
                StockFltr = GetStockFilter("JobOrder", True)

                ReportParameters.rptFile = ReportPath & "\Reports\JobWorkOrder.rpt"
                ReportParameters.rptCaption = "Job Order Register (Date Wise)"
                ReportParameters.rptFilter = "{JobOrder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions & PartyFltr & StockFltr
                Formulas.Add("DateGrp#N", 1)
                'Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                'Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                'ViewReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.JobWorkPOStatus_Billwise
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim jworderno As String = ""
                If cmbOrderNo.SelectedIndex <> -1 Then
                    jworderno = " And {vw_JobWorkRegrpt.Doc_Id} = " & Val(cmbOrderNo.Value) & ""
                End If
                FromToDt = GetFromToDateSeriesFilter("{vw_JobWorkRegrpt.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("vw_JobWorkRegrpt", True)
                StockFltr = GetStockFilter("vw_JobWorkRegrpt", True)
                'Dim jworderno = cmbOrderNo.Value
                ReportParameters.rptFile = ReportPath & "\Reports\PendJobWorkPORegDocDtl.rpt"
                ReportParameters.rptCaption = "JobWork PO Status Billwise"
                ReportParameters.rptFilter = "{vw_JobWorkRegrpt.CoBr_Id} = '" & SelBranchId & "' And {vw_JobWorkRegrpt.SODtl_ID}<>0 " & FromToDt & strSOFilter1 & PartyFltr & jworderno   ' Added By Vishnu On 11-11-2019


                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.GoodsRecvAgst_JobWorkPO
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim jworderno As String = ""
                If cmbOrderNo.SelectedIndex <> -1 Then
                    jworderno = " And {JobWorkPO.Doc_Id} = " & Val(cmbOrderNo.Value) & ""
                End If

                PartyFltr = GetPartyFilter("JobWorkPO", True)
                
                ReportParameters.rptFile = ReportPath & "\Reports\rcptagnstjobworkpo.rpt"
                ReportParameters.rptCaption = "Goods Recv Agst JobWork PO"
                ReportParameters.rptFilter = " {JobWorkPO.CoBr_Id} = '" & SelBranchId & "' " & strSOFilter1 & PartyFltr & jworderno   ' Added By Vishnu On 11-11-2019
                ' Formulas.Add("ReportCaption#S", ReportParameters.rptCaption) '


              


            Case ReportType.JobWorkOrderStatus_Billwise
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim jworderno As String = ""
                If cmbOrderNo.SelectedIndex <> -1 Then
                    jworderno = " And {vw_JobWorkOrderRegrpt.Doc_Id} = " & Val(cmbOrderNo.Value) & ""
                End If
                FromToDt = GetFromToDateSeriesFilter("{vw_JobWorkOrderRegrpt.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("vw_JobWorkOrderRegrpt", True)
                StockFltr = GetStockFilter("vw_JobWorkOrderRegrpt", True)
                'Dim jworderno = cmbOrderNo.Value vw_PurOrderRpt  Vw_JObWOrkOrderRegRpt     And {vw_PurOrderRpt.SO_DocDtlId}<>0 
                ReportParameters.rptFile = ReportPath & "\Reports\PendJobWorkOrderRegDocDtl.rpt"
                ReportParameters.rptCaption = "JobWork Order Status Billwise"
                ReportParameters.rptFilter = "{vw_JobWorkOrderRegrpt.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & strSOFilter1 & PartyFltr & jworderno   ' Added By Vishnu On 11-11-2019


                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.GoodsRecvAgst_JobWorkOrder
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim jworderno As String = ""
                If cmbOrderNo.SelectedIndex <> -1 Then
                    jworderno = " And {JobOrder.Doc_Id} = " & Val(cmbOrderNo.Value) & ""
                End If
                ' FromToDt = GetFromToDateSeriesFilter("{JobOrder.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("JobOrder", True)
              
                ReportParameters.rptFile = ReportPath & "\Reports\rcptagnstjobworkorder.rpt"
                ReportParameters.rptCaption = "Goods Recv Agst JobWork Order"
                ReportParameters.rptFilter = "{JobOrder.CoBr_Id} = '" & SelBranchId & "'  " & strSOFilter1 & PartyFltr & jworderno
                'Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                '''Satyam 03012023
            Case ReportType.JobWorkOrder_Status
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim jworderno As String = ""
                If cmbOrderNo.SelectedIndex <> -1 Then
                    jworderno = " And {JobOrder.Doc_Id} = " & Val(cmbOrderNo.Value) & ""
                End If

                PartyFltr = GetPartyFilter("JobOrder", True)

                If cmbPurType.SelectedIndex = 0 Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JobWorkStatusAll.rpt"
                    ReportParameters.rptFilter = "{JobOrder.CoBr_Id} = '" & SelBranchId & "'" & strSOFilter1 & PartyFltr & jworderno
                ElseIf cmbPurType.SelectedIndex = 1 Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JobWorkStatusFin.rpt"
                    ReportParameters.rptFilter = "{VW_JoborderStatusFin.isu_type} = 'P'  And {JobOrder.CoBr_Id} = '" & SelBranchId & "'" & strSOFilter1 & PartyFltr & jworderno
                ElseIf cmbPurType.SelectedIndex = 2 Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JobWorkStatusFab.rpt"
                    ReportParameters.rptFilter = "{VW_JoborderStatusFab.jobisu_type} = 'FI'  And{JobOrder.CoBr_Id} = '" & SelBranchId & "'" & strSOFilter1 & PartyFltr & jworderno
                ElseIf cmbPurType.SelectedIndex = 3 Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JobWorkStatusAcc.rpt"
                    ReportParameters.rptFilter = "{VW_JoborderStatusFab.jobisu_type} = 'AI' And {JobOrder.CoBr_Id} = '" & SelBranchId & "'" & strSOFilter1 & PartyFltr & jworderno
                End If
                'ReportParameters.rptFile = ReportPath & "\Reports\rcptagnstjobworkpo.rpt"
                ReportParameters.rptCaption = "JobWork Order Status"

                ' Formulas.Add("ReportCaption#S", ReportParameters.rptCaption) '

            Case ReportType.JobWorkPO_Status
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim jworderno As String = ""
                If cmbOrderNo.SelectedIndex <> -1 Then
                    jworderno = " And {JobWorkPO.Doc_Id} = " & Val(cmbOrderNo.Value) & ""
                End If

                PartyFltr = GetPartyFilter("JobWorkPO", True)

                If cmbPurType.SelectedIndex = 0 Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JobWorkPOStatusFin.rpt" '''Need report
                    ReportParameters.rptFilter = "{VW_JobWorkPOStatusFin.isu_type} = 'P'  And  {JobWorkPO.CoBr_Id} = '" & SelBranchId & "' " & strSOFilter1 & PartyFltr & jworderno   ' Added By Vishnu On 11-11-2019
                ElseIf cmbPurType.SelectedIndex = 1 Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JobWorkPOStatusFab.rpt"
                    ReportParameters.rptFilter = "{VW_JobWorkPOStatusFab.jobisu_type} = 'FP'  And {JobWorkPO.CoBr_Id} = '" & SelBranchId & "' " & strSOFilter1 & PartyFltr & jworderno   ' Added By Vishnu On 11-11-2019
                ElseIf cmbPurType.SelectedIndex = 2 Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JobWorkPOStatusAcc.rpt"
                    ReportParameters.rptFilter = "{VW_JobWorkPOStatusFab.jobisu_type} = 'IP'  And  {JobWorkPO.CoBr_Id} = '" & SelBranchId & "' " & strSOFilter1 & PartyFltr & jworderno   ' Added By Vishnu On 11-11-2019
               
                End If
                'ReportParameters.rptFile = ReportPath & "\Reports\rcptagnstjobworkpo.rpt"
                ReportParameters.rptCaption = "JobWork PO Status"

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption) '

                '''End 
            Case ReportType.JobWorkOrderStatus
                FromToDt = GetFromToDateSeriesFilter("{JobOrder.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("JobOrder", True)
                StockFltr = GetStockFilter("JobOrder", True)
                'Dim jworderno = cmbJOrderNo.Value
                Dim jworderno As String = ""
                If Val(cmbJOrderNo.Value) <> 0 Then
                    jworderno = " And {JobOrder.Doc_id} =" & cmbJOrderNo.Value & " "

                End If

                Dim strOptions As String = ""
                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then

                    If rdOthOption1.Checked = True And pnlOtherOptions.Visible = True Then
                        'strOptions = " and {ProdnplnFab.Bal_Qty}>0 "
                        Formulas.Add("BalQty_Status#S", "P")
                    ElseIf rdOthOption2.Checked = True And pnlOtherOptions.Visible = True Then
                        'strOptions = " and {ProdnplnFab.Bal_Qty}=0 "
                        Formulas.Add("BalQty_Status#S", "C")
                    End If
                End If

                If cmbPurType.SelectedIndex = 0 Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JoborderStatusAll.rpt"

                ElseIf cmbPurType.SelectedIndex = 1 Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JoborderStatusFin.rpt"

                ElseIf cmbPurType.SelectedIndex = 2 Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JoborderStatusFab.rpt"

                ElseIf cmbPurType.SelectedIndex = 3 Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JoborderStatusAcc.rpt"

                End If


                ReportParameters.rptCaption = "Job Work Order Status"
                ' ReportParameters.rptFilter = "{JobOrder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions & PartyFltr & StockFltr & jworderno  'Commented By Vishnu On 11-11-2019
                ReportParameters.rptFilter = " {JobOrder.CoBr_Id} = '" & SelBranchId & "' " & StockFltr & PartyFltr & jworderno & FromToDt & strOptions    ' Added By Vishnu On 11-11-2019

                Formulas.Add("DateGrp#N", 1)
                
                'Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                'Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                'ViewReportWithOptions(ReportParameters.rptCaption)


                '' END


                ''Job card
            Case ReportType.JobCardReg_DateWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)

                ReportParameters.rptFile = ReportPath & "\Reports\JobCard.rpt"
                ReportParameters.rptCaption = "Job Card Register (Date Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                Formulas.Add("DateGrp#N", 1)
                'Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                'Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                'ViewReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.JobCardReg_JobberWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("ProcIsu", True)
                StockFltr = GetStockFilter("ProcIsu", True)

                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim strPOFilter1 As String = ""
                If chkData.Checked = True Then

                    'Rajashri-09-12-2021'

                    If cmbOrderNo.SelectedIndex <> -1 Then
                        strPOFilter1 = " And {ProcIsu.JobPo_Id} = " & Val(cmbOrderNo.Value) & ""
                    End If
                Else
                    If cmbOrderNo.SelectedIndex <> -1 Then
                        'strPOFilter1 = " And {ProcIsu.JobOrder_ID} = " & Val(cmbOrderNo.Value) & ""
                        strPOFilter1 = " And {ProcIsu.JobOrder_Id} = " & Val(cmbOrderNo.Value) & ""
                    End If
                End If
                'sunil  29/02/2020
                'If PartyFltr <> "" Then
                '    PartyFltr = " And " & PartyFltr
                'End If

                ReportParameters.rptFile = ReportPath & "\Reports\JobCard.rpt"
                ReportParameters.rptCaption = "Job Card Register (Jobber Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & strSOFilter1 & strPOFilter1
                'ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                'Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'ViewReportWithOptions(ReportParameters.rptCaption)
                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.JobCardReg_ProcessWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\JobCard.rpt"
                ReportParameters.rptCaption = "Job Card Register (Process Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'ViewReportWithOptions(ReportParameters.rptCaption)
                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.JobCardReg_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\JobCard.rpt"
                ReportParameters.rptCaption = "Job Card Register (Sub-Group Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'ViewReportWithOptions(ReportParameters.rptCaption)
                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.JobCardReg_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\JobCard.rpt"
                ReportParameters.rptCaption = "Job Card Register (Product Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'ViewReportWithOptions(ReportParameters.rptCaption)
                ViewStockReportWithOptions(ReportParameters.rptCaption)

                'Case ReportType.StyleCosting
                '    FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                '    StockFltr = GetStockFilter("ProIsu", True)

                '    ReportParameters.rptFile = ReportPath & "\Reports\JobCard.rpt"
                '    ReportParameters.rptCaption = "Job Card Register (Product Wise)"
                '    ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                '    Formulas.Add("DateGrp#N", 0)
                '    Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                '    Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                '    'ViewReportWithOptions(ReportParameters.rptCaption)
                '    ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.JobCardReg_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\JobCard.rpt"
                ReportParameters.rptCaption = "Job Card Register (Brand Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'ViewReportWithOptions(ReportParameters.rptCaption)
                ViewStockReportWithOptions(ReportParameters.rptCaption)

                '' CHANGE BY RAHUL ON 09/07/2019
            Case ReportType.JobCardStatus_DateWise
                Dim strJobNo As String = ""
                FromToDt = GetFromToDateSeriesFilter("{View_JobCardLedger.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("View_JobCardLedger", True)

                If txtJobCardFrom.Text.Trim.Length > 0 And txtJobCardTo.Text.Trim.Length > 0 Then
                    strJobNo = " And {View_JobCardLedger.JobCard_No} >= '" & txtJobCardFrom.Text.Trim & "' And {View_JobCardLedger.JobCard_No} <= '" & txtJobCardTo.Text.Trim & "'"
                ElseIf txtJobCardFrom.Text.Trim.Length > 0 Then
                    strJobNo = " And {View_JobCardLedger.JobCard_No} = '" & txtJobCardFrom.Text.Trim & "'"
                ElseIf txtJobCardTo.Text.Trim.Length > 0 Then
                    strJobNo = " And {View_JobCardLedger.JobCard_No} = '" & txtJobCardTo.Text.Trim & "'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\FINISHStockAtJobber.rpt"
                ReportParameters.rptCaption = "Job Card Status (Date Wise)"
                ReportParameters.rptFilter = "{View_JobCardLedger.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr & strJobNo
                ''Formulas.Add("DateGrp#N", 0)
                ''Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                ''Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'ViewReportWithOptions(ReportParameters.rptCaption)
                ViewStockReportWithOptions(ReportParameters.rptCaption)
                '' END


                'process Issue
            Case ReportType.ProcessIsuReg_DateWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)

                'If Not chkSize.Checked Then
                '    OthOptions &= " And {vw_PurchaseWithRtn.Type} <> 'R'"
                'End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessIssueReg.rpt"
                ReportParameters.rptCaption = "Process Issue Register (Date Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 1)
                'Formulas.Add("DisplayGrp1Total#N", 0)
                'Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'If rdDetailed.Checked Then
                '    Formulas.Add("GroupOn1#S", "P")
                'End If

                ' ViewStockReportWithOptions(ReportParameters.rptCaption)
                Formulas.Add("HeaderText1#S", "Design/Type/Shade")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.ProcessDateWise
                If chkDispRate.Checked = True Then
                    FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                    PartyFltr = GetPartyFilter("ProcIsu", True)
                    SelProStg = GetSelectedAttributesNumeric(cmbProcessHoney, "ProStg.ProStg_Id")

                    If SelProStg <> "" Then
                        SelProStg = " And " & SelProStg
                    End If

                    ReportParameters.rptFile = ReportPath & "\Reports\ProcessDatesWise.rpt"
                    ReportParameters.rptCaption = "Process Issue Register (Date Wise)"
                    ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelProStg
                    'ReportParameters.TotalText = True
                Else
                    FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                    PartyFltr = GetPartyFilter("ProcRct", True)
                    SelProStg = GetSelectedAttributesNumeric(cmbProcessHoney, "ProStg.ProStg_Id")

                    If SelProStg <> "" Then
                        SelProStg = " And " & SelProStg
                    End If

                    ReportParameters.rptFile = ReportPath & "\Reports\ProcessDatesWiseRct.rpt"
                    ReportParameters.rptCaption = "Process  Register (Date Wise)"
                    ReportParameters.rptFilter = "{ProcRct.opening} ='0' and {ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelProStg
                End If
                '
            Case ReportType.ProcessDocWise
                
                    FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                    PartyFltr = GetPartyFilter("ProcRct", True)
                    SelProStg = GetSelectedAttributesNumeric(cmbProcessHoney, "ProStg.ProStg_Id")

                    If SelProStg <> "" Then
                        SelProStg = " And " & SelProStg
                    End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessDocWiseRct.rpt"
                    ReportParameters.rptCaption = "Process  Register (Date Wise)"
                    ReportParameters.rptFilter = "{ProcRct.opening} ='0' and {ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelProStg
            Case ReportType.ProcessSumWise

                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("ProcRct", True)
                SelProStg = GetSelectedAttributesNumeric(cmbProcessHoney, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessWiseRctSum.rpt"
                ReportParameters.rptCaption = "Process  Register-Summery"
                ReportParameters.rptFilter = "{ProcRct.opening} ='0' and {ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelProStg

            Case ReportType.StyleColWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("ProcIsu", True)
                SelProStg = GetSelectedAttributesNumeric(cmbProcessHoney, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\StyleWise.rpt"
                ReportParameters.rptCaption = "Style Shade Wise"
                ReportParameters.rptFilter = "{ProcIsu.Isu_Type}='J' and {ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt '& PartyFltr & SelProStg
            Case ReportType.StyleColSumWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("ProcIsu", True)
                SelProStg = GetSelectedAttributesNumeric(cmbProcessHoney, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\StyleWiseSum.rpt"
                ReportParameters.rptCaption = "Style Shade Wise"
                ReportParameters.rptFilter = "{ProcIsu.Isu_Type}='J' and {ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt '& PartyFltr & SelProStg


            Case ReportType.ProcessIsuReg_JobberWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("ProcIsu", True)
                StockFltr = GetStockFilter("ProcIsu", True)
                'If PartyFltr <> "" Then
                '    PartyFltr = PartyFltr
                'End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessIssueReg.rpt"
                ReportParameters.rptCaption = "Process Issue Register (Jobber Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayGrp1Total#N", 1)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'Formulas.Add("GroupOn1#S", "J")
                'Formulas.Add("GroupOn2#S", "P")

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessIsuReg_ProcessWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessIssueReg.rpt"
                ReportParameters.rptCaption = "Process Issue Register (Process Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'Formulas.Add("GroupOn1#S", "R")
                'Formulas.Add("GroupOn2#S", "J")

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessIsuReg_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessIssueReg.rpt"
                ReportParameters.rptCaption = "Process Issue Register (Sub-Group Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'Formulas.Add("GroupOn1#S", "U")
                'Formulas.Add("GroupOn2#S", "P")

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessIsuReg_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessIssueReg.rpt"
                ReportParameters.rptCaption = "Process Issue Register (Product Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'Formulas.Add("GroupOn1#S", "P")
                'Formulas.Add("GroupOn2#S", "J")

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessIsuReg_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessIssueReg.rpt"
                ReportParameters.rptCaption = "Process Issue Register (Brand Wise)"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'Formulas.Add("GroupOn1#S", "B")
                'Formulas.Add("GroupOn2#S", "P")

                ViewStockReportWithOptions(ReportParameters.rptCaption)

                ''Process Receipt
            Case ReportType.ProcessRcptReg_DateWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessReceiptReg.rpt"
                ReportParameters.rptCaption = "Process Receipt Register (Date Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 1)
                'Formulas.Add("DisplayGrp1Total#N", 0)
                'Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'ViewStockReportWithOptions(ReportParameters.rptCaption)
                Formulas.Add("HeaderText1#S", "Design/Type/Shade")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.ProcessRcptReg_JobberWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("ProcRct", True)
                StockFltr = GetStockFilter("ProcIsu", True)
                'If PartyFltr <> "" Then
                '    PartyFltr = PartyFltr
                'End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessReceiptReg.rpt"
                ReportParameters.rptCaption = "Process Receipt Register (Jobber Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayGrp1Total#N", 1)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessRcptReg_ProcessWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessReceiptReg.rpt"
                ReportParameters.rptCaption = "Process Receipt Register (Process Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessRcptReg_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProcRct", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessReceiptReg.rpt"
                ReportParameters.rptCaption = "Process Receipt Register (Sub-Group Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessRcptReg_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProcRct", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessReceiptReg.rpt"
                ReportParameters.rptCaption = "Process Receipt Register (Product Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessRcptReg_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProcRct", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessReceiptReg.rpt"
                ReportParameters.rptCaption = "Process Receipt Register (Brand Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)


                ''Process/Prodn Delay
            Case ReportType.ProcessDelayReg_DateWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessDelay.rpt"
                ReportParameters.rptCaption = "Process Delay Register (Date Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 1)
                'Formulas.Add("DisplayGrp1Total#N", 0)
                'Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                'ViewStockReportWithOptions(ReportParameters.rptCaption)

                Formulas.Add("HeaderText1#S", "Design/Type/Shade")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.ProcessDelayReg_JobberWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("ProcIsu", True)

                'If PartyFltr <> "" Then
                '    PartyFltr = PartyFltr
                'End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessDelay.rpt"
                ReportParameters.rptCaption = "Process Delay Register (Jobber Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayGrp1Total#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessDelayReg_ProcessWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessDelay.rpt"
                ReportParameters.rptCaption = "Process Delay Register (Process Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessDelayReg_SubGroupWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessDelay.rpt"
                ReportParameters.rptCaption = "Process Delay Register (Sub-Group Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessDelayReg_ProductWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessDelay.rpt"
                ReportParameters.rptCaption = "Process Delay Register (Product Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessDelayReg_BrandWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessDelay.rpt"
                ReportParameters.rptCaption = "Process Delay Register (Brand Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

                ''Process Stock With Party
            Case ReportType.ProcessStkWithPartyReg_DateWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcStkWithJbrValue.rpt"
                ReportParameters.rptCaption = "Process Stock With Jobber (Date Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 1)
                'Formulas.Add("DisplayGrp1Total#N", 0)
                'Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                'ViewStockReportWithOptions(ReportParameters.rptCaption)

                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))
                Formulas.Add("HeaderText1#S", "Design/Type/Shade")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.ProcessStkWithPartyReg_JobberWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("ProcIsu", True)

                'If PartyFltr <> "" Then
                '    PartyFltr = " And " & PartyFltr
                'End If
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcStkWithJbrValue.rpt"
                ReportParameters.rptCaption = "Process Stock With Jobber (Jobber Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & strSOFilter1
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayGrp1Total#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessStkWithPartyReg_ProcessWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcStkWithJbrValue.rpt"
                ReportParameters.rptCaption = "Process Stock With Jobber (Process Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessStkWithPartyReg_SubGroupWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcStkWithJbrValue.rpt"
                ReportParameters.rptCaption = "Process Stock With Jobber (Sub-Group Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessStkWithPartyReg_ProductWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcStkWithJbrValue.rpt"
                ReportParameters.rptCaption = "Process Stock With Jobber (Product Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessStkWithPartyReg_BrandWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcStkWithJbrValue.rpt"
                ReportParameters.rptCaption = "Process Stock With Jobber (Brand Wise) As On :"
                ReportParameters.rptFilter = "{ProcIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

                ''Semi Process Stk At Warehouse
            Case ReportType.SemiProcStkAtWHReg_DateWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)

                ReportParameters.rptFile = ReportPath & "\Reports\SemiProcStkAtWH.rpt"
                ReportParameters.rptCaption = "Semi Process Stk At WH (Date Wise) As On :"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 1)
                'Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'ViewStockReportWithOptions(ReportParameters.rptCaption)
                Formulas.Add("HeaderText1#S", "Design/Type/Shade")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.SemiProcStkAtWHReg_JobberWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("ProcRct", True)

                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                'If PartyFltr <> "" Then
                '    PartyFltr = " And " & PartyFltr
                'End If

                ReportParameters.rptFile = ReportPath & "\Reports\SemiProcStkAtWH.rpt"
                ReportParameters.rptCaption = "Semi Process Stk At WH (Jobber Wise) As On :"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & strSOFilter1
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.SemiProcStkAtWHReg_ProcessWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\SemiProcStkAtWH.rpt"
                ReportParameters.rptCaption = "Semi Process Stk At WH (Process Wise) As On :"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.SemiProcStkAtWHReg_SubGroupWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProcRct", True)

                ReportParameters.rptFile = ReportPath & "\Reports\SemiProcStkAtWH.rpt"
                ReportParameters.rptCaption = "Semi Process Stk At WH (Sub-Grp Wise) As On :"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.SemiProcStkAtWHReg_ProductWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProcRct", True)

                ReportParameters.rptFile = ReportPath & "\Reports\SemiProcStkAtWH.rpt"
                ReportParameters.rptCaption = "Semi Process Stk At WH (Product Wise) As On :"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.SemiProcStkAtWHReg_BrandWise
                'FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProcRct", True)

                ReportParameters.rptFile = ReportPath & "\Reports\SemiProcStkAtWH.rpt"
                ReportParameters.rptCaption = "Semi Process Stk At WH (Brand Wise) As On :"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)


                ''Process Ledger
            Case ReportType.ProcessLedReg_DateWise
                FromToDt = GetFromToDateSeriesFilter("{vw_ProcessDtls.Doc_Dt}", "", , False)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessLedger.rpt"
                ReportParameters.rptCaption = "Process Ledger (Date Wise)"
                ReportParameters.rptFilter = "{vw_ProcessDtls.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 1)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)
            Case ReportType.Karigar_Salary
                'FromToDt = GetFromToDateSeriesFilter("{procisu.doc_dt}", "", , False)
                'PartyFltr = GetPartyFilter("vw_procrctdtlpart", True)

                ''If PartyFltr <> "" Then
                ''    PartyFltr = " And " & PartyFltr
                ''End If
                'ReportParameters.rptFile = ReportPath & "\Reports\jobber_salary.rpt"
                'ReportParameters.rptCaption = "Karigar Salary"
                'ReportParameters.rptFilter = "{procrct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                'ReportParameters.TotalText = True
                'Formulas.Add("DateGrp#N", 1)
                'Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                'Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("ProcRct", True)

                If rdSummary.Checked = True Then
                    ReportParameters.rptFile = ReportPath & "\Reports\JobberSalarySum.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\JobberSalary.rpt"
                    Formulas.Add("Details#N", IIf(chkSize.Checked, 1, 0))
                End If

                ReportParameters.rptCaption = "Karigar Salary (Date Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                'ReportParameters.TotalText = True


            Case ReportType.ProcessLedReg_JobberWise
                FromToDt = GetFromToDateSeriesFilter("{vw_ProcessDtls.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("vw_ProcessDtls", True)
                If PartyFltr <> "" Then
                    PartyFltr = PartyFltr
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessLedger.rpt"

                ReportParameters.rptCaption = "Process Ledger (Date Wise)"
                ReportParameters.rptFilter = "{vw_ProcessDtls.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessLedReg_ProcessWise
                FromToDt = GetFromToDateSeriesFilter("{vw_ProcessDtls.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessLedger.rpt"
                ReportParameters.rptCaption = "Process Ledger (Process Wise)"
                ReportParameters.rptFilter = "{vw_ProcessDtls.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessLedReg_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{vw_ProcessDtls.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("vw_ProcessDtls", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessLedger.rpt"
                ReportParameters.rptCaption = "Process Ledger (Sub-Group Wise)"
                ReportParameters.rptFilter = "{vw_ProcessDtls.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessLedReg_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{vw_ProcessDtls.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("vw_ProcessDtls", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessLedger.rpt"
                ReportParameters.rptCaption = "Process Ledger (Product Wise)"
                ReportParameters.rptFilter = "{vw_ProcessDtls.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessLedReg_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{vw_ProcessDtls.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("vw_ProcessDtls", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcessLedger.rpt"
                ReportParameters.rptCaption = "Process Ledger (Brand Wise)"
                ReportParameters.rptFilter = "{vw_ProcessDtls.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)



                ''Process Shortage
            Case ReportType.ProcessShortReg_DateWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcShortage.rpt"
                ReportParameters.rptCaption = "Process Shortage (Date Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 1)
                'Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                'ViewStockReportWithOptions(ReportParameters.rptCaption)
                Formulas.Add("HeaderText1#S", "Design/Type/Shade")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.ProcessShortReg_JobberWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("ProcRct", True)

                'If PartyFltr <> "" Then
                '    PartyFltr = " And " & PartyFltr
                'End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcShortage.rpt"
                ReportParameters.rptCaption = "Process Shortage (Jobber Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)
            Case ReportType.FabricLedgerAtJobber
                'FromToDt = GetFromToDateSeriesFilter("{View_ProcessProdn_Ledger.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("View_JobworkProdn_Ledger", True)
                ReportParameters.rptFile = ReportPath & "\Reports\FabricStockAtJobber.rpt"
                ReportParameters.rptCaption = "Fabric Leger AT Jobber"
                StockFltr = ""
                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                    StockFltr = GetStockFilter("View_JobworkProdn_Ledger", True)
                End If
                QtyFilter = ""
                If txtText.Text.Trim.Length > 0 Then
                    QtyFilter = " And ({View_JobworkProdn_Ledger.Document_No} = '" & txtText.Text & "')"

                End If
                ReportParameters.rptFilter = "{View_JobworkProdn_Ledger.CoBr_Id} = '" & SelBranchId & "' And {View_JobworkProdn_Ledger.Fcyr_Id} = '" & SelYearId & "'" & PartyFltr & QtyFilter & StockFltr
                ReportParameters.TotalText = True

                ViewStockReportWithOptions(ReportParameters.rptCaption)
            Case ReportType.StockLedgerAtJobber
                PartyFltr = GetPartyFilter("View_ProcessProdn_Ledger", True)
                FromToDt = GetFromToDateSeriesFilter("{View_ProcessProdn_Ledger.Doc_Dt}", "", , False)

                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                ''CHANGE BY RAHUL ON 30/09/2019
                ''ReportParameters.rptFile = ReportPath & "\Reports\FabricLedgeratJobber.rpt"
                If rdSummary.Checked = True Then
                    If chkSize.Checked = False Then
                        ReportParameters.rptFile = ReportPath & "\Reports\FabricLedgeratJobberSum.rpt"
                    Else
                        ReportParameters.rptFile = ReportPath & "\Reports\FabricLedgerAtJobberSumItemwise.rpt"
                    End If

                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\FabricLedgeratJobber.rpt"
                End If
                ''END

                ReportParameters.rptCaption = "Fabric Stock Ledger(Jobberwise)"

                ''CHANGE BY RAHUL ON 03/05/2019
                StockFltr = GetStockFilter("View_ProcessProdn_Ledger", True)
                If GetSettingAsPerId(ApplnSettingsIdx.HetherGrey) = "1" Then
                    ReportParameters.rptFilter = "{View_ProcessProdn_Ledger.CoBr_Id} = '" & SelBranchId & "' AND {View_ProcessProdn_Ledger.Doc_Dt}<= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")" & PartyFltr & StockFltr
                Else
                    ReportParameters.rptFilter = "{View_ProcessProdn_Ledger.CoBr_Id} = '" & SelBranchId & "'" & PartyFltr & FromToDt & strSOFilter1
                End If
                ''END

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessShortReg_ProcessWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\ProcShortage.rpt"
                ReportParameters.rptCaption = "Process Shortage (Process Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessShortReg_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProcRct", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcShortage.rpt"
                ReportParameters.rptCaption = "Process Shortage (Sub-Group Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessShortReg_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProcRct", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcShortage.rpt"
                ReportParameters.rptCaption = "Process Shortage (Product Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.ProcessShortReg_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{ProcRct.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("ProcRct", True)

                ReportParameters.rptFile = ReportPath & "\Reports\ProcShortage.rpt"
                ReportParameters.rptCaption = "Process Shortage (Brand Wise)"
                ReportParameters.rptFilter = "{ProcRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                Formulas.Add("DisplaySize#N", IIf(chkSize.Checked, 1, 0))

                ViewStockReportWithOptions(ReportParameters.rptCaption)



                ''Fabric Issue
            Case ReportType.FabricIsuReg_DateWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)

                'ReportParameters.rptFile = ReportPath & "\Reports\FabIsu.rpt"  sunil 23/09/2014
                ReportParameters.rptFile = ReportPath & "\Reports\FabIsuDtl.rpt"
                ReportParameters.rptCaption = "Fabric Issue (Date Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 1)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))


                Formulas.Add("Text1#S", "P")
                Formulas.Add("Text2#S", "T")
                Formulas.Add("Text3#S", "H")

                Formulas.Add("HeaderText#S", "Product/Design/Shade")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                '    HeaderText = lstDetails.Items(i)
                '    If PrnHeader Then
                '        Formulas.Add("Header1#S", lstDetails.Items(i))
                '    End If
                'ElseIf i = 1 Then
                '    Formulas.Add("Text2#S", Param)
                '    HeaderText = HeaderText & "/" & lstDetails.Items(i)
                '    If PrnHeader Then
                '        Formulas.Add("Header2#S", lstDetails.Items(i))
                '    End If
                'ElseIf i = 2 Then
                '    Formulas.Add("Text3#S", Param)
                '    HeaderText = HeaderText & "/" & lstDetails.Items(i)
                '    If PrnHeader Then
                '        Formulas.Add("Header3#S", lstDetails.Items(i))
                '    End If
                'End If

                ' ViewStockReportWithOptions(ReportParameters.rptCaption)

            
	   Case ReportType.FabricIsuReg_JobberWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("JobIsu", True)

                'If PartyFltr <> "" Then
                '    PartyFltr = " And " & PartyFltr
                'End If
                Dim strSOFilter1 As String = ""  'VW_FabIsu
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim strPOFilter1 As String = ""
                If chkData.Checked = True Then
                    If cmbOrderNo.SelectedIndex <> -1 Then
                        strPOFilter1 = " And {JobIsu.JobPo_Id} = " & Val(cmbOrderNo.Value) & ""
                    End If
                Else
                    If cmbOrderNo.SelectedIndex <> -1 Then
                        strPOFilter1 = " And {JobIsu.JO_No_ID} = " & Val(cmbOrderNo.Value) & ""
                    End If
                End If
                ReportParameters.rptFile = ReportPath & "\Reports\FabIsuDtl.rpt"
                ReportParameters.rptCaption = "Fabric Issue (Jobber Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & strSOFilter1 & strPOFilter1
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                lstDetails.Items.Clear()
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
                'Formulas.Add("Text1#S", "T")
                'Formulas.Add("Text2#S", "H")

                ViewStockReportWithOptions(ReportParameters.rptCaption)
                'Formulas.Add("Text1#S", "T")
                'Formulas.Add("Text2#S", "H")
                'Formulas.Add("Text3#S", "H")

                'Formulas.Add("HeaderText#S", "Design/Shade")
                'Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.FabricIsuReg_ProcessWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\FabIsu.rpt"
                ReportParameters.rptCaption = "Fabric Issue (Process Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.FabricIsuReg_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\FabIsuDtl.rpt"
                ElseIf rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\FabIsu.rpt"
                End If

                ReportParameters.rptCaption = "Fabric Issue (Sub-Group Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.FabricIsuReg_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\FabIsuDtl.rpt"
                ElseIf rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\FabIsu.rpt"
                End If
                ReportParameters.rptCaption = "Fabric Issue (Product Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.FabricIsuReg_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\FabIsuDtl.rpt"
                ElseIf rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\FabIsu.rpt"
                End If
                ReportParameters.rptCaption = "Fabric Issue (Brand Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

                '''FABRIC RECEIVE 
                '''SATYAM 29072022
            Case ReportType.FabricRctReg_JobberWise
                FromToDt = GetFromToDateSeriesFilter("{procIsuRct.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("procIsuRct", True)

                'If PartyFltr <> "" Then
                '    PartyFltr = " And " & PartyFltr
                'End If
                Dim strSOFilter1 As String = ""  'VW_FabIsu
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim strPOFilter1 As String = ""
                If chkData.Checked = True Then
                    If cmbOrderNo.SelectedIndex <> -1 Then
                        strPOFilter1 = " And {procIsuRct.JobPo_Id} = " & Val(cmbOrderNo.Value) & ""
                    End If
                Else
                    If cmbOrderNo.SelectedIndex <> -1 Then
                        strPOFilter1 = " And {procIsuRct.JO_No_ID} = " & Val(cmbOrderNo.Value) & ""
                    End If
                End If
                ReportParameters.rptFile = ReportPath & "\Reports\FabRctDtl.rpt"
                ReportParameters.rptCaption = "Fabric Receive (Jobber Wise)"
                ReportParameters.rptFilter = "{procIsuRct.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & strSOFilter1 & strPOFilter1
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                lstDetails.Items.Clear()
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
                'Formulas.Add("Text1#S", "T")
                'Formulas.Add("Text2#S", "H")

                ViewStockReportWithOptions(ReportParameters.rptCaption)
                'Formulas.Add("Text1#S", "T")
                'Formulas.Add("Text2#S", "H")
                'Formulas.Add("Text3#S", "H")

                'Formulas.Add("HeaderText#S", "Design/Shade")
                'Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)




                ''Fabric Issue Back
            Case ReportType.FabricIsuBkReg_DateWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)

                ReportParameters.rptFile = ReportPath & "\Reports\FabIsuBack.rpt"
                ReportParameters.rptCaption = "Fabric Issue Back (Date Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 1)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                'ViewStockReportWithOptions(ReportParameters.rptCaption)

                Formulas.Add("Text1#S", "P")
                Formulas.Add("Text2#S", "T")
                Formulas.Add("Text3#S", "H")

                Formulas.Add("HeaderText#S", "Product/Design/Shade")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.FabricIsuBkReg_JobberWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("JobIsu", True)

                'If PartyFltr <> "" Then
                '    PartyFltr = " And " & PartyFltr
                'End If

                ReportParameters.rptFile = ReportPath & "\Reports\FabIsuBack.rpt"
                ReportParameters.rptCaption = "Fabric Issue Back (Jobber Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                lstDetails.Items.Clear()
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.FabricIsuBkReg_ProcessWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\FabIsuBack.rpt"
                ReportParameters.rptCaption = "Fabric Issue Back (Process Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.FabricIsuBkReg_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\FabIsuBack.rpt"
                ReportParameters.rptCaption = "Fabric Issue Back (Sub-Group Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.FabricIsuBkReg_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\FabIsuBack.rpt"
                ReportParameters.rptCaption = "Fabric Issue Back (Product Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.FabricIsuBkReg_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\FabIsuBack.rpt"
                ReportParameters.rptCaption = "Fabric Issue Back (Brand Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)


                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                'Fabric Stock with jobber

            Case ReportType.FabricStk_JobberWise
                'FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("JobIsu", True)
                StockFltr = GetStockFilter("JobIsu", True)

                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                'If PartyFltr <> "" Then
                '    PartyFltr = " And " & PartyFltr
                'End If

                ReportParameters.rptFile = ReportPath & "\Reports\FabStockWithParty.rpt"
                ReportParameters.rptCaption = "Fabric Stock as on :  " & Now.Date & " (Jobber Wise)"

                ''CHANGE BY RAHUL ON 04/10/2019
                StockFltr = GetStockFilter("JobIsu", True)
                If GetSettingAsPerId(ApplnSettingsIdx.HetherGrey) = "1" Then
                    ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "' and {JobIsu.stkType} in['GC','GP']" & FromToDt & PartyFltr & StockFltr
                Else
                    If GetSettingAsPerId(ApplnSettingsIdx.SoftwareForSagunReadymadeUdhyoug) = "1" Then
                        ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "' and {JobIsu.stkType} in['GC','GP']" & PartyFltr & StockFltr
                    Else
                        ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "' and {JobIsu.stkType} in['GC','GP']" & FromToDt & PartyFltr & strSOFilter1
                    End If
                End If
                ''END

                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                lstDetails.Items.Clear()
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
                'Formulas.Add("Text1#S", "T")
                'Formulas.Add("Text2#S", "H")

                ViewStockReportWithOptions(ReportParameters.rptCaption)

                'Formulas.Add("Text1#S", "T")
                'Formulas.Add("Text2#S", "H")
                'Formulas.Add("Text3#S", "H")

                'Formulas.Add("HeaderText#S", "Design/Shade")
                'Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.FabricStk_ProductWise
                'FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\FabStockWithParty.rpt"
                ElseIf rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\FabIsu.rpt"
                End If

                ReportParameters.rptCaption = "Fabric Stock as on :  " & Now.Date & " (Product Wise)"

                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr & strSOFilter1
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                lstDetails.Items.Clear()
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
                ViewStockReportWithOptions(ReportParameters.rptCaption)

                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

                ''Stores Issue 
            Case ReportType.StoresIsuReg_DateWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsu.rpt"
                ReportParameters.rptCaption = "Stores Issue (Date Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.TotalText = True
                If rptType <> ReportType.StoresIsuReg_DateWise Then
                    Formulas.Add("DateGrp#N", 1)
                End If
                '
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                'ViewStockReportWithOptions(ReportParameters.rptCaption) sunil
                Formulas.Add("Text1#S", "P")
                Formulas.Add("Text2#S", "H")

                Formulas.Add("HeaderText#S", "Product/Shade")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.StoresIsuReg_JobberWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("JobIsu", True)

                'If PartyFltr <> "" Then
                '    PartyFltr = " And " & PartyFltr
                'End If
                Dim strSOFilter1 As String = ""  'VW_FabIsu
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim strPOFilter1 As String = ""
                If chkData.Checked = True Then
                    If cmbOrderNo.SelectedIndex <> -1 Then
                        strPOFilter1 = " And {JobIsu.JobPo_Id} = " & Val(cmbOrderNo.Value) & ""
                    End If
                Else
                    If cmbOrderNo.SelectedIndex <> -1 Then
                        strPOFilter1 = " And {JobIsu.JO_No_ID} = " & Val(cmbOrderNo.Value) & ""
                    End If
                End If
                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsu.rpt"
                ReportParameters.rptCaption = "Stores Issue (Jobber Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & strSOFilter1 & strPOFilter1
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))


                lstDetails.Items.Clear()
                'lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuReg_ProcessWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsu.rpt"
                ReportParameters.rptCaption = "Stores Issue (Process Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuReg_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsu.rpt"
                ReportParameters.rptCaption = "Stores Issue (Sub-Group Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuReg_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsu.rpt"
                ReportParameters.rptCaption = "Stores Issue (Product Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuReg_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsu.rpt"
                ReportParameters.rptCaption = "Stores Issue (Brand Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

               

                ''Stores Issue Back
            Case ReportType.StoresIsuBkReg_DateWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsuBack.rpt"
                ReportParameters.rptCaption = "Stores Issue Back (Date Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.TotalText = True

                If rptType = ReportType.StoresIsuBkReg_DateWise Then
                Else
                    Formulas.Add("DateGrp#N", 1)
                End If

                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                'ViewStockReportWithOptions(ReportParameters.rptCaption)
                Formulas.Add("Text1#S", "P")
                Formulas.Add("Text2#S", "H")

                Formulas.Add("HeaderText#S", "Product/Shade")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.StoresIsuBkReg_JobberWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("JobIsu", True)

                'If PartyFltr <> "" Then
                '    PartyFltr = " And " & PartyFltr
                'End If

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsuBack.rpt"
                ReportParameters.rptCaption = "Stores Issue Back (Jobber Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                lstDetails.Items.Clear()
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuBkReg_ProcessWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsuBack.rpt"
                ReportParameters.rptCaption = "Stores Issue Back (Process Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuBkReg_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsuBack.rpt"
                ReportParameters.rptCaption = "Stores Issue Back (Sub-Group Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuBkReg_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsuBack.rpt"
                ReportParameters.rptCaption = "Stores Issue Back (Product Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuBkReg_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsuBack.rpt"
                ReportParameters.rptCaption = "Stores Issue Back (Brand Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)


                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                'Stores Stock with jobber


            Case ReportType.StoresStk_JobberWise
                'FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("GreyAccStock", True)

                'If PartyFltr <> "" Then
                '    PartyFltr = " And " & PartyFltr
                'End If
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\StoreStockWithParty.rpt"
                ReportParameters.rptCaption = "Stores Stock as on :  " & Now.Date & " (Jobber Wise)"
                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & strSOFilter1
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
                lstDetails.Items.Clear()
                'lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
                'Formulas.Add("Text1#S", "T")
                'Formulas.Add("Text2#S", "H")

                ViewStockReportWithOptions(ReportParameters.rptCaption)

                'Formulas.Add("Text1#S", "T")
                'Formulas.Add("Text2#S", "H")
                'Formulas.Add("Text3#S", "H")

                'Formulas.Add("HeaderText#S", "Design/Shade")
                'Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.StoresStk_ProductWise
                'FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("GreyAccStock", True)

                ReportParameters.rptFile = ReportPath & "\Reports\StoreStockWithParty.rpt"

                ReportParameters.rptCaption = "Stores Stock as on :  " & Now.Date & " (Product Wise)"

                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                lstDetails.Items.Clear()
                lstDetails.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))

                lstOption1.Items.Clear()
                lstOption2.Items.Clear()
                lstOption1.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
                lstOption2.Items.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

                '' CHANGE BY RAHUL ON 29/07/2019
            Case ReportType.AccStockLedgerAtJobber
                PartyFltr = GetPartyFilter("View_ProcessProdn_Ledger", True)
                FromToDt = GetFromToDateSeriesFilter("{View_ProcessProdn_Ledger.Doc_Dt}", "", , False)
                ReportParameters.rptFile = ReportPath & "\Reports\AccLedgerAtJobber.rpt"
                ReportParameters.rptCaption = "Accessories Stock Ledger(Jobberwise)"

                ''CHANGE BY RAHUL ON 03/05/2019
                StockFltr = GetStockFilter("View_ProcessProdn_Ledger", True)
                If GetSettingAsPerId(ApplnSettingsIdx.HetherGrey) = "1" Then
                    ReportParameters.rptFilter = "{View_ProcessProdn_Ledger.CoBr_Id} = '" & SelBranchId & "' AND {View_ProcessProdn_Ledger.Doc_Dt}<= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")" & PartyFltr & StockFltr
                Else
                    ReportParameters.rptFilter = "{View_ProcessProdn_Ledger.CoBr_Id} = '" & SelBranchId & "'" & PartyFltr & FromToDt
                End If
                ''END

                ViewStockReportWithOptions(ReportParameters.rptCaption)

                '' END

                ''closing stock
            Case ReportType.ClosingStk_Supplier
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                PartyFltr = GetPartyFilter("GreyAccStock", True)

                ReportParameters.rptFile = ReportPath & "\Reports\GreyStock.rpt"
                ReportParameters.rptCaption = "Closing Stock (Supplier Wise)"
                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                ReportParameters.TotalText = True
                'Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuBkReg_ProcessWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                SelProStg = GetSelectedAttributesNumeric(cmbTax, "ProStg.ProStg_Id")

                If SelProStg <> "" Then
                    SelProStg = " And " & SelProStg
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsuBack.rpt"
                ReportParameters.rptCaption = "Stores Issue Back (Process Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelProStg
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuBkReg_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsuBack.rpt"
                ReportParameters.rptCaption = "Stores Issue Back (Sub-Group Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuBkReg_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsuBack.rpt"
                ReportParameters.rptCaption = "Stores Issue Back (Product Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)

            Case ReportType.StoresIsuBkReg_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{JobIsu.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("JobIsu", True)

                ReportParameters.rptFile = ReportPath & "\Reports\StoresIsuBack.rpt"
                ReportParameters.rptCaption = "Stores Issue Back (Brand Wise)"
                ReportParameters.rptFilter = "{JobIsu.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.TotalText = True
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))

                ViewStockReportWithOptions(ReportParameters.rptCaption)


            Case ReportType.BirthdayList, ReportType.AnniversaryList
                If rptType = ReportType.BirthdayList Then
                    Formulas.Add("HeaderText#S", "Birthday List")
                    Formulas.Add("Type#S", "B")
                    ReportParameters.rptFilter = "{Ledger.Led_Cat} in ['R', 'W', 'D'] And Not IsNull({Ledger.DOB})"

                ElseIf rptType = ReportType.AnniversaryList Then
                    Formulas.Add("HeaderText#S", "Anniversary List")
                    Formulas.Add("Type#S", "A")
                    ReportParameters.rptFilter = "{Ledger.Led_Cat} in ['R', 'W', 'D'] And Not IsNull({Ledger.Anniv_Dt})"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\BirthdayList.rpt"

            Case ReportType.MarginSummary_Purchase
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchVerSale.Doc_Dt}", "{vw_PurchVerSale.Bill_Sr}")
                ReportParameters.rptCaption = "Margin Summary - Purchase"
                ReportParameters.rptFile = ReportPath & "\Reports\MarginPurchase.rpt"

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchVerSale.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchVerSale.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchVerSale.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFilter = "{vw_PurchVerSale.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & POTypeFltr

            Case ReportType.CustomerReport
                PartyFltr = GetPartyFilter("Ledger", False)
                ReportParameters.rptCaption = "Customer Report"
                ReportParameters.rptFile = ReportPath & "\Reports\CustomerReport.rpt"
                ReportParameters.rptFilter = "{Ledger.CoBr_Id} = '" & SelBranchId & "' And {Ledger.Led_Cat} In ['R', 'W', 'D'] And {Ledger.Led_Key} <> '' And {Ledger.CardType_Key} <> ''" & PartyFltr

            Case ReportType.CustomerStmt
                Dim OpPts As Double
                Dim PrevEarnPts As Double
                Dim PrevRedeemPts As Double
                Dim EarnPts As Double
                Dim RedeemPts As Double

                Query = "Select OpPts From Ledger Where Led_Key = '" & cmbParty.EditValue & "'"
                OpPts = CType(Common.ExecuteScalar(Query), Double)

                Query = "Select IsNull(Sum(EarnPoint), 0) Earn " _
                    & " From Bill Where Doc_Dt < '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "'" _
                    & " And Party_Key = '" & cmbParty.EditValue & "'"
                PrevEarnPts = CType(Common.ExecuteScalar(Query), Double)

                Query = "Select IsNull(Sum(RedeemPoint), 0) Redeem " _
                    & " From Bill Where Doc_Dt < '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "'" _
                    & " And Party_Key = '" & cmbParty.EditValue & "'"
                PrevRedeemPts = CType(Common.ExecuteScalar(Query), Double)


                Query = "Select IsNull(Sum(EarnPoint), 0) Earn " _
                    & " From Bill Where Doc_Dt >= '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "'" _
                    & " And Doc_Dt <= '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'" _
                    & " And Party_Key = '" & cmbParty.EditValue & "'"
                EarnPts = CType(Common.ExecuteScalar(Query), Double)


                Query = "Select IsNull(Sum(RedeemPoint), 0) Redeem " _
                    & " From Bill Where Doc_Dt >= '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "'" _
                    & " And Doc_Dt <= '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'" _
                    & " And Party_Key = '" & cmbParty.EditValue & "'"
                RedeemPts = CType(Common.ExecuteScalar(Query), Double)


                FromToDt = GetFromToDateSeriesFilter("{Bill.Doc_Dt}", "{Bill.Bill_Sr}")
                ReportParameters.rptCaption = "Customer Statement"
                ReportParameters.rptFile = ReportPath & "\Reports\CRMStatement.rpt"
                ReportParameters.rptFilter = "{Bill.CoBr_Id} = '" & SelBranchId & "' And {Bill.Party_Key} = '" & cmbParty.EditValue & "'" & FromToDt

                Formulas.Add("PrevEarnPts#N", PrevEarnPts)
                Formulas.Add("PrevRedeemPts#N", PrevRedeemPts)
                Formulas.Add("EarnPts#N", EarnPts)
                Formulas.Add("RedeemPts#N", RedeemPts)



            Case ReportType.TaxComputation
                FromToDt = GetFromToDateSeriesFilter("{vw_SalePurTax.Doc_Dt}", "{vw_SalePurTax.Bill_Sr}")

                ReportParameters.rptFile = ReportPath & "\Reports\TaxRegister.rpt"
                ReportParameters.rptCaption = "Tax Computation"
                ReportParameters.rptFilter = "{vw_SalePurTax.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelTax

            Case ReportType.PurTaxRegister_DateWise
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_PurchaseWithRtn.Type} <> 'R'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\PurRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (Purchase Summary)"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0' " & FromToDt & SelTax & OthOptions & POTypeFltr
                Formulas.Add("DateGroup#N", 1)
                Formulas.Add("DisplayGroup#N", 0)
                Formulas.Add("GroupOn1#S", "T")

            Case ReportType.PurTaxRegister_DocWise
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_PurchaseWithRtn.Type} <> 'R'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\PurRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (Purchase Summary)"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0' " & FromToDt & SelTax & OthOptions & POTypeFltr
                Formulas.Add("DateGroup#N", 0)
                Formulas.Add("DisplayGroup#N", 0)
                Formulas.Add("GroupOn1#S", "T")



            Case ReportType.SaleTaxRegister

                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "", , False)

                'If Not chkSize.Checked Then
                '    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                'End If

                ReportParameters.rptFile = ReportPath & "\Reports\SaleRegTax.rpt"
                ReportParameters.rptCaption = "Tax Register"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "' And {TaxTermsTDS.ApplySalePur} = 'S'" & FromToDt & SelTax
                Formulas.Add("DateGroup#N", 0)
                Formulas.Add("ReportCaption#S", Me.Text)
                Formulas.Add("DocType#S", "S")

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)


            Case ReportType.PurTaxRegister_Summary
                FromToDt = GetFromToDateSeriesFilter("{vw_SalePurTax.Doc_Dt}", "{vw_SalePurTax.Bill_Sr}")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SalePurTax.TaxType} = 'A'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_SalePurTax.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_SalePurTax.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_SalePurTax.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\TaxRegister.rpt"
                ReportParameters.rptCaption = "Purchase Tax Report"
                ReportParameters.rptFilter = "{vw_SalePurTax.CoBr_Id} = '" & SelBranchId & "' And {vw_SalePurTax.Type} = 'P' " & FromToDt & OthOptions & SelTax & POTypeFltr
                Formulas.Add("DisplayBalance#N", 0)
                Formulas.Add("ReportCaption#S", "Tax Summary - Purchase")

            Case ReportType.PurTaxRegister_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_PurchaseWithRtn")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_PurchaseWithRtn.Type} <> 'R'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\PurRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (" & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise)"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0' " & FromToDt & SelTax & OthOptions & StockFltr & POTypeFltr
                Formulas.Add("DateGroup#N", 0)
                Formulas.Add("DisplayGroup#N", 1)
                Formulas.Add("GroupOn1#S", "P")
                Formulas.Add("TotalText#S", GetSystemCaption(SystemCaptionIdx.DefProduct) & " Total")

            Case ReportType.PurTaxRegister_SupplierWise
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_PurchaseWithRtn.Type} <> 'R'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\PurRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (Supplier Wise)"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0' " & FromToDt & SelTax & OthOptions & PartyFltr & POTypeFltr
                Formulas.Add("DateGroup#N", 0)
                Formulas.Add("DisplayGroup#N", 1)
                Formulas.Add("GroupOn1#S", "S")

            Case ReportType.SalesTaxRegister_DateWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\SaleRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (Sales Summary)"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelTax & OthOptions
                Formulas.Add("DateGroup#N", 1)
                Formulas.Add("DisplayDetails#N", 0)
                Formulas.Add("ReportCaption#S", Me.Text)
                Formulas.Add("DocType#S", "S")

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))

            Case ReportType.SalesTaxRegister_DocWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\SaleRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (Sales Summary)"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelTax & OthOptions
                Formulas.Add("DateGroup#N", IIf(chkDispValue.Checked, 1, 0))
                Formulas.Add("DisplayDetails#N", 1)
                Formulas.Add("ReportCaption#S", Me.Text)
                Formulas.Add("DocType#S", "S")

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))

            Case ReportType.SalesVATRegister
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\SaleRegTax.rpt"
                ReportParameters.rptCaption = "VAT Register"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "' And {TaxTermsTDS.TaxClass} = 'VAT'" & FromToDt & OthOptions & SelTax
                Formulas.Add("DateGroup#N", 0)
                Formulas.Add("ReportCaption#S", Me.Text)
                Formulas.Add("DocType#S", "S")

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)

            Case ReportType.SalesTaxRegister_Summary
                FromToDt = GetFromToDateSeriesFilter("{vw_SalePurTax.Doc_Dt}", "{vw_SalePurTax.Bill_Sr}")

                ReportParameters.rptFile = ReportPath & "\Reports\TaxRegister.rpt"
                ReportParameters.rptCaption = "Sales Tax Report"
                ReportParameters.rptFilter = "{vw_SalePurTax.CoBr_Id} = '" & SelBranchId & "' And {vw_SalePurTax.Type} = 'S' " & IIf(chkSize.Checked, "", " And {vw_SalePurTax.TaxType} = 'A'") & FromToDt & SelTax
                Formulas.Add("DisplayBalance#N", 0)
                Formulas.Add("ReportCaption#S", "Tax Summary - Sales")
                Formulas.Add("DocType#S", "S")

            Case ReportType.SalesTaxRegister_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\SaleRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (" & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise)"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelTax & OthOptions & StockFltr
                Formulas.Add("DateGroup#N", 0)
                Formulas.Add("DisplayGroup#N", 1)
                Formulas.Add("GroupOn1#S", "P")
                Formulas.Add("TotalText#S", GetSystemCaption(SystemCaptionIdx.DefProduct) & " Total")
                Formulas.Add("ReportCaption#S", Me.Text)
                Formulas.Add("DocType#S", "S")

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))

            Case ReportType.SalesTaxRegister_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\SaleRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (" & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Wise)"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelTax & OthOptions & StockFltr
                Formulas.Add("DateGroup#N", 0)
                Formulas.Add("DisplayGroup#N", 1)
                Formulas.Add("GroupOn1#S", "U")
                Formulas.Add("TotalText#S", GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Total")
                Formulas.Add("ReportCaption#S", Me.Text)

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("DocType#S", "S")

                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''14/04/2012
            Case ReportType.SalesRtnTaxRegister_DateWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")

                OthOptions &= " And {vw_SaleWithRtn.Doc_Type} = 'SR'"

                ReportParameters.rptFile = ReportPath & "\Reports\SaleRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (Sales Return Summary)"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelTax & OthOptions
                Formulas.Add("DateGroup#N", 1)
                Formulas.Add("DisplayDetails#N", 0)
                Formulas.Add("ReportCaption#S", Me.Text)
                Formulas.Add("DocType#S", "R")

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))

            Case ReportType.SalesRtnTaxRegister_DocWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")

                OthOptions &= " And {vw_SaleWithRtn.Doc_Type} = 'SR'"

                ReportParameters.rptFile = ReportPath & "\Reports\SaleRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (Sales Return Summary)"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelTax & OthOptions
                Formulas.Add("DateGroup#N", IIf(chkDispValue.Checked, 1, 0))
                Formulas.Add("DisplayDetails#N", 1)
                Formulas.Add("ReportCaption#S", Me.Text)
                Formulas.Add("DocType#S", "R")

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))

            Case ReportType.SalesRtnVATRegister
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")

                OthOptions &= " And {vw_SaleWithRtn.Doc_Type} = 'SR'"

                ReportParameters.rptFile = ReportPath & "\Reports\SaleRegTax.rpt"
                ReportParameters.rptCaption = "VAT Register"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "' And {TaxTermsTDS.TaxClass} = 'VAT'" & FromToDt & OthOptions & SelTax
                Formulas.Add("DateGroup#N", 0)
                Formulas.Add("ReportCaption#S", Me.Text)
                Formulas.Add("DocType#S", "R")

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)

            Case ReportType.SalesRtnTaxRegister_Summary
                FromToDt = GetFromToDateSeriesFilter("{vw_SalePurTax.Doc_Dt}", "{vw_SalePurTax.Bill_Sr}")

                ReportParameters.rptFile = ReportPath & "\Reports\TaxRegister.rpt"
                ReportParameters.rptCaption = "Sales Tax Report"
                ReportParameters.rptFilter = "{vw_SalePurTax.CoBr_Id} = '" & SelBranchId & "' And {vw_SalePurTax.Type} = 'S' And {vw_SalePurTax.TaxType} = 'B'" & FromToDt & SelTax
                Formulas.Add("DisplayBalance#N", 0)
                Formulas.Add("ReportCaption#S", "Tax Summary - Sales Return")
                Formulas.Add("DocType#S", "R")

            Case ReportType.SalesRtnTaxRegister_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")

                OthOptions &= " And {vw_SaleWithRtn.Doc_Type} = 'SR'"

                ReportParameters.rptFile = ReportPath & "\Reports\SaleRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (" & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise)"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelTax & OthOptions & StockFltr
                Formulas.Add("DateGroup#N", 0)
                Formulas.Add("DisplayGroup#N", 1)
                Formulas.Add("GroupOn1#S", "P")
                Formulas.Add("TotalText#S", GetSystemCaption(SystemCaptionIdx.DefProduct) & " Total")
                Formulas.Add("ReportCaption#S", Me.Text)
                Formulas.Add("DocType#S", "R")

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))

            Case ReportType.SalesRtnTaxRegister_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")

                OthOptions &= " And {vw_SaleWithRtn.Doc_Type} = 'SR'"

                ReportParameters.rptFile = ReportPath & "\Reports\SaleRegTax.rpt"
                ReportParameters.rptCaption = "Tax Report (" & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Wise)"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelTax & OthOptions & StockFltr
                Formulas.Add("DateGroup#N", 0)
                Formulas.Add("DisplayGroup#N", 1)
                Formulas.Add("GroupOn1#S", "U")
                Formulas.Add("TotalText#S", GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Total")
                Formulas.Add("ReportCaption#S", Me.Text)
                Formulas.Add("DocType#S", "R")

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            Case ReportType.PeriodicalSales
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)
                StockFltr = GetStockFilter("vw_SaleWithRtn")

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                ReportParameters.rptCaption = "Periodical Sales"
                ReportParameters.rptFile = ReportPath & "\Reports\PeriodicalSales.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & SelUserCtr & OthOptions & LocFilter
                Formulas.Add("DocType#S", "S")

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    'Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "R")
                    Formulas.Add("GroupOn2#S", "B")
                    Formulas.Add("GroupOn3#S", "P")

                    'Formulas.Add("Text1#S", "T")
                    'Formulas.Add("Text2#S", "Y")
                    'Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    'Formulas.Add("HeaderText#S", "Supplier/Brand/Product")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    ViewReportWithOptions("Periodical Sales", False, True, True)
                End If


            Case ReportType.HourlySales
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\HourlySales.rpt"
                ReportParameters.rptCaption = "Hourly Sales"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)

            Case ReportType.DiscountGiven_Bill, ReportType.DiscountGiven_Customer
                FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Bill_Sr}")
                PartyFltr = GetPartyFilter("", True)

                If rptType = ReportType.DiscountGiven_Bill Then
                    ReportParameters.rptCaption = "Discount Given - Bill Wise"

                    If pnlOptions.Visible Then
                        If lstMain.SelectedIndex = 0 Then   ''User
                            Formulas.Add("Counter#N", 2)

                            SelCounter = GetSelectedAttributesForUsers(cmbOperator, "{Vw_SaleRtnRpt.Created_By}")
                            If SelCounter.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelCounter
                            End If

                        ElseIf lstMain.SelectedIndex = 3 Then   ''Supplier
                            Formulas.Add("Counter#N", 3)
                        ElseIf lstMain.SelectedIndex = 4 Then   ''Location
                            SelCounter = GetSelectedAttributesForStock(cmbLocation, "{Vw_SaleRtnRpt.Loc_Key}")
                            If SelCounter.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelCounter
                            End If

                            Formulas.Add("Counter#N", 4)
                        End If
                    Else
                        Formulas.Add("Counter#N", 1)    ''Counter

                        SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SaleRtnRpt.Ctr_Key}")
                        If SelCounter.Trim.Length > 0 Then
                            SelUserCtr = " And " & SelCounter
                        End If
                    End If

                ElseIf rptType = ReportType.DiscountGiven_Customer Then
                    ReportParameters.rptCaption = "Discount Given - Customer Wise"

                    If pnlOptions.Visible Then
                        If lstMain.SelectedIndex = 0 Then   ''User
                            Formulas.Add("Counter#N", 2)

                            SelCounter = GetSelectedAttributesForUsers(cmbOperator, "{Vw_SaleRtnRpt.Created_By}")
                            If SelCounter.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelCounter
                            End If

                        ElseIf lstMain.SelectedIndex = 3 Then   ''Supplier
                            Formulas.Add("Counter#N", 3)
                        ElseIf lstMain.SelectedIndex = 4 Then   ''Location
                            SelCounter = GetSelectedAttributesForStock(cmbLocation, "{Vw_SaleRtnRpt.Loc_Key}")
                            If SelCounter.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelCounter
                            End If

                            Formulas.Add("Counter#N", 4)
                        Else
                            Formulas.Add("Counter#N", 1)
                        End If
                    Else
                        Formulas.Add("Counter#N", 3)    ''Counter

                        'SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SaleRtnRpt.Ctr_Key}")
                        'If SelCounter.Trim.Length > 0 Then
                        '    SelUserCtr = " And " & SelCounter
                        'End If
                    End If
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\DiscountDtls.rpt"
                ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SaleRtnRpt.Doc_Type} = 'SI'" & FromToDt & PartyFltr & SelUserCtr
                ReportParameters.rptCaption = Me.Text

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.DiscountGiven_Product
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)

                ReportParameters.rptFile = ReportPath & "\Reports\DiscountDtlsProd.rpt"
                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & OthOptions & LocFilter

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    If rptType = ReportType.SalesRtnRegister_SubGroupWise Then
                        Formulas.Add("GroupOn3#S", "U")
                    ElseIf rptType = ReportType.SalesRtnRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.SalesRtnRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    ReportParameters.rptCaption = "Discount Given"

                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If

            Case ReportType.AllInOneSales
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                If pnlOptions.Visible Then
                    If lstMain.SelectedIndex = 0 Then   ''User
                        Formulas.Add("Counter#N", 2)

                        SelCounter = GetSelectedAttributesForUsers(cmbOperator, "{vw_SaleWithRtn.Created_By}")
                        If SelCounter.Trim.Length > 0 Then
                            SelUserCtr = " And " & SelCounter
                        End If

                    ElseIf lstMain.SelectedIndex = 3 Then   ''Supplier
                        Formulas.Add("Counter#N", 3)
                    ElseIf lstMain.SelectedIndex = 4 Then   ''Location
                        SelCounter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                        If SelCounter.Trim.Length > 0 Then
                            SelUserCtr = " And " & SelCounter
                        End If

                        Formulas.Add("Counter#N", 4)
                    ElseIf lstMain.SelectedIndex = 1 Or lstMain.SelectedIndex = 2 Then   ''Counter
                        Formulas.Add("Counter#N", 1)
                    End If
                Else
                    Formulas.Add("Counter#N", 1)    ''Counter

                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{vw_SaleWithRtn.Ctr_Key}")
                    If SelCounter.Trim.Length > 0 Then
                        SelUserCtr = " And " & SelCounter
                    End If
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\AllInOneSales.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & OthOptions
                ReportParameters.rptCaption = "All In One Sales"
                Formulas.Add("Header1#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                Formulas.Add("Header2#S", GetSystemCaption(SystemCaptionIdx.DefArticle) & "/" & GetSystemCaption(SystemCaptionIdx.DefType) & "/" & GetSystemCaption(SystemCaptionIdx.DefShade))
                Formulas.Add("Header3#S", GetSystemCaption(SystemCaptionIdx.DefSize))
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                'If pnlOptions.Visible Then
                '    If lstMain.SelectedIndex = 1 Then   ''User
                '        Formulas.Add("Counter#N", 2)
                '    ElseIf lstMain.SelectedIndex = 2 Then   ''Customer
                '        Formulas.Add("Counter#N", 3)
                '    Else
                '        Formulas.Add("Counter#N", 1)    ''Counter
                '    End If
                'Else
                '    Formulas.Add("Counter#N", 1)    ''Counter
                'End If

            Case ReportType.AllInOnePurchase
                If pnlOptions.Visible Then
                    If lstMain.SelectedIndex = 0 Then   ''User
                        Formulas.Add("Counter#N", 2)

                        SelCounter = GetSelectedAttributesForUsers(cmbOperator, "{vw_PurchaseWithRtn.Created_By}")
                        If SelCounter.Trim.Length > 0 Then
                            SelUserCtr = " And " & SelCounter
                        End If

                    ElseIf lstMain.SelectedIndex = 3 Then   ''Supplier
                        Formulas.Add("Counter#N", 3)
                    ElseIf lstMain.SelectedIndex = 4 Then   ''Location
                        SelCounter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtn.Loc_Key}")
                        If SelCounter.Trim.Length > 0 Then
                            SelUserCtr = " And " & SelCounter
                        End If

                        Formulas.Add("Counter#N", 4)
                        Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")
                    ElseIf lstMain.SelectedIndex = 1 Or lstMain.SelectedIndex = 2 Then   ''Counter
                        Formulas.Add("Counter#N", 1)
                    End If
                Else
                    Formulas.Add("Counter#N", 1)    ''Counter

                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{vw_PurchaseWithRtn.Ctr_Key}")
                    If SelCounter.Trim.Length > 0 Then
                        SelUserCtr = " And " & SelCounter
                    End If
                End If

                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_PurchaseWithRtn.Type} = 'I'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\AllInOnePurchase.rpt"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & POTypeFltr
                ReportParameters.rptCaption = Me.Text
                Formulas.Add("Header1#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                Formulas.Add("Header2#S", GetSystemCaption(SystemCaptionIdx.DefArticle) & "/" & GetSystemCaption(SystemCaptionIdx.DefType) & "/" & GetSystemCaption(SystemCaptionIdx.DefShade))
                Formulas.Add("Header3#S", GetSystemCaption(SystemCaptionIdx.DefSize))
                Formulas.Add("ReportCaption#S", Me.Text)

            Case ReportType.AllInOnePurchaseRtn
                If pnlOptions.Visible Then
                    If lstMain.SelectedIndex = 0 Then   ''User
                        Formulas.Add("Counter#N", 2)

                        SelCounter = GetSelectedAttributesForUsers(cmbOperator, "{vw_PurchaseWithRtn.Created_By}")
                        If SelCounter.Trim.Length > 0 Then
                            SelUserCtr = " And " & SelCounter
                        End If

                    ElseIf lstMain.SelectedIndex = 3 Then   ''Supplier
                        Formulas.Add("Counter#N", 3)
                    ElseIf lstMain.SelectedIndex = 4 Then   ''Location
                        SelCounter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtn.Loc_Key}")
                        If SelCounter.Trim.Length > 0 Then
                            SelUserCtr = " And " & SelCounter
                        End If

                        Formulas.Add("Counter#N", 4)
                    ElseIf lstMain.SelectedIndex = 1 Or lstMain.SelectedIndex = 2 Then   ''Counter
                        Formulas.Add("Counter#N", 1)
                    End If
                Else
                    Formulas.Add("Counter#N", 1)    ''Counter

                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{vw_PurchaseWithRtn.Ctr_Key}")
                    If SelCounter.Trim.Length > 0 Then
                        SelUserCtr = " And " & SelCounter
                    End If
                End If

                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                OthOptions &= " And {vw_PurchaseWithRtn.Type} = 'R'"
                ReportParameters.rptFile = ReportPath & "\Reports\AllInOnePurchase.rpt"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & POTypeFltr
                ReportParameters.rptCaption = Me.Text
                Formulas.Add("Header1#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                Formulas.Add("Header2#S", GetSystemCaption(SystemCaptionIdx.DefArticle) & "/" & GetSystemCaption(SystemCaptionIdx.DefType) & "/" & GetSystemCaption(SystemCaptionIdx.DefShade))
                Formulas.Add("Header3#S", GetSystemCaption(SystemCaptionIdx.DefSize))
                Formulas.Add("ReportCaption#S", Me.Text)

            Case ReportType.AllInOnePurchaseOrder
                FromToDt = GetFromToDateSeriesFilter("{vw_PurOrderRpt.Doc_Dt}", "{vw_PurOrderRpt.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_PurOrderRpt")

                If pnlOptions.Visible Then
                    If lstMain.SelectedIndex = 0 Then   ''User
                        SelCounter = GetSelectedAttributesForUsers(cmbOperator, "{vw_PurOrderRpt.Created_By}")
                        If SelCounter.Trim.Length > 0 Then
                            SelUserCtr &= " And " & SelCounter
                        End If

                        Formulas.Add("Counter#N", 2)

                    ElseIf lstMain.SelectedIndex = 3 Then   ''Supplier
                        Formulas.Add("Counter#N", 3)
                    ElseIf lstMain.SelectedIndex = 4 Then   ''Location
                        SelCounter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurOrderRpt.Loc_Key}")
                        If SelCounter.Trim.Length > 0 Then
                            SelUserCtr &= " And " & SelCounter
                        End If

                        Formulas.Add("Counter#N", 4)
                    ElseIf lstMain.SelectedIndex = 1 Or lstMain.SelectedIndex = 2 Then   ''Counter
                        Formulas.Add("Counter#N", 1)
                    End If
                Else
                    Formulas.Add("Counter#N", 1)    ''Counter

                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{vw_PurOrderRpt.Ctr_Key}")
                    If SelCounter.Trim.Length > 0 Then
                        SelUserCtr = " And " & SelCounter
                    End If
                End If

                If IsFabric Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\AllInOnePurOrder.rpt"
                ReportParameters.rptFilter = "{vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & POTypeFltr
                ReportParameters.rptCaption = Me.Text
                Formulas.Add("Header1#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                Formulas.Add("Header2#S", GetSystemCaption(SystemCaptionIdx.DefArticle) & "/" & GetSystemCaption(SystemCaptionIdx.DefType) & "/" & GetSystemCaption(SystemCaptionIdx.DefShade))
                Formulas.Add("Header3#S", GetSystemCaption(SystemCaptionIdx.DefSize))
                Formulas.Add("ReportCaption#S", Me.Text)

            Case ReportType.MOPAnalysis
                Dim strFilter As String = ""
                strFilter &= " AND {vw_SaleWithRtn.DOC_DT} >= DATE(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") AND {vw_SaleWithRtn.DOC_DT} <= DATE(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"
                'FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)
                ' SelUsers = GetSelectedAttributesForStock(cmbOperator, " {vw_SaleWithRtn.SalePerson_Key}")
                Dim SelectedItems As String = cmbOperator.Properties.GetCheckedItems
                Dim arr() As String = SelectedItems.Split(",")
                Dim obj As String = ""

                SelectedItems = ""
                For Each obj In arr
                    If UCase(Trim(obj)) = "CASH" Then
                        SelectedItems &= " {BillRct.ModofPayment} = '1' Or"

                    ElseIf UCase(Trim(obj)) = "CREDIT SALE" Then
                        SelectedItems &= " {BillRct.ModofPayment} = '2' Or"

                    ElseIf UCase(Trim(obj)) = "CREDIT CARD" Then
                        SelectedItems &= " {BillRct.ModofPayment} = '3' Or"

                    ElseIf UCase(Trim(obj)) = "CN ADJ" Then
                        SelectedItems &= " {BillRct.ModofPayment} = '4' Or"

                    ElseIf UCase(Trim(obj)) = "REDEEM POINT" Then
                        SelectedItems &= " {BillRct.ModofPayment} = '6' Or"

                    ElseIf UCase(Trim(obj)) = "CHEQUE" Then
                        SelectedItems &= " {BillRct.ModofPayment} = '7' Or"

                    ElseIf UCase(Trim(obj)) = "COUPON" Then
                        SelectedItems &= " {BillRct.ModofPayment} = '8' Or"

                    ElseIf UCase(Trim(obj)) = "CN ISU" Then
                        SelectedItems &= " {BillRct.ModofPayment} = '10' Or"
                    End If
                Next obj

                'If Not chkSize.Checked Then
                '    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                'End If

                If SelectedItems.Trim.Length > 0 Then
                    SelectedItems = " And (" & Mid$(SelectedItems, 1, Len(SelectedItems) - 2) & ")"
                End If
                ReportParameters.rptFile = ReportPath & "\Reports\SalesMOPAnalysis.rpt"
                ReportParameters.rptCaption = "Sales MOP Analysis"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & strFilter '& PartyFltr & OthOptions & SelectedItems
                Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))
                'Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                'Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                ' D() 'im strFilter As String = ""
            Case ReportType.retailsaleregister
                Dim strFilter As String = ""
                LocFilter = ""


                If rdDetailed.Checked Then
                    'Formulas.Item("DisplayDetails#N") = 1
                    strFilter &= " AND {vw_SaleWithRtnSum.DOC_DT} >= DATE(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") AND {vw_SaleWithRtnSum.DOC_DT} <= DATE(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"
                    'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                    ' FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtnSum.Doc_Dt}", "{vw_SaleWithRtnSum.Doc_sr}")
                    ReportParameters.rptCaption = "Sales Register (" & lstMain.Text & ")"
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterBillSum.rpt"
                    ReportParameters.rptFilter = "{vw_SaleWithRtnSum.CoBr_Id} = '" & SelBranchId & "'" & strFilter '& PartyFltr & LocFilter
                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))
                End If


            Case ReportType.taxregister

                Dim strFilter As String = ""
                LocFilter = ""
                strFilter &= " AND {vw_SalePurTaxGST.DOC_DT} >= DATE(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") AND {vw_SalePurTaxGST.DOC_DT} <= DATE(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"                
                ReportParameters.rptCaption = "Sales Register (" & lstMain.Text & ")"
                ReportParameters.rptFile = ReportPath & "\Reports\TaxRegisterGST.rpt"
                ReportParameters.rptFilter = "{vw_SalePurTaxGST.CoBr_Id} = '" & SelBranchId & "'" & strFilter '& PartyFltr & LocFilter
                Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))
                Dim OtherCharges, RdOff, NetAmt As Decimal
                Dim TotBill As Integer = 0
                Dim StartBillNo, EndBillNo As String
                'If rdSummary.Checked = True Then
                    
                    Formulas.Add("DisplayBalance#N", 0)
                ' Formulas.Add("DocType#S", "S")
                Query = "Select Isnull(sum(OthChgs_Amt),0) OthChgs_Amt ,Isnull(Sum(SaleBill.RdOff),0)  Rdoff, isnull(Sum (Net_Amt),0)  Net_Amt from SaleBill " _
                              & " Left Join Ledger On Ledger.Led_Key  = SaleBill.cust_key " _
                              & " where Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Doc_Id <>0 " _
                              & " And SaleBill.Cobr_Id = '" & SelBranchId & "' "
                    Dim dt As DataTable = Common.GetDataTable(Query)
                    If dt.Rows.Count > 0 Then
                        OtherCharges = dt.Rows(0).Item("OthChgs_Amt")
                        RdOff = dt.Rows(0).Item("Rdoff")
                        NetAmt = dt.Rows(0).Item("Net_Amt")
                    End If
                    Query = "Select count(Doc_no) TotBill from SaleBill  Left Join Ledger On Ledger.Led_Key  = SaleBill.cust_key " _
                    & " where Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'" _
                    & " And SaleBill.Cobr_Id = '" & SelBranchId & "'
                    Dim dtt As DataTable = Common.GetDataTable(Query)
                    If dtt.Rows.Count > 0 Then
                        TotBill = dtt.Rows(0).Item("TotBill")
                    End If
                    StartBillNo = "" : EndBillNo = ""
                Query = "Select IsNull(Max(Doc_NO),'')  EDoc_No, Isnull(Min(Doc_NO),'') SDoc_no from SaleBill  Left Join Ledger On Ledger.Led_Key  = SaleBill.Cust_key " _
                    & " where Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Doc_Id <>0  " _
                    & " And SaleBill.Cobr_Id = '" & SelBranchId & "'"
                    Dim dtt1 As DataTable = Common.GetDataTable(Query)
                    If dtt1.Rows.Count > 0 Then
                        StartBillNo = dtt1.Rows(0).Item("SDoc_no")
                        EndBillNo = dtt1.Rows(0).Item("EDoc_No")
                    End If

                    Formulas.Add("AddLessAmt#N", OtherCharges)
                    Formulas.Add("ROffAmt#N", RdOff)
                    Formulas.Add("NetAmt#N", NetAmt)
                    Formulas.Add("TotalBills#N", TotBill)
                    Formulas.Add("StartBillNo#S", StartBillNo)
                    Formulas.Add("EndingBillNo#S", EndBillNo)



                '  End If







                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.SalePersonCommission
                SelUsers = GetSelectedAttributesForStock(cmbOperator, "{vw_SaleWithRtn.SalePerson_Key}")
                If SelUsers.Trim.Length > 0 Then
                    SelUserCtr &= " And " & SelUsers
                End If

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_saleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalePersonComm.rpt"
                    ReportParameters.rptCaption = "Saleperson Commission - Summary"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\SalePersonCommSum.rpt"
                    ReportParameters.rptCaption = "Saleperson Commission - Detailed"
                End If


                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr & SelUserCtr & OthOptions & LocFilter & PartyFltr
                ReportParameters.TotalText = True
                ViewReportWithOptions("Saleperson Commission")

            Case ReportType.SupplierDocWiseStock
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchVerSale.Doc_Dt}", "{vw_PurchVerSale.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_PurchVerSale")

                ReportParameters.rptFile = ReportPath & "\Reports\SupDocStock.rpt"
                ReportParameters.rptCaption = "Supplier Doc Wise Stock"

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchVerSale.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchVerSale.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchVerSale.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFilter = "{vw_PurchVerSale.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & POTypeFltr


            Case ReportType.SaleByTypeAnalysis
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                ReportParameters.rptCaption = "Sales By Type"

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas.Add("GroupOn1#S", "R")
                    Formulas.Add("GroupOn2#S", "B")
                    Formulas.Add("GroupOn3#S", "P")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    ViewReportWithOptions("Sales By Type", False, True, True)
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\SaleByTypeAnalysis.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & OthOptions & LocFilter


                ''Purchase
            Case ReportType.PurchaseRegister_OperatorWise, ReportType.PurchaseRegister_CounterWise, ReportType.PurchaseRegister_SupplierWise, ReportType.PurchaseRegister_LocationWise, ReportType.PurchaseRegister_DateWise, ReportType.PurchaseRegister_BillWise
                LocFilter = ""

                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim strPOFilter1 As String = ""
                If cmbOrderNo.SelectedIndex <> -1 Then
                    strPOFilter1 = " And {vw_PurchaseWithRtn.POID} = " & Val(cmbOrderNo.Value) & ""
                End If

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("vw_PurchaseWithRtnSum")
                    FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtnSum.Doc_Dt}", "{vw_PurchaseWithRtnSum.Bill_Sr}")
                Else
                    PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")
                    FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")

                    OthOptions = ""

                    'If TypeOfEdition <> Edition.Basic Then
                    'If rdOthOption1.Checked Then
                    '    OthOptions = " And {vw_PurchaseWithRtn.PONO} <> ''"
                    '    Formulas.Add("DisplayPO#N", 1)
                    'ElseIf rdOthOption2.Checked Then
                    '    OthOptions = " And {vw_PurchaseWithRtn.PONO} = ''"
                    '    Formulas.Add("DisplayPO#N", 0)
                    'Else
                    '    Formulas.Add("DisplayPO#N", 1)
                    'End If
                    'End If

                    '23/04/2012
                    ''If TypeOfEdition = Edition.Basic Then
                    ''    Formulas.Add("DisplayPO#N", 0)
                    ''Else
                    ''    Formulas.Add("DisplayPO#N", 1)
                    ''End If
                End If

                If Not chkSize.Checked Then
                    If rdSummary.Checked Then
                        OthOptions &= " And {vw_PurchaseWithRtnSum.Type} <> 'R'"
                    Else
                        OthOptions &= " And {vw_PurchaseWithRtn.Type} <> 'R'"
                    End If
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Operator" Then
                        Formulas.Add("GroupOn1#N", 1)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{vw_purchasewithrtnsum.Created_By}")
                            Formulas.Item("HeaderText#S") = "Operator"
                        Else
                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{vw_purchasewithrtn.Created_By}")
                        End If

                        If SelUserCtr.Trim.Length > 0 Then
                            SelUserCtr = " And " & SelUserCtr
                        End If

                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Purchase Register - Summary(Operator Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(Operator Wise)"
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Counter" Then
                        Formulas.Add("GroupOn1#N", 2)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Counter"
                            ReportParameters.rptCaption = "Purchase Register - Summary(Counter Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(Counter Wise)"
                        End If

                        If rdSummary.Checked Then
                            SelCounter = GetSelectedAttributesForStock(cmbOperator, "{vw_purchasewithrtnsum.Ctr_Key}")
                        Else
                            SelCounter = GetSelectedAttributesForStock(cmbOperator, "{vw_purchasewithrtn.Ctr_Key}")
                        End If

                        If SelCounter.Trim.Length > 0 Then
                            SelUserCtr = " And " & SelCounter
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Supplier" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Supplier"
                            ReportParameters.rptCaption = "Purchase Register - Summary(Supplier Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(Supplier Wise)"
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = GetSystemCaption(SystemCaptionIdx.DefLocation)
                            ReportParameters.rptCaption = "Purchase Register - Summary(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Date"
                            ReportParameters.rptCaption = "Purchase Register - Summary(Date Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(Date Wise)"
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)

                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Purchase Register - Summary(Bill Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(Bill Wise)"
                        End If
                    End If

                    If lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        If rdDetailed.Checked Then
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtn.Loc_Key}")
                        Else
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtnSum.Loc_Key}")
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If
                    End If

                    If rdDetailed.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                        End If

                        ReportParameters.rptFile = ReportPath & "\Reports\PurRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0'" & FromToDt & PartyFltr & StockFltr & SelUserCtr & TaxFilter & OthOptions & LocFilter & POTypeFltr
                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Item("HeaderText#S") = GetSystemCaption(SystemCaptionIdx.DefProduct)
                    Else
                        If IsFabric Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'S'"
                        End If

                        ReportParameters.rptFile = ReportPath & "\Reports\PurRegDoc.rpt"
                        ReportParameters.rptFilter = "{vw_PurchaseWithRtnSum.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtnSum.Opening} = '0'" & FromToDt & PartyFltr & SelUserCtr & LocFilter & OthOptions & POTypeFltr
                    End If
                Else
                    If rptType = ReportType.PurchaseRegister_OperatorWise Then
                        Formulas.Add("GroupOn1#N", 1)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Operator"
                            ReportParameters.rptCaption = "Purchase Register - Summary(Operator Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(Operator Wise)"
                        End If

                        If rdSummary.Checked Then
                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{vw_purchasewithrtnsum.Created_By}")
                        Else
                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{vw_purchasewithrtn.Created_By}")
                        End If
                        If SelUserCtr.Trim.Length > 0 Then
                            SelUserCtr = " And " & SelUserCtr
                        End If

                    ElseIf rptType = ReportType.PurchaseRegister_CounterWise Then
                        Formulas.Add("GroupOn1#N", 2)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Counter"
                            ReportParameters.rptCaption = "Purchase Register - Summary(Counter Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(Counter Wise)"
                        End If

                        If rdSummary.Checked Then
                            SelCounter = GetSelectedAttributesForStock(cmbOperator, "{vw_purchasewithrtnsum.Ctr_Key}")
                        Else
                            SelCounter = GetSelectedAttributesForStock(cmbOperator, "{vw_purchasewithrtn.Ctr_Key}")
                        End If

                        If SelCounter.Trim.Length > 0 Then
                            SelUserCtr &= " And " & SelCounter
                        End If

                    ElseIf rptType = ReportType.PurchaseRegister_SupplierWise Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Supplier"
                            ReportParameters.rptCaption = "Purchase Register - Summary(Supplier Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(Supplier Wise)"
                        End If

                    ElseIf rptType = ReportType.PurchaseRegister_LocationWise Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = GetSystemCaption(SystemCaptionIdx.DefLocation)
                            ReportParameters.rptCaption = "Purchase Register - Summary(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                        End If

                        If rdDetailed.Checked Then
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtn.Loc_Key}")
                        Else
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtnSum.Loc_Key}")
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If

                    ElseIf rptType = ReportType.PurchaseRegister_DateWise Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Date"
                            ReportParameters.rptCaption = "Purchase Register - Summary(Date Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(Date Wise)"
                        End If

                    ElseIf rptType = ReportType.PurchaseRegister_BillWise Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)

                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Purchase Register - Summary(Bill Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Register - Details(Bill Wise)"
                        End If
                    End If

                    If rdSummary.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'S'"
                        End If
                        'If cmbSONo.SelectedIndex <> -1 Then
                        '    strSOFilter1 = " And {vw_PurchaseWithRtnSum.SO_Id} = " & Val(cmbSONo.Value) & ""
                        'End If
                        ReportParameters.rptFile = ReportPath & "\Reports\PurRegDoc.rpt"
                        ReportParameters.rptFilter = "{vw_PurchaseWithRtnSum.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtnSum.Opening} = '0'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter & POTypeFltr & strSOFilter1

                    Else
                        If IsFabric Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                        End If

                       
                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Add("HeaderText#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        StockFltr = GetStockFilter("vw_PurchaseWithRtn")
                        PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")
                        TaxFilter = GetTaxFilter("vw_PurchaseWithRtn")

                        ReportParameters.rptFile = ReportPath & "\Reports\PurRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter & POTypeFltr & strSOFilter1 & strPOFilter1
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.PeriodicalPurchase
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")
                StockFltr = GetStockFilter("vw_PurchaseWithRtn")
                ReportParameters.rptCaption = "Periodical Purchase"

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtn.Loc_Key}")

                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_PurchaseWithRtn.Type} <> 'R'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\PeriodicalPurchase.rpt"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0'" & FromToDt & PartyFltr & StockFltr & OthOptions & LocFilter & POTypeFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas.Add("GroupOn1#S", "R")
                    Formulas.Add("GroupOn2#S", "B")
                    Formulas.Add("GroupOn3#S", "P")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    ViewReportWithOptions("Periodical Purchase", , True, True)
                End If


            Case ReportType.MonthlyPurchase
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")
                StockFltr = GetStockFilter("vw_PurchaseWithRtn")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_PurchaseWithRtn.Type} <> 'R'"
                End If

                If lstOption1.Items.Count > 0 Then
                    Param = GetFieldParameter(lstOption1.Items(0))
                End If
                Formulas.Add("Header1#S", lstOption1.Items(0))
                Formulas.Add("GroupOn1#S", Param)
                Formulas.Add("ReportCaption#S", Me.Text)

                Series = ""

                If rdA.Checked Then
                    Series = " And {vw_PurchaseWithRtn.Bill_Sr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_PurchaseWithRtn.Bill_Sr} = 'B'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptCaption = "Monthly Purchase - " & lstOption1.Items(0)
                ReportParameters.rptFile = ReportPath & "\Reports\MonthlyPurchase.rpt"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0' And Month({vw_PurchaseWithRtn.Doc_Dt}) In " & SelectedMonth() & OthOptions & PartyFltr & StockFltr & Series & POTypeFltr

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)

            Case ReportType.MonthlyPurchaseDate
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")
                StockFltr = GetStockFilter("vw_PurchaseWithRtn")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_PurchaseWithRtn.Type} <> 'R'"
                End If

                If lstOption1.Items.Count > 0 Then
                    Param = GetFieldParameter(lstOption1.Items(0))
                End If
                Formulas.Add("Header1#S", lstOption1.Items(0))
                Formulas.Add("GroupOn1#S", Param)
                Formulas.Add("ReportCaption#S", Me.Text)

                Series = ""

                If rdA.Checked Then
                    Series = " And {vw_PurchaseWithRtn.Bill_Sr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_PurchaseWithRtn.Bill_Sr} = 'B'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\MonthlyPurchaseDate.rpt"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0' And Month({vw_PurchaseWithRtn.Doc_Dt}) In " & SelectedMonth() & OthOptions & PartyFltr & StockFltr & Series & POTypeFltr
                ReportParameters.rptCaption = "Monthly Purchase - Date Wise"

            Case ReportType.MonthlyPurchaseRtn
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_PurchaseWithRtn")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")

                OthOptions &= " And {vw_PurchaseWithRtn.Type} = 'R'"

                If lstOption1.Items.Count > 0 Then
                    Param = GetFieldParameter(lstOption1.Items(0))
                End If
                Formulas.Add("Header1#S", lstOption1.Items(0))
                Formulas.Add("GroupOn1#S", Param)
                Formulas.Add("RtnFlag#N", 1)
                Formulas.Add("ReportCaption#S", Me.Text)

                LocFilter = ""

                LocFilter = GetSelectedAttributes(cmbLocation, "vw_PurchaseWithRtn.Loc_Key")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                Series = ""

                If rdA.Checked Then
                    Series = " And {vw_PurchaseWithRtn.Bill_Sr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_PurchaseWithRtn.Bill_Sr} = 'B'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptCaption = "Monthly Purchase Return - " & lstOption1.Items(0)
                ReportParameters.rptFile = ReportPath & "\Reports\MonthlyPurchase.rpt"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And Month({vw_PurchaseWithRtn.Doc_Dt}) In " & SelectedMonth() & OthOptions & StockFltr & LocFilter & PartyFltr & Series & POTypeFltr

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)

            Case ReportType.MonthlyPurchaseDateRtn
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_PurchaseWithRtn")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")
                OthOptions &= " And {vw_PurchaseWithRtn.Type} = 'R'"

                If lstOption1.Items.Count > 0 Then
                    Param = GetFieldParameter(lstOption1.Items(0))
                End If

                LocFilter = ""

                LocFilter = GetSelectedAttributes(cmbLocation, "vw_PurchaseWithRtn.Loc_Key")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                Formulas.Add("Header1#S", lstOption1.Items(0))
                Formulas.Add("GroupOn1#S", Param)
                Formulas.Add("RtnFlag#N", 1)
                Formulas.Add("ReportCaption#S", Me.Text)

                Series = ""

                If rdA.Checked Then
                    Series = " And {vw_PurchaseWithRtn.Bill_Sr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_PurchaseWithRtn.Bill_Sr} = 'B'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\MonthlyPurchaseDate.rpt"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And Month({vw_PurchaseWithRtn.Doc_Dt}) In " & SelectedMonth() & OthOptions & StockFltr & LocFilter & PartyFltr & Series & POTypeFltr
                ReportParameters.rptCaption = "Monthly Purchase Return - Date Wise"

            Case ReportType.PeriodicalPurchaseRtn
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")
                StockFltr = GetStockFilter("vw_PurchaseWithRtn")
                ReportParameters.rptCaption = Me.Text

                LocFilter = ""

                LocFilter = GetSelectedAttributes(cmbLocation, "vw_PurchaseWithRtn.Loc_Key")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                OthOptions &= " And {vw_PurchaseWithRtn.Type} = 'R'"

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\PeriodicalPurchase.rpt"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & OthOptions & LocFilter & POTypeFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas.Add("GroupOn1#S", "R")
                    Formulas.Add("GroupOn2#S", "B")
                    Formulas.Add("GroupOn3#S", "P")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    ViewReportWithOptions("Periodical Purchase Return", , True, True)
                End If

            Case ReportType.TopNSuppliers
                If rdAgeQty.Checked Then
                    ReportParameters.rptCaption = "Top N Suppliers (By Quantity)"
                    Formulas.Add("QtyValue#S", "Q")
                Else
                    ReportParameters.rptCaption = "Top N Suppliers (By Value)"
                    Formulas.Add("QtyValue#S", "V")
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                ReportParameters.rptFile = ReportPath & "\Reports\TopNPurchase.rpt"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0'" & FromToDt
                Formulas.Add("Text1#S", "R")
                Formulas.Add("FirstHeader#S", "Supplier")
                Formulas.Add("ReportCaption#S", Me.Text)

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)

            Case ReportType.TopNPurchase
                If rdAgeQty.Checked Then
                    ReportParameters.rptCaption = "Top N " & GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct) & " (By Quantity)"
                    ReportParameters.rptFile = ReportPath & "\Reports\TopNPurchase.rpt"
                    Formulas.Add("QtyValue#S", "Q")

                ElseIf rdAgeValue.Checked Then
                    ReportParameters.rptCaption = "Top N " & GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct) & " (By Value)"
                    ReportParameters.rptFile = ReportPath & "\Reports\TopNPurchase.rpt"
                    Formulas.Add("QtyValue#S", "V")
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                FromToDt = GetFromToDateSeriesFilter("{Vw_PurchaseWithRtn.Doc_Dt}", "{Vw_PurchaseWithRtn.Bill_Sr}")
                ReportParameters.rptFilter = "{Vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions & POTypeFltr

                Formulas.Add("Text1#S", "P")
                Formulas.Add("FirstHeader#S", GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)

            Case ReportType.ConsolidatedPurchase_DtProduct
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_PurchaseWithRtn")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")
                LocFilter = ""

                LocFilter = GetSelectedAttributes(cmbLocation, "vw_PurchaseWithRtn.Loc_Key")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\PurRegProdSum.rpt"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0'" & FromToDt & PartyFltr & StockFltr & LocFilter & POTypeFltr
                ReportParameters.rptCaption = "Consolidated Purchase (Date/" & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise)"

                ReportParameters.TotalText = True
                ReportParameters.DisplayDetails = True
                ViewReportWithOptions(Me.Text)

            Case ReportType.ExcessLessQty_AgainstOrder
                FromToDt = GetFromToDateSeriesFilter("{vw_PurOrderRpt.Doc_Dt}", "{vw_PurOrderRpt.Bill_Sr}")
                StockFltr = GetStockFilter("vw_PurOrderRpt")

                If IsFabric Then
                    POTypeFltr = " And {Purchase.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {Purchase.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {Purchase.Pur_Type} = 'S'"
                End If

                Formulas.Add("Total1Text#S", GetSystemCaption(SystemCaptionIdx.DefProduct) & " Total")
                ReportParameters.rptFile = ReportPath & "\Reports\PurOrderExcessLess.rpt"
                ReportParameters.rptFilter = "{vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {@ExcessLess} <> 0.00" & FromToDt & StockFltr & POTypeFltr
                ReportParameters.rptCaption = Me.Text

            Case ReportType.PurchaseRegister_SubGroupWise, ReportType.PurchaseRegister_ProductWise, ReportType.PurchaseRegister_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_PurchaseWithRtn")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_PurchaseWithRtn.Type} <> 'R'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PurRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PurRegProdSum.rpt"
                End If

                LocFilter = ""

                LocFilter = GetSelectedAttributes(cmbLocation, "vw_PurchaseWithRtn.Loc_Key")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0'" & FromToDt & PartyFltr & StockFltr & OthOptions & LocFilter & POTypeFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    If rptType = ReportType.PurchaseRegister_SubGroupWise Then
                        Formulas.Add("GroupOn3#S", "U")
                    ElseIf rptType = ReportType.PurchaseRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.PurchaseRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Purchase Detail"
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.rptCaption = "Purchase Summary"
                    End If

                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


            Case ReportType.BarcodeWisePurchase
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_PurchaseWithRtn")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_PurchaseWithRtn.Type} <> 'R'"
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\BarcodePurchase.rpt"
                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Opening} = '0'" & FromToDt & PartyFltr & StockFltr & OthOptions & POTypeFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    If rptType = ReportType.PurchaseRegister_SubGroupWise Then
                        Formulas.Add("GroupOn3#S", "U")
                    ElseIf rptType = ReportType.PurchaseRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.PurchaseRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", Me.Text)
                Else
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(Me.Text)
                End If
                ReportParameters.rptCaption = Me.Text



                ''ankita 20042019

            Case ReportType.PurRegister_DateWise
                ''CHANGE BY RAHUL ON 23/04/2019
                Dim ReportFilter As String = ""
                If cmbPurType.SelectedIndex > 0 Then
                    ReportFilter = " And {vw_PurRegBillWise.PUR_TYPE} = '" & GetPurType(cmbPurType.SelectedIndex) & "'"
                End If

                If chkDispRate.Checked = True Then
                    ReportFilter &= " AND {vw_PurRegBillWise.BillNo}<>''"
                ElseIf chkDispValue.Checked = True Then
                    ReportFilter &= " AND {vw_PurRegBillWise.BillNo}=''"
                End If
                ''END
                
                

                FromToDt = GetFromToDateSeriesFilter("{vw_PurRegBillWise.Doc_Dt}", "", , False)

                ''COMMENTED BY RAHUL ON 23/04/2019

                ''Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                ''Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ''END
                Formulas.Add("ReportCaption#S", Me.Text)

                PartyFltr = GetPartyFilter("vw_PurRegBillWise")

                ''COMMENTED BY RAHUL ON 23/04/2019

                ''If cmbPurType.SelectedIndex > 0 Then
                ''    ReportFilter = " vw_PurRegBillWise.CoBr_Id = '" & SelBranchId & "' And vw_PurRegBillWise.PUR_TYPE = " & GetPurType(cmbPurType.Value) & FromToDt
                ''Else
                ''    ReportFilter = " vw_PurRegBillWise.CoBr_Id = '" & SelBranchId & "' " & FromToDt
                ''End If
                ''FromToDt = " And vw_PurRegBillWise.Doc_Dt >= '" & Format$(dtpFrom.Value, "dd/MM/yyyy") & "' And vw_PurRegBillWise.Doc_Dt <= '" & Format$(dtpTo.Value, "dd/MM/yyyy") & "'"

                ''END

                ReportParameters.rptFile = ReportPath & "\Reports\PurchaseRegAgainstBill.rpt"
                ReportParameters.rptFilter = "{vw_PurRegBillWise.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter & ReportFilter

                ''end ankita 20042019

            Case ReportType.PurbillRegister_DateWise
                ''CHANGE BY RAHUL ON 23/04/2019
                Dim ReportFilter As String = ""
                If cmbPurType.SelectedIndex > 0 Then
                    ReportFilter = " And {PurchaseBill.PURBILL_TYPE} = '" & GetPurType(cmbPurType.SelectedIndex) & "'"
                End If


                If chkDispRate.Checked = True Then
                    ReportFilter &= " AND {PurchaseBillDtl.PurDoc_Id}<>0"
                ElseIf chkDispValue.Checked = True Then
                    ReportFilter &= " AND {PurchaseBillDtl.PurDoc_Id}=0"
                ElseIf chkSize.Checked = True Then
                    ReportFilter &= " AND {Vw_PurchaseBillApproval.ApproveFlag} <> 'A'"
                End If
                ''END
                'VW_purchaseBillApproval
                FromToDt = GetFromToDateSeriesFilter("{PurchaseBill.Doc_Dt}", "", , False)
                If chkSize.Checked = False Then
                    Formulas.Add("ReportCaption#S", Me.Text)
                End If
                PartyFltr = GetPartyFilter("PurchaseBill")

                'ReportParameters.rptFile = ReportPath & "\Reports\PurchaseBillAgainstPurchase.rpt"
                'ReportParameters.rptFilter = "{PurchaseBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter & ReportFilter
                ''ankita 25042019
                If rdDetailed.Checked Then
                    StockFltr = GetStockFilter("PurchaseBill", True)
                    ReportParameters.rptFile = ReportPath & "\Accounts\PurchaseBillDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Accounts\PurchaseBillAgainstPurchase.rpt"
                    
                End If

                If chkSize.Checked = True Then
                    ReportParameters.rptFile = ReportPath & "\Accounts\PendingForApprovalPurchaseBill.rpt"
                End If

                ReportParameters.rptFilter = "{PurchaseBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter & ReportFilter & StockFltr
                ' ''end ankita 25042019

            Case ReportType.SalesRegister_OperatorWise, ReportType.SalesRegister_CounterWise, ReportType.SalesRegister_CustomerWise, ReportType.SalesRegister_LocationWise, ReportType.SalesRegister_DateWise, ReportType.SalesRegister_BillWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("Vw_SaleRtnRpt", True)
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Bill_Sr}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SaleRtnRpt", True)
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Bill_Sr}")
                End If

                If Not chkSize.Checked Then
                    If rdSummary.Checked Then
                        OthOptions &= " And {Vw_SaleRtnRpt.Doc_Type} <> 'SR'"
                    Else
                        OthOptions &= " And {Vw_SaleRtnRpt.Doc_Type} <> 'SR'"
                    End If
                End If

                'If rdDetailed.Checked Then
                '    If chkDispValue.Checked Then
                '        Formulas.Add("ReportType#N", 0)
                '    Else
                'Formulas.Add("ReportType#N", 1)
                '    End If
                'End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then

                    If lstMain.Items(lstMain.SelectedIndex) = "Operator" Then
                        Formulas.Add("GroupOn1#N", 1)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", "Operator Total")
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 1)
                        End If

                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Sales Register - Summary(Operator Wise)"
                            Formulas.Add("HeaderText#S", "Operator")

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{Vw_SaleRtnRpt.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Sales Register - Details(Operator Wise)"

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{Vw_SaleRtnRpt.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Counter" Then
                        Formulas.Add("GroupOn1#N", 2)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", "Counter Total")
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 1)
                        End If

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Counter")
                            ReportParameters.rptCaption = "Sales Register - Summary(Counter Wise)"

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{Vw_SaleRtnRpt.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Sales Register - Details(Counter Wise)"

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{Vw_SaleRtnRpt.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", "Customer Total")
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 1)
                        End If

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Customer")
                            ReportParameters.rptCaption = "Sales Register - Summary(Customer Wise)"
                        Else
                            ReportParameters.rptCaption = "Sales Register - Details(Customer Wise)"
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 1)
                        End If

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", GetSystemCaption(SystemCaptionIdx.DefLocation))
                            ReportParameters.rptCaption = "Sales Register - Summary(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"

                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_SaleRtnRpt.Loc_Key}")
                        Else
                            ReportParameters.rptCaption = "Sales Register - Details(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"

                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_SaleRtnRpt.Loc_Key}")
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 2)
                        End If
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Date")
                            ReportParameters.rptCaption = "Sales Register - Summary(Date Wise)"
                        Else
                            ReportParameters.rptCaption = "Sales Register - Details(Date Wise)"
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 3)
                        End If

                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Sales Register - Summary(Bill Wise)"
                        Else
                            ReportParameters.rptCaption = "Sales Register - Details(Bill Wise)"
                            Formulas.Item("DisplayDetails#N") = 1
                        End If
                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterBillDetail.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter
                    Else
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterBillSum.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & LocFilter & OthOptions
                    End If
                Else
                    If rptType = ReportType.SalesRegister_OperatorWise Then
                        Formulas.Add("GroupOn1#N", 1)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Operator")
                            ReportParameters.rptCaption = "Sales Register - Summary(Operator Wise)"

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{Vw_SaleRtnRpt.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Sales Register - Details(Operator Wise)"

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{Vw_SaleRtnRpt.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf rptType = ReportType.SalesRegister_CounterWise Then
                        Formulas.Add("GroupOn1#N", 2)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Counter")
                            ReportParameters.rptCaption = "Sales Register - Summary(Counter Wise)"

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{Vw_SaleRtnRpt.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Sales Register - Details(Counter Wise)"

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{Vw_SaleRtnRpt.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf rptType = ReportType.SalesRegister_CustomerWise Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Customer")
                            ReportParameters.rptCaption = "Sales Register - Summary(Customer Wise)"
                        Else
                            ReportParameters.rptCaption = "Sales Register - Details(Customer Wise)"
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf rptType = ReportType.SalesRegister_LocationWise Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Location")
                            ReportParameters.rptCaption = "Sales Register - Summary(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"

                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_SaleRtnRpt.Loc_Key}")
                        Else
                            ReportParameters.rptCaption = "Sales Register - Details(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"

                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_SaleRtnRpt.Loc_Key}")
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If

                    ElseIf rptType = ReportType.SalesRegister_DateWise Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Date")
                            ReportParameters.rptCaption = "Sales Register - Summary(Date Wise)"
                        Else
                            Formulas.Item("ReportType#N") = 2
                            Formulas.Item("DisplayDetails#N") = 1
                            ReportParameters.rptCaption = "Sales Register - Details(Date Wise)"
                        End If

                    ElseIf rptType = ReportType.SalesRegister_BillWise Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)

                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Sales Register - Summary(Bill Wise)"
                        Else
                            ReportParameters.rptCaption = "Sales Register - Details(Bill Wise)"
                        End If
                    End If

                    If rdSummary.Checked Then
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterBillSum.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter

                    Else
                        PartyFltr = GetPartyFilter("Vw_SaleRtnRpt", True)

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterBillDetail.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.SalesRegister_SupplierWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterProdDetail.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterProdSum.rpt"
                End If

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & OthOptions & LocFilter

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    If rptType = ReportType.SalesRegister_SubGroupWise Then
                        Formulas.Add("GroupOn3#S", "S")
                    ElseIf rptType = ReportType.SalesRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "")
                    ElseIf rptType = ReportType.SalesRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    ReportParameters.TotalText = True
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Sales Detail"
                        ViewReportWithOptions(ReportParameters.rptCaption, , )
                    Else
                        ReportParameters.rptCaption = "Sales Summary"
                        ViewReportWithOptions(ReportParameters.rptCaption, , , True)
                    End If
                End If

                'PartyFltr = GetPartyFilter("ItemStock")
                'If Not chkSize.Checked Then
                '    OthOptions = " And {Bill.Doc_Type} <> 'SR'"
                'End If

                'ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterBillDetail.rpt"
                'ReportParameters.rptFilter = "{Bill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & OthOptions

                'Formulas.Add("DisplayDetails#N", 0)
                'Formulas.Add("GroupOn1#N", 6)

                'ReportParameters.rptCaption = "Supplier Wise Sales Register"


            Case ReportType.SalesRegister_SubGroupWise, ReportType.SalesRegister_ProductWise, ReportType.SalesRegister_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterProdDetail.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterProdSum.rpt"
                End If

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & OthOptions & LocFilter

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    If rptType = ReportType.SalesRegister_SubGroupWise Then
                        Formulas.Add("GroupOn3#S", "U")
                    ElseIf rptType = ReportType.SalesRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.SalesRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Sales Detail"
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.rptCaption = "Sales Summary"
                        ReportParameters.DisplayDetails = False
                    End If

                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


            Case ReportType.SalesRegister_CustProductWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)

                ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterProdDetail.rpt"

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & OthOptions

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "S")
                    Formulas.Add("GroupOn2#S", "P")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    ReportParameters.rptCaption = "Sales Register"

                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


            Case ReportType.DailySalesReport_DateWise
                PartyFltr = GetPartyFilter("Vw_SaleRtnRpt", True)
                FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Bill_Sr}")
                ReportParameters.rptFile = ReportPath & "\Reports\DlySalLed.rpt"
                ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr

                ReDim subrpt(1)

                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}", False)
                subrpt(0).Report = "TaxSum"
                subrpt(0).Filter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr


            Case ReportType.SalesRegisterWithRtn_DateWise
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                ReportParameters.rptFile = ReportPath & "\Reports\SalesRegWithRtnBill.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr

                ReDim subrpt(1)

                subrpt(0).Report = "TaxSum"
                subrpt(0).Filter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr

            Case ReportType.SalesRegisterWithRtn_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)
                StockFltr = GetStockFilter("vw_SaleWithRtn", , False)

                ReportParameters.rptFile = ReportPath & "\Reports\SalesRegWithRtnProduct.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr

                ReDim subrpt(1)

                subrpt(0).Report = "TaxSum"
                subrpt(0).Filter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr

            Case ReportType.SalesRegisterWithRtn_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)
                StockFltr = GetStockFilter("vw_SaleWithRtn", , False)

                Formulas.Add("Header#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                Formulas.Add("Footer#S", GetSystemCaption(SystemCaptionIdx.DefBrand) & " Total")
                ReportParameters.rptFile = ReportPath & "\Reports\SalesRegWithRtnBrand.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr

                ReDim subrpt(1)

                subrpt(0).Report = "TaxSum"
                subrpt(0).Filter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr

            Case ReportType.SalesRtnRegister_OperatorWise, ReportType.SalesRtnRegister_CounterWise, ReportType.SalesRtnRegister_PartyWise, ReportType.SalesRtnRegister_LocationWise, ReportType.SalesRtnRegister_DateWise, ReportType.SalesRtnRegister_BillWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SalesRtn")
                    FromToDt = GetFromToDateSeriesFilter("{SalesRtn.Doc_Dt}", "{SalesRtn.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SaleRtnRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Doc_Type}")
                End If

                If rdSummary.Checked Then
                    OthOptions &= " And {SalesRtn.Doc_Type} = 'SR'"
                Else
                    OthOptions &= " And {Vw_SaleRtnRpt.Doc_Type} = 'SR'"
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Operator" Then
                        Formulas.Add("GroupOn1#N", 1)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", "Operator Total")
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 1)
                        End If

                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Sales Return Register - Summary(Operator Wise)"
                            Formulas.Add("HeaderText#S", "Operator")

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{Vw_SaleRtnRpt.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Sales Return Register - Details(Operator Wise)"

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{vw_SaleWithRtn.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Counter" Then
                        Formulas.Add("GroupOn1#N", 2)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", "Counter Total")
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 1)
                        End If

                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Sales Return Register - Summary(Counter Wise)"
                            Formulas.Add("HeaderText#S", "Counter")

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{Vw_SaleRtnRpt.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Sales Return Register - Details(Counter Wise)"

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{vw_SaleWithRtn.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", "Customer Total")
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 1)
                        End If

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Customer")
                            ReportParameters.rptCaption = "Sales Return Register - Summary(Customer Wise)"
                        Else
                            ReportParameters.rptCaption = "Sales Return Register - Details(Customer Wise)"
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 1)
                        End If

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Location")
                            ReportParameters.rptCaption = "Sales Return Register - Summary(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"

                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_SaleRtnRpt.Loc_Key}")
                        Else
                            ReportParameters.rptCaption = "Sales Return Register - Details(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If


                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 2)
                        End If

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Date Wise")
                            ReportParameters.rptCaption = "Sales Return Register - Summary(Date Wise)"
                        Else
                            ReportParameters.rptCaption = "Sales Return Register - Details(Date Wise)"
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                        If rdDetailed.Checked Then
                            Formulas.Add("ReportType#N", 3)
                        End If

                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Sales Return Register - Summary(Bill Wise)"
                        Else
                            ReportParameters.rptCaption = "Sales Return Register - Details(Bill Wise)"
                            Formulas.Item("DisplayDetails#N") = 1
                        End If
                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesRtnRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter
                    Else
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesRtnRegDoc.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & LocFilter & OthOptions
                    End If
                Else
                    If rptType = ReportType.SalesRtnRegister_OperatorWise Then
                        Formulas.Add("GroupOn1#N", 1)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Add("HeaderText#S", "Operator")
                            ReportParameters.rptCaption = "Sales Return Register - Summary(Operator Wise)"

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{Vw_SaleRtnRpt.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Sales Return Register - Details(Operator Wise)"

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{vw_SaleWithRtn.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf rptType = ReportType.SalesRtnRegister_CounterWise Then
                        Formulas.Add("GroupOn1#N", 2)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            ' Formulas.Add("HeaderText#S", "Counter")
                            ReportParameters.rptCaption = "Sales Return Register - Summary(Counter Wise)"

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{Vw_SaleRtnRpt.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Sales Return Register - Details(Counter Wise)"

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{vw_SaleWithRtn.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf rptType = ReportType.SalesRtnRegister_PartyWise Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            'Formulas.Add("HeaderText#S", "Customer")
                            ReportParameters.rptCaption = "Sales Return Register - Summary(Customer Wise)"
                        Else
                            ReportParameters.rptCaption = "Sales Return Register - Details(Customer Wise)"
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf rptType = ReportType.SalesRtnRegister_LocationWise Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            ' Formulas.Add("HeaderText#S", "Location")
                            ReportParameters.rptCaption = "Sales Return Register - Summary(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_SaleRtnRpt.Loc_Key}")
                        Else
                            ReportParameters.rptCaption = "Sales Return Register - Details(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If

                    ElseIf rptType = ReportType.SalesRtnRegister_DateWise Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            ' Formulas.Add("HeaderText#S", "Date")
                            ReportParameters.rptCaption = "Sales Return Register - Summary(Date Wise)"
                        Else
                            '  Formulas.Item("ReportType#N") = 2
                            Formulas.Item("DisplayDetails#N") = 1
                            ReportParameters.rptCaption = "Sales Return Register - Details(Date Wise)"
                        End If

                    ElseIf rptType = ReportType.SalesRtnRegister_BillWise Then
                        Formulas.Add("GroupOn1#N", 0)
                        '  Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", 1)

                        If rdSummary.Checked Then
                            'PartyFltr = GetPartyFilter("SalesRtn")
                            'FromToDt = GetFromToDateSeriesFilter("{SalesRtn.Doc_Dt}", "{SalesRtn.Doc_Type}")
                            ReportParameters.rptCaption = "Sales Return Register - Summary(Bill Wise)"
                        Else
                            '  'PartyFltr = GetPartyFilter("Vw_SaleRtnRpt")
                            ' FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Doc_Type}")
                            ReportParameters.rptCaption = "Sales Return Register - Details(Bill Wise)"
                        End If
                    End If

                    If rdSummary.Checked Then
                        ' ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterBillSum.rpt"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesRtnRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ' ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SaleRtnRpt", True)
                        ''19/04/2012
                        ' ReportParameters.rptFile = ReportPath & "\Reports\SalesRtnRegisterBillDetail.rpt"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesRtnRegDocDtl.rpt"
                        ' ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter
                        ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.SalesRtnRegister_SubGroupWise, ReportType.SalesRtnRegister_ProductWise, ReportType.SalesRtnRegister_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.doc_type}")
                StockFltr = GetStockFilter("Vw_SaleRtnRpt")
                PartyFltr = GetPartyFilter("Vw_SaleRtnRpt", True)

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterRtnProdDetail.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterRtnProdSum.rpt"
                End If

                OthOptions &= " And {Vw_SaleRtnRpt.Doc_Type} = 'A'"

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_SaleRtnRpt.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & OthOptions & LocFilter

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    'Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    If rptType = ReportType.SalesRtnRegister_SubGroupWise Then
                        Formulas.Add("GroupOn3#S", "U")
                    ElseIf rptType = ReportType.SalesRtnRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.SalesRtnRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Sales Return Detail"
                    Else
                        ReportParameters.rptCaption = "Sales Return Summary"
                    End If

                    ReportParameters.DisplayDetails = False
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If

            Case ReportType.SalesRtnRegister_SalepersonWise
                PartyFltr = GetSelectedAttributes(cmbOperator, "SalesPerson.Led_Key")
                If PartyFltr.Trim.Length > 0 Then
                    PartyFltr = " And " & PartyFltr
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("Vw_SaleRtnRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Bill_Sr}")
                    OthOptions &= " And {Vw_SaleRtnRpt.Doc_Type} = 'SR'"
                Else
                    PartyFltr = GetPartyFilter("Vw_SaleRtnRpt") 'GetPartyFilter("Bill", True)
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Bill_Sr}") 'GetFromToDateSeriesFilter("{Bill.Doc_Dt}", "{Bill.Bill_Sr}")
                    'OthOptions &= " And {Bill.Doc_Type} = 'SR'"
                    OthOptions &= " And {Vw_SaleRtnRpt.Doc_Type} = 'SR'"
                End If



                If rdSummary.Checked Then
                    Formulas.Add("DisplayDetails#N", 0)
                    Formulas.Add("GroupOn1#N", 7)
                    ReportParameters.rptCaption = "Sales Return Register - Summary(Saleperson Wise)"
                Else
                    Formulas.Add("GroupOn1#N", 7)
                    Formulas.Add("DateGrp#N", 0)
                    Formulas.Add("DisplayDetails#N", 1)
                    ReportParameters.rptCaption = "Sales Return Register - Details(Saleperson Wise)"
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRtnRegisterBillDetail.rpt"
                    ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions & LocFilter & PartyFltr
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterBillSum.rpt"
                    ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & LocFilter & OthOptions & PartyFltr
                End If
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.SalesRtnRegister_ProdSalepersonWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn")

                PartyFltr = ""
                PartyFltr = GetSelectedAttributes(cmbOperator, "vw_SaleWithRtn.Saleperson_Key")
                If PartyFltr.Trim.Length > 0 Then
                    PartyFltr = " And " & PartyFltr
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterProdDetail.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterProdSum.rpt"
                End If

                OthOptions &= " And {vw_SaleWithRtn.Doc_Type} = 'SR'"

                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & OthOptions & LocFilter

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    If rptType = ReportType.SalesRtnRegister_SubGroupWise Then
                        Formulas.Add("GroupOn3#S", "U")
                    ElseIf rptType = ReportType.SalesRtnRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.SalesRtnRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Sales Return Detail"
                    Else
                        ReportParameters.rptCaption = "Sales Return Summary"
                    End If

                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


                ''ADDED BY RAHUL ON 11/02/2019
            Case ReportType.SalesRtnRegister_BrokerPartyWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SalesRtn")
                    FromToDt = GetFromToDateSeriesFilter("{SalesRtn.Doc_Dt}", "{SalesRtn.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SaleRtnRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Doc_Type}")
                End If

                'If rdSummary.Checked Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.DlvParty_Key}")
                'Else
                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesRtn.Broker_Key}")
                'End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If


                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Return Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\BorkerwiseSalesRtnRegPartyDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Sales Return Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\BrokerwiseSalesRtnRegParty.rpt"
                        ReportParameters.rptFilter = "{SalesRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else

                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 7)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\BrokerwiseSalesRtnRegParty.rpt"
                        ReportParameters.rptFilter = "{SalesRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Return Register - Summary (Broker Party Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\BorkerwiseSalesRtnRegPartyDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Return Register - Detail (Broker Party Wise)"
                    End If

                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                ''END


            Case ReportType.SalesRegister_SalepersonWise
                LocFilter = ""

                LocFilter = GetSelectedAttributes(cmbOperator, "SalesPerson.Led_Key")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("Vw_SaleRtnRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Bill_Sr}")
                    Formulas.Add("DisplayDetails#N", 0)
                    If Not chkSize.Checked Then
                        OthOptions &= " And {Vw_SaleRtnRpt.Doc_Type} <> 'SR'"
                    End If

                    ReportParameters.rptCaption = "Sales Register - Summary(Saleperson Wise)"
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterBillSum.rpt"
                    ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & LocFilter & OthOptions
                Else
                    PartyFltr = GetPartyFilter("Vw_SaleRtnRpt") 'GetPartyFilter("Bill", True)
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Bill_Sr}")

                    If Not chkSize.Checked Then
                        OthOptions &= " And {Vw_SaleRtnRpt.Doc_Type} <> 'SR'"
                    End If
                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1
                    End If
                    ReportParameters.rptCaption = "Sales Register - Details(Saleperson Wise)"
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterBillDetail.rpt"
                    ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions & LocFilter

                End If

                Formulas.Add("GroupOn1#N", 7)
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            Case ReportType.CounterWiseProductSold
                FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Bill_Sr}")

                If Not chkSize.Checked Then
                    OthOptions &= " And {Vw_SaleRtnRpt.Doc_Type} <> 'SR'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\CounterSales.rpt"
                ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelUserCtr & OthOptions
                ReportParameters.rptCaption = GetSystemCaption(SystemCaptionIdx.DefProduct) & " Sold/Counter"

                Formulas.Add("GroupOn1#N", 2)
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.TopSoldItems
                If rdAgeQty.Checked Then
                    ReportParameters.rptCaption = "Top N " & GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct) & " (By Quantity)"
                    ReportParameters.rptFile = ReportPath & "\Reports\TopNSales.rpt"
                    Formulas.Add("QtyValue#S", "Q")

                ElseIf rdAgeValue.Checked Then
                    ReportParameters.rptCaption = "Top N " & GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct) & " (By Value)"
                    ReportParameters.rptFile = ReportPath & "\Reports\TopNSales.rpt"
                    Formulas.Add("QtyValue#S", "V")
                End If

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                'Formulas.Add("TopNVal#N", txtStkFrom.EditValue)

                'If Not chkSize.Checked Then
                '    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                'End If

                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions

                For i = 0 To lstDetails.Items.Count - 1
                    Param = GetFieldParameter(lstDetails.Items(i))

                    If i = 0 Then
                        Formulas.Add("Text1#S", Param)
                    ElseIf i = 1 Then
                        Formulas.Add("Text2#S", Param)
                    ElseIf i = 2 Then
                        Formulas.Add("Text3#S", Param)
                    End If
                Next i

                For i = 0 To lstDetails.Items.Count - 1
                    Param = lstDetails.Items(i)

                    If i = 0 Then
                        Formulas.Add("FirstHeader#S", Param)
                    ElseIf i = 1 Then
                        Formulas.Add("SecondHeader#S", Param)
                    ElseIf i = 2 Then
                        Formulas.Add("ThirdHeader#S", Param)
                    End If
                Next i

                Formulas.Add("DispQty#N", IIf(rdAgeQty.Checked, 1, 0))
                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                'Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)

                'ViewReportWithOptions("Top Sold Items")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("DocType#S", "S")

            Case ReportType.TopCustomersNotVisitedThisMonth
                OthOptions &= " And {vw_SaleWithRtn.Doc_Type} = 'SI'"
                ReportParameters.rptCaption = Me.Text '"Top Customers Not Visited This Month"
                ReportParameters.rptFile = ReportPath & "\Reports\TopCustNotVisitThisMth.rpt"

                If rdA.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'B'"
                End If
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "' And Month({vw_SaleWithRtn.Doc_Dt}) <> " & Now.Month & OthOptions & Series

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.ProductsSoldPerHour
                ReportParameters.rptCaption = Me.Text
                ReportParameters.rptFile = ReportPath & "\Reports\ProductsSoldPerHour.rpt"

                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                OthOptions &= " And {vw_SaleWithRtn.Doc_Type} = 'SI'"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                Formulas.Add("Header2#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.BusyDays
                If rdAgeQty.Checked Then
                    Formulas.Add("DayOrMonth#S", "D")
                ElseIf rdAgeValue.Checked Then
                    Formulas.Add("DayOrMonth#S", "M")
                End If

                ReportParameters.rptCaption = "Busy Days"
                ReportParameters.rptFile = ReportPath & "\Reports\BusyDays.rpt"

                If rdAgeQty.Checked Then
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Bill_Sr}")
                Else
                    If rdA.Checked Then
                        Series = " And {Vw_SaleRtnRpt.Bill_Sr} = 'A'"
                    ElseIf rdB.Checked Then
                        Series = " And {Vw_SaleRtnRpt.Bill_Sr} = 'B'"
                    End If
                End If
                OthOptions &= " And {Vw_SaleRtnRpt.Doc_Type} = 'SI'"

                ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.BusyHours
                ReportParameters.rptCaption = "Busy Hours"
                ReportParameters.rptFile = ReportPath & "\Reports\BusyHours.rpt"

                FromToDt = GetFromToDateSeriesFilter("{Vw_SaleRtnRpt.Doc_Dt}", "{Vw_SaleRtnRpt.Bill_Sr}")
                OthOptions &= " And {Vw_SaleRtnRpt.Doc_Type} = 'SI'"

                ReportParameters.rptFilter = "{Vw_SaleRtnRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.BottomSoldItems
                If rdAgeQty.Checked Then
                    ReportParameters.rptCaption = "Bottom N " & GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct) & " (By Quantity)"
                    Formulas.Add("QtyValue#S", "Q")

                ElseIf rdAgeValue.Checked Then
                    ReportParameters.rptCaption = "Bottom N " & GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct) & " (By Value)"
                    Formulas.Add("QtyValue#S", "V")
                End If

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\BottomN.rpt"
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions

                For i = 0 To lstDetails.Items.Count - 1
                    Param = GetFieldParameter(lstDetails.Items(i))

                    If i = 0 Then
                        Formulas.Add("Text1#S", Param)
                    ElseIf i = 1 Then
                        Formulas.Add("Text2#S", Param)
                    ElseIf i = 2 Then
                        Formulas.Add("Text3#S", Param)
                    End If
                Next i

                For i = 0 To lstDetails.Items.Count - 1
                    Param = lstDetails.Items(i)

                    If i = 0 Then
                        Formulas.Add("FirstHeader#S", Param)
                    ElseIf i = 1 Then
                        Formulas.Add("SecondHeader#S", Param)
                    ElseIf i = 2 Then
                        Formulas.Add("ThirdHeader#S", Param)
                    End If
                Next i

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("DocType#S", "S")

            Case ReportType.TopNCustomers
                If rdAgeQty.Checked Then
                    ReportParameters.rptCaption = "Top N Customers (By Quantity)"
                    Formulas.Add("QtyValue#S", "Q")
                Else
                    ReportParameters.rptCaption = "Top N Customers (By Value)"
                    Formulas.Add("QtyValue#S", "V")
                End If

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                ReportParameters.rptFile = ReportPath & "\Reports\TopNSales.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                Formulas.Add("Text1#S", "R")
                Formulas.Add("FirstHeader#S", "Customer")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("DocType#S", "S")
                Formulas.Add("DispQty#N", IIf(rdAgeQty.Checked, 1, 0))
                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))

            Case ReportType.TopNBills
                If rdAgeQty.Checked Then
                    ReportParameters.rptCaption = "Top N Bills (By Quantity)"
                    Formulas.Add("QtyValue#S", "Q")
                Else
                    ReportParameters.rptCaption = "Top N Bills (By Value)"
                    Formulas.Add("QtyValue#S", "V")
                End If


                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                ReportParameters.rptFile = ReportPath & "\Reports\TopNSales.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                Formulas.Add("Text1#S", "N")
                Formulas.Add("FirstHeader#S", "Bill No")
                Formulas.Add("ReportCaption#S", Me.Text)

            Case ReportType.MonthlySales
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)

                Series = ""

                If rdA.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'B'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\MonthlySales.rpt"

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "' And Month({vw_SaleWithRtn.Doc_Dt}) In " & SelectedMonth() & OthOptions & StockFltr & PartyFltr & LocFilter & Series
                If lstOption1.Items.Count > 0 Then
                    Param = GetFieldParameter(lstOption1.Items(0))
                End If
                Formulas.Add("GroupOn1#S", Param)
                Formulas.Add("Header1#S", lstOption1.Items(0))

                ReportParameters.rptCaption = "Monthly Sales - " & lstOption1.Items(0)
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)


            Case ReportType.MonthlySalesDate
                'FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                Series = ""

                If rdA.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'B'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\MonthlySalesDate.rpt"
                'ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions & PartyFltr & StockFltr & LocFilter
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "' And Month({vw_SaleWithRtn.Doc_Dt}) In " & SelectedMonth() & OthOptions & PartyFltr & StockFltr & LocFilter & Series
                ReportParameters.rptCaption = "Monthly Sales - Date Wise"

                If lstOption1.Items.Count > 0 Then
                    Param = GetFieldParameter(lstOption1.Items(0))
                End If
                Formulas.Add("GroupOn1#S", Param)
                Formulas.Add("Header1#S", lstOption1.Items(0))

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.MonthlySalesRtn
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)
                ReportParameters.rptFile = ReportPath & "\Reports\MonthlySales.rpt"

                OthOptions &= " And {vw_SaleWithRtn.Doc_Type} = 'SR'"

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                Series = ""

                If rdA.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'B'"
                End If

                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "' And Month({vw_SaleWithRtn.Doc_Dt}) In " & SelectedMonth() & OthOptions & StockFltr & LocFilter & PartyFltr & Series
                If lstOption1.Items.Count > 0 Then
                    Param = GetFieldParameter(lstOption1.Items(0))
                End If
                Formulas.Add("GroupOn1#S", Param)
                Formulas.Add("Header1#S", lstOption1.Items(0))
                Formulas.Add("RtnFlag#N", 1)

                ReportParameters.rptCaption = "Monthly Sales Return - " & lstOption1.Items(0)
                Formulas.Add("ReportCaption#S", Me.Text)

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)

            Case ReportType.MonthlySalesRtnDate
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn", True)

                OthOptions &= " And {vw_SaleWithRtn.Doc_Type} = 'SR'"

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                Series = ""

                If rdA.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'B'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\MonthlySalesDate.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "' And Month({vw_SaleWithRtn.Doc_Dt}) In " & SelectedMonth() & OthOptions & StockFltr & LocFilter & PartyFltr & Series
                ReportParameters.rptCaption = "Monthly Sales Return - Date Wise"

                If lstOption1.Items.Count > 0 Then
                    Param = GetFieldParameter(lstOption1.Items(0))
                End If
                Formulas.Add("GroupOn1#S", Param)
                Formulas.Add("Header1#S", lstOption1.Items(0))
                Formulas.Add("RtnFlag#N", 1)

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.MonthlySalesSaleperson
                LocFilter = GetSelectedAttributes(cmbTax, "vw_SaleWithRtn.Saleperson_Key")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                Series = ""

                If rdA.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'B'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\MonthlySales.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "' And Month({vw_SaleWithRtn.Doc_Dt}) In " & SelectedMonth() & OthOptions & LocFilter & Series
                ReportParameters.rptCaption = "Monthly Sales - Saleperson" ' & lstOption1.Items(0)

                'If lstOption1.Items.Count > 0 Then
                '    Param = GetFieldParameter(lstOption1.Items(0))
                'End If
                Formulas.Add("GroupOn1#S", "N")
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
                Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
                Formulas.Add("ChartCaption#S", ReportParameters.rptCaption)
                Formulas.Add("Header1#S", "Salesperson")

                'FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")

                'LocFilter = GetSelectedAttributes(cmbOperator, "vw_SaleWithRtn.Saleperson_Key")
                'If LocFilter.Trim.Length > 0 Then
                '    LocFilter = " And " & LocFilter
                'End If

                'If Not chkSize.Checked Then
                '    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                'End If

                'ReportParameters.rptFile = ReportPath & "\Reports\MonthlySalesDate.rpt"
                'ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions & LocFilter
                'ReportParameters.rptCaption = "Monthly Sales - Saleperson Wise"

                'Formulas.Add("GroupOn1#S", "N")
                'Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.Profitability, ReportType.MarginSummary_SubGroupWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn")

                If rptType = ReportType.MarginSummary_SubGroupWise Or rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\ProfitabilitySum.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\ProfitabilityDetail.rpt"
                End If

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_SaleWithRtn.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & OthOptions & LocFilter

                If rdDetailed.Checked Then
                    ReportParameters.rptCaption = "Profitability Detail"
                Else
                    ReportParameters.rptCaption = "Profitability Summary"
                End If

                ReportParameters.TotalText = True
                ViewReportWithOptions(ReportParameters.rptCaption, IIf(lstDetails.Items.Count > 0, True, False))

            Case ReportType.MarginSummary_DateWise
                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")

                If Not chkSize.Checked Then
                    OthOptions &= " And {vw_SaleWithRtn.Doc_Type} <> 'SR'"
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\MarginSummaryDate.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & OthOptions
                ReportParameters.rptCaption = Me.Text

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.CancelledBills_DateWise
                'PartyFltr = GetPartyFilter("Bill", True)
                FromToDt = GetFromToDateSeriesFilter("{Bill.Doc_Dt}", "{Bill.Bill_Sr}")
                OthOptions &= " And {Bill.Doc_Type} <> 'SR'"

                'Formulas.Add("DisplayDetails#N", 1)
                'Formulas.Add("GroupOn1#N", 5)

                PartyFltr = GetPartyFilter("Bill", True)

                ReportParameters.rptFile = ReportPath & "\Reports\SalesBillCancel.rpt"
                ReportParameters.rptFilter = "{Bill.CoBr_Id} = '" & SelBranchId & "' And {Bill.Status} = '0'" & FromToDt & PartyFltr & OthOptions
                ReportParameters.rptCaption = "Cancelled Sales Bill"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


                '''saurabh 
            Case ReportType.ReverseMechanism1

                Dim Formulas As Hashtable
                Dim partyfl As String = ""
                Dim party1 As String = ""
                Dim stateloc As String = ""
                Dim stationloc As String = ""
                Dim stateloc1 As String = ""
                Dim stationloc1 As String = ""


                party1 = GetSelectedAttributesForStock(cmbParty, "{ledger.Led_Key}")
                If party1.Trim.Length > 0 Then
                    party1 = " And " & party1
                End If

                stateloc = GetSelectedAttributesForStock(cmbState, "{state.state_Key}")
                If stateloc.Trim.Length > 0 Then
                    stateloc = " And " & stateloc
                End If

                stationloc = GetSelectedAttributesForStock(cmbStation, "{city.stn_Key}")
                If stationloc.Trim.Length > 0 Then
                    stationloc = " And " & stationloc
                End If



                FromToDt = GetFromToDateSeriesFilter("{Purchasebill.Doc_Dt}", "", , False)

                PartyFltr = GetPartyFilter("Ledger", True)
                'FromToDate = GetFromToDateSeriesFilter("{Purchasebill.Doc_Dt}", "", , False)
                ReportParameters.rptFile = ReportPath & "\Reports\RCM.rpt"
                ReportParameters.rptFilter = "{party.revcm} = '1' and {COBR.Cobr_id} ='" & SelBranchId & "' and {Purchasebill.Net_Amt} > 750 " & FromToDt '& party1 & stateloc & stationloc

                ReportParameters.rptCaption = "Reverse Mechanism"
                'Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                ''''
                ''Purchase Rtn If rptType = ReportType.MRN Then
            Case ReportType.MRN

                Dim Formulas As Hashtable
                

                Dim MRNNO As String = ""
                If cmbMRN.Text <> "" Then
                    MRNNO = " And {MRN.Doc_Id} = " & Val(cmbMRN.Value) & ""
                End If


                Dim OCNO As String = ""
                If cmbOCNO.Text <> "" Then
                    OCNO = " And {SalesOrder.Doc_Id} = " & Val(cmbOCNO.Value) & ""
                End If

                Dim SampleCreation As String = ""
                If cmbCreationNo.Text <> "" Then
                    SampleCreation = " And {SampleCreation.SampleCreation_ID } = " & Val(cmbCreationNo.Value) & ""
                End If

                Dim FromDept As String = ""
                If cmbFromDept.Text <> "" Then
                    FromDept = " And {FromDept.Dept_Key } = '" & cmbFromDept.Value & "'"
                End If

                FromToDt = GetFromToDateSeriesFilter("{MRN.Doc_Dt}", "", , False)

                
                ReportParameters.rptFile = ReportPath & "\Reports\mrnlistingfordepartment.rpt"
                ReportParameters.rptFilter = " {MRN.Cobr_id} ='" & SelBranchId & "'  " & FromToDt & MRNNO & OCNO & SampleCreation & FromDept

            Case ReportType.MIN

                Dim Formulas As Hashtable

                Dim MINNO As String = ""
                If cmbMIN.Text <> "" Then
                    MINNO = " And {MIN.Doc_Id} = " & Val(cmbMIN.Value) & ""
                End If

                Dim MRNNO As String = ""
                If cmbMRN.Text <> "" Then
                    MRNNO = " And {MRN.Doc_Id} = " & Val(cmbMRN.Value) & ""
                End If


                Dim OCNO As String = ""
                If cmbOCNO.Text <> "" Then
                    OCNO = " And {SalesOrder.Doc_Id} = " & Val(cmbOCNO.Value) & ""
                End If

                Dim SampleCreation As String = ""
                If cmbCreationNo.Text <> "" Then
                    SampleCreation = " And {SampleCreation.SampleCreation_ID } = " & Val(cmbCreationNo.Value) & ""
                End If

                Dim FromDept As String = ""
                If cmbFromDept.Text <> "" Then
                    FromDept = " And {FromDept.Dept_Key } = '" & cmbFromDept.Value & "'"
                End If

                FromToDt = GetFromToDateSeriesFilter("{MIN.Doc_Dt}", "", , False)


                ReportParameters.rptFile = ReportPath & "\Reports\minlistingfordepartment.rpt"
                ReportParameters.rptFilter = " {MIN.Cobr_id} ='" & SelBranchId & "'  " & FromToDt & MRNNO & OCNO & SampleCreation & FromDept & MINNO


            Case ReportType.MRT

                Dim Formulas As Hashtable

                Dim MRTNO As String = ""
                If cmbMIN.Text <> "" Then
                    MRTNO = " And {MRT.Doc_Id} = " & Val(cmbMIN.Value) & ""
                End If

                Dim MINNO As String = ""
                If cmbMRN.Text <> "" Then
                    MINNO = " And {MIN.Doc_Id} = " & Val(cmbMRN.Value) & ""
                End If


                Dim OCNO As String = ""
                If cmbOCNO.Text <> "" Then
                    OCNO = " And {SalesOrder.Doc_Id} = " & Val(cmbOCNO.Value) & ""
                End If

                Dim SampleCreation As String = ""
                If cmbCreationNo.Text <> "" Then
                    SampleCreation = " And {SampleCreation.SampleCreation_ID } = " & Val(cmbCreationNo.Value) & ""
                End If

                Dim FromDept As String = ""
                If cmbFromDept.Text <> "" Then
                    FromDept = " And {FromDept.Dept_Key } = '" & cmbFromDept.Value & "'"
                End If

                FromToDt = GetFromToDateSeriesFilter("{MRT.Doc_Dt}", "", , False)


                ReportParameters.rptFile = ReportPath & "\Reports\mrtlistingfordepartment.rpt"
                ReportParameters.rptFilter = " {MRT.Cobr_id} ='" & SelBranchId & "'  " & FromToDt & MRTNO & OCNO & SampleCreation & FromDept & MINNO

            Case ReportType.PurRtnRegister_OperatorWise, ReportType.PurRtnRegister_CounterWise, ReportType.PurRtnRegister_SupplierWise, ReportType.PurRtnRegister_LocationWise, ReportType.PurRtnRegister_DateWise, ReportType.PurRtnRegister_BillWise
                LocFilter = ""

                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim strPOFilter1 As String = ""
                If cmbOrderNo.SelectedIndex <> -1 Then
                    strPOFilter1 = " And {vw_PurchaseWithRtn.POID} = " & Val(cmbOrderNo.Value) & ""
                End If

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("vw_PurchaseWithRtnSum")
                    FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtnSum.Doc_Dt}", "{vw_PurchaseWithRtnSum.Bill_Sr}")
                Else
                    PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")
                    FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Operator" Then
                        Formulas.Add("GroupOn1#N", 1)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Operator"
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(Operator Wise)"

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{vw_purchasewithrtnsum.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(Operator Wise)"

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{vw_purchasewithrtn.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Counter" Then
                        Formulas.Add("GroupOn1#N", 2)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Counter"
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(Counter Wise)"

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{vw_purchasewithrtnsum.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(Counter Wise)"

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{vw_purchasewithrtn.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Supplier" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Supplier"
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(Supplier Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(Supplier Wise)"
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")

                        If rdDetailed.Checked Then
                            Formulas.Item("HeaderText#S") = GetSystemCaption(SystemCaptionIdx.DefLocation)
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtn.Loc_Key}")
                        Else
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtnSum.Loc_Key}")
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If

                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Date"
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(Date Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(Date Wise)"
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)

                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(Bill Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(Bill Wise)"
                        End If
                    End If

                    If rdDetailed.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                        End If

                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Item("HeaderText#S") = GetSystemCaption(SystemCaptionIdx.DefProduct)
                        ReportParameters.rptFile = ReportPath & "\Reports\PurRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Type} = 'R' And {vw_PurchaseWithRtn.Opening} = '0'" & FromToDt & PartyFltr & StockFltr & SelUserCtr & TaxFilter & OthOptions & LocFilter & POTypeFltr
                    Else
                        If IsFabric Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'S'"
                        End If

                        ReportParameters.rptFile = ReportPath & "\Reports\PurRegDoc.rpt"
                        ReportParameters.rptFilter = "{vw_PurchaseWithRtnSum.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtnSum.Type} = 'R' And {vw_PurchaseWithRtnSum.Opening} = '0'" & FromToDt & PartyFltr & SelUserCtr & LocFilter & OthOptions & POTypeFltr
                    End If
                Else
                    If rptType = ReportType.PurRtnRegister_OperatorWise Then
                        Formulas.Add("GroupOn1#N", 1)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Operator"
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(Operator Wise)"

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{vw_purchasewithrtnsum.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(Operator Wise)"

                            SelUserCtr = GetSelectedAttributesForUsers(cmbOperator, "{vw_purchasewithrtn.Created_By}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        End If

                    ElseIf rptType = ReportType.PurRtnRegister_CounterWise Then
                        Formulas.Add("GroupOn1#N", 2)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Counter"
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(Counter Wise)"

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{vw_purchasewithrtnsum.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(Counter Wise)"

                            SelUserCtr = GetSelectedAttributesForStock(cmbOperator, "{vw_purchasewithrtn.Ctr_Key}")
                            If SelUserCtr.Trim.Length > 0 Then
                                SelUserCtr = " And " & SelUserCtr
                            End If
                        End If

                    ElseIf rptType = ReportType.PurRtnRegister_SupplierWise Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Supplier"
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(Supplier Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(Supplier Wise)"
                        End If

                    ElseIf rptType = ReportType.PurRtnRegister_LocationWise Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Item("ItemFooterCaption#S") = GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total"

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = GetSystemCaption(SystemCaptionIdx.DefLocation)
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                        End If

                        If rdDetailed.Checked Then
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtn.Loc_Key}")
                        Else
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtnSum.Loc_Key}")
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If

                    ElseIf rptType = ReportType.PurRtnRegister_DateWise Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        If rdSummary.Checked Then
                            Formulas.Item("HeaderText#S") = "Date"
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(Date Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(Date Wise)"
                        End If

                    ElseIf rptType = ReportType.PurRtnRegister_BillWise Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)

                        If cmbSONo.SelectedIndex <> -1 Then
                            strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                        End If
                        If rdSummary.Checked Then
                            ReportParameters.rptCaption = "Purchase Return Register - Summary(Bill Wise)"
                        Else
                            ReportParameters.rptCaption = "Purchase Return Register - Details(Bill Wise)"
                        End If
                    End If

                    If rdSummary.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {vw_PurchaseWithRtnSum.Pur_Type} = 'S'"
                        End If

                        ReportParameters.rptFile = ReportPath & "\Reports\PurRegDoc.rpt"
                        ReportParameters.rptFilter = "{vw_PurchaseWithRtnSum.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtnSum.Type} = 'R' And {vw_PurchaseWithRtnSum.Opening} = '0'" & FromToDt & PartyFltr & SelUserCtr & OthOptions & LocFilter & POTypeFltr & strSOFilter1

                    Else
                        If IsFabric Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                        End If

                        StockFltr = GetStockFilter("vw_PurchaseWithRtn")
                        PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")
                        TaxFilter = GetTaxFilter("vw_PurchaseWithRtn")

                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Item("HeaderText#S") = GetSystemCaption(SystemCaptionIdx.DefProduct)
                        ReportParameters.rptFile = ReportPath & "\Reports\PurRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Type} = 'R' And {vw_PurchaseWithRtn.Opening} = '0'" & FromToDt & PartyFltr & StockFltr & SelUserCtr & TaxFilter & OthOptions & LocFilter & POTypeFltr & strSOFilter1 & strPOFilter1
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.PurRtnRegister_SubGroupWise, ReportType.PurRtnRegister_ProductWise, ReportType.PurRtnRegister_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchaseWithRtn.Doc_Dt}", "{vw_PurchaseWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_PurchaseWithRtn")
                PartyFltr = GetPartyFilter("vw_PurchaseWithRtn")

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PurRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PurRegProdSum.rpt"
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_PurchaseWithRtn.Loc_Key}")

                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                If IsFabric Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {vw_PurchaseWithRtn.Pur_Type} = 'S'"
                End If

                ReportParameters.rptFilter = "{vw_PurchaseWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_PurchaseWithRtn.Type} = 'R' And {vw_PurchaseWithRtn.Opening} = '0'" & FromToDt & PartyFltr & StockFltr & LocFilter & POTypeFltr

                'Formulas = New Hashtable
                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")

                    If rptType = ReportType.PurRtnRegister_SubGroupWise Then
                        Formulas.Add("GroupOn3#S", "U")
                    ElseIf rptType = ReportType.PurRtnRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.PurRtnRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Purchase Return Detail"
                    Else
                        ReportParameters.rptCaption = "Purchase Return Summary"
                    End If

                    ReportParameters.DisplayDetails = False
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If

            Case ReportType.StockTransfer_DateWise
                FromToDt = " And {StockTfr.Doc_Dt} >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And {StockTfr.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"

                Formulas.Add("GroupOn1#N", 0)
                Formulas.Add("DateGrp#N", 1)
                Formulas.Add("DisplayDetails#N", 0)

                ReportParameters.rptCaption = "Stock Transfer Register - Date Wise"
                ReportParameters.rptFile = ReportPath & "\Reports\StockTfrRegDoc.rpt"
                ReportParameters.rptFilter = "{StockTfr.CoBr_Id} = '" & SelBranchId & "'" & FromToDt '& PartyFltr & LocFilter

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.StockTransfer_DocWise
                FromToDt = " And {StockTfr.Doc_Dt} >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And {StockTfr.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"

                Formulas.Add("GroupOn1#N", 0)
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", 1)

                ReportParameters.rptCaption = "Stock Transfer Register - Document Wise"
                ReportParameters.rptFile = ReportPath & "\Reports\StockTfrRegDoc.rpt"
                ReportParameters.rptFilter = "{StockTfr.CoBr_Id} = '" & SelBranchId & "'" & FromToDt

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.StockTransfer_SalepersonWise
                FromToDt = " And {StockTfr.Doc_Dt} >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And {StockTfr.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"

                Formulas.Add("GroupOn1#N", 1)
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("DisplayDetails#N", 0)

                ReportParameters.rptCaption = "Stock Transfer Register - Salesperson Wise"
                ReportParameters.rptFile = ReportPath & "\Reports\StockTfrRegDoc.rpt"
                ReportParameters.rptFilter = "{StockTfr.CoBr_Id} = '" & SelBranchId & "'" & FromToDt

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.StockTransfer_TfrOut
                FromToDt = " And {StockTfr.Doc_Dt} >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And {StockTfr.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"
                StockFltr = GetStockFilter("StockTfr", True)
                SelUsers = GetSelectedAttributesForStock(cmbLocation, "{StockTfr.ToLoc_Key}")
                If SelUsers.Trim.Length > 0 Then
                    SelUserCtr &= " And " & SelUsers
                End If

                Formulas.Add("GroupOn1#N", "'F'")
                Formulas.Add("LocType#N", "'F'")

                ReportParameters.rptCaption = "Transfer Out Register - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"
                ReportParameters.rptFile = ReportPath & "\Reports\StockTfrRegDocDtl.rpt"
                ReportParameters.rptFilter = "{StockTfr.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelUserCtr & StockFltr

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.StockTransfer_TfrIn
                FromToDt = " And {StockTfr.Doc_Dt} >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And {StockTfr.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"
                StockFltr = GetStockFilter("StockTfr", True)
                SelUsers = GetSelectedAttributesForStock(cmbLocation, "{StockTfr.ToLoc_Key}")
                If SelUsers.Trim.Length > 0 Then
                    SelUserCtr &= " And " & SelUsers
                End If

                Formulas.Add("GroupOn1#N", "'T'")
                Formulas.Add("LocType#N", "'T'")

                ReportParameters.rptCaption = "Transfer In Register - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"
                ReportParameters.rptFile = ReportPath & "\Reports\StockTfrRegDocDtl.rpt"
                ReportParameters.rptFilter = "{StockTfr.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & SelUserCtr & StockFltr

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.StockTransfer_TfrOutSalesperson
                FromToDt = " And {StockTfr.Doc_Dt} >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And {StockTfr.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"
                StockFltr = GetStockFilter("StockTfr", True)
                SelCounter = GetSelectedAttributesForStock(cmbLocation, "{StockTfr.ToLoc_Key}")
                If SelUsers.Trim.Length > 0 Then
                    SelUserCtr &= " And " & SelUsers
                End If

                Formulas.Add("GroupOn1#N", "'F'")
                Formulas.Add("LocType#N", "'F'")
                Formulas.Add("Salesperson#N", 1)

                ReportParameters.rptCaption = "Transfer Out Register - Salesperson Wise"
                ReportParameters.rptFile = ReportPath & "\Reports\StockTfrRegDocDtl.rpt"
                ReportParameters.rptFilter = "{StockTfr.CoBr_Id} = '" & SelBranchId & "'" & FromToDt

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.StockTransfer_TfrInSalesperson
                FromToDt = " And {StockTfr.Doc_Dt} >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And {StockTfr.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"

                Formulas.Add("GroupOn1#N", "'T'")
                Formulas.Add("LocType#N", "'T'")
                Formulas.Add("Salesperson#N", 1)

                ReportParameters.rptCaption = "Transfer In Register - Salesperson Wise"
                ReportParameters.rptFile = ReportPath & "\Reports\StockTfrRegDocDtl.rpt"
                ReportParameters.rptFilter = "{StockTfr.CoBr_Id} = '" & SelBranchId & "'" & FromToDt

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.PurOrderRegister_DateWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("PurOrder")
                    FromToDt = GetFromToDateSeriesFilter("{PurOrder.Doc_Dt}", "{PurOrder.Bill_Sr}")
                Else
                    PartyFltr = GetPartyFilter("Vw_PurOrderRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_PurOrderRpt.Doc_Dt}", "{Vw_PurOrderRpt.Bill_Sr}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Supplier" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        If rdDetailed.Checked Then
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_PurOrderRpt.Loc_Key}")
                        Else
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{PurOrder.Loc_Key}")
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If
                    End If

                    If rdDetailed.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {Purchase.Pur_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {Purchase.Pur_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {Purchase.Pur_Type} = 'S'"
                        End If
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))

                        ReportParameters.rptCaption = "PO Register - Details (" & lstMain.Text & ")"

                        If IsFabric = True Then
                            Formulas.Add("ProdHeader#S", "Product/Design/Shade")
                            ReportParameters.rptFile = ReportPath & "\Reports\FabricPurOrderRegDocDtl.rpt"
                        Else
                            Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                            ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        End If

                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} <> '0'" & FromToDt & PartyFltr & LocFilter & POTypeFltr
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Item("ReportCaption#S") = "PO Register - Detail (" & lstMain.Text & ")"
                    Else
                        If IsFabric Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'S'"
                        End If

                        ReportParameters.rptCaption = "PO Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{PurOrder.CoBr_Id} = '" & SelBranchId & "' And {PurOrder.Status} <> '0'" & FromToDt & PartyFltr & LocFilter & POTypeFltr
                        'Formulas.Item("ReportCaption#S") = "PO Register - Summary (" & lstMain.Text & ")"
                    End If
                Else
                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", 1)

                    If rdSummary.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'S'"
                        End If

                        ReportParameters.rptCaption = "PO Register - Summary (Date Wise)"
                        ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{PurOrder.CoBr_Id} = '" & SelBranchId & "' And {PurOrder.Status} <> '0'" & FromToDt & PartyFltr & POTypeFltr

                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    Else
                        If IsFabric Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                        End If
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        ' Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        If IsFabric = True Then
                            Formulas.Add("ProdHeader#S", "Product/Design/Shade")
                            ReportParameters.rptFile = ReportPath & "\Reports\FabricPurOrderRegDocDtl.rpt"
                        Else
                            Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                            ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        End If

                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} <> '0'" & FromToDt & PartyFltr & POTypeFltr
                        ReportParameters.rptCaption = "PO Register - Detail (Date Wise)"

                        PartyFltr = GetPartyFilter("Vw_PurOrderRpt")
                        Formulas.Item("DisplayDetails#N") = 1
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


                ''finished pur order
                ''-----------------------------------------------------------------------------------
            Case ReportType.PurOrderRegister_BillWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("PurOrder")
                    FromToDt = GetFromToDateSeriesFilter("{PurOrder.Doc_Dt}", "{PurOrder.Bill_Sr}")
                Else
                    PartyFltr = GetPartyFilter("Vw_PurOrderRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_PurOrderRpt.Doc_Dt}", "{Vw_PurOrderRpt.Bill_Sr}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Supplier" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        If rdDetailed.Checked Then
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_PurOrderRpt.Loc_Key}")
                        Else
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{PurOrder.Loc_Key}")
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If
                    End If

                    If rdDetailed.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                        End If
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "PO Register - Detail (" & lstMain.Text & ")"

                        If IsFabric = True Then
                            Formulas.Add("ProdHeader#S", "Product/Design/Shade")
                            ReportParameters.rptFile = ReportPath & "\Reports\FabricPurOrderRegDocDtl.rpt"
                        Else
                            Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                            ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        End If
                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} <>'0'" & FromToDt & PartyFltr & LocFilter & POTypeFltr
                    Else
                        If IsFabric Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'S'"
                        End If

                        ReportParameters.rptCaption = "PO Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{PurOrder.CoBr_Id} = '" & SelBranchId & "' And {PurOrder.Status} <>'0'" & FromToDt & PartyFltr & LocFilter & POTypeFltr
                    End If
                Else
                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))

                    If rdSummary.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'S'"
                        End If

                        Formulas.Item("DisplayDetails#N") = 1 'IIf(chkDispRate.Checked, 1, 0)
                        ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{PurOrder.CoBr_Id} = '" & SelBranchId & "' And {PurOrder.Status} <>'0' " & FromToDt & PartyFltr & POTypeFltr
                        ReportParameters.rptCaption = "PO Register - Summary (Bill Wise)"
                    Else
                        If IsFabric Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                        End If
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        PartyFltr = GetPartyFilter("Vw_PurOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        'ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        If IsFabric = True Then
                            Formulas.Add("ProdHeader#S", "Product/Design/Shade")
                            ReportParameters.rptFile = ReportPath & "\Reports\FabricPurOrderRegDocDtl.rpt"
                        Else
                            Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                            ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        End If
                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} <>'0'" & FromToDt & PartyFltr & POTypeFltr
                        ReportParameters.rptCaption = "PO Register - Detail (Bill Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.PreShipmentAnalysis 'jyoti -18-02-2022
                'LocFilter = ""
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                'ReDim subrpt(2)

                'subrpt(0).Report = "rpt_OCPostSummExp.rpt - 01"
                'subrpt(0).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & strSOFilter1

                'subrpt(1).Report = "rpt_OCPostSummExp.rpt"
                'subrpt(1).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & strSOFilter1

                ReportParameters.rptFile = ReportPath & "\Reports\OCPreShipDetail.rpt"
                ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & strSOFilter1




            Case ReportType.PurOrderRegister_SupplierWise
                LocFilter = ""
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim strPOFilter1 As String = ""
                If cmbOrderNo.SelectedIndex <> -1 Then
                    strPOFilter1 = " And {Vw_PurOrderRpt.Doc_Id} = " & Val(cmbOrderNo.Value) & ""
                End If

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("PurOrder")
                    FromToDt = GetFromToDateSeriesFilter("{PurOrder.Doc_Dt}", "{PurOrder.Bill_Sr}")
                Else
                    PartyFltr = GetPartyFilter("Vw_PurOrderRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_PurOrderRpt.Doc_Dt}", "{Vw_PurOrderRpt.Bill_Sr}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Supplier" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        If rdDetailed.Checked Then
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_PurOrderRpt.Loc_Key}")
                        Else
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{PurOrder.Loc_Key}")
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If
                    End If

                    If rdDetailed.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                        End If
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "PO Register - Detail (" & lstMain.Text & ")"

                        If IsFabric = True Then
                            Formulas.Add("ProdHeader#S", "Product/Design/Shade")
                            ReportParameters.rptFile = ReportPath & "\Reports\FabricPurOrderRegDocDtl.rpt"
                        Else
                            Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                            ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        End If

                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & LocFilter & POTypeFltr
                    Else
                        If IsFabric Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'S'"
                        End If

                        ReportParameters.rptCaption = "PO Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{PurOrder.CoBr_Id} = '" & SelBranchId & "' And {PurOrder.Status} <>'0'" & FromToDt & PartyFltr & LocFilter & POTypeFltr
                    End If
                Else
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 3)

                    If rdSummary.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'S'"
                        End If

                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{PurOrder.CoBr_Id} = '" & SelBranchId & "' And {PurOrder.Status} <>'0' " & FromToDt & PartyFltr & POTypeFltr
                        ReportParameters.rptCaption = "PO Register - Summary (Supplier Wise)"
                    Else
                        If IsFabric Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                        End If
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        PartyFltr = GetPartyFilter("Vw_PurOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        'ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        If IsFabric = True Then
                            Formulas.Add("ProdHeader#S", "Product/Design/Shade")
                            ReportParameters.rptFile = ReportPath & "\Reports\FabricPurOrderRegDocDtl.rpt"
                        Else
                            Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                            ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        End If

                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} <>'0'" & FromToDt & PartyFltr & POTypeFltr & strPOFilter1 & strSOFilter1
                        ReportParameters.rptCaption = "PO Register - Detail (Supplier Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.PurOrderRegister_LocationWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("PurOrder")
                    FromToDt = GetFromToDateSeriesFilter("{PurOrder.Doc_Dt}", "{PurOrder.Bill_Sr}")
                Else
                    PartyFltr = GetPartyFilter("Vw_PurOrderRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_PurOrderRpt.Doc_Dt}", "{Vw_PurOrderRpt.Bill_Sr}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Supplier" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        If rdDetailed.Checked Then
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        Formulas.Add("GroupOn1#N", 4)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")
                        If rdDetailed.Checked Then
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        If rdDetailed.Checked Then
                            Formulas.Item("DisplayDetails#N") = 1
                        End If

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        If rdDetailed.Checked Then
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_PurOrderRpt.Loc_Key}")
                        Else
                            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{PurOrder.Loc_Key}")
                        End If

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If
                    End If

                    If rdDetailed.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                        End If

                        'Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "PO Register - Detail (" & lstMain.Text & ")"
                        'ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"

                        If IsFabric = True Then
                            Formulas.Add("ProdHeader#S", "Product/Design/Shade")
                            ReportParameters.rptFile = ReportPath & "\Reports\FabricPurOrderRegDocDtl.rpt"
                        Else
                            Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                            ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        End If

                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & LocFilter & POTypeFltr
                    Else
                        If IsFabric Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'S'"
                        End If

                        ReportParameters.rptCaption = "PO Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{PurOrder.CoBr_Id} = '" & SelBranchId & "' And {PurOrder.Status} <>'0'" & FromToDt & PartyFltr & LocFilter & POTypeFltr
                    End If
                Else
                    Formulas.Add("GroupOn1#N", 4)
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")

                    If rdDetailed.Checked Then
                        LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_PurOrderRpt.Loc_Key}")
                    Else
                        LocFilter = GetSelectedAttributesForStock(cmbLocation, "{PurOrder.Loc_Key}")
                    End If

                    If LocFilter.Trim.Length > 0 Then
                        LocFilter = " And " & LocFilter
                    End If

                    If rdSummary.Checked Then
                        If IsFabric Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {PurOrder.PO_Type} = 'S'"
                        End If

                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        'Formulas.Add("ItemFooterCaption#S", GetSystemCaption(SystemCaptionIdx.DefLocation) & " Total")

                        ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{PurOrder.CoBr_Id} = '" & SelBranchId & "' And {PurOrder.Status} <>'0'" & FromToDt & PartyFltr & LocFilter & POTypeFltr
                        ReportParameters.rptCaption = "PO Register - Summary (" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                    Else
                        If IsFabric Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                        End If

                        PartyFltr = GetPartyFilter("Vw_PurOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        'ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        If IsFabric = True Then
                            Formulas.Add("ProdHeader#S", "Product/Design/Shade")
                            ReportParameters.rptFile = ReportPath & "\Reports\FabricPurOrderRegDocDtl.rpt"
                        Else
                            Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                            ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        End If
                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} <>'0'" & FromToDt & PartyFltr & LocFilter & POTypeFltr
                        ReportParameters.rptCaption = "PO Register - Detail (" & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.PurOrderRegister_SubGroupWise, ReportType.PurOrderRegister_ProductWise, ReportType.PurOrderRegister_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_PurOrderRpt.Doc_Dt}", "{Vw_PurOrderRpt.Bill_Sr}")
                StockFltr = GetStockFilter("Vw_PurOrderRpt")
                PartyFltr = GetPartyFilter("Vw_PurOrderRpt")

                If IsFabric Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} <>'5' " & FromToDt & PartyFltr & StockFltr & POTypeFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    'Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    If rptType = ReportType.PurOrderRegister_SubGroupWise Then
                        Formulas.Add("GroupOn3#S", "U")
                    ElseIf rptType = ReportType.PurOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.PurOrderRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    If rdDetailed.Checked Then
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    End If

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", Me.Text)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Purchase Order Detail"
                    Else
                        ReportParameters.rptCaption = "Purchase Order Summary"
                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If
                ''-----------------------------------------------------------------------------------
                ''ankita 09052019
            Case ReportType.PurOrderRegisterAsPerPurchase_DateWise
                FromToDt = GetFromToDateSeriesFilter("{purorder.Doc_Dt}", "", , False)
                StockFltr = GetStockFilter("purorder", True)
                'PartyFltr = GetPartyFilter("purorder")
                If IsFabric Then
                    POTypeFltr = " And {purorder.PO_Type} = 'G'"
                End If
                If rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\POwisePurReg.rpt"
                End If
                ReportParameters.rptFilter = "{purorder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr & POTypeFltr

                ''end ankita 09052019

            Case ReportType.PendPurOrderRegister_DateWise, ReportType.PendPurOrderRegister_BillWise, ReportType.PendPurOrderRegister_SupplierWise
                LocFilter = ""
                PartyFltr = GetPartyFilter("Vw_PurOrderRpt")
                FromToDt = GetFromToDateSeriesFilter("{Vw_PurOrderRpt.Doc_Dt}", "{Vw_PurOrderRpt.Bill_Sr}")
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                Dim strPOFilter1 As String = ""
                If cmbOrderNo.SelectedIndex <> -1 Then
                    strPOFilter1 = " And {Vw_PurOrderRpt.Doc_Id} = " & Val(cmbOrderNo.Value) & ""
                End If
                OthOptions = "" ''All  Vw_PurOrderRpt
                If rdOthOption1.Checked Then
                    OthOptions = " And {Vw_PurOrderRpt.BalQty} > 0" ''Pending
                ElseIf rdOthOption2.Checked Then
                    OthOptions = " And {Vw_PurOrderRpt.BalQty} = 0" ''Completed
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Supplier" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        'ElseIf lstMain.Items(lstMain.SelectedIndex) = "Location" Then
                        '    Formulas.Add("GroupOn1#N", 4)
                        '    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        '    Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 2)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    End If

                    If lstMain.Items(lstMain.SelectedIndex) = GetSystemCaption(SystemCaptionIdx.DefLocation) Then
                        LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Vw_PurOrderRpt.Loc_Key}")

                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If
                    End If

                    If IsFabric Then
                        POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                    ElseIf IsFinished Then
                        POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                    ElseIf IsStores Then
                        POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))

                        ReportParameters.rptCaption = "PO Status Register - Detail"

                        If IsFabric = True Then
                            Formulas.Add("ProdHeader#S", "Product/Design/Shade")
                            ReportParameters.rptFile = ReportPath & "\Reports\PendFabricPurOrderRegDocDtl.rpt"
                        Else
                            Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                            ReportParameters.rptFile = ReportPath & "\Reports\PendPurOrderRegDocDtl.rpt"
                        End If

                        'ReportParameters.rptFile = ReportPath & "\Reports\PendPurOrderRegDocDtl.rpt"

                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "'  And {Vw_PurOrderRpt.Status} = '1'" & FromToDt & strSOFilter1 & strPOFilter1 & PartyFltr & LocFilter & OthOptions & POTypeFltr
                    Else
                        ReportParameters.rptCaption = "PO Status Register - Summary"
                        ReportParameters.rptFile = ReportPath & "\Reports\PendPurOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} = '1'" & FromToDt & PartyFltr & LocFilter & OthOptions & POTypeFltr
                    End If
                Else
                    If rdSummary.Checked Then
                        If rptType = ReportType.PendPurOrderRegister_BillWise Then
                            Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                            Formulas.Add("DisplayDetails#N", 0)
                            Formulas.Add("GroupOn1#N", 2)

                        ElseIf rptType = ReportType.PendPurOrderRegister_DateWise Then
                            Formulas.Add("DateGrp#N", 1)
                            Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                            Formulas.Add("GroupOn1#N", 0)

                        ElseIf rptType = ReportType.PendPurOrderRegister_SupplierWise Then
                            Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                            Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                            Formulas.Add("GroupOn1#N", 3)
                        End If

                        'If rptType = ReportType.PendPurOrderRegister_LocationWise Then
                        '    Formulas.Add("GroupOn1#N", 4)
                        'ElseIf rptType = ReportType.PendPurOrderRegister_SupplierWise Then
                        '    Formulas.Add("GroupOn1#N", 3)
                        'End If

                        If IsFabric Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                        End If

                        ReportParameters.rptFile = ReportPath & "\Reports\PendPurOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} = '1'" & FromToDt & PartyFltr & OthOptions & POTypeFltr
                        ReportParameters.rptCaption = "PO Status Register - Summary"
                    Else
                        Formulas.Add("DisplayDetails#N", 1)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))

                        If rptType = ReportType.PendPurOrderRegister_LocationWise Then
                            'Formulas.Add("GroupOn1#N", 4)
                        ElseIf rptType = ReportType.PendPurOrderRegister_SupplierWise Then
                            Formulas.Add("GroupOn1#N", 3)
                        Else
                            Formulas.Add("GroupOn1#N", 0)
                        End If

                        If IsFabric Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                        ElseIf IsFinished Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                        ElseIf IsStores Then
                            POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                        End If

                        'ReportParameters.rptFile = ReportPath & "\Reports\PendPurOrderRegDocDtl.rpt"
                        'If IsFabric = True Then
                        '    Formulas.Add("ProdHeader#S", "Product/Design/Shade")
                        '    ReportParameters.rptFile = ReportPath & "\Reports\FabricPurOrderRegDocDtl.rpt"
                        'Else
                        '    Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        '    ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                        'End If
                        If IsFabric = True Then
                            Formulas.Add("ProdHeader#S", "Product/Design/Shade")
                            ReportParameters.rptFile = ReportPath & "\Reports\PendFabricPurOrderRegDocDtl.rpt"
                        Else
                            Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                            ReportParameters.rptFile = ReportPath & "\Reports\PendPurOrderRegDocDtl.rpt"
                        End If

                        ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} = '1'" & FromToDt & strSOFilter1 & strPOFilter1 & PartyFltr & OthOptions & POTypeFltr
                        ReportParameters.rptCaption = "PO Status Register - Detail"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.PendPurOrderRegister_SubGroupWise, ReportType.PendPurOrderRegister_ProductWise, ReportType.PendPurOrderRegister_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_PurOrderRpt.Doc_Dt}", "{Vw_PurOrderRpt.Bill_Sr}")
                StockFltr = GetStockFilter("Vw_PurOrderRpt")
                PartyFltr = GetPartyFilter("Vw_PurOrderRpt")

                OthOptions = "" ''All
                If rdOthOption1.Checked Then
                    OthOptions = " And {Vw_PurOrderRpt.BalQty} > 0" ''Pending
                ElseIf rdOthOption2.Checked Then
                    OthOptions = " And {Vw_PurOrderRpt.BalQty} = 0" ''Completed
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PendPurOrderRegProdDtl.rpt"
                    ReportParameters.rptCaption = "PO Status Detail"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PendPurOrderRegProdSum.rpt"
                    ReportParameters.rptCaption = "PO Status Summary"
                    ReportParameters.POSummary = True
                End If

                If IsFabric Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                End If

                ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} = '1'" & FromToDt & PartyFltr & StockFltr & OthOptions & POTypeFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    If rptType = ReportType.PendPurOrderRegister_SubGroupWise Then
                        Formulas.Add("GroupOn3#S", "U")
                    ElseIf rptType = ReportType.PendPurOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.PendPurOrderRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    If rdDetailed.Checked Then
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    End If

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", Me.Text)

                Else
                    ReportParameters.DisplayDetails = False
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If
                ReportParameters.POSummary = False

            Case ReportType.PurOrderCancelled_SupplierWise
                PartyFltr = GetPartyFilter("Vw_PurOrderRpt")
                FromToDt = GetFromToDateSeriesFilter("{Vw_PurOrderRpt.Doc_Dt}", "{Vw_PurOrderRpt.Bill_Sr}")

                Formulas.Add("GroupOn1#N", 3)
                Formulas.Add("DisplayDetails#N", 1)
                Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                If IsFabric Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                End If

                ReportParameters.rptCaption = "PO Status Register (Cancelled)"
                ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} = '0'" & FromToDt & PartyFltr & POTypeFltr

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.FabPurOrderRegister_AllInOne

                ReDim subrpt(1)

                'FromToDt = GetFromToDateSeriesFilter("{Vw_PurOrderRpt.Doc_Dt}", "{Vw_PurOrderRpt.Bill_Sr}")
                'StockFltr = GetStockFilter("Vw_PurOrderRpt")
                'PartyFltr = GetPartyFilter("Vw_PurOrderRpt")

                If rdOthOption3.Checked Then
                    FromToDt = GetFromToDateSeriesFilter("{PurOrder.Doc_Dt}", "{PurOrder.Bill_Sr}")
                Else
                    FromToDt = GetFrom2To2DateSeriesFilter("{PurOrder.DlvDate}", "{PurOrder.Bill_Sr}")
                End If

                StockFltr = GetStockFilter("PurOrderDtl", True)
                PartyFltr = GetPartyFilter("PurOrder")

                If AsPerUser = " Created_By <> 0 " Then
                    SelUsers = GetSelectedAttributesNumeric(cmbTax, "PurOrder.Created_By")
                Else
                    SelUsers = "{PurOrder.Created_By} =" & UserId
                End If


                If SelUsers <> "" Then
                    SelUsers = " And " & SelUsers
                End If


                OthOptions = "" ''All

                If rdOthOption1.Checked Then
                    OthOptions = " And {PurOrderDtl.BalQty} > 0 And {PurOrder.Status} = '1'" ''Pending
                    Formulas.Add("StatusType#S", "P")
                ElseIf rdOthOption2.Checked Then
                    OthOptions = " And {PurOrderDtl.BalQty} <= 0" ''Completed
                    Formulas.Add("StatusType#S", "C")
                Else
                    Formulas.Add("StatusType#S", "A")
                End If

                If IsFabric Then
                    POTypeFltr = " And {PurOrder.PO_Type} = 'G'"
                    'ElseIf IsFinished Then
                    '    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                    'ElseIf IsStores Then
                    '    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"


                    If (cmbTax.Properties.Items.Count = Split(cmbTax.Text).Length) Or cmbTax.Text = "" Then
                        Formulas.Add("Vertical#S", "ALL")
                    Else
                        Formulas.Add("Vertical#S", cmbTax.Text)
                    End If

                    If (cmbBrand.Properties.Items.Count = Split(cmbBrand.Text).Length) Or cmbBrand.Text = "" Then
                        Formulas.Add("Brand#S", "ALL")
                    Else
                        Formulas.Add("Brand#S", cmbBrand.Text)
                    End If

                    If (cmbOperator.Properties.Items.Count = Split(cmbOperator.Text).Length) Or cmbOperator.Text = "" Then
                        Formulas.Add("BuyerCountry#S", "ALL")
                    Else
                        Formulas.Add("BuyerCountry#S", cmbOperator.Text)
                    End If

                    If (cmbParty.Properties.Items.Count = Split(cmbParty.Text).Length) Or cmbParty.Text = "" Then
                        Formulas.Add("Vendor#S", "ALL")
                    Else
                        Formulas.Add("Vendor#S", cmbParty.Text)
                    End If

                    If (cmbProduct.Properties.Items.Count = Split(cmbProduct.Text).Length) Or cmbProduct.Text = "" Then
                        Formulas.Add("Product#S", "ALL")
                    Else
                        Formulas.Add("Product#S", cmbProduct.Text)
                    End If

                    If (cmbStation.Properties.Items.Count = Split(cmbStation.Text).Length) Or cmbStation.Text = "" Then
                        Formulas.Add("VendorCity#S", "ALL")
                    Else
                        Formulas.Add("VendorCity#S", cmbStation.Text)
                    End If

                    If (cmbCountry.Properties.Items.Count = Split(cmbCountry.Text).Length) Or cmbCountry.Text = "" Then
                        Formulas.Add("VendorCountry#S", "ALL")
                    Else
                        Formulas.Add("VendorCountry#S", cmbCountry.Text)
                    End If



                End If

                If chkSize.Checked Then

                    subrpt(0).Report = "currencysummary.rpt"
                    subrpt(0).Filter = "{PurOrder.CoBr_Id} = '" & SelBranchId & "' And {PurOrder.Status} <> '0'" & FromToDt & PartyFltr & StockFltr & OthOptions & POTypeFltr & SelUsers

                    ReportParameters.rptFile = ReportPath & "\Reports\POwisePurRegValue.rpt"
                Else
                    subrpt(0).Report = "currencysummary.rpt"
                    subrpt(0).Filter = "{PurOrder.CoBr_Id} = '" & SelBranchId & "' And {PurOrder.Status} <> '0'" & FromToDt & PartyFltr & StockFltr & OthOptions & POTypeFltr & SelUsers

                    ReportParameters.rptFile = ReportPath & "\Reports\POwisePurReg.rpt"
                End If



                ReportParameters.rptFilter = "{PurOrder.CoBr_Id} = '" & SelBranchId & "' And {PurOrder.Status} <> '0'" & FromToDt & PartyFltr & StockFltr & OthOptions & POTypeFltr & SelUsers



            Case ReportType.PurOrderShortClose_SupplierWise
                PartyFltr = GetPartyFilter("Vw_PurOrderRpt")
                FromToDt = GetFromToDateSeriesFilter("{Vw_PurOrderRpt.Doc_Dt}", "{Vw_PurOrderRpt.Bill_Sr}")

                Formulas.Add("DisplayDetails#N", 1)
                Formulas.Add("GroupOn1#N", 3)
                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                If IsFabric Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'G'"
                ElseIf IsFinished Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'F'"
                ElseIf IsStores Then
                    POTypeFltr = " And {Vw_PurOrderRpt.PO_Type} = 'S'"
                End If

                ReportParameters.rptCaption = "PO Register (Short Close)"
                ReportParameters.rptFile = ReportPath & "\Reports\PurOrderRegDocDtl.rpt"
                ReportParameters.rptFilter = "{Vw_PurOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_PurOrderRpt.Status} = '5'" & FromToDt & PartyFltr & POTypeFltr

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                ''Purchase Rtn
            Case ReportType.PurchaseRtn_SummaryDateWise, ReportType.PurchaseRtn_DateWise
                If rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PurRtnSummaryDateWise.rpt"
                    ReportParameters.rptFilter = "{PurchaseRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                    ReportParameters.rptCaption = "Purchase Return Register - Summary (Date Wise)"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PurRtnDetailDateWise.rpt"
                    ReportParameters.rptFilter = "{PurchaseRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr
                    ReportParameters.rptCaption = "Purchase Return Register - Detail (Date Wise)"
                End If

            Case ReportType.PurchaseRtn_SummaryPartyWise, ReportType.PurchaseRtn_PartyWise
                If rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PurRtnSummaryPartyWise.rpt"
                    ReportParameters.rptFilter = "{PurchaseRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                    ReportParameters.rptCaption = "Purchase Return Register - Summary (Party Wise)"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PurRtnDetailPartyWise.rpt"
                    ReportParameters.rptFilter = "{PurchaseRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr
                    ReportParameters.rptCaption = "Purchase Return Register - Detail (Party Wise)"
                End If

            Case ReportType.PurchaseRtn_ProductWise
                ReportParameters.rptFile = ReportPath & "\Reports\PurRtnDetailProductWise.rpt"
                ReportParameters.rptFilter = "{PurchaseRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr
                ReportParameters.rptCaption = "Purchase Return Register (" & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise)"

            Case ReportType.PurchaseRtn_PartyProductWise

            Case ReportType.PurchaseRtn_BrandWise

            Case ReportType.PendingOrderReport
                LocFilter = ""
                FromToDt = GetFromToDateSeriesFilter("{SalesOrder.Doc_Dt}", "{SalesOrder.Doc_Type}")
                ReDim subrpt(6)

                subrpt(0).Report = "SaleBill.rpt"
                'subrpt(0).FormulaName = "FromDate"
                'subrpt(0).FormulaValue = Format$(dtpFrom.Value, "dd/MM/yyyy")
                'subrpt(0).FormulaName = "ToDate"
                'subrpt(0).FormulaValue = Format$(dtpTo.Value, "dd/MM/yyyy")
                If chkDispValue.Checked = True Then
                    subrpt(0).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0' " & FromToDt
                Else
                    subrpt(0).Filter = "{SalesOrder.CoBr_Id} <>'0' And {SalesOrder.Status} <>'0' " & FromToDt
                End If


                subrpt(1).Report = "OrderPending.rpt"
                subrpt(1).FormulaName = "FromDate"
                subrpt(1).FormulaValue = Format$(AccFromDt, "dd/MM/yyyy")
                'subrpt(1).FormulaName = "ToDate"
                'subrpt(1).FormulaValue = Format$(dtpTo.Value, "dd/MM/yyyy")

                Dim FromDt As String = ""
                Dim FromDt1 As Date
                FromDt = " And {SalesOrder.Doc_Dt} < Date(" & Format$(AccFromDt, "yyyy,MM,dd") & ") "
                If chkDispValue.Checked = True Then
                    subrpt(1).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "'  " & FromDt
                Else
                    subrpt(1).Filter = "{SalesOrder.CoBr_Id} <>'0' " & FromDt
                End If


                subrpt(2).Report = "OrderBooking.rpt"
                subrpt(2).FormulaName = "FromDate"
                subrpt(2).FormulaValue = Format$(AccFromDt, "dd/MM/yyyy")
                FromDt1 = DateAdd(DateInterval.Day, -1, dtpFrom.Value)
                'subrpt(2).FormulaName = "ToDate"
                'subrpt(2).FormulaValue = Format$(FromDt1, "dd/MM/yyyy")
                'FromDt = " And " & DateField & " >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And " & DateField & " <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"
                FromDt = " And {SalesOrder.Doc_Dt} >= Date(" & Format$(AccFromDt, "yyyy,MM,dd") & ") And {SalesOrder.Doc_Dt} <= Date(" & Format$(FromDt1, "yyyy,MM,dd") & ")"
                If chkDispValue.Checked = True Then
                    subrpt(2).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0' " & FromDt
                Else
                    subrpt(2).Filter = "{SalesOrder.CoBr_Id} <>'0' And {SalesOrder.Status} <>'0' " & FromDt
                End If

                subrpt(3).Report = "BillBooking.rpt"
                subrpt(3).FormulaName = "FromDate"
                subrpt(3).FormulaValue = Format$(AccFromDt, "dd/MM/yyyy")
                subrpt(3).FormulaName = "ToDate"
                subrpt(3).FormulaValue = Format$(FromDt1, "dd/MM/yyyy")
                If chkDispValue.Checked = True Then
                    subrpt(3).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0' " & FromDt
                Else
                    subrpt(3).Filter = "{SalesOrder.CoBr_Id}<>'0'  And {SalesOrder.Status} <>'0'" & FromDt
                End If

                subrpt(4).Report = "ShortClose"
                subrpt(4).FormulaName = "FromDate"
                subrpt(4).FormulaValue = Format$(AccFromDt, "dd/MM/yyyy")
                FromDt1 = DateAdd(DateInterval.Day, -1, dtpFrom.Value)
                'subrpt(4).FormulaName = "ToDate"
                'subrpt(4).FormulaValue = Format$(FromDt1, "dd/MM/yyyy")
                'FromDt = " And " & DateField & " >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And " & DateField & " <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"
                FromDt = " And {SalesOrder.Doc_Dt} >= Date(" & Format$(AccFromDt, "yyyy,MM,dd") & ") And {SalesOrder.Doc_Dt} <= Date(" & Format$(FromDt1, "yyyy,MM,dd") & ")"
                If chkDispValue.Checked = True Then
                    subrpt(4).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} ='2' " & FromDt
                Else
                    subrpt(4).Filter = "{SalesOrder.CoBr_Id} <>'0' And {SalesOrder.Status} ='2' " & FromDt
                End If

                subrpt(5).Report = "ShortCloseRecord.rpt"
                subrpt(5).FormulaName = "FromDate"
                subrpt(5).FormulaValue = Format$(dtpFrom.Value, "dd/MM/yyyy")
                subrpt(5).FormulaName = "ToDate"
                subrpt(5).FormulaValue = Format$(dtpTo.Value, "dd/MM/yyyy")
                If chkDispValue.Checked = True Then
                    subrpt(5).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} ='2' " & FromToDt
                Else
                    subrpt(5).Filter = "{SalesOrder.CoBr_Id} <>'0' And {SalesOrder.Status} ='2' " & FromToDt
                End If

                Formulas.Add("FromDate1#S", Format$(FromDt1, "dd/MM/yyyy"))

                If rdDetailed.Checked Then
                    ReportParameters.rptCaption = "Pending Order Report- Detailed"
                    ReportParameters.rptFile = ReportPath & "\Reports\PendigOrderReportDtl.rpt"
                    If chkDispValue.Checked = True Then
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0'" & FromToDt
                    Else
                        ReportParameters.rptFilter = " {SalesOrder.Status} <>'0'" & FromToDt
                    End If
                Else
                    ReportParameters.rptCaption = "Pending Order Report- Summary "
                    ReportParameters.rptFile = ReportPath & "\Reports\PendigOrderReport.rpt"
                    If chkDispValue.Checked = True Then
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0'" & FromToDt
                    Else
                        ReportParameters.rptFilter = "{SalesOrder.Status} <>'0'" & FromToDt
                    End If

                End If

                ''''''''''''''''''''Sales Order
                '1


                ''CHANGE BY RAHUL ON 14/11/2019
            Case ReportType.PPStatus
                Dim ReportFilter As String = ""
                Dim PPFiter As String = ""
                Dim PPFiter1 As String = ""

                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                    StockFltr = GetStockFilter("", True, True)
                    ' PartyFltr = GetPartyFilter("", True)
                    Dim strOptions As String = ""
                

                    'FromToDt = " And {Prodnpln.doc_dt} >= '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And {Prodnpln.doc_dt} <= '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'"
                    PPFiter = GetSelectedAttributesForQuery(cmbrate, "{Prodnpln.Doc_ID}")
                    FromToDt = GetFromToDateSeriesFilter("{Prodnpln.doc_dt}", "", , False)
                    PPFiter1 = PPFiter.Replace("(", "[").Replace(")", "]").Replace("'", "").Replace("'", "")
                    If cmbSONo.Text <> "" Then

                        ReportParameters.rptFilter = " {Prodnpln.TRANS_TYPE} = '" & cmbSONo.Value & "'" & FromToDt & IIf(PPFiter1.ToString.Length > 1, " And " & PPFiter & "", PPFiter) & strOptions
                    Else
                        ReportParameters.rptFilter = "{Prodnpln.Cobr_id} = '" & SelBranchId & "' " & IIf(PPFiter1.ToString.Length > 1, " And " & PPFiter1 & "", PPFiter1) & FromToDt & StockFltr & strOptions
                    End If

                    'StockParam = StockParam.Replace(".Style", ".Style_Code")
                    If rdOthOption1.Checked = True And pnlOtherOptions.Visible = True Then
                        'strOptions = " and {ProdnplnFab.Bal_Qty}>0 "
                        Formulas.Add("BalQty_Status#S", "P")
                    ElseIf rdOthOption2.Checked = True And pnlOtherOptions.Visible = True Then
                        'strOptions = " and {ProdnplnFab.Bal_Qty}=0 "
                        Formulas.Add("BalQty_Status#S", "C")

                    End If

                    ReportParameters.rptCaption = "PP Status Report"
                    ReportParameters.rptFile = ReportPath & "\Reports\PP_Status.rpt"

                    'ExportPPStatusNew(ReportFilter, "VW_PPStatusALL", "PP_No")
                    ''END
                Else
                    FromToDt = " And VW_PPStatusALL.PP_Date >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' And VW_PPStatusALL.PP_Date <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'"
                    PPFiter = GetSelectedAttributesForQuery(cmbrate, "Doc_ID")
                    If cmbSONo.Text <> "" Then
                        ReportFilter = " VW_PPStatusALL.TRANS_TYPE = '" & cmbSONo.Value & "'" & FromToDt & IIf(PPFiter.ToString.Length > 1, " And " & PPFiter & "", PPFiter)
                    Else
                        ReportFilter = " VW_PPStatusALL.PP_Date >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' And VW_PPStatusALL.PP_Date <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'" & IIf(PPFiter.ToString.Length > 1, " And " & PPFiter & "", PPFiter)
                    End If

                    'ExportPPStatus(ReportFilter, "VW_PPStatusALL", "PP_No")
                    ExportPPStatusNew(ReportFilter, "VW_PPStatusALL", "PP_No")
                    ''END
                End If
               
               

            Case ReportType.PPFABStatus '''Rohit 05-10-2018
                LocFilter = ""
                FromToDt = GetFromToDateSeriesFilter("{VW_PPFABStatus.Doc_Dt}", "{VW_PPFABStatus.Doc_type}")

                ReportParameters.rptCaption = "PP Status Report-Fab"
                ReportParameters.rptFile = ReportPath & "\Reports\PPFABSTATUS.rpt"
                If chkDispValue.Checked = True Then
                    ReportParameters.rptFilter = "{VW_PPFABStatus.CoBr_Id} = '" & SelBranchId & "' " & FromToDt
                Else
                    ReportParameters.rptFilter = " {VW_PPFABStatus.CoBr_Id} <>'0'" & FromToDt
                End If

            Case ReportType.PPAccStatus '''Rohit 05-10-2018
                LocFilter = ""
                FromToDt = GetFromToDateSeriesFilter("{VW_PPACCStatus.Doc_Dt}", "{VW_PPACCStatus.Doc_type}")

                ReportParameters.rptCaption = "PP Status Report-ACC"
                ReportParameters.rptFile = ReportPath & "\Reports\PPACCSTATUS.rpt"
                If chkDispValue.Checked = True Then
                    ReportParameters.rptFilter = "{VW_PPACCStatus.CoBr_Id} = '" & SelBranchId & "' " & FromToDt
                Else
                    ReportParameters.rptFilter = " {VW_PPACCStatus.CoBr_Id} <>'0'" & FromToDt
                End If

            Case ReportType.JobOrderStatus
                LocFilter = ""
                'FromToDt = GetFromToDateSeriesFilter("{VW_JobOrderStatus.Doc_Dt}", "{VW_JobOrderStatus.Doc_type}")

                ReportParameters.rptCaption = "Job Order Status Report"
                ReportParameters.rptFile = ReportPath & "\Reports\JOBORDERSTATUS.rpt"
                'If chkDispValue.Checked = True Then
                '    ReportParameters.rptFilter = "{VW_JobOrderStatus.CoBr_Id} = '" & SelBranchId & "' And {VW_JobOrderStatus.JwDoc_id} = " & cmbOrderNo.Value
                'Else
                '    ReportParameters.rptFilter = " {VW_JobOrderStatus.CoBr_Id} <>'0'" & FromToDt
                'End If
                If cmbOrderNo.Value > 0 Then
                    ReportParameters.rptFilter = "{VW_JobOrderStatus.CoBr_Id} = '" & SelBranchId & "' And {VW_JobOrderStatus.JwDoc_id} = " & cmbOrderNo.Value
                Else
                    ReportParameters.rptFilter = " {VW_JobOrderStatus.CoBr_Id} = '" & SelBranchId & "'"
                End If
            Case ReportType.SalesOrderRegister_BillWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SalesOrder")
                    FromToDt = GetFromToDateSeriesFilter("{SalesOrder.Doc_Dt}", "{SalesOrder.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then

                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Order Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Sales Order Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else
                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))

                    If rdSummary.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1 'IIf(chkDispRate.Checked, 1, 0)
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0' " & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Order Register - Summary (Bill Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Order Register - Detail (Bill Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                '2
            Case ReportType.SalesOrderRegister_DateWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SalesOrder")
                    FromToDt = GetFromToDateSeriesFilter("{SalesOrder.Doc_Dt}", "{SalesOrder.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        ReportParameters.rptCaption = "Sales Order Register - Details (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <> '0'" & FromToDt & PartyFltr & LocFilter
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Item("ReportCaption#S") = "PO Register - Detail (" & lstMain.Text & ")"
                    Else
                        ReportParameters.rptCaption = "Sales Order Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <> '0'" & FromToDt & PartyFltr & LocFilter
                        'Formulas.Item("ReportCaption#S") = "PO Register - Summary (" & lstMain.Text & ")"
                    End If
                Else

                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", 1)

                    If rdSummary.Checked Then
                        ReportParameters.rptCaption = "Sales Order Register - Summary (Date Wise)"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <> '0'" & FromToDt & PartyFltr

                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    Else
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <> '0'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Order Register - Detail (Date Wise)"

                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Item("DisplayDetails#N") = 1
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                ''''
            Case ReportType.SalesOrderStatus
                Dim ReportFilter As String = ""

                Dim PPFiter As String = ""
                Dim PPFiter1 As String = ""

                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                    StockFltr = GetStockFilter("", True, True)
                    ' PartyFltr = GetPartyFilter("", True)

                   

                    'FromToDt = " And {Prodnpln.doc_dt} >= '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And {Prodnpln.doc_dt} <= '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'"
                    PPFiter = GetSelectedAttributesForQuery(cmbrate, "{SalesOrder.Doc_ID}")
                    FromToDt = GetFromToDateSeriesFilter("{SalesOrder.doc_dt}", "", , False)
                    PPFiter1 = PPFiter.Replace("(", "[").Replace(")", "]").Replace("'", "").Replace("'", "")
                   
                    ReportParameters.rptFilter = "{SalesOrder.Cobr_id} = '" & SelBranchId & "' " & IIf(PPFiter1.ToString.Length > 1, " And " & PPFiter1 & "", PPFiter1) & FromToDt & StockFltr '& strOptions 

                    Dim strOptions As String = ""
                    If rdOthOption1.Checked = True And pnlOtherOptions.Visible = True Then
                        'strOptions = " and {SumBalQty}>0 "
                        Formulas.Add("BalQty_Status#S", "P")
                    ElseIf rdOthOption2.Checked = True And pnlOtherOptions.Visible = True Then
                        'strOptions = " and {SumBalQty}=0 "
                        Formulas.Add("BalQty_Status#S", "C")
                    End If
                    'StockParam = StockParam.Replace(".Style", ".Style_Code")


                    ReportParameters.rptCaption = "SalesOrder Status Report"
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderStatus.rpt"




                Else

                    'FromToDt = GetFromToDateSeriesFilter("{Vw_SOApprovalStatusReport.Doc_Dt}", "{Vw_SOApprovalStatusReport.Doc_Type}")
                    FromToDt = " And Vw_SOApprovalStatusReport.Doc_DT >= '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And Vw_SOApprovalStatusReport.Doc_DT <= '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'"
                    ''ReportParameters.rptCaption = "Sales Order Approval Status"
                    'ReportParameters.rptFile = ReportPath & "\Reports\SOApprovalStatus.rpt"
                    If cmbSONo.Value <> 0 Then
                        If UserId = 1 Then
                            ReportFilter = " Vw_SOApprovalStatusReport.doc_id= " & cmbSONo.Value & " And Vw_SOApprovalStatusReport.CoBr_Id = '" & SelBranchId & "'  And Vw_SOApprovalStatusReport.Status <> '0'" & FromToDt
                        Else
                            'Remove the JobIsuCreatedBy Filter On 25 Feb 2019
                            'ReportFilter = "Vw_SOApprovalStatusReport.doc_id= " & cmbSONo.Value & " And Vw_SOApprovalStatusReport.CoBr_Id = '" & SelBranchId & "' And (Vw_SOApprovalStatusReport.SoCreated_By = " & UserId & " Or Vw_SOApprovalStatusReport.PPCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.JobCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FinCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FabCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.AccCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FinPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FabPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.AccPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.JobIsuCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.PACKINGSLIPCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.PACKINGCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.salebillCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.BomCreated_By = " & UserId & " ) And Vw_SOApprovalStatusReport.Status <> '0'" & FromToDt
                            ReportFilter = "Vw_SOApprovalStatusReport.doc_id= " & cmbSONo.Value & " And Vw_SOApprovalStatusReport.CoBr_Id = '" & SelBranchId & "' And (Vw_SOApprovalStatusReport.SoCreated_By = " & UserId & " Or Vw_SOApprovalStatusReport.PPCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.JobCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FinCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FabCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.AccCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FinPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FabPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.AccPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.PACKINGSLIPCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.PACKINGCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.salebillCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.BomCreated_By = " & UserId & " ) And Vw_SOApprovalStatusReport.Status <> '0'" & FromToDt
                        End If
                    Else
                        If UserId = 1 Then
                            ReportFilter = "  Vw_SOApprovalStatusReport.CoBr_Id = '" & SelBranchId & "'  And Vw_SOApprovalStatusReport.Status <> '0'" & FromToDt
                        Else
                            'Remove the JobIsuCreatedBy Filter On 25 Feb 2019
                            'ReportFilter = " Vw_SOApprovalStatusReport.CoBr_Id = '" & SelBranchId & "' And (Vw_SOApprovalStatusReport.SoCreated_By = " & UserId & " Or Vw_SOApprovalStatusReport.PPCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.JobCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FinCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FabCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.AccCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FinPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FabPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.AccPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.JobIsuCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.PACKINGSLIPCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.PACKINGCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.salebillCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.BomCreated_By = " & UserId & " ) And Vw_SOApprovalStatusReport.Status <> '0'" & FromToDt
                            ReportFilter = " Vw_SOApprovalStatusReport.CoBr_Id = '" & SelBranchId & "' And (Vw_SOApprovalStatusReport.SoCreated_By = " & UserId & " Or Vw_SOApprovalStatusReport.PPCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.JobCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FinCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FabCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.AccCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FinPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.FabPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.AccPurCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.PACKINGSLIPCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.PACKINGCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.salebillCreated_By = " & UserId & "  Or Vw_SOApprovalStatusReport.BomCreated_By = " & UserId & " ) And Vw_SOApprovalStatusReport.Status <> '0'" & FromToDt
                        End If
                    End If


                    If rptType = ReportType.SalesOrderStatus Then
                        Dim Trans As SqlTransaction
                        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
                        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
                        Dim xlApp As New Excel.Application
                        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
                        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
                        Dim Reg As String = ""
                        xlSheet.Cells(1, 1) = "Sr No."
                        xlSheet.Cells(1, 2) = "SoDoc_No"
                        xlSheet.Cells(1, 3) = "Doc_Dt"
                        xlSheet.Cells(1, 4) = "SOApprovalStage"
                        xlSheet.Cells(1, 5) = "Username"
                        xlSheet.Cells(1, 6) = "Buyer"
                        xlSheet.Cells(1, 7) = "Brand_name"
                        xlSheet.Cells(1, 8) = "Country"
                        xlSheet.Cells(1, 9) = "Style_Code"
                        xlSheet.Cells(1, 10) = "MfgTrd"
                        xlSheet.Cells(1, 11) = "Shade_Name"
                        xlSheet.Cells(1, 12) = "Item_Name"
                        xlSheet.Cells(1, 13) = "BOM"
                        xlSheet.Cells(1, 14) = "BomUser"
                        xlSheet.Cells(1, 15) = "BomApprovalStage"
                        xlSheet.Cells(1, 16) = "PPDoc_no"
                        xlSheet.Cells(1, 17) = "PPUser"
                        xlSheet.Cells(1, 18) = "PPApprovalStage"
                        xlSheet.Cells(1, 19) = "Job_Docno"
                        xlSheet.Cells(1, 20) = "JobUser"
                        xlSheet.Cells(1, 21) = "JobApprovalStage"
                        xlSheet.Cells(1, 22) = "FinPODoc_no"
                        xlSheet.Cells(1, 23) = "FinPOUser"
                        xlSheet.Cells(1, 24) = "FinApproval"
                        xlSheet.Cells(1, 25) = "FabPODoc_no"
                        xlSheet.Cells(1, 26) = "FabPOUser"
                        xlSheet.Cells(1, 27) = "FabApproval"
                        xlSheet.Cells(1, 28) = "AccPODoc_no"
                        xlSheet.Cells(1, 29) = "AccPOUser"
                        xlSheet.Cells(1, 30) = "TrimApproval"
                        xlSheet.Cells(1, 31) = "FinPurDoc_No"
                        xlSheet.Cells(1, 32) = "FinPurUser"
                        xlSheet.Cells(1, 33) = "FabPurDoc_No"
                        xlSheet.Cells(1, 34) = "FabPurUser"
                        xlSheet.Cells(1, 35) = "FabPurApproval"
                        xlSheet.Cells(1, 36) = "AccPurDoc_No"
                        xlSheet.Cells(1, 37) = "AccPurUser"
                        xlSheet.Cells(1, 38) = "Reco No"
                        xlSheet.Cells(1, 39) = "Slip_No"
                        xlSheet.Cells(1, 40) = "SlipUser"
                        xlSheet.Cells(1, 41) = "Challan_No"
                        xlSheet.Cells(1, 42) = "ChallanUser"
                        xlSheet.Cells(1, 43) = "SaleBill"
                        xlSheet.Cells(1, 44) = "SaleBillUser"
                        xlSheet.Cells(1, 45) = "SaleBillApproval"
                        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 51)).Font.Bold = True

                        Query = " SELECT Distinct * FROM Vw_SOApprovalStatusReport  where " & ReportFilter & " Order by SoDoc_No "
                        Dim dtb2CSmall As DataTable = Common.GetDataTable(Query)
                        Dim recrow As DataRow
                        If dtb2CSmall.Rows.Count > 0 Then
                            Dim i As Integer = 2
                            Dim j As Integer = 2
                            Dim k As Integer = 1
                            For Each recrow In dtb2CSmall.Rows
                                xlSheet.Cells(j, 1) = k
                                xlSheet.Cells(i, 2) = recrow("SoDoc_No")
                                xlSheet.Cells(i, 3) = recrow("Doc_Dt")
                                xlSheet.Cells(i, 4) = recrow("SOApprovalStage")
                                xlSheet.Cells(i, 5) = recrow("Username")
                                xlSheet.Cells(i, 6) = recrow("Buyer")
                                xlSheet.Cells(i, 7) = recrow("Brand_name")
                                xlSheet.Cells(i, 8) = recrow("Country")
                                xlSheet.Cells(i, 9) = recrow("Style_Code")
                                xlSheet.Cells(i, 10) = recrow("MfgTrd")
                                xlSheet.Cells(i, 11) = recrow("Shade_Name")
                                xlSheet.Cells(i, 12) = recrow("Item_Name")
                                xlSheet.Cells(i, 13) = recrow("BOM")
                                xlSheet.Cells(i, 14) = recrow("BomUser")
                                xlSheet.Cells(i, 15) = recrow("BomApprovalStage")
                                xlSheet.Cells(i, 16) = recrow("PPDoc_no")
                                xlSheet.Cells(i, 17) = recrow("PPUser")
                                xlSheet.Cells(i, 18) = recrow("PPApprovalStage")
                                xlSheet.Cells(i, 19) = recrow("Job_Docno")
                                xlSheet.Cells(i, 20) = recrow("JobUser")
                                xlSheet.Cells(i, 21) = recrow("JobApprovalStage")
                                xlSheet.Cells(i, 22) = recrow("FinPODoc_no")
                                xlSheet.Cells(i, 23) = recrow("FinPOUser")
                                xlSheet.Cells(i, 24) = recrow("FinApproval")
                                xlSheet.Cells(i, 25) = recrow("FabPODoc_no")
                                xlSheet.Cells(i, 26) = recrow("FabPOUser")
                                xlSheet.Cells(i, 27) = recrow("FabApproval")
                                xlSheet.Cells(i, 28) = recrow("AccPODoc_no")
                                xlSheet.Cells(i, 29) = recrow("AccPOUser")
                                xlSheet.Cells(i, 30) = recrow("TrimApproval")
                                xlSheet.Cells(i, 31) = recrow("FinPurDoc_No")
                                xlSheet.Cells(i, 32) = recrow("FinPurUser")
                                xlSheet.Cells(i, 33) = recrow("FabPurDoc_No")
                                xlSheet.Cells(i, 34) = recrow("FabPurUser")
                                xlSheet.Cells(i, 35) = recrow("FabPurApproval")
                                xlSheet.Cells(i, 36) = recrow("AccPurDoc_No")
                                xlSheet.Cells(i, 37) = recrow("AccPurUser")
                                xlSheet.Cells(i, 38) = recrow("Reco_No")
                                xlSheet.Cells(i, 39) = recrow("Slip_No")
                                xlSheet.Cells(i, 40) = recrow("SlipUser")
                                xlSheet.Cells(i, 41) = recrow("Challan_No")
                                xlSheet.Cells(i, 42) = recrow("ChallanUser")
                                xlSheet.Cells(i, 43) = recrow("SaleBill")
                                xlSheet.Cells(i, 44) = recrow("SaleBillUser")
                                xlSheet.Cells(i, 45) = recrow("SaleBillApproval")
                                i += 1
                                j += 1
                                k += 1
                            Next recrow
                            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                            'xlSheet.Range(xlSheet.Cells(i + 3, 2), xlSheet.Cells(i + 3, 19)).Font.Bold = True
                        End If
                        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                        xlSheet.Columns.AutoFit()

                        Try
                            xlSheet.SaveAs(Application.StartupPath & "Sales Order Approval Status " & "-" & Today & ".xlsx")
                        Catch ex As Exception
                            Exit Sub
                        End Try

                        xlApp.Visible = True
                        Exit Sub
                    End If


                End If


                ''ankita 15122018
            Case ReportType.SalesOrderReport
                Dim ReportFilter As String = ""
                'Rajashri -28-01-2022 Start
                If chkSize.Checked Then
                    If rdSummary.Checked = True Then
                        PartyFltr = GetPartyFilter("vw_SalesOrderSummarySizeWise")
                        FromToDt = " And vw_SalesOrderSummarySizeWise.Order_Date >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' And vw_SalesOrderSummarySizeWise.Order_Date <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'" 'RAJASHRI
                        If cmbSONo.Text <> "" Then
                            ReportFilter = " vw_SalesOrderSummarySizeWise.CoBr_Id = '" & SelBranchId & "' And vw_SalesOrderSummarySizeWise.doc_id = " & cmbSONo.Value & FromToDt
                        Else
                            ReportFilter = " vw_SalesOrderSummarySizeWise = '" & SelBranchId & "' " & FromToDt
                        End If
                        'ExportSalesorderSummarySizeWise(ReportFilter)
                        ExportSalesorderSummarySizeWiseNew(ReportFilter)
                    End If
                    'Rajashri -28-01-2022 End

                Else
                    If rdSummary.Checked = True Then
                        PartyFltr = GetPartyFilter("vw_SalesOrderSummary")
                        FromToDt = " And vw_SalesOrderSummary.Order_Date >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' And vw_SalesOrderSummary.Order_Date <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'" 'RAJASHRI
                        If cmbSONo.Text <> "" Then
                            ReportFilter = " vw_SalesOrderSummary.CoBr_Id = '" & SelBranchId & "' And vw_SalesOrderSummary.doc_id = " & cmbSONo.Value & FromToDt
                        Else
                            ReportFilter = " vw_SalesOrderSummary.CoBr_Id = '" & SelBranchId & "' " & FromToDt
                        End If
                        'ExportSalesorderSummary(ReportFilter)
                        ExportSalesorderSummaryNew(ReportFilter)
                    ElseIf rdDetailed.Checked = True Then
                        PartyFltr = GetPartyFilter("vw_SalesOrderDetails")
                        'FromToDt = " And vw_SalesOrderDetails.Doc_Dt >= '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And vw_SalesOrderDetails.Doc_Dt <= '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'"
                        FromToDt = " And vw_SalesOrderDetails.Order_Date >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' And vw_SalesOrderDetails.Order_Date <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'"
                        If cmbSONo.Text <> "" Then
                            ReportFilter = " vw_SalesOrderDetails.CoBr_Id = '" & SelBranchId & "' And vw_SalesOrderDetails.doc_id = " & cmbSONo.Value & FromToDt
                        Else
                            ReportFilter = " vw_SalesOrderDetails.CoBr_Id = '" & SelBranchId & "' " & FromToDt
                        End If
                        'ExportSalesorderDetails(ReportFilter)
                        ExportSalesorderDetailsNew(ReportFilter)
                    Else


                        Exit Sub
                    End If
                End If
                'End If   '  Comenetd by Somesh Due to error

                'ReportFilter = " Vw_SORptDtl.CoBr_Id = '" & SelBranchId & "' And Vw_SORptDtl.doc_id = " & cmbSONo.Value & FromToDt


                'If rptType = ReportType.SalesOrderReport Then

                '    If rdDetailed.Checked = True Then

                '        Dim Trans As SqlTransaction
                '        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
                '        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
                '        Dim xlApp As New Excel.Application
                '        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
                '        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
                '        Dim Reg As String = ""
                '        xlSheet.Cells(1, 1) = "Sr No."
                '        xlSheet.Cells(1, 2) = "Company"
                '        xlSheet.Cells(1, 3) = "Saleorder"
                '        xlSheet.Cells(1, 4) = "Order_Date"
                '        xlSheet.Cells(1, 5) = "Username"
                '        xlSheet.Cells(1, 6) = "party_refNo"
                '        xlSheet.Cells(1, 7) = "Buyer"
                '        xlSheet.Cells(1, 8) = "Country"
                '        xlSheet.Cells(1, 9) = "Consignee"
                '        xlSheet.Cells(1, 10) = "Item_Name"
                '        xlSheet.Cells(1, 11) = "Style_Code"
                '        xlSheet.Cells(1, 12) = "Type_Name"
                '        xlSheet.Cells(1, 13) = "Shade_Name"
                '        xlSheet.Cells(1, 14) = "Occassion"
                '        xlSheet.Cells(1, 15) = "Brand_Name"
                '        xlSheet.Cells(1, 16) = "Qty"
                '        xlSheet.Cells(1, 17) = "UOM"
                '        xlSheet.Cells(1, 18) = "Rate"
                '        xlSheet.Cells(1, 19) = "Amount"
                '        xlSheet.Cells(1, 20) = "NetAmt"
                '        xlSheet.Cells(1, 21) = "Currency"
                '        xlSheet.Cells(1, 22) = "PytTermDisc_Name"
                '        xlSheet.Cells(1, 23) = "Quality"


                '        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 24)).Font.Bold = True

                '        Query = " SELECT * FROM Vw_SORptDtl where " & ReportFilter & " Order by SaleOrder "
                '        'Query = " SELECT * FROM Vw_SORptDtl Inner join Ledger on Ledger.led_key = Salesorder.cust_key"
                '        ' & "Inner join station on Salesorder.stn_key = station.stn_key"
                '        '  inner join state on station.state_key  = state.state_key
                '        '  inner join Country on country.cont_key = state.cont_key
                '        '        where " & ReportFilter & " Order by SaleOrder "

                '        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
                '        Dim recrow As DataRow
                '        If dtb3CSmall.Rows.Count > 0 Then
                '            Dim i As Integer = 2
                '            Dim j As Integer = 2
                '            Dim k As Integer = 1
                '            For Each recrow In dtb3CSmall.Rows
                '                xlSheet.Cells(j, 1) = k
                '                xlSheet.Cells(i, 2) = recrow("Company")
                '                xlSheet.Cells(i, 3) = recrow("Saleorder")
                '                xlSheet.Cells(i, 4) = recrow("Order_Date")
                '                xlSheet.Cells(i, 5) = recrow("Username")
                '                xlSheet.Cells(i, 6) = recrow("Buyer PO_NO")
                '                xlSheet.Cells(i, 7) = recrow("Buyer")
                '                xlSheet.Cells(i, 8) = recrow("Country")
                '                xlSheet.Cells(i, 9) = recrow("Consignee")
                '                xlSheet.Cells(i, 10) = recrow("Item_Name")
                '                xlSheet.Cells(i, 11) = recrow("Style_Code")
                '                xlSheet.Cells(i, 12) = recrow("Type_Name")
                '                xlSheet.Cells(i, 13) = recrow("Shade_Name")
                '                xlSheet.Cells(i, 14) = recrow("Occassion")
                '                xlSheet.Cells(i, 15) = recrow("Brand_Name")
                '                xlSheet.Cells(i, 16) = recrow("Qty")
                '                xlSheet.Cells(i, 17) = recrow("UOM")
                '                xlSheet.Cells(i, 18) = recrow("Rate")
                '                xlSheet.Cells(i, 19) = recrow("Amount")
                '                xlSheet.Cells(i, 20) = recrow("NetAmt")
                '                xlSheet.Cells(i, 21) = recrow("Currency")
                '                xlSheet.Cells(i, 22) = recrow("Payment Terms")
                '                xlSheet.Cells(i, 23) = recrow("Quality")


                '                i += 1
                '                j += 1
                '                k += 1
                '            Next recrow
                '            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                '            'xlSheet.Range(xlSheet.Cells(i + 3, 2), xlSheet.Cells(i + 3, 19)).Font.Bold = True
                '        End If

                '        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                '        xlSheet.Columns.AutoFit()

                '        Try
                '            xlSheet.SaveAs(Application.StartupPath & "Sales Order Report Details" & "-" & Today & ".xlsx")
                '        Catch ex As Exception
                '            Exit Sub
                '        End Try

                '        xlApp.Visible = True
                '        Exit Sub
                '    ElseIf rdSummary.Checked = True Then
                '        Dim Trans As SqlTransaction
                '        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
                '        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
                '        Dim xlApp As New Excel.Application
                '        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
                '        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
                '        Dim Reg As String = ""
                '        xlSheet.Cells(1, 1) = "Sr No."
                '        xlSheet.Cells(1, 2) = "Company"
                '        xlSheet.Cells(1, 3) = "Executed By"
                '        xlSheet.Cells(1, 4) = "Financial Year"
                '        xlSheet.Cells(1, 5) = "SaleOrder"
                '        xlSheet.Cells(1, 6) = "Order_Date"
                '        xlSheet.Cells(1, 7) = "Buyer Po_No"
                '        xlSheet.Cells(1, 8) = "Buyer"
                '        xlSheet.Cells(1, 9) = "Place"
                '        xlSheet.Cells(1, 10) = "Sales Ledger"
                '        xlSheet.Cells(1, 11) = "TotQty"
                '        xlSheet.Cells(1, 12) = "Currency"
                '        xlSheet.Cells(1, 13) = "Payment Terms"


                '        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 13)).Font.Bold = True

                '        Query = " SELECT * FROM Vw_SORptSum where " & ReportFilter & " Order by SaleOrder "
                '        'Query = " SELECT * FROM Vw_SORptSum Inner join Ledger on Ledger.led_key = Salesorder.cust_key"
                '        ' & "Inner join station on Salesorder.stn_key = station.stn_key "_
                '        '  & "inner join state on station.state_key  = state.state_key "_
                '        '   & " inner join Country on country.cont_key = state.cont_key"_
                '        '        where " & ReportFilter & " Order by SaleOrder "

                '        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
                '        Dim recrow As DataRow
                '        If dtb3CSmall.Rows.Count > 0 Then
                '            Dim i As Integer = 2
                '            Dim j As Integer = 2
                '            Dim k As Integer = 1
                '            For Each recrow In dtb3CSmall.Rows
                '                xlSheet.Cells(j, 1) = k
                '                xlSheet.Cells(i, 2) = recrow("Company")
                '                xlSheet.Cells(i, 3) = recrow("Executed By")
                '                xlSheet.Cells(i, 4) = recrow("Financial Year")
                '                xlSheet.Cells(i, 5) = recrow("SaleOrder")
                '                xlSheet.Cells(i, 6) = recrow("Order_Date")
                '                xlSheet.Cells(i, 7) = recrow("Buyer Po_No")
                '                xlSheet.Cells(i, 8) = recrow("Buyer")
                '                xlSheet.Cells(i, 9) = recrow("Place")
                '                xlSheet.Cells(i, 10) = recrow("Sales Ledger")
                '                xlSheet.Cells(i, 11) = recrow("TotQty")
                '                xlSheet.Cells(i, 12) = recrow("Currency")
                '                xlSheet.Cells(i, 13) = recrow("Payment Terms")

                '                i += 1
                '                j += 1
                '                k += 1
                '            Next recrow
                '            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                '            'xlSheet.Range(xlSheet.Cells(i + 3, 2), xlSheet.Cells(i + 3, 19)).Font.Bold = True
                '        End If

                '        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                '        xlSheet.Columns.AutoFit()

                '        Try
                '            xlSheet.SaveAs(Application.StartupPath & "Sales Order Report Summary " & "-" & Today & ".xlsx")
                '        Catch ex As Exception
                '            Exit Sub
                '        End Try

                '        xlApp.Visible = True
                '        Exit Sub
                '    End If
                'End If


            Case ReportType.SalesInvoiceReport
                Dim ReportFilter As String = ""
                Dim ViewName As String = ""
                Dim SortBy As String = ""

                If rdSummary.Checked = True Then
                    If Val(GetSettingAsPerId(ApplnSettingsIdx.HetherGrey)) = 1 Then
                        ViewName = "vw_InvoiceSummary"
                        SortBy = "" 'Sales_Order
                    Else
                        ViewName = "Vw_SalesInvoiceSum"
                        SortBy = ""
                    End If

                    If chkSize.Checked Then
                        'If Val(GetSettingAsPerId(ApplnSettingsIdx.HetherGrey)) = 1 Then 'RAJASHRI
                        ViewName = "vw_InvoiceSummarySizeWise"
                        SortBy = "" 'Sales_Order
                        'End If
                    End If

                    PartyFltr = GetPartyFilter("" & ViewName & "")

                    FromToDt = " And " & ViewName & ".Invoice_Date >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' And " & ViewName & ".Invoice_Date <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'"
                    If cmbSONo.Text <> "" Then
                        ReportFilter = " " & ViewName & ".CoBr_Id = '" & SelBranchId & "' And " & ViewName & ".doc_id = " & cmbSONo.Value & FromToDt
                    Else
                        ReportFilter = " " & ViewName & ".CoBr_Id = '" & SelBranchId & "' " & FromToDt
                    End If

                ElseIf rdDetailed.Checked = True Then
                    If Val(GetSettingAsPerId(ApplnSettingsIdx.HetherGrey)) = 1 Then
                        ViewName = "vw_InvoiceDetails"
                        SortBy = "SalesOrder" 'Sales_Order  Rajashri
                    Else
                        ViewName = "Vw_SalesInvoiceDtl"
                        SortBy = ""
                    End If

                    PartyFltr = GetPartyFilter("" & ViewName & "")


                    'Dim ReportFilter As String = ""
                    FromToDt = " And " & ViewName & ".Invoice_Date >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' And " & ViewName & ".Invoice_Date <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'" 'Rajashri
                    If cmbSONo.Text <> "" Then
                        ReportFilter = " " & ViewName & ".CoBr_Id = '" & SelBranchId & "' And " & ViewName & ".doc_id = " & cmbSONo.Value & FromToDt
                    Else
                        ReportFilter = " " & ViewName & ".CoBr_Id = '" & SelBranchId & "' " & FromToDt
                    End If
                Else
                    Exit Sub
                End If


                If rptType = ReportType.SalesInvoiceReport And Val(GetSettingAsPerId(ApplnSettingsIdx.HetherGrey)) = 0 Then

                    If rdDetailed.Checked = True Then

                        Dim Trans As SqlTransaction
                        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
                        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
                        Dim xlApp As New Excel.Application
                        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
                        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
                        Dim Reg As String = ""
                        xlSheet.Cells(1, 1) = "Sr No."
                        xlSheet.Cells(1, 2) = "Company"
                        xlSheet.Cells(1, 3) = "SaleBill"
                        xlSheet.Cells(1, 4) = "Invoice_Date"
                        xlSheet.Cells(1, 5) = "SalesOrder"
                        xlSheet.Cells(1, 6) = "Buyer Po_No"
                        xlSheet.Cells(1, 7) = "Buyer"
                        xlSheet.Cells(1, 8) = "Place"
                        xlSheet.Cells(1, 9) = "Sales Ledger"
                        xlSheet.Cells(1, 10) = "Item_Name"
                        xlSheet.Cells(1, 11) = "Style_Code"
                        xlSheet.Cells(1, 12) = "Type_Name"
                        xlSheet.Cells(1, 13) = "Shade_Name"
                        xlSheet.Cells(1, 14) = "Gender"
                        xlSheet.Cells(1, 15) = "Brand_Name"
                        xlSheet.Cells(1, 16) = "Qty"
                        xlSheet.Cells(1, 17) = "UOM"
                        xlSheet.Cells(1, 18) = "Rate"
                        xlSheet.Cells(1, 19) = "Amount"
                        xlSheet.Cells(1, 20) = "TaxPerc"
                        xlSheet.Cells(1, 21) = "Tax Amount"
                        xlSheet.Cells(1, 22) = "NetAmt"
                        xlSheet.Cells(1, 23) = "Currency"
                        xlSheet.Cells(1, 24) = "Payment Terms"

                        'RAJASHRI-24-01-2022

                        'xlSheet.Cells(1, 1) = "Sr No."
                        'xlSheet.Cells(1, 2) = "Company"
                        'xlSheet.Cells(1, 3) = "Vertical"
                        'xlSheet.Cells(1, 4) = "Fcyr"
                        'xlSheet.Cells(1, 5) = "Invoice_Date"
                        'xlSheet.Cells(1, 6) = "Invoice_No"
                        'xlSheet.Cells(1, 7) = "SalesOrder"
                        'xlSheet.Cells(1, 8) = "Order_Date"
                        'xlSheet.Cells(1, 9) = "Buyer Po_No"
                        'xlSheet.Cells(1, 10) = "Buyer"
                        'xlSheet.Cells(1, 11) = "Place"
                        'xlSheet.Cells(1, 12) = "GST_No"
                        'xlSheet.Cells(1, 13) = "Brand_Name"
                        'xlSheet.Cells(1, 14) = "Place"
                        'xlSheet.Cells(1, 15) = "State_Name"
                        'xlSheet.Cells(1, 16) = "Country"
                        'xlSheet.Cells(1, 17) = "Consignee_Name"
                        'xlSheet.Cells(1, 18) = "Consignee_Place"
                        'xlSheet.Cells(1, 19) = "Consignee_Country"
                        'xlSheet.Cells(1, 20) = "Sales_Ledger"
                        'xlSheet.Cells(1, 21) = "Item_Name"
                        'xlSheet.Cells(1, 22) = "Style_Code"
                        'xlSheet.Cells(1, 23) = "Type_Name"
                        'xlSheet.Cells(1, 24) = "Shade_Name"
                        'xlSheet.Cells(1, 25) = "Gender"
                        'xlSheet.Cells(1, 26) = "HSN_Code"
                        'xlSheet.Cells(1, 27) = "Qty"
                        'xlSheet.Cells(1, 28) = "UOM"
                        'xlSheet.Cells(1, 29) = "Rate"
                        'xlSheet.Cells(1, 30) = "Amount"
                        'xlSheet.Cells(1, 31) = "Discount"
                        'xlSheet.Cells(1, 32) = "Discount_Amt"
                        'xlSheet.Cells(1, 33) = "Taxable"
                        'xlSheet.Cells(1, 34) = "Exchgrate"
                        'xlSheet.Cells(1, 35) = "TaxPerc"
                        'xlSheet.Cells(1, 36) = "Tax Amount"
                        'xlSheet.Cells(1, 37) = "NetAmt"
                        'xlSheet.Cells(1, 38) = "Currency"
                        'xlSheet.Cells(1, 39) = "Payment Terms"

                        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 39)).Font.Bold = True

                        Query = " SELECT * FROM Vw_SalesInvoiceDtl where " & ReportFilter & " Order by SaleBill "
                        'Query = " SELECT * FROM Vw_SORptDtl Inner join Ledger on Ledger.led_key = Salesorder.cust_key"
                        ' & "Inner join station on Salesorder.stn_key = station.stn_key"
                        '  inner join state on station.state_key  = state.state_key
                        '  inner join Country on country.cont_key = state.cont_key
                        '        where " & ReportFilter & " Order by SaleOrder "

                        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
                        Dim recrow As DataRow
                        If dtb3CSmall.Rows.Count > 0 Then
                            Dim i As Integer = 2
                            Dim j As Integer = 2
                            Dim k As Integer = 1
                            For Each recrow In dtb3CSmall.Rows
                                xlSheet.Cells(j, 1) = k
                                xlSheet.Cells(1, 2) = "Company"
                                xlSheet.Cells(1, 3) = "SaleBill"
                                xlSheet.Cells(1, 4) = "Invoice_Date"
                                xlSheet.Cells(1, 5) = "SalesOrder"
                                xlSheet.Cells(1, 6) = "Buyer Po_No"
                                xlSheet.Cells(1, 7) = "Buyer"
                                xlSheet.Cells(1, 8) = "Place"
                                xlSheet.Cells(1, 9) = "Sales Ledger"
                                xlSheet.Cells(1, 10) = "Item_Name"
                                xlSheet.Cells(1, 11) = "Style_Code"
                                xlSheet.Cells(1, 12) = "Type_Name"
                                xlSheet.Cells(1, 13) = "Shade_Name"
                                xlSheet.Cells(1, 14) = "Gender"
                                xlSheet.Cells(1, 15) = "Brand_Name"
                                xlSheet.Cells(1, 16) = "Qty"
                                xlSheet.Cells(1, 17) = "UOM"
                                xlSheet.Cells(1, 18) = "Rate"
                                xlSheet.Cells(1, 19) = "Amount"
                                xlSheet.Cells(1, 20) = "TaxPerc"
                                xlSheet.Cells(1, 21) = "Tax Amount"
                                xlSheet.Cells(1, 22) = "NetAmt"
                                xlSheet.Cells(1, 23) = "Currency"
                                xlSheet.Cells(1, 24) = "Payment Terms"

                                'RAJASHRI-24-01-2022


                                'xlSheet.Cells(1, 1) = "Sr No."
                                'xlSheet.Cells(1, 2) = "Company"
                                'xlSheet.Cells(1, 3) = "Vertical"
                                'xlSheet.Cells(1, 4) = "Fcyr"
                                'xlSheet.Cells(1, 5) = "Invoice_Date"
                                'xlSheet.Cells(1, 6) = "Invoice_No"
                                'xlSheet.Cells(1, 7) = "SalesOrder"
                                'xlSheet.Cells(1, 8) = "Order_Date"
                                'xlSheet.Cells(1, 9) = "Buyer Po_No"
                                'xlSheet.Cells(1, 10) = "Buyer"
                                'xlSheet.Cells(1, 11) = "Place"
                                'xlSheet.Cells(1, 12) = "GST_No"
                                'xlSheet.Cells(1, 13) = "Brand_Name"
                                'xlSheet.Cells(1, 14) = "Place"
                                'xlSheet.Cells(1, 15) = "State_Name"
                                'xlSheet.Cells(1, 16) = "Country"
                                'xlSheet.Cells(1, 17) = "Consignee_Name"
                                'xlSheet.Cells(1, 18) = "Consignee_Place"
                                'xlSheet.Cells(1, 19) = "Consignee_Country"
                                'xlSheet.Cells(1, 20) = "Sales_Ledger"
                                'xlSheet.Cells(1, 21) = "Item_Name"
                                'xlSheet.Cells(1, 22) = "Style_Code"
                                'xlSheet.Cells(1, 23) = "Type_Name"
                                'xlSheet.Cells(1, 24) = "Shade_Name"
                                'xlSheet.Cells(1, 25) = "Gender"
                                'xlSheet.Cells(1, 26) = "HSN_Code"
                                'xlSheet.Cells(1, 27) = "Qty"
                                'xlSheet.Cells(1, 28) = "UOM"
                                'xlSheet.Cells(1, 29) = "Rate"
                                'xlSheet.Cells(1, 30) = "Amount"
                                'xlSheet.Cells(1, 31) = "Discount"
                                'xlSheet.Cells(1, 32) = "Discount_Amt"
                                'xlSheet.Cells(1, 33) = "Taxable"
                                'xlSheet.Cells(1, 34) = "Exchgrate"
                                'xlSheet.Cells(1, 35) = "TaxPerc"
                                'xlSheet.Cells(1, 36) = "Tax Amount"
                                'xlSheet.Cells(1, 37) = "NetAmt"
                                'xlSheet.Cells(1, 38) = "Currency"
                                'xlSheet.Cells(1, 39) = "Payment Terms"


                                i += 1
                                j += 1
                                k += 1
                            Next recrow
                            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                            'xlSheet.Range(xlSheet.Cells(i + 3, 2), xlSheet.Cells(i + 3, 19)).Font.Bold = True
                        End If

                        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                        xlSheet.Columns.AutoFit()

                        Try
                            xlSheet.SaveAs(Application.StartupPath & "Sales Invoice Report Details" & "-" & Today & ".xlsx")
                        Catch ex As Exception
                            Exit Sub
                        End Try

                        xlApp.Visible = True
                        Exit Sub
                    ElseIf rdSummary.Checked = True Then
                        Dim Trans As SqlTransaction
                        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
                        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
                        Dim xlApp As New Excel.Application
                        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
                        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
                        Dim Reg As String = ""
                        xlSheet.Cells(1, 1) = "Sr No."
                        xlSheet.Cells(1, 2) = "Company"
                        xlSheet.Cells(1, 3) = "SaleBill"
                        xlSheet.Cells(1, 4) = "Invoice_Date"
                        xlSheet.Cells(1, 5) = "SalesOrder"
                        xlSheet.Cells(1, 6) = "Buyer Po_No"
                        xlSheet.Cells(1, 7) = "Buyer"
                        xlSheet.Cells(1, 8) = "Brand"
                        xlSheet.Cells(1, 9) = "Country"
                        xlSheet.Cells(1, 10) = "Sales Ledger"
                        xlSheet.Cells(1, 11) = "TotQty"
                        xlSheet.Cells(1, 12) = "Net_Amt"
                        xlSheet.Cells(1, 13) = "Currency"
                        xlSheet.Cells(1, 14) = "Payment Terms"

                        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 14)).Font.Bold = True

                        Query = " SELECT * FROM Vw_SalesInvoiceSum where " & ReportFilter & " Order by SaleBill "
                        'Query = " SELECT * FROM Vw_SORptDtl Inner join Ledger on Ledger.led_key = Salesorder.cust_key"
                        ' & "Inner join station on Salesorder.stn_key = station.stn_key"
                        '  inner join state on station.state_key  = state.state_key
                        '  inner join Country on country.cont_key = state.cont_key
                        '        where " & ReportFilter & " Order by SaleOrder "

                        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
                        Dim recrow As DataRow
                        If dtb3CSmall.Rows.Count > 0 Then
                            Dim i As Integer = 2
                            Dim j As Integer = 2
                            Dim k As Integer = 1
                            For Each recrow In dtb3CSmall.Rows
                                xlSheet.Cells(j, 1) = k
                                xlSheet.Cells(i, 2) = recrow("Company")
                                xlSheet.Cells(i, 3) = recrow("SaleBill")
                                xlSheet.Cells(i, 4) = recrow("Invoice_Date")
                                xlSheet.Cells(i, 5) = recrow("Sales Order")
                                xlSheet.Cells(i, 6) = recrow("Buyer Po_No")
                                xlSheet.Cells(i, 7) = recrow("Buyer")
                                xlSheet.Cells(i, 8) = recrow("Brand")
                                xlSheet.Cells(i, 9) = recrow("Country")
                                xlSheet.Cells(i, 10) = recrow("Sales Ledger")
                                xlSheet.Cells(i, 11) = recrow("TotQty")
                                xlSheet.Cells(i, 12) = recrow("Net_Amt")
                                xlSheet.Cells(i, 13) = recrow("Currency")
                                xlSheet.Cells(i, 14) = recrow("Payment Terms")

                                i += 1
                                j += 1
                                k += 1
                            Next recrow
                            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
                            'xlSheet.Range(xlSheet.Cells(i + 3, 2), xlSheet.Cells(i + 3, 19)).Font.Bold = True
                        End If

                        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                        xlSheet.Columns.AutoFit()

                        Try
                            xlSheet.SaveAs(Application.StartupPath & "Sales Invoice Report Summery" & "-" & Today & ".xlsx")
                        Catch ex As Exception
                            Exit Sub
                        End Try

                        xlApp.Visible = True
                        Exit Sub
                    End If
                ElseIf rptType = ReportType.SalesInvoiceReport And Val(GetSettingAsPerId(ApplnSettingsIdx.HetherGrey)) = 1 Then
                    'ExportInvoiceSummaryDetails(ReportFilter, IIf(rdSummary.Checked, "S", "D"), ViewName, SortBy)
                    ExportInvoiceSummaryDetailsNew(ReportFilter, IIf(rdSummary.Checked, "S", "D"), ViewName, SortBy)
                End If
                ''end ankita 15122018

            Case ReportType.JobWorkPPWise
                Dim ReportFilter As String = ""
                Dim PPFiter As String = ""
                PartyFltr = GetPartyFilter("vw_JobWorkPPWise")
                FromToDt = " vw_JobWorkPPWise.JW_Date >= '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And vw_JobWorkPPWise.JW_Date <= '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'"
                PPFiter = GetSelectedAttributesForQuery(cmbrate, "Doc_ID")
                '    ReportFilter = "" & PartyFltr & FromToDt & IIf(PPFiter.ToString.Length > 1, " And " & PPFiter & "")
                ReportFilter = "" & FromToDt & IIf(PPFiter.ToString.Length > 1, " And " & PPFiter & "", PPFiter) & IIf(PartyFltr.ToString.Length > 1, " And " & PartyFltr & "", PartyFltr)
                ExportJobWorkPPDetails(ReportFilter, "vw_JobWorkPPWise", "JOBORDER")

            Case ReportType.GRNPendingAgainstPO
                Dim ReportFilter As String = ""
                Dim PPFiter As String = ""
                PartyFltr = GetPartyFilter("vw_GRN_Pending_Against_PO")
                FromToDt = " And vw_GRN_Pending_Against_PO.PO_Date >= '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And vw_GRN_Pending_Against_PO.PO_Date <= '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'"
                ReportFilter = " vw_GRN_Pending_Against_PO.TRANS_TYPE = '" & cmbSONo.Value & "'" & FromToDt
                ExportPendingGRNAgainstPO(ReportFilter, "vw_GRN_Pending_Against_PO", "Doc_NO")

            Case ReportType.ItemStockRpt
                Dim ReportFilter As String = ""
                Dim ViewName As String = ""
                Dim SortBy As String = ""
                If rdSummary.Checked = True Then
                    ViewName = "vw_ItemStockSummary"
                Else
                    ViewName = "vw_ItemStockDetails"
                End If
                SortBy = "Product"

                Dim StkFltr As String = ""
                'StkFltr = GetStockFilterForQuery("", True, True)
                ReportFilter = " " & ViewName & ".CoBr_Id = '" & SelBranchId & "' " & StkFltr
                ExportItemStockSummaryDetails(ReportFilter, IIf(rdSummary.Checked, "S", "D"), ViewName, SortBy)

            Case ReportType.SoBalanceRpt
                Dim ReportFilter As String = ""
                Dim ViewName As String = ""
                Dim SortBy As String = ""
                If rdSummary.Checked = True Then
                    ViewName = "vw_SoBalance"
                Else
                    ViewName = "vw_SoBalance"
                End If
                SortBy = "Company, sodoc_no, fcyr_id"

                Dim StkFltr As String = ""
                ReportFilter = " " & ViewName & ".CoBr_Id = '" & SelBranchId & "' " & StkFltr
                ExportSalesOrderBalance(ReportFilter, IIf(rdSummary.Checked, "S", "D"), ViewName, SortBy)

                'prashant 03/12/19
            Case ReportType.SoFabricIssueAgtJobWorkRpt



                Dim ReportFilter As String = ""
                Dim PPFiter As String = ""




                Dim PPFiter1 As String = ""

                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                    StockFltr = GetStockFilter("", True, True)
                    ' PartyFltr = GetPartyFilter("", True)

                    Dim strOptions As String = ""
                  


                    'FromToDt = " And {Prodnpln.doc_dt} >= '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And {Prodnpln.doc_dt} <= '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'"
                    PPFiter = GetSelectedAttributesForQuery(cmbrate, "{JobOrder.Doc_ID}")
                    FromToDt = GetFromToDateSeriesFilter("{JobOrder.doc_dt}", "", , False)
                    PPFiter1 = PPFiter.Replace("(", "[").Replace(")", "]").Replace("'", "").Replace("'", "")

                    If cmbSONo.Value = "G" Then
                        ReportParameters.rptFilter = "{JobOrder.Cobr_id} = '" & SelBranchId & "' and  {View_JobworkProdn_Ledger.Stk_Type}='FG' " & IIf(PPFiter1.ToString.Length > 1, " And " & PPFiter1 & "", PPFiter1) & FromToDt & StockFltr '& strOptions


                    ElseIf cmbSONo.Value = "A" Then
                        ReportParameters.rptFilter = "{JobOrder.Cobr_id} = '" & SelBranchId & "'  and  {View_JobworkProdn_Ledger.Stk_Type}='AG' " & IIf(PPFiter1.ToString.Length > 1, " And " & PPFiter1 & "", PPFiter1) & FromToDt & StockFltr '& strOptions


                    Else
                        ReportParameters.rptFilter = "{JobOrder.Cobr_id} = '" & SelBranchId & "' " & IIf(PPFiter1.ToString.Length > 1, " And " & PPFiter1 & "", PPFiter1) & FromToDt & StockFltr '& strOptions


                    End If
                    If rdOthOption1.Checked = True And pnlOtherOptions.Visible = True Then
                        'strOptions = " and {BalQty}>0 "
                        Formulas.Add("BalQty_Status#S", "P")
                    ElseIf rdOthOption2.Checked = True And pnlOtherOptions.Visible = True Then
                        'strOptions = " and {BalQty}=0 "
                        Formulas.Add("BalQty_Status#S", "C")
                    End If


                    'StockParam = StockParam.Replace(".Style", ".Style_Code")

                    If cmbSONo.Value = "F" Then

                        ReportParameters.rptCaption = "Finish Process Ledger Report"
                        ReportParameters.rptFile = ReportPath & "\Reports\FinishProcessLedger.rpt"
                       Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                    ElseIf cmbSONo.Value = "A" Then
                        ReportParameters.rptCaption = "Accessories Process Ledger Report"
                        ReportParameters.rptFile = ReportPath & "\Reports\GreyProcessLedger.rpt"
                      Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                    Else
                        ReportParameters.rptCaption = "Fabric Process Ledger Report"
                        ReportParameters.rptFile = ReportPath & "\Reports\GreyProcessLedger.rpt"
                        Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                    End If


                    'ExportPPStatusNew(ReportFilter, "VW_PPStatusALL", "PP_No")
                    ''END
                Else
                    FromToDt = "  vw_PendFabIssueAgstJobOrder.JW_Date >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' And vw_PendFabIssueAgstJobOrder.JW_Date <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'"



                    ExportSalesPendingFabricIssueAgtJobWorkorder(FromToDt)

                End If


                'End Prashant

            Case ReportType.ServiceJobOrderRegister_BillWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SalesOrder")
                    FromToDt = GetFromToDateSeriesFilter("{SalesOrder.Doc_Dt}", "{SalesOrder.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_ServiceJOBRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceJOBRpt.Doc_Dt}", "{Vw_ServiceJOBRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then

                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Job Order Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <>'0'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Job Order Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else
                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))

                    If rdSummary.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1 'IIf(chkDispRate.Checked, 1, 0)
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0' " & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Job Order Register - Summary (Bill Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <>'0'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Job Order Register - Detail (Bill Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.ServiceJobOrderRegister_DateWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SalesOrder")
                    FromToDt = GetFromToDateSeriesFilter("{SalesOrder.Doc_Dt}", "{SalesOrder.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_ServiceJOBRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceJOBRpt.Doc_Dt}", "{Vw_ServiceJOBRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        ReportParameters.rptCaption = "Job Order Register - Details (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <> '0'" & FromToDt & PartyFltr & LocFilter
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Item("ReportCaption#S") = "PO Register - Detail (" & lstMain.Text & ")"
                    Else
                        ReportParameters.rptCaption = "Job Order Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <> '0'" & FromToDt & PartyFltr & LocFilter
                        'Formulas.Item("ReportCaption#S") = "PO Register - Summary (" & lstMain.Text & ")"
                    End If
                Else

                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", 1)

                    If rdSummary.Checked Then
                        ReportParameters.rptCaption = "Job Order Register - Summary (Date Wise)"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <> '0'" & FromToDt & PartyFltr

                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    Else
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <> '0'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Job Order Register - Detail (Date Wise)"

                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Item("DisplayDetails#N") = 1
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)





                '3
            Case ReportType.SalesOrderRegister_PartyWise
                LocFilter = ""
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SalesOrder")
                    FromToDt = GetFromToDateSeriesFilter("{SalesOrder.Doc_Dt}", "{SalesOrder.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Order Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Sales Order Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else

                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 3)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0' " & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Order Register - Summary (Party Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0'" & FromToDt & PartyFltr & strSOFilter1
                        ReportParameters.rptCaption = "Sales Order Register - Detail (Party Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.StockReadyToDispatch
                LocFilter = ""
                StockParam = ""
                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForTJS)) = 1 Then
                    StockParam = GetStockFilter("Vw_SalesOrder", False, False)
                End If


                PartyFltr = GetPartyFilter("Vw_SalesOrder")
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrder.Doc_Dt}", "{Vw_SalesOrder.Doc_Type}")
                ReportParameters.rptCaption = "Stock Ready to Dispatch"
                ReportParameters.rptFile = ReportPath & "\Reports\StockReadyToDispatch.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrder.Status} <>'0' " & FromToDt & PartyFltr & LocFilter & StockParam


            Case ReportType.ServiceJobOrderRegister_PartyWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SalesOrder")
                    FromToDt = GetFromToDateSeriesFilter("{SalesOrder.Doc_Dt}", "{SalesOrder.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_ServiceJOBRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceJOBRpt.Doc_Dt}", "{Vw_ServiceJOBRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Job Order Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <>'0' " & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Job Order Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else

                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 3)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0' " & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Job Order Register - Summary (Party Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <>'0'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Job Order Register - Detail (Party Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)




                '4
            Case ReportType.SalesOrderRegister_ConsigneeWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SalesOrder")
                    FromToDt = GetFromToDateSeriesFilter("{SalesOrder.Doc_Dt}", "{SalesOrder.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}")
                End If

                'If rdSummary.Checked Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.DlvParty_Key}")
                'Else
                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.DlvParty_Key}")
                'End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If


                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Order Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Sales Order Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 6)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0' " & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Order Register - Summary (Consignee Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Order Register - Detail (Consignee Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                '5
            Case ReportType.SalesOrderRegister_BrokerWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SalesOrder")
                    FromToDt = GetFromToDateSeriesFilter("{SalesOrder.Doc_Dt}", "{SalesOrder.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}")
                End If


                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.Broker_Key}")

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If


                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Order Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Sales Order Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 7)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' And {SalesOrder.Status} <>'0' " & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Order Register - Summary (Broker Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Order Register - Detail (Broker Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                'Sales Order Item
            Case ReportType.SalesOrderRegister_ProductWise, ReportType.SalesOrderRegister_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_SalesOrderRpt")
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")

                If lblOperator.Text = "Consignee" Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.DlvParty_Key}")
                ElseIf lblOperator.Text = "Broker" Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.Broker_Key}")
                End If
                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    'Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    'If rptType = ReportType.PurOrderRegister_SubGroupWise Then
                    '    Formulas.Add("GroupOn3#S", "U")
                    If rptType = ReportType.SalesOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.ServiceJobOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.SalesOrderRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")
                    If rdDetailed.Checked Then
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    End If

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", Me.Text)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Sales Order Detail"
                    Else
                        ReportParameters.rptCaption = "Sales Order Summary"

                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


            Case ReportType.ServiceJobOrderRegister_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceJOBRpt.Doc_Dt}", "{Vw_ServiceJOBRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_ServiceJOBRpt")
                PartyFltr = GetPartyFilter("Vw_ServiceJOBRpt")

                If lblOperator.Text = "Consignee" Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_ServiceJOBRpt.DlvParty_Key}")
                ElseIf lblOperator.Text = "Broker" Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_ServiceJOBRpt.Broker_Key}")
                End If
                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    'Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    'If rptType = ReportType.PurOrderRegister_SubGroupWise Then
                    '    Formulas.Add("GroupOn3#S", "U")
                    If rptType = ReportType.SalesOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.ServiceJobOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.SalesOrderRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")
                    If rdDetailed.Checked Then
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    End If

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", Me.Text)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Job Order Detail"
                    Else
                        ReportParameters.rptCaption = "Job Order Summary"

                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


            Case ReportType.SalesOrderRegister_PartyProdWise, ReportType.SalesOrderRegister_ConsigneeProdWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_SalesOrderRpt")
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForTJS)) = 1 Then ''Satyam 22072022 

                    If lblOperator.Text = "Consignee" Then
                        SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.DlvParty_Key}")
                    ElseIf lblOperator.Text = "Broker" Then
                        SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.Broker_Key}")
                    End If
                    If SelCounter.Trim.Length > 0 Then
                        PartyFltr &= " And " & SelCounter
                    End If
                End If
                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr & strSOFilter1

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "S")
                    Formulas.Add("GroupOn2#S", "P")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    If rdDetailed.Checked Then
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    End If

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Sales Order Detail"
                    Else
                        ReportParameters.rptCaption = "Sales Order Summary"
                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


            Case ReportType.ServiceJobOrderRegister_PartyProdWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceJOBRpt.Doc_Dt}", "{Vw_ServiceJOBRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_ServiceJOBRpt")
                PartyFltr = GetPartyFilter("Vw_ServiceJOBRpt")

                If lblOperator.Text = "Consignee" Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_ServiceJOBRpt.DlvParty_Key}")
                ElseIf lblOperator.Text = "Broker" Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_ServiceJOBRpt.Broker_Key}")
                End If
                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\ServiceJobOrderRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "S")
                    Formulas.Add("GroupOn2#S", "P")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    If rdDetailed.Checked Then
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    End If

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Job Order Detail"
                    Else
                        ReportParameters.rptCaption = "Job Order Summary"
                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If




                ' Pending Sales Order

            Case ReportType.PendSalesOrderRegister_DateWise, ReportType.PendSalesOrderRegister_BillWise, ReportType.PendSalesOrderRegister_PartyWise, ReportType.PendSalesOrderRegister_ConsigneeWise, ReportType.PendSalesOrderRegister_BrokerWise

                LocFilter = ""
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}")

                If rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.DlvParty_Key}")
                ElseIf rptType = ReportType.PendSalesOrderRegister_BrokerWise Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.Broker_Key}")
                End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                OthOptions = "" ''All

                If rdOthOption1.Checked Then
                    OthOptions = " And {Vw_SalesOrderRpt.BalQty} > 0 And {Vw_SalesOrderRpt.Status} = '1'" ''Pending
                ElseIf rdOthOption2.Checked Then
                    OthOptions = " And {Vw_SalesOrderRpt.BalQty} = 0" ''Completed
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then

                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        'Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If


                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Order Status Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <> '0'" & FromToDt & PartyFltr & LocFilter & OthOptions
                    Else
                        ReportParameters.rptCaption = "Sales Order Status Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <> '0'" & FromToDt & PartyFltr & LocFilter & OthOptions
                    End If
                Else

                    If rdSummary.Checked Then

                        If rptType = ReportType.PendSalesOrderRegister_BillWise Then
                            Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                            Formulas.Add("DisplayDetails#N", 1)
                            Formulas.Add("GroupOn1#N", 0) '2

                        ElseIf rptType = ReportType.PendSalesOrderRegister_DateWise Then
                            Formulas.Add("DateGrp#N", 1)
                            Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                            Formulas.Add("GroupOn1#N", 0)

                        ElseIf rptType = ReportType.PendSalesOrderRegister_PartyWise Then
                            Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                            Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                            Formulas.Add("GroupOn1#N", 3)

                        ElseIf rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Then
                            Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                            Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                            Formulas.Add("GroupOn1#N", 6)

                        ElseIf rptType = ReportType.PendSalesOrderRegister_BrokerWise Then
                            Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                            Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                            Formulas.Add("GroupOn1#N", 7)
                        End If

                        ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <> '0'" & FromToDt & PartyFltr & OthOptions
                        ReportParameters.rptCaption = "Sales Order Status Register - Summary"
                    Else

                        Formulas.Add("DisplayDetails#N", 1)
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        If rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Then
                            Formulas.Add("GroupOn1#N", 6)
                        ElseIf rptType = ReportType.PendSalesOrderRegister_BrokerWise Then
                            Formulas.Add("GroupOn1#N", 7)
                        ElseIf rptType = ReportType.PendSalesOrderRegister_PartyWise Then
                            Formulas.Add("GroupOn1#N", 3)
                        Else
                            Formulas.Add("GroupOn1#N", 0)
                        End If

                        ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <> '0'" & FromToDt & PartyFltr & OthOptions
                        ReportParameters.rptCaption = "Sales Order Status Register - Detail"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)



            Case ReportType.PendServiceJobOrderRegister_DateWise, ReportType.PendServiceJobOrderRegister_BillWise, ReportType.PendServiceJobOrderRegister_PartyWise

                LocFilter = ""
                PartyFltr = GetPartyFilter("Vw_ServiceJOBRpt")
                FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceJOBRpt.Doc_Dt}", "{Vw_ServiceJOBRpt.Doc_Type}")

                If rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_ServiceJOBRpt.DlvParty_Key}")
                ElseIf rptType = ReportType.PendSalesOrderRegister_BrokerWise Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_ServiceJOBRpt.Broker_Key}")
                End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                OthOptions = "" ''All

                If rdOthOption1.Checked Then
                    OthOptions = " And {Vw_ServiceJOBRpt.BalQty} > 0 And {Vw_ServiceJOBRpt.Status} = '1'" ''Pending
                ElseIf rdOthOption2.Checked Then
                    OthOptions = " And {Vw_ServiceJOBRpt.BalQty} = 0" ''Completed
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then

                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        'Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If


                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Job Order Status Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PendServiceJobOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <> '0'" & FromToDt & PartyFltr & LocFilter & OthOptions
                    Else
                        ReportParameters.rptCaption = "Job Order Status Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PendServiceobOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <> '0'" & FromToDt & PartyFltr & LocFilter & OthOptions
                    End If
                Else

                    If rdSummary.Checked Then

                        If rptType = ReportType.PendServiceJobOrderRegister_BillWise Then
                            Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                            Formulas.Add("DisplayDetails#N", 1)
                            Formulas.Add("GroupOn1#N", 0) '2

                        ElseIf rptType = ReportType.PendServiceJobOrderRegister_DateWise Then
                            Formulas.Add("DateGrp#N", 1)
                            Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                            Formulas.Add("GroupOn1#N", 0)

                        ElseIf rptType = ReportType.PendServiceJobOrderRegister_PartyWise Then
                            Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                            Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                            Formulas.Add("GroupOn1#N", 3)


                        End If

                        ReportParameters.rptFile = ReportPath & "\Reports\PendServiceJobOrderRegDoc.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <> '0'" & FromToDt & PartyFltr & OthOptions
                        ReportParameters.rptCaption = "Job Order Status Register - Summary"
                    Else

                        Formulas.Add("DisplayDetails#N", 1)
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))


                        If rptType = ReportType.PendServiceJobOrderRegister_PartyWise Then
                            Formulas.Add("GroupOn1#N", 3)
                        Else
                            Formulas.Add("GroupOn1#N", 0)
                        End If

                        ReportParameters.rptFile = ReportPath & "\Reports\PendServiceJobOrderRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <> '0'" & FromToDt & PartyFltr & OthOptions
                        ReportParameters.rptCaption = "Job Order Status Register - Detail"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.PendSalesOrderRegister_ProductWise, ReportType.PendSalesOrderRegister_BrandWise

                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_SalesOrderRpt")
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")

                'If rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.DlvParty_Key}")
                'ElseIf rptType = ReportType.PendSalesOrderRegister_BrokerWise Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.Broker_Key}")
                'End If

                'If SelCounter.Trim.Length > 0 Then
                '    PartyFltr &= " And " & SelCounter
                'End If

                OthOptions = "" ''All
                If rdOthOption1.Checked Then
                    OthOptions = " And {Vw_SalesOrderRpt.BalQty} > 0 And {Vw_SalesOrderRpt.Status} = '1'" ''Pending
                ElseIf rdOthOption2.Checked Then
                    OthOptions = " And {Vw_SalesOrderRpt.BalQty} = 0" ''Completed
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderRegProdDtl.rpt"
                    ReportParameters.rptCaption = "Sales Order Status Detail"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderRegProdSum.rpt"
                    ReportParameters.rptCaption = "Sales Order Status Summary"
                    ReportParameters.POSummary = True
                End If

                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} = '1'" & FromToDt & PartyFltr & StockFltr & OthOptions

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")

                    If rptType = ReportType.PendPurOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.PendPurOrderRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    If rdDetailed.Checked Then
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    End If

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", Me.Text)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Sales Order Detail"

                    Else
                        ReportParameters.rptCaption = "Sales Order Summary"
                    End If
                    'If chkDispRate.Checked = False Then
                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                    'End If
                End If


            Case ReportType.PendServiceJobOrderRegister_ProductWise

                FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceJOBRpt.Doc_Dt}", "{Vw_ServiceJOBRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_ServiceJOBRpt")
                PartyFltr = GetPartyFilter("Vw_ServiceJOBRpt")

                'If rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.DlvParty_Key}")
                'ElseIf rptType = ReportType.PendSalesOrderRegister_BrokerWise Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.Broker_Key}")
                'End If

                'If SelCounter.Trim.Length > 0 Then
                '    PartyFltr &= " And " & SelCounter
                'End If

                OthOptions = "" ''All
                If rdOthOption1.Checked Then
                    OthOptions = " And {Vw_ServiceJOBRpt.BalQty} > 0 And {Vw_ServiceJOBRpt.Status} = '1'" ''Pending
                ElseIf rdOthOption2.Checked Then
                    OthOptions = " And {Vw_ServiceJOBRpt.BalQty} = 0" ''Completed
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PendServiceJobOrderRegProdDtl.rpt"
                    ReportParameters.rptCaption = "Job Order Status Detail"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PendServiceJobOrderRegProdSum.rpt"
                    ReportParameters.rptCaption = "Job Order Status Summary"
                    ReportParameters.POSummary = True
                End If

                ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} = '1'" & FromToDt & PartyFltr & StockFltr & OthOptions

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")

                    If rptType = ReportType.PendPurOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.PendPurOrderRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    If rdDetailed.Checked Then
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    End If

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", Me.Text)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Job Order Detail"

                    Else
                        ReportParameters.rptCaption = "Job Order Summary"
                    End If
                    'If chkDispRate.Checked = False Then
                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                    'End If
                End If




            Case ReportType.PendSalesOrderRegister_PartyProdWise, ReportType.PendSalesOrderRegister_ConsigneeProdWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_SalesOrderRpt")
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")

                If rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.DlvParty_Key}")
                ElseIf rptType = ReportType.PendSalesOrderRegister_BrokerWise Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.Broker_Key}")
                End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                OthOptions = "" ''All
                If rdOthOption1.Checked Then
                    OthOptions = " And {Vw_SalesOrderRpt.BalQty} > 0 And {Vw_SalesOrderRpt.Status} = '1'" ''Pending
                ElseIf rdOthOption2.Checked Then
                    OthOptions = " And {Vw_SalesOrderRpt.BalQty} = 0" ''Completed
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr & OthOptions


                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "S")
                    Formulas.Add("GroupOn2#S", "P")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    If rdDetailed.Checked Then
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    End If

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Sales Order Detail"
                    Else
                        ReportParameters.rptCaption = "Sales Order Summary"
                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


                'ReportParameters.POSummary = False

                '''''''''''''''''''''''Delivery Challan

                '1

            Case ReportType.SalesOrderRegister_AllInOne
                ReDim subrpt(1)

                If rdOthOption3.Checked Then
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}")
                Else
                    FromToDt = GetFrom2To2DateSeriesFilter("{Vw_SalesOrderRpt.DlvDt}", "{Vw_SalesOrderRpt.Doc_Type}")
                End If

                StockFltr = GetStockFilter("Vw_SalesOrderRpt")
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")

                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.DlvParty_Key}")

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                OthOptions = "" ''All
                If rdOthOption1.Checked Then
                    OthOptions = " And {Vw_SalesOrderRpt.BalQty} > 0 And {Vw_SalesOrderRpt.Status} = '1'" ''Pending
                    Formulas.Add("StatusType#S", "P")
                ElseIf rdOthOption2.Checked Then
                    OthOptions = " And {Vw_SalesOrderRpt.BalQty} <= 0" ''Completed
                    Formulas.Add("StatusType#S", "C")
                Else
                    Formulas.Add("StatusType#S", "A")
                End If

                If (cmbProductGrp.Properties.Items.Count = Split(cmbProductSubGrp.Text).Length) Or cmbProductSubGrp.Text = "" Then
                    Formulas.Add("ItemSubGrp_Name#S", "ALL")
                Else
                    Formulas.Add("ItemSubGrp_Name#S", cmbProductSubGrp.Text)
                End If

                If (cmbProductGrp.Properties.Items.Count = Split(cmbProductGrp.Text).Length) Or cmbProductGrp.Text = "" Then
                    Formulas.Add("Vertical#S", "ALL")
                Else
                    Formulas.Add("Vertical#S", cmbProductGrp.Text)
                End If

                If (cmbBrand.Properties.Items.Count = Split(cmbBrand.Text).Length) Or cmbBrand.Text = "" Then
                    Formulas.Add("Brand#S", "ALL")
                Else
                    Formulas.Add("Brand#S", cmbBrand.Text)
                End If

                If (cmbStation.Properties.Items.Count = Split(cmbStation.Text).Length) Or cmbStation.Text = "" Then
                    Formulas.Add("Stn_Name#S", "ALL")
                Else
                    Formulas.Add("Stn_Name#S", cmbStation.Text)
                End If

                If (cmbCountry.Properties.Items.Count = Split(cmbCountry.Text).Length) Or cmbCountry.Text = "" Then
                    Formulas.Add("Country#S", "ALL")
                Else
                    Formulas.Add("Country#S", cmbCountry.Text)
                End If

                If (cmbRegion.Properties.Items.Count = Split(cmbRegion.Text).Length) Or cmbRegion.Text = "" Then
                    Formulas.Add("Regn_Name#S", "ALL")
                Else
                    Formulas.Add("Regn_Name#S", cmbRegion.Text)
                End If

                If (cmbProduct.Properties.Items.Count = Split(cmbProduct.Text).Length) Or cmbProduct.Text = "" Then
                    Formulas.Add("ITEM#S", "ALL")
                Else
                    Formulas.Add("ITEM#S", cmbProduct.Text)
                End If

                '    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                '    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_SOUsers]')) " _
                      & " Drop View [dbo].[vw_SOUsers]"
                Common.ExecuteQuery(Query)

                Query = " Create View [vw_SOUsers] as SELECT DISTINCT Created_By, 0 Assign_To FROM SalesOrder WHERE " & AsPerUser & "  " _
                      & " UNION ALL " _
                      & " Select Distinct 0, Assign_To From SalesOrder Where Assign_To = " & UserId
                Common.ExecuteQuery(Query)

                If chkSize.Checked Then

                    subrpt(0).Report = "currencysummary.rpt"
                    subrpt(0).Filter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr & OthOptions

                    ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderRegDocDtlValue.rpt"
                Else
                    subrpt(0).Report = "currencysummary.rpt"
                    subrpt(0).Filter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr & OthOptions

                    ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderRegDocDtl.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr & OthOptions


                'If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                '    Formulas = New Hashtable

                '    Formulas.Add("GroupOn1#S", "S")
                '    Formulas.Add("GroupOn2#S", "P")
                '    Formulas.Add("GroupOn3#S", "")

                '    Formulas.Add("Text1#S", "T")
                '    Formulas.Add("Text2#S", "Y")
                '    Formulas.Add("Text3#S", "H")

                '    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                '    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                '    If rdDetailed.Checked Then
                '        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                '    End If

                '    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                '    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                'Else
                '    If rdDetailed.Checked Then
                '        ReportParameters.rptCaption = "Sales Order Detail"
                '    Else
                '        ReportParameters.rptCaption = "Sales Order Summary"
                '    End If

                '    If rdDetailed.Checked Then
                '        ReportParameters.DisplayDetails = True
                '    Else
                '        ReportParameters.DisplayDetails = False
                '    End If
                '    ReportParameters.TotalText = True
                '    ViewReportWithOptions(ReportParameters.rptCaption)
                'End If


            Case ReportType.SalesOrderStatusANS


                SelCounter = "" : TaxFilter = "" : PurType = ""

                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderDlvDt.DlvDate}", "{SalesOrder.Doc_Type}", False)
                FromToDt1 = GetFrom1To1DateSeriesFilter("{SalesOrder.Party_RefDt}", "{SalesOrder.Doc_Type}", False)

                StockFltr = "" 'GetStockFilter("Vw_SalesOrderRpt")
                PartyFltr = GetPartyFilter("SalesOrder")

                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.SalesPerson_Key}")
                TaxFilter = GetSelectedAttributesForUsers(cmbSalesType, "{SalesOrder.SOStatus_Id}")
                PurType = GetSelectedAttributesForStock(cmbTax, "{SalesOrder.PreCarrage}")

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If TaxFilter.Trim.Length > 0 Then
                    PartyFltr &= " And " & TaxFilter
                End If

                If PurType.Trim.Length > 0 Then
                    PartyFltr &= " And " & PurType
                End If

                'Formulas.Add("DelFromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                'Formulas.Add("DelToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                'Formulas.Add("BuyerFromDate#S", Format$(dtpFrom1.Value, "dd/MM/yyyy"))
                'Formulas.Add("BuyerToDate#S", Format$(dtpTo1.Value, "dd/MM/yyyy"))

                If rdOthOption1.Checked = True Then
                    If chkDispRate.Checked Then
                        ReDim subrpt(2)

                        subrpt(0).Report = "MonthlyOrderStatusCurrency"
                        'subrpt(0).FormulaName = "DelFromDate"
                        'subrpt(0).FormulaValue = Format$(dtpFrom.Value, "dd/MM/yyyy")
                        'subrpt(0).FormulaName = "DelToDate"
                        'subrpt(0).FormulaValue = Format$(dtpTo.Value, "dd/MM/yyyy")
                        'subrpt(0).FormulaName = "BuyerFromDate"
                        'subrpt(0).FormulaValue = Format$(dtpFrom1.Value, "dd/MM/yyyy")
                        'subrpt(0).FormulaName = "BuyerToDate"
                        'subrpt(0).FormulaValue = Format$(dtpTo1.Value, "dd/MM/yyyy")
                        subrpt(0).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr

                        subrpt(1).Report = "MonthlyOrderStatusCurrency1"
                        subrpt(1).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderStatusMonthWise.rpt"

                    ElseIf chkDispValue.Checked Then
                        ReDim subrpt(1)
                        subrpt(0).Report = "MonthlyOrderStatusCurrency"
                        subrpt(0).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderStatusDocWise.rpt"
                    End If

                    ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr

                ElseIf rdOthOption2.Checked Then

                    If chkDispRate.Checked = True Then
                        'subrpt(0).Report = "currencysummary.rpt"
                        'subrpt(0).Filter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr & OthOptions
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderStatusPurchaseMonthWise.rpt"

                    ElseIf chkDispValue.Checked Then
                        'subrpt(0).Report = "currencysummary.rpt"
                        'subrpt(0).Filter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr & OthOptions
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderStatusPurchaseDocWise.rpt"
                    End If

                    ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr '& StockFltr & SelCounter & TaxFilter & PurType
                End If


                'ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr & OthOptions

                'Nitin


            Case ReportType.SalesOrderRegister_AllInOneANS


                SelCounter = "" : TaxFilter = "" : PurType = ""

                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderDlvDt.DlvDate}", "{SalesOrder.Doc_Type}", False)
                FromToDt1 = GetFrom1To1DateSeriesFilter("{SalesOrder.Party_RefDt}", "{SalesOrder.Doc_Type}", False)

                StockFltr = "" 'GetStockFilter("Vw_SalesOrderRpt")
                PartyFltr = GetPartyFilter("SalesOrder")

                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.SalesPerson_Key}")
                TaxFilter = GetSelectedAttributesForUsers(cmbSalesType, "{SalesOrder.SOStatus_Id}")
                PurType = GetSelectedAttributesForStock(cmbTax, "{SalesOrder.PreCarrage}")

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If TaxFilter.Trim.Length > 0 Then
                    PartyFltr &= " And " & TaxFilter
                End If

                If PurType.Trim.Length > 0 Then
                    PartyFltr &= " And " & PurType
                End If


                ReportParameters.rptFile = ReportPath & "\Reports\BuyerWiseGrid.rpt"
                If cmbSONo.SelectedIndex > -1 Then
                    ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' and {SalesOrder.Doc_id}=" & cmbSONo.Value & " " & PartyFltr

                Else
                    ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "'" & PartyFltr



                End If
                '-----------------------
            Case ReportType.OCPendingStatus


                SelCounter = "" : TaxFilter = "" : PurType = ""

                FromToDt = GetFromToDateSeriesFilter("{SalesOrder.DlvDate}", "{SalesOrder.Doc_Type}", False)
                FromToDt1 = GetFrom1To1DateSeriesFilter("{SalesOrder.Party_RefDt}", "{SalesOrder.Doc_Type}", False)

                StockFltr = "" 'GetStockFilter("Vw_SalesOrderRpt")
                PartyFltr = GetPartyFilter("SalesOrder", True)

                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.SalesPerson_Key}")
                TaxFilter = GetSelectedAttributesForUsers(cmbSalesType, "{SalesOrder.SOStatus_Id}")
                PurType = GetSelectedAttributesForStock(cmbTax, "{SalesOrder.PreCarrage}")

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If TaxFilter.Trim.Length > 0 Then
                    PartyFltr &= " And " & TaxFilter
                End If

                If PurType.Trim.Length > 0 Then
                    PartyFltr &= " And " & PurType
                End If

                If rdOthOption1.Checked = True Then
                    If chkDispRate.Checked Then
                        ReDim subrpt(1)
                        subrpt(0).Report = "Pending Order Buyer"
                        subrpt(0).Filter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr
                        ReportParameters.rptFile = ReportPath & "\Reports\OCPendingStatusProductwise.rpt"

                    Else

                        Query = "Delete from TmpOcPendingStatus"
                        Common.ExecuteQuery(Query)

                        Dim strToMonth As String = Format$(Month(dtpTo.Value), "00")
                        Dim StrFromDate As String = ""
                        Dim StrToDate As String = ""

                        Dim FromYr As Integer
                        Dim ToYr As Integer
                        Dim FromToYr As Byte

                        FromYr = Mid$(Year(dtpFrom.Value), 3)

                        If strToMonth = "01" Or strToMonth = "02" Or strToMonth = "03" Then
                            ToYr = Mid$(Year(dtpTo.Value) - 1, 3)
                        Else
                            ToYr = Mid$(Year(dtpTo.Value), 3)
                        End If

                        For FromToYr = FromYr To ToYr
                            If FromYr = ToYr Then
                                Query = "Insert Into TmpOcPendingStatus values('" & FromToYr & "','" & SelBranchId & "','" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "','" & Format$(dtpTo.Value, "MM/dd/yyyy") & "')"
                            ElseIf FromYr = FromToYr Then
                                StrToDate = "31/03/" & FromYr + 1
                                Query = "Insert Into TmpOcPendingStatus values('" & FromToYr & "','" & SelBranchId & "','" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "','" & Format$(CDate(StrToDate), "MM/dd/yyyy") & "')"
                            ElseIf ToYr = FromToYr Then
                                StrFromDate = "01/04/" & ToYr
                                Query = "Insert Into TmpOcPendingStatus values('" & FromToYr & "','" & SelBranchId & "','" & Format$(CDate(StrFromDate), "MM/dd/yyyy") & "','" & Format$(dtpTo.Value, "MM/dd/yyyy") & "')"
                            Else
                                StrFromDate = "01/04/" & FromToYr
                                StrToDate = "31/03/" & FromToYr + 1
                                Query = "Insert Into TmpOcPendingStatus values('" & FromToYr & "','" & SelBranchId & "','" & Format$(CDate(StrFromDate), "MM/dd/yyyy") & "','" & Format$(CDate(StrToDate), "MM/dd/yyyy") & "')"
                            End If

                            Common.ExecuteQuery(Query)

                        Next

                        ReDim subrpt(1)
                        subrpt(0).Report = "Pending Order Buyer"
                        subrpt(0).Filter = "{Salesorder.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr
                        ReportParameters.rptFile = ReportPath & "\Reports\OCPendingStatusBuyerwise.rpt"
                    End If

                    'ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr

                ElseIf rdOthOption2.Checked Then

                    If chkDispRate.Checked = True Then



                        ReDim subrpt(1)
                        subrpt(0).Report = "Pending Order Buyer"
                        subrpt(0).Filter = "{cobr.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr
                        ReportParameters.rptFile = ReportPath & "\Reports\OCPendingStatusBuyerwise.rpt"

                    Else

                        Query = "Delete from TmpOcPendingStatusproductwise"
                        Common.ExecuteQuery(Query)

                        Dim strToMonth As String = Format$(Month(dtpTo.Value), "00")
                        Dim StrFromDate As String = ""
                        Dim StrToDate As String = ""

                        Dim FromYr As Integer
                        Dim ToYr As Integer
                        Dim FromToYr As Byte

                        FromYr = Mid$(Year(dtpFrom.Value), 3)

                        If strToMonth = "01" Or strToMonth = "02" Or strToMonth = "03" Then
                            ToYr = Mid$(Year(dtpTo.Value) - 1, 3)
                        Else
                            ToYr = Mid$(Year(dtpTo.Value), 3)
                        End If

                        For FromToYr = FromYr To ToYr
                            If FromYr = ToYr Then
                                Query = "Insert Into TmpOcPendingStatusproductwise values('" & FromToYr & "','" & SelBranchId & "','" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "','" & Format$(dtpTo.Value, "MM/dd/yyyy") & "')"
                            ElseIf FromYr = FromToYr Then
                                StrToDate = "31/03/" & FromYr + 1
                                Query = "Insert Into TmpOcPendingStatusproductwise values('" & FromToYr & "','" & SelBranchId & "','" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "','" & Format$(CDate(StrToDate), "MM/dd/yyyy") & "')"
                            ElseIf ToYr = FromToYr Then
                                StrFromDate = "01/04/" & ToYr
                                Query = "Insert Into TmpOcPendingStatusproductwise values('" & FromToYr & "','" & SelBranchId & "','" & Format$(CDate(StrFromDate), "MM/dd/yyyy") & "','" & Format$(dtpTo.Value, "MM/dd/yyyy") & "')"
                            Else
                                StrFromDate = "01/04/" & FromToYr
                                StrToDate = "31/03/" & FromToYr + 1
                                Query = "Insert Into TmpOcPendingStatusproductwise values('" & FromToYr & "','" & SelBranchId & "','" & Format$(CDate(StrFromDate), "MM/dd/yyyy") & "','" & Format$(CDate(StrToDate), "MM/dd/yyyy") & "')"
                            End If

                            Common.ExecuteQuery(Query)

                        Next


                        ReDim subrpt(1)
                        subrpt(0).Report = "Pending Order Buyer"
                        subrpt(0).Filter = "{cobr.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr
                        ReportParameters.rptFile = ReportPath & "\Reports\OCPendingStatusProductwise.rpt"
                    End If

                    'ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr '& StockFltr & SelCounter & TaxFilter & PurType
                End If


                'ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr & OthOptions
            Case ReportType.BuyerProgressChart


                SelCounter = "" : TaxFilter = "" : PurType = ""

                FromToDt = GetFromToDateSeriesFilter("{SalesOrder.DlvDate}", "{SalesOrder.Doc_Type}", False)
                FromToDt1 = GetFrom1To1DateSeriesFilter("{SalesOrder.Party_RefDt}", "{SalesOrder.Doc_Type}", False)

                StockFltr = "" 'GetStockFilter("Vw_SalesOrderRpt")
                PartyFltr = GetPartyFilter("SalesOrder")

                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.SalesPerson_Key}")
                TaxFilter = GetSelectedAttributesForUsers(cmbSalesType, "{SalesOrder.SOStatus_Id}")
                PurType = GetSelectedAttributesForStock(cmbTax, "{SalesOrder.PreCarrage}")

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If TaxFilter.Trim.Length > 0 Then
                    PartyFltr &= " And " & TaxFilter
                End If

                If PurType.Trim.Length > 0 Then
                    PartyFltr &= " And " & PurType
                End If

                'Formulas.Add("DelFromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                'Formulas.Add("DelToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                'Formulas.Add("BuyerFromDate#S", Format$(dtpFrom1.Value, "dd/MM/yyyy"))
                'Formulas.Add("BuyerToDate#S", Format$(dtpTo1.Value, "dd/MM/yyyy"))

                If rdOthOption1.Checked = True Then
                    chkDispRate.Visible = False
                    'If chkDispRate.Checked = True Then
                    If Not chkDispValue.Checked = True Then
                        ReDim subrpt(1)
                        subrpt(0).Report = "Pending Order Buyer"
                        subrpt(0).Filter = "{cobr.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr


                        ReportParameters.rptFile = ReportPath & "\Reports\BuyerWiseProgressOCEXRate.rpt"

                    ElseIf chkDispValue.Checked Then
                        ReDim subrpt(1)
                        subrpt(0).Report = "Pending Order Buyer"
                        subrpt(0).Filter = "{cobr.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr
                        ReportParameters.rptFile = ReportPath & "\Reports\BuyerWiseProgressCurrentEXRate.rpt"
                    End If



                ElseIf rdOthOption2.Checked Then
                    chkDispRate.Visible = False
                    'If chkDispRate.Checked = True Then
                    If Not chkDispValue.Checked = True Then
                        ReDim subrpt(1)
                        subrpt(0).Report = "Pending Order Buyer"
                        subrpt(0).Filter = "{cobr.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr
                        ReportParameters.rptFile = ReportPath & "\Reports\BuyerWiseProgressOCEXRate.rpt"

                    ElseIf chkDispValue.Checked Then
                        ReDim subrpt(1)
                        subrpt(0).Report = "Pending Order Buyer"
                        subrpt(0).Filter = "{cobr.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr
                        ReportParameters.rptFile = ReportPath & "\Reports\BuyerWiseProgressOCEXRate.rpt"
                    End If

                End If


                'ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_SalesOrderRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr & OthOptions


                'Nitin

                '-----

            Case ReportType.CountryBuyerwiseOrderAnalysis


                SelCounter = "" : TaxFilter = "" : PurType = ""

                FromToDt = GetFromToDateSeriesFilter("{SalesOrder.DlvDate}", "{SalesOrder.Doc_Type}", False)
                FromToDt1 = GetFrom1To1DateSeriesFilter("{SalesOrder.Party_RefDt}", "{SalesOrder.Doc_Type}", False)

                StockFltr = "" 'GetStockFilter("Vw_SalesOrderRpt")
                PartyFltr = GetPartyFilter("SalesOrder")

                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.SalesPerson_Key}")
                TaxFilter = GetSelectedAttributesForUsers(cmbSalesType, "{SalesOrder.SOStatus_Id}")
                PurType = GetSelectedAttributesForStock(cmbTax, "{SalesOrder.PreCarrage}")

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If TaxFilter.Trim.Length > 0 Then
                    PartyFltr &= " And " & TaxFilter
                End If

                If PurType.Trim.Length > 0 Then
                    PartyFltr &= " And " & PurType
                End If

                'Formulas.Add("DelFromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                'Formulas.Add("DelToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                'Formulas.Add("BuyerFromDate#S", Format$(dtpFrom1.Value, "dd/MM/yyyy"))
                'Formulas.Add("BuyerToDate#S", Format$(dtpTo1.Value, "dd/MM/yyyy"))

                If rdOthOption1.Checked = True Then
                    chkDispRate.Visible = False
                    'If chkDispRate.Checked = True Then
                    If Not chkDispValue.Checked = True Then

                        ReDim subrpt(1)
                        subrpt(0).Report = "Pending Order Buyer"
                        subrpt(0).Filter = "{cobr.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr


                        ReportParameters.rptFile = ReportPath & "\Reports\BuyerWiseProgressOCEXRate.rpt"

                    ElseIf chkDispValue.Checked Then

                        ReportParameters.rptFile = ReportPath & "\Reports\CountryWiseBuyerWiseOrderAnal.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & FromToDt1 & PartyFltr

                    End If



                ElseIf rdOthOption2.Checked Then
                    chkDispRate.Visible = False
                    'If chkDispRate.Checked = True Then
                    If Not chkDispValue.Checked = True Then
                        ReDim subrpt(1)
                        subrpt(0).Report = "Pending Order Buyer"
                        subrpt(0).Filter = "{cobr.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & FromToDt1 & PartyFltr
                        ReportParameters.rptFile = ReportPath & "\Reports\BuyerWiseProgressOCEXRate.rpt"

                    ElseIf chkDispValue.Checked Then
                        'ReportParameters.rptFile = ReportPath & "\Reports\CountryWiseSummary.rpt"
                        'ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & FromToDt1 & PartyFltr

                        'ReportParameters.PrintToPrinter = False
                        'ReportParameters.PrintFormat = ReportParameters.PrintType.PrintToWindow
                        'ReportParameters.rptCaption = Me.Text

                        'Dim frmView As New frmViewReports
                        'frmView = New frmViewReports
                        'frmView.Show()

                        ReportParameters.rptFile = ReportPath & "\Reports\CountryWiseBuyerWiseOrderAnal.rpt"
                        ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & FromToDt1 & PartyFltr

                        ReportParameters.PrintToPrinter = False
                        ReportParameters.PrintFormat = ReportParameters.PrintType.PrintToWindow
                        ReportParameters.rptCaption = Me.Text

                        Dim frmView1 As New frmViewReports
                        frmView1 = New frmViewReports
                        frmView1.Show()

                    End If

                End If


            Case ReportType.ProductCategorywiseBuyerwiseOrderAnal

                Dim SelGroup As String = ""
                Dim SelSubGroup As String = ""
                Dim SelProducts As String = ""
                Dim SelStyle As String = ""
                SelCounter = "" : TaxFilter = "" : PurType = ""

                FromToDt = GetFromToDateSeriesFilter("{SalesOrder.DlvDate}", "{SalesOrder.Doc_Type}", False)
                FromToDt1 = GetFrom1To1DateSeriesFilter("{SalesOrder.Party_RefDt}", "{SalesOrder.Doc_Type}", False)

                StockFltr = "" 'GetStockFilter("Vw_SalesOrderRpt")
                PartyFltr = GetPartyFilter("SalesOrder")

                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.SalesPerson_Key}")
                TaxFilter = GetSelectedAttributesForUsers(cmbSalesType, "{SalesOrder.SOStatus_Id}")
                PurType = GetSelectedAttributesForStock(cmbTax, "{SalesOrder.PreCarrage}")

                SelGroup = GetSelectedAttributesForStock(cmbProductGrp, "{ItemGrp.ItemGrp_Key}")
                If SelGroup.Trim.Length > 0 Then
                    StockParam &= " And " & SelGroup
                End If

                SelSubGroup = GetSelectedAttributesForStock(cmbProductSubGrp, "{ItemSubGrp.ItemSubGrp_Key}")
                If SelSubGroup.Trim.Length > 0 Then
                    StockParam &= " And " & SelSubGroup
                End If

                SelProducts = GetSelectedAttributesForStock(cmbProduct, "{Item.Item_Key}")
                If SelProducts.Trim.Length > 0 Then
                    StockParam &= " And " & SelProducts
                End If

                SelStyle = GetSelectedAttributesForStock(cmbStyle, "{Style.Style_Code}")
                If SelStyle.Trim.Length > 0 Then
                    StockParam &= " And " & SelStyle
                End If


                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If TaxFilter.Trim.Length > 0 Then
                    PartyFltr &= " And " & TaxFilter
                End If

                If PurType.Trim.Length > 0 Then
                    PartyFltr &= " And " & PurType
                End If

                'Formulas.Add("DelFromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                'Formulas.Add("DelToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                'Formulas.Add("BuyerFromDate#S", Format$(dtpFrom1.Value, "dd/MM/yyyy"))
                'Formulas.Add("BuyerToDate#S", Format$(dtpTo1.Value, "dd/MM/yyyy"))

                'If rdOthOption1.Checked = True Then

                ' If chkDispRate.Checked And chkDispValue.Checked Then
                If Not chkDispRate.Checked Then


                    ReportParameters.rptFile = ReportPath & "\Reports\ProdCatWiseOrderAnal.rpt"
                    ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & FromToDt1 & PartyFltr

                ElseIf chkDispRate.Checked Then

                    ReportParameters.rptFile = ReportPath & "\Reports\ProdCatWiseOrderAnalAll.rpt"
                    ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & FromToDt1 & PartyFltr & StockParam
                End If



            Case ReportType.TopStyle

                Dim SelGroup As String = ""
                Dim SelSubGroup As String = ""
                Dim SelProducts As String = ""
                Dim SelStyle As String = ""
                Dim SelPartyFltr As String = ""
                SelCounter = "" : TaxFilter = "" : PurType = ""

                'FromToDt = GetFromToDateSeriesFilter("SalesOrder.DlvDate", "SalesOrder.Doc_Type", False)
                'PartyFltr = GetPartyFilter("SalesOrder")

                SelPartyFltr = GetSelectedAttributes1(cmbParty, "salesorder.cust_key")
                If SelPartyFltr.Trim.Length > 0 Then
                    StockParam &= " and " & SelPartyFltr
                End If

                SelGroup = GetSelectedAttributes1(cmbProductGrp, "ItemGrp.ItemGrp_Key")
                If SelGroup.Trim.Length > 0 Then
                    StockParam &= " And " & SelGroup
                End If

                SelSubGroup = GetSelectedAttributes1(cmbProductSubGrp, "ItemSubGrp.ItemSubGrp_Key")
                If SelSubGroup.Trim.Length > 0 Then
                    StockParam &= " And " & SelSubGroup
                End If

                SelProducts = GetSelectedAttributes1(cmbProduct, "Item.Item_Key")
                If SelProducts.Trim.Length > 0 Then
                    StockParam &= " And " & SelProducts
                End If

                SelStyle = GetSelectedAttributes1(cmbStyle, "Style.Style_Code")
                If SelStyle.Trim.Length > 0 Then
                    StockParam &= " And " & SelStyle
                End If


                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If TaxFilter.Trim.Length > 0 Then
                    PartyFltr &= " And " & TaxFilter
                End If

                If PurType.Trim.Length > 0 Then
                    PartyFltr &= " And " & PurType
                End If

                Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_TopStyle]')) " _
                                      & " Drop View [dbo].[vw_TopStyle]"
                Common.ExecuteQuery(Query)

                Query = " Create view [dbo].[vw_TopStyle]  as " _
                 & " select SalesOrder.Cobr_Id, Style_Key,SalesOrderDtl.Unit_Key, Shade_Key,Cust_Key, sum(qty) Qty,sum(Amount)Amount ,Sum(SalesOrderdtl.Amount*Imp_Rate) / Sum(Qty) AvgRate,Sum(Amount*Imp_Rate) As TotalRs, " _
                 & " ItemSubGrp.ItemSubGrp_Key, itemgrp.itemgrp_key, SalesOrderDtl.Item_Key " _
                 & " from salesorderdtl " _
                 & " Left Join SalesOrder On salesorderdtl.Doc_Id = SalesOrder.Doc_Id " _
                 & " left join item on SalesOrderDtl.Item_Key=item.Item_Key " _
                 & " left join ItemSubGrp  on ItemSubGrp.ItemSubGrp_Key=item.ItemSubGrp_Key " _
                 & " left join ItemGrp on ItemGrp.ItemGrp_Key=item.ItemGrp_Key " _
                 & " left join Unit on Unit.Unit_Key=SalesOrderDtl.Unit_Key " _
                 & " left join Currency on SalesOrder.Currn_Key = Currency.Currn_Key " _
                 & " where   SalesOrder.DlvDate between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And SalesOrder.Status <> 0 And salesorder.SOStatus_Id <> 7 And SalesOrderDtl.Status = 1 And SalesOrder.Cobr_ID = '" & SelBranchId & "'  " _
                 & StockParam _
                 & " group by SalesOrder.Cobr_Id,ItemSubGrp.ItemSubGrp_Key,ItemGrp.ItemGrp_Key,Style_Key,SalesOrderDtl.Item_Key,shade_key,SALESORDERDTL.Unit_Key,Cust_Key "
                Common.ExecuteQuery(Query)
                If chkDispRate.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\TopStyleSummary.rpt"
                    ' ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & FromToDt1 & PartyFltr & StockParam
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\TopStyleDetail.rpt"
                    ' ReportParameters.rptFilter = "{SalesOrder.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & FromToDt1 & PartyFltr & StockParam
                End If



            Case ReportType.PendServiceJobOrderRegister_PartyProdWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceJOBRpt.Doc_Dt}", "{Vw_ServiceJOBRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_ServiceJOBRpt")
                PartyFltr = GetPartyFilter("Vw_ServiceJOBRpt")

                If rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_ServiceJOBRpt.DlvParty_Key}")
                ElseIf rptType = ReportType.PendSalesOrderRegister_BrokerWise Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_ServiceJOBRpt.Broker_Key}")
                End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                OthOptions = "" ''All
                If rdOthOption1.Checked Then
                    OthOptions = " And {Vw_ServiceJOBRpt.BalQty} > 0 And {Vw_ServiceJOBRpt.Status} = '1'" ''Pending
                ElseIf rdOthOption2.Checked Then
                    OthOptions = " And {Vw_ServiceJOBRpt.BalQty} = 0" ''Completed
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PendServiceJobOrderRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PendServiceJobOrderRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_ServiceJOBRpt.CoBr_Id} = '" & SelBranchId & "' And {Vw_ServiceJOBRpt.Status} <>'0' " & FromToDt & PartyFltr & StockFltr & OthOptions


                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "S")
                    Formulas.Add("GroupOn2#S", "P")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    If rdDetailed.Checked Then
                        Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    End If

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Job Order Detail"
                    Else
                        ReportParameters.rptCaption = "Job Order Summary"
                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


                'ReportParameters.POSummary = False


            Case ReportType.PackingRegister_BillWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("Packing")
                    FromToDt = GetFromToDateSeriesFilter("{Packing.Doc_Dt}", "{Packing.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_PackingRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_PackingRpt.Doc_Dt}", "{Vw_PackingRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then

                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Delivery Challan Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else

                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))

                    If rdSummary.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1 'IIf(chkDispRate.Checked, 1, 0)
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (Bill Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Delivery Challan Register - Detail (Bill Wise)"
                    End If

                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.ServiceChallanRegister_BillWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("Packing")
                    FromToDt = GetFromToDateSeriesFilter("{Packing.Doc_Dt}", "{Packing.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_ServiceChallanRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceChallanRpt.Doc_Dt}", "{Vw_ServiceChallanRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then

                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Service Challan Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceChallanRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else

                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))

                    If rdSummary.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1 'IIf(chkDispRate.Checked, 1, 0)
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Service Challan Register - Summary (Bill Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceChallanRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Service Challan Register - Detail (Bill Wise)"
                    End If

                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)



                '2
            Case ReportType.PackingRegister_DateWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("Packing")
                    FromToDt = GetFromToDateSeriesFilter("{Packing.Doc_Dt}", "{Packing.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_PackingRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_PackingRpt.Doc_Dt}", "{Vw_PackingRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Delivery Challan Register - Details (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Item("ReportCaption#S") = "PO Register - Detail (" & lstMain.Text & ")"
                    Else
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        'Formulas.Item("ReportCaption#S") = "PO Register - Summary (" & lstMain.Text & ")"
                    End If
                Else

                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", 1)

                    If rdSummary.Checked Then
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (Date Wise)"
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr

                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    Else
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Delivery Challan Register - Detail (Date Wise)"

                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Item("DisplayDetails#N") = 1
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                '3

            Case ReportType.ServiceChallanRegister_DateWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("Packing")
                    FromToDt = GetFromToDateSeriesFilter("{Packing.Doc_Dt}", "{Packing.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_ServiceChallanRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceChallanRpt.Doc_Dt}", "{Vw_ServiceChallanRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Service Challan Register - Details (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceChallanRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Item("ReportCaption#S") = "PO Register - Detail (" & lstMain.Text & ")"
                    Else
                        ReportParameters.rptCaption = "Service Challan Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        'Formulas.Item("ReportCaption#S") = "PO Register - Summary (" & lstMain.Text & ")"
                    End If
                Else

                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", 1)

                    If rdSummary.Checked Then
                        ReportParameters.rptCaption = "Service Challan Register - Summary (Date Wise)"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr

                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    Else
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceChallanRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Service Challan Register - Detail (Date Wise)"

                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Item("DisplayDetails#N") = 1
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                '3

            Case ReportType.PackingRegister_PartyWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("Packing")
                    FromToDt = GetFromToDateSeriesFilter("{Packing.Doc_Dt}", "{Packing.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_PackingRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_PackingRpt.Doc_Dt}", "{Vw_PackingRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Delivery Challan Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else

                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 3)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (Party Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Delivery Challan Register - Detail (Party Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)



                ''Added by Pooja on 17-08-17
            Case ReportType.PackingRegister_Brokerwise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("Packing")
                    FromToDt = GetFromToDateSeriesFilter("{Packing.Doc_Dt}", "{Packing.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_PackingRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_PackingRpt.Doc_Dt}", "{Vw_PackingRpt.Doc_Type}")
                End If

                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Packing.Broker_Key}")

                If SelCounter.Trim.Length > 0 Then
                    FromToDt &= " And " & SelCounter
                End If




                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Delivery Challan Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else

                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 7)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (Party Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Delivery Challan Register - Detail (Party Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                ''END 17-08-17 Pooja




            Case ReportType.ServiceChallanRegister_PartyWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("Packing")
                    FromToDt = GetFromToDateSeriesFilter("{Packing.Doc_Dt}", "{Packing.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_ServiceChallanRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceChallanRpt.Doc_Dt}", "{Vw_ServiceChallanRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Service Challan Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceChallanRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else

                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 3)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (Party Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceChallanRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Delivery Challan Register - Detail (Party Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


                '4
            Case ReportType.PackingRegister_ConsigneeWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("Packing")
                    FromToDt = GetFromToDateSeriesFilter("{Packing.Doc_Dt}", "{Packing.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_PackingRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_PackingRpt.Doc_Dt}", "{Vw_PackingRpt.Doc_Type}")
                End If

                'If rdSummary.Checked Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.DlvParty_Key}")
                'Else
                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Packing.DlvParty_Key}")
                'End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If


                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Delivery Challan Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 6)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDoc.rpt"
                        ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Delivery Challan Register - Summary (Consignee Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\PackingRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Delivery Challan Register - Detail (Consignee Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                'Delivery Challan Item
            Case ReportType.PackingRegister_ProductWise, ReportType.PackingRegister_BrandWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_PackingRpt.Doc_Dt}", "{Vw_PackingRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_PackingRpt")
                PartyFltr = GetPartyFilter("Vw_PackingRpt")

                'If lblOperator.Text = "Consignee" Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_PackingRpt.DlvParty_Key}")
                'ElseIf lblOperator.Text = "Broker" Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_PackingRpt.Broker_Key}")
                'End If
                'If SelCounter.Trim.Length > 0 Then
                '    PartyFltr &= " And " & SelCounter
                'End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PackingRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PackingRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    'Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    'If rptType = ReportType.PurOrderRegister_SubGroupWise Then
                    '    Formulas.Add("GroupOn3#S", "U")
                    If rptType = ReportType.SalesOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.ServiceJobOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.SalesOrderRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", Me.Text)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Delivery Challan Detail"
                    Else
                        ReportParameters.rptCaption = "Delivery Challan Summary"

                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If

            Case ReportType.ServiceChallanRegister_ProductWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceChallanRpt.Doc_Dt}", "{Vw_ServiceChallanRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_ServiceChallanRpt")
                PartyFltr = GetPartyFilter("Vw_ServiceChallanRpt")

                'If lblOperator.Text = "Consignee" Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_PackingRpt.DlvParty_Key}")
                'ElseIf lblOperator.Text = "Broker" Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_PackingRpt.Broker_Key}")
                'End If
                'If SelCounter.Trim.Length > 0 Then
                '    PartyFltr &= " And " & SelCounter
                'End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_ServiceChallanRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    'Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    'If rptType = ReportType.PurOrderRegister_SubGroupWise Then
                    '    Formulas.Add("GroupOn3#S", "U")
                    If rptType = ReportType.SalesOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.ServiceJobOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.SalesOrderRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", Me.Text)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Service Challan Detail"
                    Else
                        ReportParameters.rptCaption = "Service Challan Summary"

                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


            Case ReportType.PackingRegister_PartyProdWise, ReportType.PackingRegister_ConsigneeProdWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_PackingRpt.Doc_Dt}", "{Vw_PackingRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_PackingRpt")
                PartyFltr = GetPartyFilter("Vw_PackingRpt")

                If rptType = ReportType.PackingRegister_ConsigneeProdWise Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_PackingRpt.DlvParty_Key}")
                    'ElseIf lblOperator.Text = "Broker" Then
                    '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_PackingRpt.Broker_Key}")
                End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PackingRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\PackingRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr


                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "S")
                    Formulas.Add("GroupOn2#S", "P")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Delivery Challan Detail"
                    Else
                        ReportParameters.rptCaption = "Delivery Challan Summary"
                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


                '''''''''''''''''''''''''''''''''''''''  SALES BILL
                '1

            Case ReportType.SalesBillRegister_PartyProdWise, ReportType.SalesBillRegister_ConsigneeProdWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SaleBillRpt.Doc_Dt}", "{Vw_SaleBillRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_SaleBillRpt")
                PartyFltr = GetPartyFilter("Vw_SaleBillRpt")

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr


                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "S")
                    Formulas.Add("GroupOn2#S", "P")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "SalesBill Detail Party/Product Wise"
                    Else
                        ReportParameters.rptCaption = "SalesBill Summary Party/Product Wise"
                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If
                ''=========================================================================Satyam 05082022

            Case ReportType.DesignWiseNetSalesRegister
                FromToDt = GetFromToDateSeriesFilter("{vw_designwisesalewithrtn.Doc_Dt}", "{vw_designwisesalewithrtn.Doc_Type}")
                StockFltr = GetStockFilter("vw_designwisesalewithrtn")
                PartyFltr = GetPartyFilter("vw_designwisesalewithrtn")

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\NetSaleRegDesignSum.rpt"
                End If

                ReportParameters.rptFilter = "{vw_designwisesalewithrtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr


                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "S")
                    Formulas.Add("GroupOn2#S", "P")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Net Sales Register Design"
                    Else
                        ReportParameters.rptCaption = "Design Wise Sales Register"
                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If

                '==========================================
            Case ReportType.ServiceChallanRegister_PartyProdWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceChallanRpt.Doc_Dt}", "{Vw_ServiceChallanRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_ServiceChallanRpt")
                PartyFltr = GetPartyFilter("Vw_ServiceChallanRpt")

                If rptType = ReportType.PackingRegister_ConsigneeProdWise Then
                    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_ServiceChallanRpt.DlvParty_Key}")
                    'ElseIf lblOperator.Text = "Broker" Then
                    '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_PackingRpt.Broker_Key}")
                End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\ServiceChallanRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_ServiceChallanRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr


                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "S")
                    Formulas.Add("GroupOn2#S", "P")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Service Challan Detail"
                    Else
                        ReportParameters.rptCaption = "Service Challan Summary"
                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If


                '''''''''''''''''''''''''''''''''''''''  SALES BILL
                '1
                'Case ReportType.SalesBillRegister_BillWise

            Case ReportType.SalesBillRegister_BillWise
                LocFilter = ""
                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SaleBillDtl.SO_Id} = " & Val(cmbSONo.Value) & ""
                End If
                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SaleBillRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleBillRpt.Doc_Dt}", "{Vw_SaleBillRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then

                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter & strSOFilter1
                    Else
                        ReportParameters.rptCaption = "Sales Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter & strSOFilter1
                    End If


                Else

                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))

                    If rdSummary.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1 'IIf(chkDispRate.Checked, 1, 0)
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Register - Summary (Bill Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & strSOFilter1
                        ReportParameters.rptCaption = "Sales Register - Detail (Bill Wise)"
                    End If

                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.ServiceBillRegister_BillWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_ServiceBillRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceBillRpt.Doc_Dt}", "{Vw_ServiceBillRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then

                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Service Invoice Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Service Invoice Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If


                Else

                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))

                    If rdSummary.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1 'IIf(chkDispRate.Checked, 1, 0)
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Service Invoice Register - Summary (Bill Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Service Invoice Register - Detail (Bill Wise)"
                    End If

                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


                '2
            Case ReportType.SalesBillRegister_DateWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SaleBillRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleBillRpt.Doc_Dt}", "{Vw_SaleBillRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Register - Details (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Item("ReportCaption#S") = "PO Register - Detail (" & lstMain.Text & ")"
                    Else
                        ReportParameters.rptCaption = "Sales Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        'Formulas.Item("ReportCaption#S") = "PO Register - Summary (" & lstMain.Text & ")"
                    End If
                Else

                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", 1)

                    If rdSummary.Checked Then
                        ReportParameters.rptCaption = "Sales Register - Summary (Date Wise)"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr

                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    Else
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Register - Detail (Date Wise)"

                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Item("DisplayDetails#N") = 1
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.ServiceBillRegister_DateWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_ServiceBillRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceBillRpt.Doc_Dt}", "{Vw_ServiceBillRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Service Invoice Register - Details (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Item("ReportCaption#S") = "PO Register - Detail (" & lstMain.Text & ")"
                    Else
                        ReportParameters.rptCaption = "Service Invoice Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        'Formulas.Item("ReportCaption#S") = "PO Register - Summary (" & lstMain.Text & ")"
                    End If
                Else

                    Formulas.Add("GroupOn1#N", 0)
                    Formulas.Add("DateGrp#N", 1)

                    If rdSummary.Checked Then
                        ReportParameters.rptCaption = "Service Invoice Register - Summary (Date Wise)"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr

                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    Else
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Service Invoice Register - Detail (Date Wise)"

                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Item("DisplayDetails#N") = 1
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


                '2
            Case ReportType.SalesBillRegister_PartyWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SaleBillRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleBillRpt.Doc_Dt}", "{Vw_SaleBillRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        Formulas.Item("DisplayDetails#N") = 1

                        ReportParameters.rptCaption = "Sales Register - Details (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Item("ReportCaption#S") = "PO Register - Detail (" & lstMain.Text & ")"
                    Else
                        ReportParameters.rptCaption = "Sales Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        'Formulas.Item("ReportCaption#S") = "PO Register - Summary (" & lstMain.Text & ")"
                    End If
                Else

                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 3)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Register - Summary (Party Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Register - Detail (Party Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.ServiceBillRegister_PartyWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_ServiceBillRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceBillRpt.Doc_Dt}", "{Vw_ServiceBillRpt.Doc_Type}")
                End If

                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))
                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        Formulas.Item("DisplayDetails#N") = 1

                        ReportParameters.rptCaption = "Service Invoice Register - Details (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        Formulas.Item("DisplayDetails#N") = 1
                        'Formulas.Item("ReportCaption#S") = "PO Register - Detail (" & lstMain.Text & ")"
                    Else
                        ReportParameters.rptCaption = "Service Invoice Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                        'Formulas.Item("ReportCaption#S") = "PO Register - Summary (" & lstMain.Text & ")"
                    End If
                Else

                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 3)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Service Invoice Register - Summary (Party Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_ServiceBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Service Invoice Register - Detail (Party Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


                '4
            Case ReportType.SalesBillRegister_ConsigneeWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SaleBillRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleBillRpt.Doc_Dt}", "{Vw_SaleBillRpt.Doc_Type}")
                End If

                'If rdSummary.Checked Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.DlvParty_Key}")
                'Else
                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SaleBill.DlvParty_Key}")
                'End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If


                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Sales Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else
                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 6)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Register - Summary (Consignee Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Register - Detail (Consignee Wise)"
                    End If
                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                '5
            Case ReportType.SalesBillRegister_BrokerWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                Else
                    StockFltr = GetStockFilter("Vw_SaleBillRpt")

                    PartyFltr = GetPartyFilter("Vw_SaleBillRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleBillRpt.Doc_Dt}", "{Vw_SaleBillRpt.Doc_Type}")
                End If

                'If rdSummary.Checked Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.DlvParty_Key}")
                'Else
                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SaleBill.Broker_Key}")
                'End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If


                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Sales Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else

                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 7)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Register - Summary (Broker Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr
                        ReportParameters.rptCaption = "Sales Register - Detail (Broker Wise)"
                    End If

                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            Case ReportType.SalesBillRegister_BrokerBrandWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SaleBillRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleBillRpt.Doc_Dt}", "{Vw_SaleBillRpt.Doc_Type}")
                End If

                'If rdSummary.Checked Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.DlvParty_Key}")
                'Else
                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SaleBill.Broker_Key}")
                StockFltr = GetStockFilter("Brand")
                'End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If


                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Sales Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else

                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 7)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocBrand.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr
                        ReportParameters.rptCaption = "Sales Register - Summary (Broker Brand Wise)"
                    Else

                        Formulas.Add("DisplayDetails#N", 1)

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Register - Detail (Broker Wise)"
                    End If

                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                '6
            Case ReportType.SalesBillRegister_SalePersonWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("Vw_SaleBillRpt")
                    FromToDt = GetFromToDateSeriesFilter("{Vw_SaleBillRpt.Doc_Dt}", "{Vw_SaleBillRpt.Doc_Type}")
                End If

                'If rdSummary.Checked Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.DlvParty_Key}")
                'Else
                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SaleBill.SalesPerson_Key}")
                'End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If


                If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                    If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                        Formulas.Add("GroupOn1#N", 3)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                        Formulas.Add("GroupOn1#N", 6)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                        Formulas.Add("GroupOn1#N", 7)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Sales Person" Then
                        Formulas.Add("GroupOn1#N", 8)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", 1)
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                        Formulas.Add("GroupOn1#N", 0)
                        Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                        Formulas.Add("DisplayDetails#N", 1)
                    End If

                    If rdDetailed.Checked Then
                        Formulas.Item("DisplayDetails#N") = 1

                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptCaption = "Sales Register - Detail (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    Else
                        ReportParameters.rptCaption = "Sales Register - Summary (" & lstMain.Text & ")"
                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                    End If
                Else

                    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                    Formulas.Add("GroupOn1#N", 8)

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                        ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Register - Summary (Sales Person Wise)"
                    Else
                        'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                        Formulas.Add("DisplayDetails#N", 1)
                        'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                        ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                        ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                        ReportParameters.rptCaption = "Sales Register - Detail (Sales Person Wise)"
                    End If

                End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.SalesBillRegister_SalePersonPartyWise
                LocFilter = ""

                If rdSummary.Checked Then
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                Else
                    PartyFltr = GetPartyFilter("SaleBill")
                    FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "{SaleBill.Doc_Type}")
                End If

                'If rdSummary.Checked Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SalesOrder.DlvParty_Key}")
                'Else
                SelCounter = GetSelectedAttributesForStock(cmbOperator, "{SaleBill.SalesPerson_Key}")
                'End If

                If SelCounter.Trim.Length > 0 Then
                    PartyFltr &= " And " & SelCounter
                End If


                ' If pnlOptions.Visible And lstMain.SelectedIndex >= 0 Then
                'If lstMain.Items(lstMain.SelectedIndex) = "Customer" Then
                '    Formulas.Add("GroupOn1#N", 3)
                '    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                '    Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                'ElseIf lstMain.Items(lstMain.SelectedIndex) = "Consignee" Then
                '    Formulas.Add("GroupOn1#N", 6)
                '    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                '    Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                'ElseIf lstMain.Items(lstMain.SelectedIndex) = "Broker" Then
                '    Formulas.Add("GroupOn1#N", 7)
                '    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                '    Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                'ElseIf lstMain.Items(lstMain.SelectedIndex) = "Sales Person" Then
                '    Formulas.Add("GroupOn1#N", 8)
                '    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                '    Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                'ElseIf lstMain.Items(lstMain.SelectedIndex) = "Date Wise" Then
                '    Formulas.Add("GroupOn1#N", 0)
                '    Formulas.Add("DateGrp#N", 1)
                '    Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                'ElseIf lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                '    Formulas.Add("GroupOn1#N", 0)
                '    Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                '    Formulas.Add("DisplayDetails#N", 1)
                'End If

                'If rdDetailed.Checked Then
                '    Formulas.Item("DisplayDetails#N") = 1

                '    'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                '    ReportParameters.rptCaption = "Sales Register - Detail (" & lstMain.Text & ")"
                '    ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtl.rpt"
                '    ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                'Else
                '    ReportParameters.rptCaption = "Sales Register - Summary (" & lstMain.Text & ")"
                '    ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDoc.rpt"
                '    ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & LocFilter
                'End If
                ' Else

                Formulas.Add("DateGrp#N", IIf(chkDispValue.Checked, 1, 0))
                Formulas.Add("GroupOn1#N", 8)

                If rdSummary.Checked Then
                    Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

                    ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocParty.rpt"
                    ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                    ReportParameters.rptCaption = "Sales Register - Summary (Sales Person Party Wise)"
                Else
                    'PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                    Formulas.Add("DisplayDetails#N", 1)
                    'Formulas.Add("ProdHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))

                    ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegDocDtlParty.rpt"
                    ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                    ReportParameters.rptCaption = "Sales Register - Detail (Sales Person Party Wise)"
                End If

                'End If

                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                'Sale Bill Item
            Case ReportType.SalesBillRegister_ProductWise, ReportType.SalesBillRegister_BrandWise

                FromToDt = GetFromToDateSeriesFilter("{Vw_SaleBillRpt.Doc_Dt}", "{Vw_SaleBillRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_SaleBillRpt")
                PartyFltr = GetPartyFilter("Vw_SaleBillRpt")

                'If lblOperator.Text = "Consignee" Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_PackingRpt.DlvParty_Key}")
                'ElseIf lblOperator.Text = "Broker" Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_PackingRpt.Broker_Key}")
                'End If
                'If SelCounter.Trim.Length > 0 Then
                '    PartyFltr &= " And " & SelCounter
                'End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesBillRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_SaleBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    'Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    'If rptType = ReportType.PurOrderRegister_SubGroupWise Then
                    '    Formulas.Add("GroupOn3#S", "U")
                    If rptType = ReportType.SalesOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.ServiceJobOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.SalesOrderRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", Me.Text)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Sales Register Detail"
                    Else
                        ReportParameters.rptCaption = "Sales Summary"

                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If

                ''''''''''''''''''''''''''''''''''''END OF SALE BILL

            Case ReportType.MonthlySales_ProductWise

                FromToDt = GetFromToDateSeriesFilter("{SaleBill.Doc_Dt}", "", True, False)
                StockFltr = GetStockFilter("SaleBillDtl", True)

                ReportParameters.rptFile = ReportPath & "\Accounts\SalesDtlCrosProdSum.rpt"
                ReportParameters.rptFilter = "{SaleBill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockFltr
                ReportParameters.rptCaption = "Monthly Sales - Product/Type Wise"

            Case ReportType.ServiceBillRegister_ProductWise

                FromToDt = GetFromToDateSeriesFilter("{Vw_ServiceBillRpt.Doc_Dt}", "{Vw_SaleBillRpt.Doc_Type}")
                StockFltr = GetStockFilter("Vw_ServiceBillRpt")
                PartyFltr = GetPartyFilter("Vw_ServiceBillRpt")

                'If lblOperator.Text = "Consignee" Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_PackingRpt.DlvParty_Key}")
                'ElseIf lblOperator.Text = "Broker" Then
                '    SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_PackingRpt.Broker_Key}")
                'End If
                'If SelCounter.Trim.Length > 0 Then
                '    PartyFltr &= " And " & SelCounter
                'End If

                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegProdDtl.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\ServiceBillRegProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{Vw_ServiceBillRpt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    'Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    'If rptType = ReportType.PurOrderRegister_SubGroupWise Then
                    '    Formulas.Add("GroupOn3#S", "U")
                    If rptType = ReportType.SalesOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.ServiceJobOrderRegister_ProductWise Then
                        Formulas.Add("GroupOn3#S", "P")
                    ElseIf rptType = ReportType.SalesOrderRegister_BrandWise Then
                        Formulas.Add("GroupOn3#S", "B")
                    End If

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")
                    Formulas.Add("ReportCaption#S", Me.Text)

                Else
                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Service Invoice Register Detail"
                    Else
                        ReportParameters.rptCaption = "Service Invoice Summary"

                    End If

                    If rdDetailed.Checked Then
                        ReportParameters.DisplayDetails = True
                    Else
                        ReportParameters.DisplayDetails = False
                    End If
                    ReportParameters.TotalText = True
                    ViewReportWithOptions(ReportParameters.rptCaption)
                End If

                ''''''''''''''''''''''''''''''''''''END OF SALE BILL


                'Sales Register
            Case ReportType.SalesRegister_ProductWise

                'ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterProdSum.rpt"
                'ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr
                'ReportParameters.rptCaption = "Sales Summary (Product Wise)"

                FromToDt = GetFromToDateSeriesFilter("{vw_SaleWithRtn.Doc_Dt}", "{vw_SaleWithRtn.Bill_Sr}")
                StockFltr = GetStockFilter("vw_SaleWithRtn")
                PartyFltr = GetPartyFilter("vw_SaleWithRtn")

                If lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0 Then
                    'Formulas = New Hashtable

                    Formulas.Add("GroupOn1#S", "")
                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "P")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    Formulas.Add("HeaderText#S", "Design/Type/Shade")

                    If rdDetailed.Checked Then
                        ReportParameters.rptCaption = "Sales Register Detail"
                    Else
                        ReportParameters.rptCaption = "Sales Summary"
                    End If

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                Else
                    ViewReportWithOptions("Sales")
                End If

                'Formulas.Add("DisplayDetails#N", IIf(rdDetailed.Checked, 1, 0))
                If rdDetailed.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterProdDetail.rpt"
                Else
                    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterProdSum.rpt"
                End If

                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "' And {vw_SaleWithRtn.Doc_Type} = 'SI' " & FromToDt & PartyFltr & StockFltr


                'Case ReportType.SalesRegister_PartyWise
                '    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterParty.rpt"
                '    ReportParameters.rptFilter = "{Bill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                '    ReportParameters.rptCaption = "Sales Register (Party Wise)"

                'Case ReportType.SalesRegister_ProductWise
                '    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegisterProduct.rpt"
                '    ReportParameters.rptFilter = "{Bill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr
                '    ReportParameters.rptCaption = "Sales Register (Product Wise)"

                'Case ReportType.ProductWiseSales
                '    ReportParameters.rptFile = ReportPath & "\Reports\ProductWiseSales.rpt"
                '    ReportParameters.rptFilter = "{Bill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr & StockFltr
                '    ReportParameters.rptCaption = "Product Wise Sales"

                'Case ReportType.SalesWithRtnTaxDetails_BillWise
                '    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegWithRtnBill.rpt"
                '    ReportParameters.rptFilter = "{Bill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                '    ReportParameters.rptCaption = "Sales Register (With Return) - Bill Wise"

                'Case ReportType.SalesWithRtnTaxDetails_ProductWise
                '    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegWithRtnProduct.rpt"
                '    ReportParameters.rptFilter = "{Bill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                '    ReportParameters.rptCaption = "Sales Register (With Return) - Product Wise"

                'Case ReportType.SalesWithRtnTaxDetails_BrandWise
                '    ReportParameters.rptFile = ReportPath & "\Reports\SalesRegWithRtnBrand.rpt"
                '    ReportParameters.rptFilter = "{Bill.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                '    ReportParameters.rptCaption = "Sales Register (With Return) - Brand Wise"


            Case ReportType.TopSoldItems
                Formulas = Nothing
                Series = ""
                PartyFltr = "{vw_SaleWithRtn.Supl_Key}"
                'PartyFltr = GetSelectedAttributesForStock(cmbSupplier, PartyFltr)

                If PartyFltr.Trim.Length > 0 Then
                    StockFltr &= " And " & PartyFltr
                End If

                If rdA.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'B'"
                End If

                FromToDt = " And {vw_SaleWithRtn.Doc_Dt} >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And {vw_SaleWithRtn.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")" & Series

                Formulas = New Hashtable

                'If chkOption1.Checked Then
                '    Formulas.Add("Field1#N", lstMain.SelectedIndex)
                'End If
                'Formulas.Add("First#N", IIf(chkOption1.Checked, 1, 0))

                'If chkOption2.Checked Then
                '    Formulas.Add("Field2#N", lstOption2.SelectedIndex)
                'End If
                'Formulas.Add("Second#N", IIf(chkOption2.Checked, 1, 0))

                'If chkOption3.Checked Then
                '    Formulas.Add("Field3#N", lstOption3.SelectedIndex)
                'End If
                'Formulas.Add("Third#N", IIf(chkOption3.Checked, 1, 0))

                ReportParameters.rptFile = ReportPath & "\Reports\TopSoldItems.rpt"
                ReportParameters.rptFilter = "{vw_SaleWithRtn.CoBr_Id} = '" & SelBranchId & "' " & FromToDt & PartyFltr


                'Pend Bill Agst Pack

            Case ReportType.PendAgstPack_BillWise
                PartyFltr = GetPartyFilter("Packing")
                FromToDt = GetFromToDateSeriesFilter("{Packing.Doc_Dt}", "{Packing.Doc_Type}")

                Formulas.Add("GroupOn1#N", 0)
                Formulas.Add("DateGrp#N", 0)

                If rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PendBillAgstPack.rpt"
                    ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                    ReportParameters.rptCaption = "Pending Bill Against Packing - (Bill Wise)"
                End If
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.PendAgstPack_PartyWise
                PartyFltr = GetPartyFilter("Packing")
                FromToDt = GetFromToDateSeriesFilter("{Packing.Doc_Dt}", "{Packing.Doc_Type}")

                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("GroupOn1#N", 3)

                If rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PendBillAgstPack.rpt"
                    ReportParameters.rptFilter = "{Packing.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                    ReportParameters.rptCaption = "Pending Bill Against Packing - (Party Wise)"
                End If
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.PendDrNtAgstPurRtd_BillWise
                PartyFltr = GetPartyFilter("PurchaseRtn")
                FromToDt = GetFromToDateSeriesFilter("{PurchaseRtn.Doc_Dt}", "", True, False)

                Formulas.Add("GroupOn1#N", 0)
                Formulas.Add("DateGrp#N", 0)

                If rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PendDrNoteAgstPurchRtd.rpt"
                    ReportParameters.rptFilter = "{PurchaseRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                    ReportParameters.rptCaption = "Pending DebitNote Against Purchase Rtd - (Bill Wise)"
                End If
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.PendDrNtAgstPurRtd_PartyWise
                PartyFltr = GetPartyFilter("PurchaseRtn")
                FromToDt = GetFromToDateSeriesFilter("{PurchaseRtn.Doc_Dt}", "", True, False)

                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("GroupOn1#N", 3)

                If rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PendDrNoteAgstPurchRtd.rpt"
                    ReportParameters.rptFilter = "{PurchaseRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                    ReportParameters.rptCaption = "Pending DebitNote Against Purchase Rtd - (Party Wise)"
                End If
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.PendCrNtAgstSaleRtd_BillWise
                PartyFltr = GetPartyFilter("SalesRtn")
                FromToDt = GetFromToDateSeriesFilter("{SalesRtn.Doc_Dt}", "", True, False)

                Formulas.Add("GroupOn1#N", 0)
                Formulas.Add("DateGrp#N", 0)

                If rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PendCrNoteAgstSalesRtd.rpt"
                    ReportParameters.rptFilter = "{SalesRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                    ReportParameters.rptCaption = "Pending CreditNote Against Sales Rtd - (Bill Wise)"
                End If
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.PendCrNtAgstSaleRtd_PartyWise
                PartyFltr = GetPartyFilter("SalesRtn")
                FromToDt = GetFromToDateSeriesFilter("{SalesRtn.Doc_Dt}", "", True, False)

                Formulas.Add("DateGrp#N", 0)
                Formulas.Add("GroupOn1#N", 3)

                If rdSummary.Checked Then
                    ReportParameters.rptFile = ReportPath & "\Reports\PendCrNoteAgstSalesRtd.rpt"
                    ReportParameters.rptFilter = "{SalesRtn.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr
                    ReportParameters.rptCaption = "Pending CreditNote Against Sales Rtd - (Party Wise)"
                End If
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


            Case ReportType.PendSalesOrderCrossTab_StyleWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                StockParam = GetStockFilter("", True, True)
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.BALQTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderCrossTabStyle.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "' AND {Vw_SalesOrderRpt.STATUS} = '1' " & StockParam & QtyFilter & FromToDt
                '" And {Vw_SalesOrderRpt.BALQTY} > 0 "

                ReportParameters.rptCaption = "Pending Sales Order (Style Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "T")
                'Formulas.Add("GroupOn2#S", "")
                'Formulas.Add("GroupOn3#S", "")
                'Formulas.Add("Text1#S", "T")
                'Formulas.Add("Text2#S", "Y")
                'Formulas.Add("Text3#S", "H")

            Case ReportType.PendSalesOrderCrossTab_Stock
                'FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderStock.Doc_Dt}", "{Vw_SalesOrderStock.Doc_Type}", False)
                StockParam = GetStockFilter("", True, True)
                QtyFilter = GetQtyFilter("{Vw_SalesOrderStock.BALQTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderCrossTabStyleStock.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam '& QtyFilter '& FromToDt
                ReportParameters.rptCaption = "Pending Sales Order (Style Wise) Stock "
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "T")

            Case ReportType.PendSalesOrderCrossTab_StylePartyWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                StockParam = GetStockFilter("", True, False)
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.BALQTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderCrossTabStyleParty.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "' AND {Vw_SalesOrderRpt.STATUS} = '1' " & StockParam & PartyFltr & QtyFilter & FromToDt

                ReportParameters.rptCaption = "Pending Sales Order (Style/Party Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "T")
                Formulas.Add("GroupOn2#S", "R")

            Case ReportType.PendSalesOrderCrossTab_PartyStyleWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                StockParam = GetStockFilter("", True, False)
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.BALQTY}")


                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForTJS)) = 1 Then ''Satyam 30072022 

                    If lblOperator.Text = "Consignee" Then
                        SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.DlvParty_Key}")
                    ElseIf lblOperator.Text = "Broker" Then
                        SelCounter = GetSelectedAttributesForStock(cmbOperator, "{Vw_SalesOrderRpt.Broker_Key}")
                    End If
                    If SelCounter.Trim.Length > 0 Then
                        PartyFltr &= " And " & SelCounter
                    End If
                End If

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderCrossTabStyleParty.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "' AND {Vw_SalesOrderRpt.STATUS} = '1' " & StockParam & PartyFltr & QtyFilter & FromToDt

                ReportParameters.rptCaption = "Pending Sales Order (Party/Style Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "R")
                Formulas.Add("GroupOn2#S", "T")

            Case ReportType.PendSalesOrderCrossTab_PartySizeWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.BALQTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderCrossTabStyle.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "' AND {Vw_SalesOrderRpt.STATUS} = '1' " & PartyFltr & QtyFilter & FromToDt

                ReportParameters.rptCaption = "Pending Sales Order (Party/Size Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "R")

            Case ReportType.PendSalesOrderCrossTab_PartyConsigneeWise

                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.BALQTY}")

                '''''''''''''''Added by Pooja on 30-10-2017-----------------
                Dim ConsigneeFltr As String = ""
                Dim ConsigneeFltrCtr As String = ""
                ConsigneeFltr = GetConsignnFltr(cmbOperator, "{Vw_SalesOrderRpt.CONSIGNEE_KEY}")
                If ConsigneeFltr.Trim.Length > 0 Then
                    ConsigneeFltrCtr = ConsigneeFltr
                End If
                ''''''''''''''''''END Pooja


                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderCrossTabStyleParty.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "' AND {Vw_SalesOrderRpt.STATUS} = '1' " & PartyFltr & QtyFilter & FromToDt & ConsigneeFltrCtr

                ReportParameters.rptCaption = "Pending Sales Order (Party/Consingee Wise)"
                Formulas.Add("ReportCaption#Ss", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "R")
                Formulas.Add("GroupOn2#S", "C")

            Case ReportType.PendSalesOrderCrossTab_StylePartyConsigneeWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                StockParam = GetStockFilter("", True, False)
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.BALQTY}")

                '''''''''''''''Added by Pooja on 30-10-2017-----------------
                Dim ConsigneeFltr As String = ""
                Dim ConsigneeFltrCtr As String = ""
                ConsigneeFltr = GetConsignnFltr(cmbOperator, "{Vw_SalesOrderRpt.CONSIGNEE_KEY}")
                If ConsigneeFltr.Trim.Length > 0 Then
                    ConsigneeFltrCtr = ConsigneeFltr
                End If
                ''''''''''''''''''END Pooja--------------------------


                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderCrossTabStylePartyConsignee.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "' AND {Vw_SalesOrderRpt.STATUS} = '1' " & StockParam & PartyFltr & QtyFilter & FromToDt & ConsigneeFltrCtr

                ReportParameters.rptCaption = "Pending Sales Order (Style/Party/Consingee Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "T")
                Formulas.Add("GroupOn2#S", "R")
                Formulas.Add("GroupOn3#S", "C")

                '' CHANGE BY RAHUL ON 21/06/2019
            Case ReportType.PendSalesOrderCrossTab_PartyConsigneeWiseStyle
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                StockParam = GetStockFilter("", True, False)
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.BALQTY}")

                '''''''''''''''Added by Pooja on 30-10-2017-----------------
                Dim ConsigneeFltr As String = ""
                Dim ConsigneeFltrCtr As String = ""
                ConsigneeFltr = GetConsignnFltr(cmbOperator, "{Vw_SalesOrderRpt.CONSIGNEE_KEY}")
                If ConsigneeFltr.Trim.Length > 0 Then
                    ConsigneeFltrCtr = ConsigneeFltr
                End If
                ''''''''''''''''''END Pooja--------------------------


                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PendSalesOrderCrossTabPartyConsigneeStyle.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "' AND {Vw_SalesOrderRpt.STATUS} = '1' " & StockParam & PartyFltr & QtyFilter & FromToDt & ConsigneeFltrCtr

                ReportParameters.rptCaption = "Pending Sales Order (Party/Consingee/Style Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "R")
                Formulas.Add("GroupOn2#S", "C")
                Formulas.Add("GroupOn3#S", "T")
                '' END



            Case ReportType.SalesOrderCrossTab_StyleWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                StockParam = GetStockFilter("", True, True)
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.QTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderCrossTabStyle.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & FromToDt

                ReportParameters.rptCaption = "Sales Order Summary (Style Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "T")


            Case ReportType.SalesOrderCrossTab_StylePartyWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                StockParam = GetStockFilter("", True, False)
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.QTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderCrossTabStyleParty.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & PartyFltr & QtyFilter & FromToDt

                ReportParameters.rptCaption = "Sales Order Summary (Style/Party Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "T")
                Formulas.Add("GroupOn2#S", "R")

            Case ReportType.SalesOrderCrossTab_PartyStyleWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                StockParam = GetStockFilter("", True, False)
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.QTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderCrossTabStyleParty.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & PartyFltr & QtyFilter & FromToDt

                ReportParameters.rptCaption = "Sales Order Summary (Party/Style Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "R")
                Formulas.Add("GroupOn2#S", "T")

            Case ReportType.SalesOrderCrossTab_PartySizeWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.QTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderCrossTabStyle.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "'" & PartyFltr & QtyFilter & FromToDt

                ReportParameters.rptCaption = "Sales Order Summary (Party/Size Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "R")

            Case ReportType.SalesOrderCrossTab_StylePartyConsigneeWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                StockParam = GetStockFilter("", True, False)
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.QTY}")

                '''''''''''''''Added by Pooja on 30-10-2017-----------------
                Dim ConsigneeFltr As String = ""
                Dim ConsigneeFltrCtr As String = ""
                ConsigneeFltr = GetConsignnFltr(cmbOperator, "{Vw_SalesOrderRpt.CONSIGNEE_KEY}")
                If ConsigneeFltr.Trim.Length > 0 Then
                    ConsigneeFltrCtr = ConsigneeFltr
                End If
                ''''''''''''''''''END Pooja-------------------------

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderCrossTabStylePartyConsignee.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & PartyFltr & QtyFilter & FromToDt & ConsigneeFltrCtr

                ReportParameters.rptCaption = "Sales Order Summary (Style/Party/Consingee Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "T")
                Formulas.Add("GroupOn2#S", "R")
                Formulas.Add("GroupOn3#S", "C")

                '' CHANGE BY RAHUL ON 21/06/2019
            Case ReportType.SalesOrderCrossTab_PartyConsigneeStyleWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_SalesOrderRpt.Doc_Dt}", "{Vw_SalesOrderRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_SalesOrderRpt")
                StockParam = GetStockFilter("", True, False)
                QtyFilter = GetQtyFilter("{Vw_SalesOrderRpt.QTY}")

                '''''''''''''''Added by Pooja on 30-10-2017-----------------
                Dim ConsigneeFltr As String = ""
                Dim ConsigneeFltrCtr As String = ""
                ConsigneeFltr = GetConsignnFltr(cmbOperator, "{Vw_SalesOrderRpt.CONSIGNEE_KEY}")
                If ConsigneeFltr.Trim.Length > 0 Then
                    ConsigneeFltrCtr = ConsigneeFltr
                End If
                ''''''''''''''''''END Pooja-------------------------

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\SalesOrderCrossTabPartyConsigneeStyle.rpt"
                ReportParameters.rptFilter = "{Vw_SalesOrderRpt.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & PartyFltr & QtyFilter & FromToDt & ConsigneeFltrCtr

                ReportParameters.rptCaption = "Sales Order Summary (Party/Consingee/Style Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "R")
                Formulas.Add("GroupOn2#S", "C")
                Formulas.Add("GroupOn3#S", "T")
                '' END

            Case ReportType.SalesOrderpackingCrossTab_StylePartyConsigneeWise
                FromToDt = GetFromToDateSeriesFilter1("{Vw_packingOrdersum.ord_dt}", "{Vw_packingOrdersum.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_packingOrdersum")
                StockParam = GetStockFilter("", True, False)
                'QtyFilter = GetQtyFilter("{Vw_packingOrdersum.QTY}")

                FromToDt1 = FromToDt & " or {Vw_packingOrdersum.pack_dt} >= Date(" & Format$(dtpFrom1.Value, "yyyy,MM,dd") & ") And {Vw_packingOrdersum.pack_dt}  <= Date(" & Format$(dtpTo1.Value, "yyyy,MM,dd") & "))"

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PackingVSSalesOrder.rpt"
                ReportParameters.rptFilter = "{Vw_packingOrdersum.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & PartyFltr & FromToDt1

                ReportParameters.rptCaption = "Sales Order/ Packing Summary (Style/Party Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "T")
                Formulas.Add("GroupOn2#S", "R")
                Formulas.Add("GroupOn3#S", "C")

            Case ReportType.RetailerWiseSaleOrder
                FromToDt = GetFromToDateSeriesFilter("{vws1.Doc_Dt}", "{vws1.Doc_Type}", False)
                PartyFltr = GetPartyFilter("vws1")

                Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\RetailerWiseSaleOrder.rpt"
                ReportParameters.rptFilter = "{vws1.CoBr_Id} = '" & SelBranchStkId & "'" & PartyFltr & FromToDt

                ReportParameters.rptCaption = "RetailerWise SaleOrder"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

            Case ReportType.RetailerWiseSaleOrder_design
                FromToDt = GetFromToDateSeriesFilter("{vws1_design.Doc_Dt}", "{vws1_design.Doc_Type}", False)
                StockParam = GetStockFilter("", True, True)
                QtyFilter = GetQtyFilter("{vws1_design.QTY}")
                PartyFltr = GetPartyFilter("vws1_design")
                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\RetailerWiseSaleOrderDesign.rpt"
                ReportParameters.rptFilter = "{vws1_design.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & FromToDt & PartyFltr

                ReportParameters.rptCaption = "Design Wise Retailer"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)

                '''saurabh 08092018
                'Case ReportType.ReverseMechanism1

                '    'PartyFltr = GetPartyFilter()
                '    ' FromToDt = GetFromToDateSeriesFilter("{Purchasebill.Doc_Dt}")

                '    Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                '    Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                '    ReportParameters.rptFile = ReportPath & "\Reports\RCM.rpt"

                '    '  ReportParameters.rptFile = ReportPath & "\Reports\RCM.rpt" SelBranchId
                '    ReportParameters.rptFilter = "{ledger.Revcm} <> '" & SelBranchId & "'" & FromToDt

                '  ReportParameters.rptCaption = "Reverse Mechanism"
                ' Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)


                ''' end saurabh 08092018
                ''ankita 23112018
            Case ReportType.PackingCrossTab_StyleWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_PackingRpt.Doc_Dt}", "{Vw_PackingRpt.Doc_Type}", False)
                StockParam = GetStockFilter("", True, True)
                QtyFilter = GetQtyFilter("{Vw_PackingRpt.QTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PackingCrossTabStyle.rpt"
                ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & FromToDt

                ReportParameters.rptCaption = "Packing Summary (Style Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "T")





            Case ReportType.PackingCrossTab_StylePartyWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_PackingRpt.Doc_Dt}", "{Vw_PackingRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_PackingRpt")
                StockParam = GetStockFilter("", True, False)
                QtyFilter = GetQtyFilter("{Vw_PackingRpt.QTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PackingCrossTabStyleParty.rpt"
                ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & PartyFltr & QtyFilter & FromToDt

                ReportParameters.rptCaption = "Packing Summary (Style/Party Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "T")
                Formulas.Add("GroupOn2#S", "R")

            Case ReportType.PackingCrossTab_PartyStyleWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_PackingRpt.Doc_Dt}", "{Vw_PackingRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_PackingRpt")
                StockParam = GetStockFilter("", True, False)
                QtyFilter = GetQtyFilter("{Vw_PackingRpt.QTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PackingCrossTabStyleParty.rpt"
                ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & PartyFltr & QtyFilter & FromToDt

                ReportParameters.rptCaption = "Packing Summary (Party/Style Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "R")
                Formulas.Add("GroupOn2#S", "T")


            Case ReportType.PackingCrossTab_PartySizeWise
                FromToDt = GetFromToDateSeriesFilter("{Vw_PackingRpt.Doc_Dt}", "{Vw_PackingRpt.Doc_Type}", False)
                PartyFltr = GetPartyFilter("Vw_PackingRpt")
                QtyFilter = GetQtyFilter("{Vw_PackingRpt.QTY}")

                Formulas.Add("FromDt#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDt#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                ReportParameters.rptFile = ReportPath & "\Reports\PackingCrossTabStyle.rpt"
                ReportParameters.rptFilter = "{Vw_PackingRpt.CoBr_Id} = '" & SelBranchStkId & "'" & PartyFltr & QtyFilter & FromToDt

                ReportParameters.rptCaption = "Packing Summary (Party/Size Wise)"
                Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Formulas.Add("GroupOn1#S", "R")


            Case ReportType.OrderInHandMonthWise
                Dim i As Integer = 0
                Dim j As Integer = 2
                Dim k As Integer = 1
                Dim SOMonthWise As DataTable

                Query = "Delete from TmpSalesSOStatus Where Cobr_id ='" & SelBranchId & "' "
                Common.ExecuteQuery(Query)

                Dim strmonth As String = Format$(Month(dtpFrom.Value), "00")
                Dim CurrentYr As Integer
                Dim CurrentYear As Integer

                If strmonth = "01" Or strmonth = "02" Or strmonth = "03" Then
                    CurrentYr = Mid$(Year(dtpFrom.Value) - 1, 3)
                    CurrentYear = Year(dtpFrom.Value) - 1
                Else
                    CurrentYr = Mid$(Year(dtpFrom.Value), 3)
                    CurrentYear = Year(dtpFrom.Value)
                End If

                Dim Year1, Year2, Year3 As String

                Year3 = CurrentYear & "-" & CurrentYr + 1
                Year2 = CurrentYear - 1 & "-" & CurrentYr
                Year1 = CurrentYear - 2 & "-" & CurrentYr - 1

                'Query = "Insert Into TmpSalesSOStatus values(" & i & ",'MONTH','2019-20','2020-21',0,0,0,'','2021-22','" & SelBranchId & "','0')"
                Query = "Insert Into TmpSalesSOStatus values(" & i & ",'MONTH','" & Year1 & "','" & Year2 & "',0,0,0,'','" & Year3 & "','" & SelBranchId & "','0')"

                Common.ExecuteQuery(Query)

                'datename(month,dlvdate) 
                Query = "Insert Into TmpSalesSOStatus values(1,'APRIL','','',0, 0 ,0,'','','" & SelBranchId & "','4')"
                Common.ExecuteQuery(Query)
                Query = "Insert Into TmpSalesSOStatus values(2,'MAY','','',0, 0 ,0,'','','" & SelBranchId & "','5')"
                Common.ExecuteQuery(Query)
                Query = "Insert Into TmpSalesSOStatus values(3,'JUNE','','',0, 0 ,0,'','','" & SelBranchId & "','6')"
                Common.ExecuteQuery(Query)
                Query = "Insert Into TmpSalesSOStatus values(4,'JULY','','',0, 0 ,0,'','','" & SelBranchId & "','7')"
                Common.ExecuteQuery(Query)
                Query = "Insert Into TmpSalesSOStatus values(5,'AUGUST','','',0, 0 ,0,'','','" & SelBranchId & "','8')"
                Common.ExecuteQuery(Query)
                Query = "Insert Into TmpSalesSOStatus values(6,'SEPTEMBER','','',0, 0 ,0,'','','" & SelBranchId & "','9')"
                Common.ExecuteQuery(Query)
                Query = "Insert Into TmpSalesSOStatus values(7,'OCTOBER','','',0, 0 ,0,'','','" & SelBranchId & "','10')"
                Common.ExecuteQuery(Query)
                Query = "Insert Into TmpSalesSOStatus values(8,'NOVEMBER','','',0, 0 ,0,'','','" & SelBranchId & "','11')"
                Common.ExecuteQuery(Query)
                Query = "Insert Into TmpSalesSOStatus values(9,'DECEMBER','','',0, 0 ,0,'','','" & SelBranchId & "','12')"
                Common.ExecuteQuery(Query)
                Query = "Insert Into TmpSalesSOStatus values(10,'JANUARY','','',0, 0 ,0,'','','" & SelBranchId & "','1')"
                Common.ExecuteQuery(Query)
                Query = "Insert Into TmpSalesSOStatus values(11,'FEBRUARY','','',0, 0 ,0,'','','" & SelBranchId & "','2')"
                Common.ExecuteQuery(Query)
                Query = "Insert Into TmpSalesSOStatus values(12,'MARCH','','',0, 0 ,0,'','','" & SelBranchId & "','3')"
                Common.ExecuteQuery(Query)


                'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And 

                If strmonth = "04" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                          & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                          & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                          & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '04/30/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & "  Where Sr_No=1"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo 5

                    'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And

                ElseIf strmonth = "05" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                   & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '05/31/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=2"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo 6

                    'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And 

                ElseIf strmonth = "06" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                   & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '06/30/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=3"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo 7

                    'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And
                ElseIf strmonth = "07" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                   & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '07/31/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=4"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo 8

                    'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And
                ElseIf strmonth = "08" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                   & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '08/31/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=5"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo 9

                    'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And 
                ElseIf strmonth = "09" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                   & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '09/30/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=6"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo 10

                    'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And 
                ElseIf strmonth = "10" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                   & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '10/31/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=7"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo 11

                    'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And 

                ElseIf strmonth = "11" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                   & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '11/30/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=8"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo 12

                    'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And 
                ElseIf strmonth = "12" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                   & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '12/31/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=9"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo 1

                    'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And 
                ElseIf strmonth = "01" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                   & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '01/31/" & CurrentYear + 1 & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=10"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo 2

                    'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And 
                ElseIf strmonth = "02" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                   & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '02/28/" & CurrentYear + 1 & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=11"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo 3

                    'vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And 
                ElseIf strmonth = "03" Then
                    Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                   & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                   & " WHERE  vw_SalesOrderDlvDt.DlvDate <= '03/31/" & CurrentYear + 1 & "' And SalesOrder.SOStatus_Id in(1,2) "
                    SOMonthWise = Common.GetDataTable(Query)
                    If SOMonthWise.Rows.Count > 0 Then
                        Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=12"
                        Common.ExecuteQuery(Query)
                    End If
                    GoTo bill
                End If


4:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '04/01/" & CurrentYear & "' And vw_SalesOrderDlvDt.DlvDate <= '04/30/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & " , TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=1"
                    Common.ExecuteQuery(Query)

                End If
5:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '05/01/" & CurrentYear & "' And vw_SalesOrderDlvDt.DlvDate <= '05/31/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=2"
                    Common.ExecuteQuery(Query)
                End If
6:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '06/01/" & CurrentYear & "' And vw_SalesOrderDlvDt.DlvDate <= '06/30/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=3"
                    Common.ExecuteQuery(Query)
                End If

7:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '07/01/" & CurrentYear & "' And vw_SalesOrderDlvDt.DlvDate <= '07/31/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=4"
                    Common.ExecuteQuery(Query)

                End If
8:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '08/01/" & CurrentYear & "' And vw_SalesOrderDlvDt.DlvDate <= '08/31/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=5"
                    Common.ExecuteQuery(Query)

                End If
9:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '09/01/" & CurrentYear & "' And vw_SalesOrderDlvDt.DlvDate <= '09/30/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=6"
                    Common.ExecuteQuery(Query)

                End If
10:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '10/01/" & CurrentYear & "' And vw_SalesOrderDlvDt.DlvDate <= '10/31/" & CurrentYear & "'  And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=7"
                    Common.ExecuteQuery(Query)

                End If
11:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '11/01/" & CurrentYear & "' And vw_SalesOrderDlvDt.DlvDate <= '11/30/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=8"
                    Common.ExecuteQuery(Query)

                End If
12:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '12/01/" & CurrentYear & "' And vw_SalesOrderDlvDt.DlvDate <= '12/31/" & CurrentYear & "' And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=9"
                    Common.ExecuteQuery(Query)
                End If
1:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '01/01/" & CurrentYear + 1 & "' And vw_SalesOrderDlvDt.DlvDate <= '01/31/" & CurrentYear + 1 & "' And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=10"
                    Common.ExecuteQuery(Query)
                End If
2:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '02/01/" & CurrentYear + 1 & "' And vw_SalesOrderDlvDt.DlvDate <= '02/28/" & CurrentYear + 1 & "' And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=11"
                    Common.ExecuteQuery(Query)

                End If

3:
                i = i + 1
                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) Order_Amt FROM vw_SalesOrderCurrencyWise " _
                    & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderCurrencyWise.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " LEFT JOIN SalesOrder ON SalesOrder.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                    & " WHERE  vw_SalesOrderDlvDt.DlvDate >= '03/01/" & CurrentYear + 1 & "' And vw_SalesOrderDlvDt.DlvDate <= '03/31/" & CurrentYear + 1 & "' And SalesOrder.SOStatus_Id in(1,2) "
                SOMonthWise = Common.GetDataTable(Query)
                If SOMonthWise.Rows.Count > 0 Then
                    Query = "Update TmpSalesSOStatus Set OrderInHand=" & SOMonthWise.Rows(0)(0) & ", TotalTurnover =" & SOMonthWise.Rows(0)(0) & " Where Sr_No=12"
                    Common.ExecuteQuery(Query)
                End If

Bill:
                Dim MonthNum1 As Integer = Month(dtpFrom.Value)

                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) SaleAmt ,month(vw_SalesOrderShipped.Doc_Dt) MonthNum FROM vw_SalesOrderShipped " _
                       & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderShipped.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                       & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '04/01/" & CurrentYear & "' And vw_SalesOrderShipped.Doc_Dt <= '03/31/" & CurrentYear + 1 & "' " _
                       & " group by month(vw_SalesOrderShipped.Doc_Dt)"
                SOMonthWise = Common.GetDataTable(Query)
                Dim recrow As DataRow
                If SOMonthWise.Rows.Count > 0 Then

                    If MonthNum1 = 4 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            End If
                        Next recrow

                    ElseIf MonthNum1 = 5 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 5 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=2"
                                Common.ExecuteQuery(Query)
                            End If
                        Next recrow

                    ElseIf MonthNum1 = 6 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 5 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=2"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 6 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=3"
                                Common.ExecuteQuery(Query)
                            End If
                        Next recrow

                    ElseIf MonthNum1 = 7 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 5 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=2"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 6 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=3"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 7 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=4"
                                Common.ExecuteQuery(Query)

                            End If
                        Next recrow

                    ElseIf MonthNum1 = 8 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 5 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=2"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 6 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=3"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 7 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=4"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 8 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=5"
                                Common.ExecuteQuery(Query)
                            End If
                        Next recrow

                    ElseIf MonthNum1 = 9 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 5 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=2"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 6 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=3"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 7 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=4"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 8 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=5"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 9 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=6"
                                Common.ExecuteQuery(Query)
                            End If
                        Next recrow

                    ElseIf MonthNum1 = 10 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 5 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=2"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 6 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=3"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 7 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=4"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 8 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=5"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 9 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=6"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 10 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=7"
                                Common.ExecuteQuery(Query)
                            End If
                        Next recrow


                    ElseIf MonthNum1 = 11 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 5 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=2"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 6 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=3"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 7 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=4"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 8 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=5"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 9 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=6"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 10 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=7"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 11 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=8"
                                Common.ExecuteQuery(Query)
                            End If
                        Next recrow

                    ElseIf MonthNum1 = 12 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 5 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=2"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 6 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=3"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 7 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=4"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 8 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=5"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 9 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=6"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 10 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=7"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 11 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=8"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 12 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=9"
                                Common.ExecuteQuery(Query)
                            End If
                        Next recrow

                    ElseIf MonthNum1 = 1 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 5 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=2"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 6 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=3"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 7 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=4"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 8 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=5"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 9 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=6"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 10 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=7"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 11 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=8"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 12 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=9"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 1 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=10"
                                Common.ExecuteQuery(Query)
                            End If
                        Next recrow

                    ElseIf MonthNum1 = 2 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 5 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=2"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 6 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=3"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 7 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=4"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 8 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=5"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 9 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=6"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 10 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=7"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 11 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=8"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 12 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=9"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 1 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=10"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 2 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=11"
                                Common.ExecuteQuery(Query)
                            End If
                        Next recrow

                    ElseIf MonthNum1 = 3 Then
                        For Each recrow In SOMonthWise.Rows
                            If recrow("MonthNum") = 4 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=1"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 5 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=2"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 6 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=3"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 7 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=4"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 8 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=5"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 9 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=6"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 10 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=7"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 11 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=8"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 12 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=9"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 1 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=10"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 2 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=11"
                                Common.ExecuteQuery(Query)
                            ElseIf recrow("MonthNum") = 3 Then
                                Query = "Update TmpSalesSOStatus Set Sales=" & recrow("SaleAmt") & ", TotalTurnover = OrderInHand + " & recrow("SaleAmt") & "  Where Sr_No=12"
                                Common.ExecuteQuery(Query)
                            End If
                        Next recrow

                    End If

                End If


                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) SaleAmt ,month(vw_SalesOrderShipped.Doc_Dt) MonthNum FROM vw_SalesOrderShipped " _
                      & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderShipped.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                      & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '04/01/" & CurrentYear - 1 & "' And vw_SalesOrderShipped.Doc_Dt <= '03/31/" & CurrentYear & "' " _
                      & " group by month(vw_SalesOrderShipped.Doc_Dt)"
                SOMonthWise = Common.GetDataTable(Query)
                Dim recrow1 As DataRow
                If SOMonthWise.Rows.Count > 0 Then
                    For Each recrow1 In SOMonthWise.Rows
                        Query = "Update TmpSalesSOStatus Set Year_2='" & Format(recrow1("SaleAmt"), "0") & "'  Where Main='" & recrow1("MonthNum") & "'"
                        Common.ExecuteQuery(Query)
                    Next recrow1
                End If

                Query = "SELECT IsNull(Round(SUM (PendingRs),0),0) SaleAmt ,month(vw_SalesOrderShipped.Doc_Dt) MonthNum FROM vw_SalesOrderShipped " _
                     & " LEFT JOIN vw_SalesOrderDlvDt ON vw_SalesOrderShipped.DOC_ID=vw_SalesOrderDlvDt.DOC_ID " _
                     & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '04/01/" & CurrentYear - 2 & "' And vw_SalesOrderShipped.Doc_Dt <= '03/31/" & CurrentYear - 1 & "' " _
                     & " group by month(vw_SalesOrderShipped.Doc_Dt)"
                SOMonthWise = Common.GetDataTable(Query)
                Dim recrow2 As DataRow
                If SOMonthWise.Rows.Count > 0 Then
                    For Each recrow2 In SOMonthWise.Rows
                        Query = "Update TmpSalesSOStatus Set Year_1= '" & Format(recrow2("SaleAmt"), "0") & "' Where Main='" & recrow2("MonthNum") & "'"
                        Common.ExecuteQuery(Query)
                    Next recrow2
                End If

Final:



                ReportParameters.rptFile = ReportPath & "\Reports\MISOrderInHandMonthWise.rpt"
                ReportParameters.rptFilter = "{TmpSalesSOStatus.CoBr_Id} = '" & SelBranchId & "'"
                ReportParameters.rptCaption = "Sales / Order In Hand (Month Wise)"



            Case ReportType.OrderInHandPartyWise
                Dim i As Integer = 1
                Dim j As Integer = 2
                Dim k As Integer = 1
                Dim SOPartyWise As DataTable

                Query = "Delete from TmpSalesSOStatusBuyerwise Where Cobr_id ='" & SelBranchId & "' "
                Common.ExecuteQuery(Query)

                Dim strmonth As String = Format$(Month(dtpFrom.Value), "00")
                Dim StrDate As String = ""

                If strmonth = "04" Then
                    StrDate = "04/30/2021"
                ElseIf strmonth = "05" Then
                    StrDate = "05/31/2021"
                ElseIf strmonth = "06" Then
                    StrDate = "06/30/2021"
                ElseIf strmonth = "07" Then
                    StrDate = "07/31/2021"
                ElseIf strmonth = "08" Then
                    StrDate = "08/31/2021"
                ElseIf strmonth = "09" Then
                    StrDate = "09/30/2021"
                ElseIf strmonth = "10" Then
                    StrDate = "10/31/2021"
                ElseIf strmonth = "11" Then
                    StrDate = "11/30/2021"
                ElseIf strmonth = "12" Then
                    StrDate = "12/31/2021"
                ElseIf strmonth = "01" Then
                    StrDate = "01/31/2022"
                ElseIf strmonth = "02" Then
                    StrDate = "02/28/2022"
                ElseIf strmonth = "03" Then
                    StrDate = "03/31/2022"
                End If

                Query = "Select round(sum(a.amount),2) Amount, a.Led_Name,a.led_key From " _
                       & " (SELECT SUM (PendingRs )/100000 Amount,Led_Name,ledger.led_key " _
                       & " FROM vw_SalesOrderCurrencyWise " _
                       & " left join SalesOrder on vw_SalesOrderCurrencyWise.Doc_Id=SalesOrder.Doc_Id " _
                       & " left join ledger on ledger.Led_Key=SalesOrder.Cust_Key " _
                       & " WHERE  SalesOrder.DlvDate >= '04/01/2021'  And SalesOrder.DlvDate <= '03/31/2022' And SalesOrder.SOStatus_Id in(1,2) " _
                       & " group by Led_Name,ledger.led_key " _
                       & " union all " _
                       & " SELECT SUM (PendingRs )/100000 Amount,Led_Name,ledger.led_key " _
                       & " FROM vw_SalesOrderShipped " _
                       & " left join ledger on ledger.Led_Key=vw_SalesOrderShipped.Cust_Key " _
                       & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '04/01/2021'  And vw_SalesOrderShipped.Doc_Dt <= '" & StrDate & "' " _
                       & " group by Led_Name,ledger.led_key  " _
                       & ") as a  " _
                       & " group by  a.Led_Name,a.led_key " _
                       & " order by amount desc"

                'Query = "Select sum(a.amount) Amount, a.Led_Name,a.led_key From " _
                '       & " (SELECT round(SUM (PendingRs )/100000,0) Amount,Led_Name,ledger.led_key " _
                '       & " FROM vw_SalesOrderShipped " _
                '       & " left join ledger on ledger.Led_Key=vw_SalesOrderShipped.Cust_Key " _
                '       & " WHERE  vw_SalesOrderShipped.Doc_Dt >= '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "'  And vw_SalesOrderShipped.Doc_Dt <= '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' " _
                '       & " group by Led_Name,ledger.led_key  " _
                '       & ") as a  " _
                '       & " group by  a.Led_Name,a.led_key " _
                '       & " order by amount desc"
                SOPartyWise = Common.GetDataTable(Query)

                Dim recrow As DataRow
                If SOPartyWise.Rows.Count > 0 Then

                    For Each recrow In SOPartyWise.Rows
                        If chkDispRate.Checked = False Then '''Satyam 09082022

                            If i <= 25 Then
                                Query = "Insert Into TmpSalesSOStatusBuyerwise values(" & i & ",'" & recrow("Led_Name") & "','" & recrow("Led_Key") & "','','',0,0," & recrow("Amount") & ",'','','" & SelBranchId & "','0')"
                                Common.ExecuteQuery(Query)
                            ElseIf i = 26 Then
                                Query = "Insert Into TmpSalesSOStatusBuyerwise values(" & i & ",'OTHER BUYERS','','','',0,0," & recrow("Amount") & ",'','','" & SelBranchId & "','0')"
                                Common.ExecuteQuery(Query)
                            Else
                                Query = "Update TmpSalesSOStatusBuyerwise Set TotalTurnover = TotalTurnover + " & recrow("Amount") & "  Where Sr_No=26"
                                Common.ExecuteQuery(Query)
                            End If
                        Else
                            Query = "Insert Into TmpSalesSOStatusBuyerwise values(" & i & ",'" & recrow("Led_Name") & "','" & recrow("Led_Key") & "','','',0,0," & recrow("Amount") & ",'','','" & SelBranchId & "','0')"
                            Common.ExecuteQuery(Query)
                        End If


                        i = i + 1
                    Next recrow
                End If
                Formulas.Add("Allbuyer#S", IIf(chkDispRate.Checked, 0, 1)) ''Satyam 09082022
                ReportParameters.rptFile = ReportPath & "\Reports\MISOrderInHandPartyWise.rpt"
                ReportParameters.rptFilter = "{TmpSalesSOStatusBuyerwise.CoBr_Id} = '" & SelBranchId & "'"
                ReportParameters.rptCaption = "Sales / Orders In Hand (Buyer Wise)"

        End Select
    End Sub

    Private Sub SetStockReportParameters()
        Dim PartyFltr As String = ""
        Dim StockParam As String = ""
        Dim StockParam1 As String = ""
        Dim QtyFilter As String = ""
        Dim QtyFilter1 As String = ""
        Dim FromToDt As String = ""
        Dim LocFilter As String = ""
        Dim LocFilter1 As String = ""
        Dim StkType As String = ""

        Series = ""



        'If rdA.Checked Then
        '    Series = " And {vw_ItemSizeStock.StkSr} = 'A'"
        'ElseIf rdB.Checked Then
        '    Series = " And {vw_ItemSizeStock.StkSr} = 'B'"
        'End If

        If rptType = ReportType.OpeningStockProduct Or rptType = ReportType.OpeningStockSubGroup Or rptType = ReportType.OpeningStockBrand Or rptType = ReportType.OpeningStockLocation Then
            If cmbDisplay.SelectedIndex = 0 Then ''All

            ElseIf cmbDisplay.SelectedIndex = 1 Then ''Equal To
                QtyFilter = " And {vw_ItemSizeStock.OpQty} = " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 2 Then ''Greater Than
                QtyFilter = " And {vw_ItemSizeStock.OpQty} > " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 3 Then ''Less Than
                QtyFilter = " And {vw_ItemSizeStock.OpQty} < " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 4 Then ''Range
                QtyFilter = " And {vw_ItemSizeStock.OpQty} > " & txtStkFrom.EditValue & " And {vw_ItemSizeStock.OpQty} < " & txtStkTo.EditValue
            End If

            QtyFilter = GetQtyFilter("{vw_ItemSizeStock.OpQty}")

        ElseIf rptType = ReportType.StockStatement Then
            'QtyFilter = GetQtyFilter("{@ClQty}")

        ElseIf rptType = ReportType.OpeningStk_Brand Or rptType = ReportType.OpeningStk_Location Or rptType = ReportType.OpeningStk_Product Or rptType = ReportType.OpeningStk_SubGroup Then
            If cmbDisplay.SelectedIndex = 0 Then ''All

            ElseIf cmbDisplay.SelectedIndex = 1 Then ''Equal To
                QtyFilter = " And {GreyAccStock.OpQty} = " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 2 Then ''Greater Than
                QtyFilter = " And {GreyAccStock.OpQty} > " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 3 Then ''Less Than
                QtyFilter = " And {GreyAccStock.OpQty} < " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 4 Then ''Range
                QtyFilter = " And {GreyAccStock.OpQty} > " & txtStkFrom.EditValue & " And {GreyAccStock.OpQty} < " & txtStkTo.EditValue
            End If

            QtyFilter = GetQtyFilter("{GreyAccStock.OpQty}")

        ElseIf rptType = ReportType.ClosingStk_Brand Or rptType = ReportType.ClosingStk_Location Or rptType = ReportType.ClosingStk_Product Or rptType = ReportType.ClosingStk_SubGroup Or rptType = ReportType.ClosingStk_Supplier Then
            If cmbDisplay.SelectedIndex = 0 Then ''All

            ElseIf cmbDisplay.SelectedIndex = 1 Then ''Equal To
                QtyFilter = " And {GreyAccStock.ClQty} = " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 2 Then ''Greater Than
                QtyFilter = " And {GreyAccStock.ClQty} > " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 3 Then ''Less Than
                QtyFilter = " And {GreyAccStock.ClQty} < " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 4 Then ''Range
                QtyFilter = " And {GreyAccStock.ClQty} > " & txtStkFrom.EditValue & " And {GreyAccStock.ClQty} < " & txtStkTo.EditValue
            End If

            QtyFilter = GetQtyFilter("{GreyAccStock.ClQty}")

        Else
            If cmbDisplay.SelectedIndex = 0 Then ''All

            ElseIf cmbDisplay.SelectedIndex = 1 Then ''Equal To
                QtyFilter = " And {vw_ItemSizeStock.ClQty} = " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 2 Then ''Greater Than
                QtyFilter = " And {vw_ItemSizeStock.ClQty} > " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 3 Then ''Less Than
                QtyFilter = " And {vw_ItemSizeStock.ClQty} < " & txtStkFrom.EditValue
            ElseIf cmbDisplay.SelectedIndex = 4 Then ''Range
                QtyFilter = " And {vw_ItemSizeStock.ClQty} > " & txtStkFrom.EditValue & " And {vw_ItemSizeStock.ClQty} < " & txtStkTo.EditValue
            End If

            QtyFilter = GetQtyFilter("{vw_ItemSizeStock.ClQty}")

        End If


        If rptType = ReportType.OpeningStk_Location Or rptType = ReportType.ClosingStk_Location Or rptType = ReportType.OpeningStk_Product Then
            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{GreyAccStock.Loc_Key}")

            If LocFilter.Trim.Length > 0 Then
                LocFilter = " And " & LocFilter
            End If
        Else
            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{vw_ItemSizeStock.Loc_Key}")
            If LocFilter.Trim.Length > 0 Then
                LocFilter = " And " & LocFilter
            End If
        End If
        If rptType = ReportType.stockledgerlocation Then
            LocFilter = GetSelectedAttributesForStock(cmbLocation, "{View_StockLedgerLocation.Loc_Key}")

            If LocFilter.Trim.Length > 0 Then
                LocFilter = " And " & LocFilter
            End If
        End If

        Formulas = New Hashtable

        Select Case rptType
            ''closing stock
            Case ReportType.ClosingStk_SubGroup, ReportType.ClosingStk_Product, ReportType.ClosingStk_Brand, ReportType.ClosingStk_Supplier, ReportType.ClosingStk_Location

                If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 And IsFabric = True And rptType = ReportType.ClosingStk_Supplier Then
                    PartyFltr = GetPartyFilter("vw_GreyLedger")
                Else
                    If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 And IsStores = True And rptType = ReportType.ClosingStk_Supplier Then
                        PartyFltr = GetPartyFilter("vw_AccLedger")
                    Else
                        PartyFltr = GetPartyFilter("GreyAccStock")
                    End If


                End If

                StockParam = GetStockFilter("", True)

                'Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                If chkSize.Checked = True Then

                Else
                    If rptType = ReportType.ClosingStk_SubGroup Or rptType = ReportType.ClosingStockSubGroup Then
                    Else
                        Formulas.Add("DisplayRate#N", IIf(chkDispRate.Checked, 1, 0))
                        Formulas.Add("DisplayValue#N", IIf(chkDispValue.Checked, 1, 0))
                    End If
                    
                End If
                'If rdMRP.Checked Then
                '    Formulas.Add("RateFlag#S", "M")
                'ElseIf rdSP.Checked Then
                '    Formulas.Add("RateFlag#S", "S")
                'Else
                '    Formulas.Add("RateFlag#S", "P")
                'End If

                If IsFabric Then

                    StkType = " And {GreyAccStock.StkType} = 'GG'"
                ElseIf IsStores Then
                    StkType = " And {GreyAccStock.StkType} = 'AG'"
                ElseIf IsPacking Then
                    StkType = " And {GreyAccStock.StkType} = 'PG'"
                End If

                If chkSize.Checked = True Then
                    If rdSummary.Checked = 0 Then
                        Formulas.Add("DHFlag#S", "1")
                    Else
                        Formulas.Add("DHFlag#S", "0")
                    End If

                    ReportParameters.rptFile = ReportPath & "\Reports\GreyStockBalewise.rpt"
                Else
                    ''CHANGE BY RAHUL ON 23/11/2019
                    ''ReportParameters.rptFile = ReportPath & "\Reports\GreyStock.rpt"
                    If Val(GetSettingAsPerId(ApplnSettingsIdx.HetherGrey)) = 1 Then
                        If rdSummary.Checked = True Then
                            ReportParameters.rptFile = ReportPath & "\Reports\GreyStockSumm.rpt"
                        Else
                            ReportParameters.rptFile = ReportPath & "\Reports\GreyStockDtl.rpt"
                        End If
                    Else
                        LocFilter = GetSelectedAttributesForStock(cmbLocation, "{GreyAccStock.Loc_Key}")
                        If LocFilter.Trim.Length > 0 Then
                            LocFilter = " And " & LocFilter
                        End If
                        'Query = "Select SalesOrder.Doc_Id From Salesorder Left Join SalesOrderdtl On Salesorder.Doc_ID = SalesOrderDtl.Doc_Id Left Join GreyAccstock On  GreyAccstock.SODocDtl_Id = SalesOrderDtl.Docdtl_Id WHERE SalesOrder.Doc_Id =" & cmbSONo.Value & " "
                        'Dim SoNo As DataTable = Common.GetDataTable(Query)
                        'If SoNo.Rows.Count > 0 Then
                        '    cmbSONo.Value = SoNo.Rows(0).Item("Doc_ID")
                        'End If
                        Dim strSOFilter1 As String = ""
                        If cmbSONo.SelectedIndex <> -1 Then
                            strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                        End If

                        If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                            If IsFabric = True Then
                                ReportParameters.rptFile = ReportPath & "\Reports\GreyStock.rpt"
                            Else
                                ReportParameters.rptFile = ReportPath & "\Reports\AccStk.rpt"
                            End If

                        Else
                            ReportParameters.rptFile = ReportPath & "\Reports\GreyStock.rpt"
                        End If

                        ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'  " & strSOFilter1 & StockParam & LocFilter & PartyFltr
                    End If
                    ''END
                End If

                Dim strSOFilter As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = 1 Then
                    If IsFabric Then
                        StkType = " And {GreyAccStock.StkType} = 'GG'"
                        If rptType = ReportType.ClosingStk_SubGroup Then
                            ReportParameters.rptFile = ReportPath & "\Reports\GreyStockLedgerFabric.rpt"
                            ReportParameters.rptFilter = "{Vw_STOCKLEDGERALLFABRIC.CoBr_Id} = '" & SelBranchStkId & "' " & strSOFilter & StockParam & PartyFltr
                        ElseIf rdOthOption1.Checked Then
                            If rdSummary.Checked = True Then
                                ReportParameters.rptFile = ReportPath & "\Reports\GreyStockSummary.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "' And {GreyAccStock.SODocdtl_Id}<>0 " & strSOFilter & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            Else
                                ReportParameters.rptFile = ReportPath & "\Reports\GreyStockOCWise.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "' And {GreyAccStock.SODocdtl_Id}<>0 " & strSOFilter & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            End If
                        ElseIf rdOthOption2.Checked Then
                            If rdSummary.Checked = True Then
                                ReportParameters.rptFile = ReportPath & "\Reports\GreyStockSummary.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "' And {GreyAccStock.SODocdtl_Id}=0 " & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            Else
                                ReportParameters.rptFile = ReportPath & "\Reports\GreyStock.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "' AND {GreyAccStock.SoDocDtl_id} =0 " & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            End If
                        ElseIf rdOthOption3.Checked Then
                            If rdSummary.Checked = True Then
                                ReportParameters.rptFile = ReportPath & "\Reports\GreyStockSummary.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            Else
                                ReportParameters.rptFile = ReportPath & "\Reports\GreyStock.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            End If
                        End If
                    ElseIf IsStores Then
                        'StkType = " And {GreyAccStock.StkType} = 'AG'"
                        StkType = " And {GreyAccStock.StkType} IN ['AG','PG'] "
                        If rptType = ReportType.ClosingStk_SubGroup Then
                            ReportParameters.rptFile = ReportPath & "\Reports\GreyStockLedgerAcc.rpt"
                            ReportParameters.rptFilter = "{Vw_STOCKLEDGERALLACCESSORIES.CoBr_Id} = '" & SelBranchStkId & "'  " & strSOFilter & StockParam & PartyFltr
                        ElseIf rdOthOption1.Checked Then
                            If rdSummary.Checked = True Then
                                ReportParameters.rptFile = ReportPath & "\Reports\AccStockSummary.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'  And {GreyAccStock.SODocdtl_Id}<>0  " & strSOFilter & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            Else
                                ReportParameters.rptFile = ReportPath & "\Reports\AccStockOCWise.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'  And {GreyAccStock.SODocdtl_Id}<>0  " & strSOFilter & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            End If
                        ElseIf rdOthOption2.Checked Then
                            If rdSummary.Checked = True Then
                                ReportParameters.rptFile = ReportPath & "\Reports\AccStockSummary.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "' AND {GreyAccStock.SoDocDtl_id} =0 " & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            Else
                                ReportParameters.rptFile = ReportPath & "\Reports\AccStock.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "' AND {GreyAccStock.SoDocDtl_id} =0 " & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            End If
                        ElseIf rdOthOption3.Checked Then
                            If rdSummary.Checked = True Then
                                ReportParameters.rptFile = ReportPath & "\Reports\AccStockSummary.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            Else
                                ReportParameters.rptFile = ReportPath & "\Reports\AccStock.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            End If
                        End If
                    ElseIf IsPacking Then
                        StkType = " And {GreyAccStock.StkType} = 'PG'"
                        End If

                Else
                    If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                        If ReportParameters.rptFile.Contains("GreyStockBalewise") Or IsFabric = False Then

                            If ReportParameters.rptFile.Contains("GreyStockBalewise") Or IsStores = True Then
                                ReportParameters.rptFilter = "{vw_AccLedger.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & Series & LocFilter & PartyFltr
                            Else
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & Series & LocFilter & PartyFltr & StkType
                            End If



                        Else
                            ReportParameters.rptFilter = "{vw_GreyLedger.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & Series & LocFilter & PartyFltr '& StkType
                        End If

                    Else
                        ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                    End If


                End If
                ReportParameters.TotalText = True

                If DefaultSelection() Then
                    Formulas = New Hashtable

                    If rptType = ReportType.ClosingStockSubGroup Then
                        Formulas.Add("GroupOn1#S", "U")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefSubGroup))
                        ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Wise"

                    ElseIf rptType = ReportType.ClosingStockProduct Then
                        Formulas.Add("GroupOn1#S", "P")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    ElseIf rptType = ReportType.ClosingStockSupplier Then
                        Formulas.Add("GroupOn1#S", "S")
                        Formulas.Add("GroupHeader#S", "Supplier")
                        ReportParameters.rptCaption = "Closing Stock - Supplier Wise"

                    ElseIf rptType = ReportType.ClosingStockBrand Then
                        Formulas.Add("GroupOn1#S", "B")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefBrand))
                        ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefBrand) & " Wise"

                    ElseIf rptType = ReportType.ClosingStockLocation Then
                        Formulas.Add("GroupOn1#S", "L")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefLocation))
                        ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise"
                    End If

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Else

                    If chkSize.Checked = True Then

                    Else
                        If rptType = ReportType.ClosingStk_SubGroup Or rptType = ReportType.ClosingStockSubGroup Then

                        Else
                            ViewStockReportWithOptions("Closing Stock", True, True)
                        End If
                    End If

                End If


                ''closing stock
            Case ReportType.OpeningStk_SubGroup, ReportType.OpeningStk_Product, ReportType.OpeningStk_Brand, ReportType.OpeningStk_Location
                PartyFltr = GetPartyFilter("GreyAccStock")
                StockParam = GetStockFilter("", True)
                If chkSize.Checked = True Then

                Else
                    'Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    Formulas.Add("DisplayRate#N", IIf(chkDispRate.Checked, 1, 0))
                    Formulas.Add("DisplayValue#N", IIf(chkDispValue.Checked, 1, 0))
                End If
                'If rdMRP.Checked Then
                '    Formulas.Add("RateFlag#S", "M")
                'ElseIf rdSP.Checked Then
                '    Formulas.Add("RateFlag#S", "S")
                'Else
                '    Formulas.Add("RateFlag#S", "P")
                'End If

                If IsFabric Then
                    StkType = " And {GreyAccStock.StkType} = 'GG'"
                ElseIf IsStores Then
                    StkType = " And {GreyAccStock.StkType} = 'AG'"
                ElseIf IsPacking Then
                    StkType = " And {GreyAccStock.StkType} = 'PG'"
                End If
                If chkSize.Checked = True Then
                    ReportParameters.rptFile = ReportPath & "\Reports\GreyStockBalewise.rpt"
                Else

                    If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                        If IsFabric = True Then
                            ReportParameters.rptFile = ReportPath & "\Reports\GreyStock.rpt"
                        Else
                            ReportParameters.rptFile = ReportPath & "\Reports\AccStk.rpt"
                        End If
                    Else
                        ReportParameters.rptFile = ReportPath & "\Reports\GreyStock.rpt"
                    End If


                End If
                'Nitin
                Dim strSOFilter As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = 1 Then
                    If IsFabric Then
                        StkType = " And {GreyAccStock.StkType} = 'GG'"
                        If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = 1 Then
                            If rdOthOption1.Checked Then
                                ReportParameters.rptFile = ReportPath & "\Reports\OpeningGreyStockOCWise.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'  " & strSOFilter & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            ElseIf rdOthOption2.Checked Then
                                ReportParameters.rptFile = ReportPath & "\Reports\OpeningGreyStock.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'And {GreyAccStock.SoDocDtl_Id}=0" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            ElseIf rdOthOption3.Checked Then
                                ReportParameters.rptFile = ReportPath & "\Reports\OpeningGreyStock.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            End If
                        End If
                    ElseIf IsStores Then
                        StkType = " And {GreyAccStock.StkType} IN ['AG','PG'] "
                        If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = 1 Then
                            If rdOthOption1.Checked Then
                                ReportParameters.rptFile = ReportPath & "\Reports\OpeningAccStockOCWise.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "' " & strSOFilter & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            ElseIf rdOthOption2.Checked Then
                                ReportParameters.rptFile = ReportPath & "\Reports\OpeningAccStock.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'And {GreyAccStock.SoDocDtl_Id}=0" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            ElseIf rdOthOption3.Checked Then
                                ReportParameters.rptFile = ReportPath & "\Reports\OpeningAccStock.rpt"
                                ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                            End If
                        End If
                    End If
                Else
                    If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
                        ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                    Else
                        ReportParameters.rptFilter = "{GreyAccStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StkType
                    End If

                    ReportParameters.TotalText = True
                End If
                If DefaultSelection() Then
                    Formulas = New Hashtable

                    If rptType = ReportType.ClosingStockSubGroup Then
                        Formulas.Add("GroupOn1#S", "U")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefSubGroup))
                        ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Wise"

                    ElseIf rptType = ReportType.ClosingStockProduct Then
                        Formulas.Add("GroupOn1#S", "P")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    ElseIf rptType = ReportType.ClosingStockSupplier Then
                        Formulas.Add("GroupOn1#S", "S")
                        Formulas.Add("GroupHeader#S", "Supplier")
                        ReportParameters.rptCaption = "Opening Stock - Supplier Wise"

                    ElseIf rptType = ReportType.ClosingStockBrand Then
                        Formulas.Add("GroupOn1#S", "B")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefBrand))
                        ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefBrand) & " Wise"

                    ElseIf rptType = ReportType.ClosingStockLocation Then
                        Formulas.Add("GroupOn1#S", "L")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefLocation))
                        ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise"
                    End If

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Else
                    If chkSize.Checked = True Then

                    Else
                        ViewStockReportWithOptions("Opening Stock", True, True)
                    End If
                End If




            Case ReportType.OpeningStockSubGroup, ReportType.OpeningStockProduct, ReportType.OpeningStockBrand, ReportType.OpeningStockLocation
                PartyFltr = GetPartyFilter("vw_ItemSizeStock")
                StockParam = GetStockFilter("", True)

                If DefaultSelection() Then
                    If rptType = ReportType.OpeningStockSubGroup Then
                        Formulas.Add("GroupOn1#S", "U")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefSubGroup))
                        ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Wise"

                    ElseIf rptType = ReportType.OpeningStockProduct Then
                        Formulas.Add("GroupOn1#S", "P")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    ElseIf rptType = ReportType.OpeningStockBrand Then
                        Formulas.Add("GroupOn1#S", "B")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefBrand))
                        ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefBrand) & " Wise"

                    ElseIf rptType = ReportType.OpeningStockLocation Then
                        Formulas.Add("GroupOn1#S", "L")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefLocation))
                        ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise"
                    End If

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Else
                    ReportParameters.TotalText = True
                    ViewStockReportWithOptions("Opening Stock", True)
                End If

                Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                Formulas.Add("DisplayRate#N", IIf(chkDispRate.Checked, 1, 0))
                Formulas.Add("DisplayValue#N", IIf(chkDispValue.Checked, 1, 0))
                If rdMRP.Checked Then
                    Formulas.Add("RateFlag#S", "M")
                ElseIf rdSP.Checked Then
                    Formulas.Add("RateFlag#S", "S")
                Else
                    Formulas.Add("RateFlag#S", "P")
                End If
                ReportParameters.rptFile = ReportPath & "\Reports\OpeningStkProd.rpt"

                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = 1 Then
                    If rdOthOption1.Checked Then
                        ReportParameters.rptFile = ReportPath & "\Reports\OpeningStkProdOCWise.rpt"
                        ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'  " & strSOFilter1 & StockParam & QtyFilter & Series & LocFilter & PartyFltr
                    ElseIf rdOthOption2.Checked Then
                        ReportParameters.rptFile = ReportPath & "\Reports\OpeningStkProd.rpt"
                        ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'And {vw_ItemSizeStock.SoDtl_id}=0" & StockParam & QtyFilter & Series & LocFilter & PartyFltr
                    ElseIf rdOthOption3.Checked Then
                        ReportParameters.rptFile = ReportPath & "\Reports\OpeningStkProd.rpt"
                        ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr
                    End If
                Else
                    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr

                End If
            Case ReportType.ClosingStockSubGroup, ReportType.ClosingStockProduct, ReportType.ClosingStockBrand, ReportType.ClosingStockSupplier, ReportType.ClosingStockLocation
                Dim StrstkTypeFilter As String = ""

                If rptType = ReportType.ClosingStockSubGroup Then
                    If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = 1 Then

                    End If
                Else
                    PartyFltr = GetPartyFilter("vw_ItemSizeStock")
                    StockParam = GetStockFilter("", True)

                    Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                    Formulas.Add("DisplayRate#N", IIf(chkDispRate.Checked, 1, 0))
                    Formulas.Add("DisplayValue#N", IIf(chkDispValue.Checked, 1, 0))
                End If

                If rdfinished.Checked = True Then
                    StrstkTypeFilter = " And {vw_ItemSizeStock.StkType}='F'"
                ElseIf rddamnaged.Checked = True Then
                    StrstkTypeFilter = " And {vw_ItemSizeStock.StkType}='D'"
                End If
                If rdMRP.Checked Then
                    Formulas.Add("RateFlag#S", "M")
                ElseIf rdSP.Checked Then
                    Formulas.Add("RateFlag#S", "S")
                Else
                    Formulas.Add("RateFlag#S", "P")
                End If
                ReportParameters.rptFile = ReportPath & "\Reports\ClosingStkProd.rpt"

                Dim strSOFilter1 As String = ""
                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = 1 Then
                    If rptType = ReportType.ClosingStockSubGroup Then
                        ReportParameters.rptFile = ReportPath & "\Reports\GreyStockLedgerFinish.rpt"
                        ReportParameters.rptFilter = "{Vw_STOCKLEDGERALLFINISH.CoBr_Id} = '" & SelBranchStkId & "' And {Vw_STOCKLEDGERALLFINISH.SODocdtl_Id}<>0 " & strSOFilter1 & StockParam & PartyFltr
                    ElseIf rdOthOption1.Checked Then
                        If rdSummary.Checked = True Then
                            ReportParameters.rptFile = ReportPath & "\Reports\ClosingStkProdSummary.rpt"
                            ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "' And {vw_ItemSizeStock.SoDtl_id}<>0 " & StockParam & QtyFilter & Series & LocFilter & PartyFltr
                        Else
                            ReportParameters.rptFile = ReportPath & "\Reports\ClosingStkProdOCWise.rpt"
                            ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "' And {vw_ItemSizeStock.SoDtl_id}<>0 " & strSOFilter1 & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StrstkTypeFilter
                        End If
                    ElseIf rdOthOption2.Checked Then
                        If rdSummary.Checked = True Then
                            ReportParameters.rptFile = ReportPath & "\Reports\ClosingStkProdSummary.rpt"
                            ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "' And {vw_ItemSizeStock.SoDtl_id}=0 " & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StrstkTypeFilter
                        Else
                            ReportParameters.rptFile = ReportPath & "\Reports\ClosingStkProd.rpt"
                            ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'And {vw_ItemSizeStock.SoDtl_id}=0" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StrstkTypeFilter
                        End If
                    ElseIf rdOthOption3.Checked Then
                        If rdSummary.Checked = True Then
                            ReportParameters.rptFile = ReportPath & "\Reports\ClosingStkProdSummary.rpt"
                            ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StrstkTypeFilter
                        Else
                            ReportParameters.rptFile = ReportPath & "\Reports\ClosingStkProd.rpt"
                            ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StrstkTypeFilter
                        End If
                    End If
                Else
                    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr & StrstkTypeFilter
                End If
                'End Nitin
                ReportParameters.TotalText = True

                If DefaultSelection() Then
                    Formulas = New Hashtable

                    If rptType = ReportType.ClosingStockSubGroup Then
                        Formulas.Add("GroupOn1#S", "U")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefSubGroup))
                        ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Wise"

                    ElseIf rptType = ReportType.ClosingStockProduct Then
                        Formulas.Add("GroupOn1#S", "P")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    ElseIf rptType = ReportType.ClosingStockSupplier Then
                        Formulas.Add("GroupOn1#S", "S")
                        Formulas.Add("GroupHeader#S", "Supplier")
                        ReportParameters.rptCaption = "Closing Stock - Supplier Wise"

                    ElseIf rptType = ReportType.ClosingStockBrand Then
                        Formulas.Add("GroupOn1#S", "B")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefBrand))
                        ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefBrand) & " Wise"

                    ElseIf rptType = ReportType.ClosingStockLocation Then
                        Formulas.Add("GroupOn1#S", "L")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefLocation))
                        ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise"
                    End If

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Else
                    If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = 1 Then
                    Else
                        ViewStockReportWithOptions("Closing Stock", True, True)
                    End If

                End If


                ' ''Case ReportType.OpeningStockSubGroup, ReportType.OpeningStockProduct, ReportType.OpeningStockBrand, ReportType.OpeningStockLocation
                ' ''    PartyFltr = GetPartyFilter("vw_ItemSizeStock")
                ' ''    StockParam = GetStockFilter("", True)

                ' ''    If DefaultSelection() Then
                ' ''        If rptType = ReportType.OpeningStockSubGroup Then
                ' ''            Formulas.Add("GroupOn1#S", "U")
                ' ''            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefSubGroup))
                ' ''            ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Wise"

                ' ''        ElseIf rptType = ReportType.OpeningStockProduct Then
                ' ''            Formulas.Add("GroupOn1#S", "P")
                ' ''            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                ' ''            ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                ' ''        ElseIf rptType = ReportType.OpeningStockBrand Then
                ' ''            Formulas.Add("GroupOn1#S", "B")
                ' ''            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefBrand))
                ' ''            ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefBrand) & " Wise"

                ' ''        ElseIf rptType = ReportType.OpeningStockLocation Then
                ' ''            Formulas.Add("GroupOn1#S", "L")
                ' ''            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefLocation))
                ' ''            ReportParameters.rptCaption = "Opening Stock - " & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise"
                ' ''        End If

                ' ''        Formulas.Add("GroupOn2#S", "")
                ' ''        Formulas.Add("GroupOn3#S", "")

                ' ''        Formulas.Add("Text1#S", "T")
                ' ''        Formulas.Add("Text2#S", "Y")
                ' ''        Formulas.Add("Text3#S", "H")

                ' ''        Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                ' ''    Else
                ' ''        ReportParameters.TotalText = True
                ' ''        ViewStockReportWithOptions("Opening Stock", True)
                ' ''    End If

                ' ''    Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                ' ''    Formulas.Add("DisplayRate#N", IIf(chkDispRate.Checked, 1, 0))
                ' ''    Formulas.Add("DisplayValue#N", IIf(chkDispValue.Checked, 1, 0))
                ' ''    If rdMRP.Checked Then
                ' ''        Formulas.Add("RateFlag#S", "M")
                ' ''    ElseIf rdSP.Checked Then
                ' ''        Formulas.Add("RateFlag#S", "S")
                ' ''    Else
                ' ''        Formulas.Add("RateFlag#S", "P")
                ' ''    End If
                ' ''    ReportParameters.rptFile = ReportPath & "\Reports\OpeningStkProd.rpt"
                ' ''    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr


                ' ''Case ReportType.ClosingStockSubGroup, ReportType.ClosingStockProduct, ReportType.ClosingStockBrand, ReportType.ClosingStockSupplier, ReportType.ClosingStockLocation
                ' ''    PartyFltr = GetPartyFilter("vw_ItemSizeStock")
                ' ''    StockParam = GetStockFilter("", True)

                ' ''    Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                ' ''    Formulas.Add("DisplayRate#N", IIf(chkDispRate.Checked, 1, 0))
                ' ''    Formulas.Add("DisplayValue#N", IIf(chkDispValue.Checked, 1, 0))

                ' ''    If rdMRP.Checked Then
                ' ''        Formulas.Add("RateFlag#S", "M")
                ' ''    ElseIf rdSP.Checked Then
                ' ''        Formulas.Add("RateFlag#S", "S")
                ' ''    Else
                ' ''        Formulas.Add("RateFlag#S", "P")
                ' ''    End If
                ' ''    ReportParameters.rptFile = ReportPath & "\Reports\ClosingStkProd.rpt"
                ' ''    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr
                ' ''    ReportParameters.TotalText = True

                ' ''    If DefaultSelection() Then
                ' ''        Formulas = New Hashtable

                ' ''        If rptType = ReportType.ClosingStockSubGroup Then
                ' ''            Formulas.Add("GroupOn1#S", "U")
                ' ''            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefSubGroup))
                ' ''            ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Wise"

                ' ''        ElseIf rptType = ReportType.ClosingStockProduct Then
                ' ''            Formulas.Add("GroupOn1#S", "P")
                ' ''            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                ' ''            ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                ' ''        ElseIf rptType = ReportType.ClosingStockSupplier Then
                ' ''            Formulas.Add("GroupOn1#S", "S")
                ' ''            Formulas.Add("GroupHeader#S", "Supplier")
                ' ''            ReportParameters.rptCaption = "Closing Stock - Supplier Wise"

                ' ''        ElseIf rptType = ReportType.ClosingStockBrand Then
                ' ''            Formulas.Add("GroupOn1#S", "B")
                ' ''            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefBrand))
                ' ''            ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefBrand) & " Wise"

                ' ''        ElseIf rptType = ReportType.ClosingStockLocation Then
                ' ''            Formulas.Add("GroupOn1#S", "L")
                ' ''            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefLocation))
                ' ''            ReportParameters.rptCaption = "Closing Stock - " & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise"
                ' ''        End If

                ' ''        Formulas.Add("GroupOn2#S", "")
                ' ''        Formulas.Add("GroupOn3#S", "")

                ' ''        Formulas.Add("Text1#S", "T")
                ' ''        Formulas.Add("Text2#S", "Y")
                ' ''        Formulas.Add("Text3#S", "H")

                ' ''        Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                ' ''    Else
                ' ''        ViewStockReportWithOptions("Closing Stock", True, True)
                ' ''    End If


            Case ReportType.NoStockReport
                StockParam = GetStockFilter("", True)

                Formulas.Add("GroupOn1#S", "P")
                Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                Formulas.Add("Header1#S", GetSystemCaption(SystemCaptionIdx.DefArticle))
                Formulas.Add("Header2#S", GetSystemCaption(SystemCaptionIdx.DefType))
                Formulas.Add("Header3#S", GetSystemCaption(SystemCaptionIdx.DefShade))
                Formulas.Add("Total1Text#S", GetSystemCaption(SystemCaptionIdx.DefProduct) & " Total")
                Formulas.Add("ViewSize#N", 0)
                Formulas.Add("DisplayRate#N", 0)
                Formulas.Add("DisplayValue#N", 0)
                Formulas.Add("ReportCaption#S", Me.Text)

                ReportParameters.rptFile = ReportPath & "\Reports\ClosingStkProd.rpt"
                ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "' And {vw_ItemSizeStock.ClQty} <= 0 " & StockParam & Series & LocFilter

            Case ReportType.StockAsOnPrevDate
                Series = ""

                If rdA.Checked Then
                    Series = " And {ItemStock.StkSr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {ItemStock.StkSr} = 'B'"
                End If

                StockParam = GetStockFilter("", True)
                FromToDt = " And {View_StockLedger.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Location.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If
                Formulas.Add("DisplayRate#N", IIf(chkDispRate.Checked, 1, 0))
                '  Formulas.Add("DisplayValue#N", IIf(chkDispValue.Checked, 1, 0))
                ReportParameters.rptFile = ReportPath & "\Reports\StockAsOn.rpt"
                ReportParameters.rptFilter = "{View_StockLedger.CoBr_Id} = '" & SelBranchId & "' And {View_StockLedger.Dtl_Key} > 0" & StockParam & FromToDt & LocFilter & Series
                ReportParameters.rptCaption = Me.Text
                ReportParameters.TotalText = True

                Formulas.Add("FromDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))
                'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                If rdMRP.Checked Then
                    Formulas.Add("RateFlag#S", "M")
                ElseIf rdSP.Checked Then
                    Formulas.Add("RateFlag#S", "S")
                Else
                    Formulas.Add("RateFlag#S", "P")
                End If

                If DefaultSelection() Then
                    Formulas.Add("GroupOn1#S", "P")
                    ReportParameters.rptCaption = "Stock As On Previous Date - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", Me.Text)
                Else
                    ViewStockReportWithOptions("Stock As On Previous Date")
                End If

            Case ReportType.BarcodeStockSubGroup, ReportType.BarcodeStockProduct, ReportType.BarcodeStockBrand, ReportType.BarcodeStockSupplier, ReportType.BarcodeStockLocation
                PartyFltr = GetPartyFilter("vw_ItemSizeStock")
                StockParam = GetStockFilter("", True)

                'Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))


                If rdMRP.Checked Then
                    Formulas.Add("RateFlag#S", "M")
                ElseIf rdSP.Checked Then
                    Formulas.Add("RateFlag#S", "S")
                Else
                    Formulas.Add("RateFlag#S", "P")
                End If

                Formulas.Add("Header1#S", GetSystemCaption(SystemCaptionIdx.DefArticle))
                Formulas.Add("Header2#S", GetSystemCaption(SystemCaptionIdx.DefType))
                Formulas.Add("Header3#S", GetSystemCaption(SystemCaptionIdx.DefShade))

                Dim rateFltr As String = ""
                Dim SelRate As String = ""
                Dim SelectedItems As String = ""
                SelectedItems = cmbrate.Properties.GetCheckedItems

                'If chkDispRate.Checked = False And chkDispValue.Checked = False And cmbrate.Enabled = True Then
                If SelectedItems <> "" Then
                    SelRate = GetSelectedAttributesForQuery(cmbrate, "multiRate_name")
                    If SelRate.Trim.Length > 0 Then
                        rateFltr &= " And " & SelRate
                    End If
                    Formulas.Add("DisplayRate#N", 1)
                    Formulas.Add("DisplayValue#N", 1)

                    'Dim AllItems As String = SelectedList(cmbrate, SelectedItems)
                    'Dim SelValues As String = ""
                    Dim mrp As Char = ""
                    Dim mrpval As Char = ""
                    Dim wsp As Char = ""
                    Dim wspval As Char = ""
                    Dim CP As Char = ""
                    Dim CPval As Char = ""

                    Dim Rates As String() = SelectedItems.Split(New Char() {","c})

                    Dim word As String
                    For Each word In Rates
                        If Trim(word) = "M" Then
                            'Formulas.Add("RateMFlag#S", "M")
                            mrp = "1"
                        ElseIf Trim(word) = "MV" Then
                            'Formulas.Add("RateMVFlag#S", "MV")
                            mrpval = "1"
                        ElseIf Trim(word) = "W" Then
                            'Formulas.Add("RateWFlag#S", "W")
                            wsp = "1"
                        ElseIf Trim(word) = "WV" Then
                            'Formulas.Add("RateWVFlag#S", "WV")
                            wspval = "1"
                        ElseIf Trim(word) = "P" Then
                            'Formulas.Add("RateCFlag#S", "C")
                            CP = "1"
                        ElseIf Trim(word) = "PV" Then
                            ' Formulas.Add("RateCVFlag#S", "CV")
                            CPval = "1"
                        End If
                    Next

                    If CP = "1" Then
                        Formulas.Add("RateCFlag#S", "P")
                    Else
                        Formulas.Add("RateCFlag#S", "1")
                    End If

                    If CPval = "1" Then
                        Formulas.Add("RateCVFlag#S", "PV")
                    Else
                        Formulas.Add("RateCVFlag#S", "1")
                    End If

                    If mrp = "1" Then
                        Formulas.Add("RateMFlag#S", "M")
                    Else
                        Formulas.Add("RateMFlag#S", "1")
                    End If

                    If mrpval = "1" Then
                        Formulas.Add("RateMVFlag#S", "MV")
                    Else
                        Formulas.Add("RateMVFlag#S", "1")
                    End If

                    If wsp = "1" Then
                        Formulas.Add("RateWFlag#S", "W")
                    Else
                        Formulas.Add("RateWFlag#S", "1")
                    End If

                    If wspval = "1" Then
                        Formulas.Add("RateWVFlag#S", "WV")
                    Else
                        Formulas.Add("RateWVFlag#S", "1")
                    End If

                    'Dim obj As Object

                    'For Each obj In SelectedItems
                    '    If Trim(obj) = "M" Then
                    '        Formulas.Add("RateMFlag#S", "M")
                    '    ElseIf Trim(obj) = "MV" Then
                    '        Formulas.Add("RateMVFlag#S", "MV")
                    '    ElseIf Trim(obj) = "," Then

                    '    End If
                    'Next obj

                    'If AllItems <> "" Then
                    '    SelValues = FieldName & " In (" & AllItems & ")"
                    'Else
                    '    SelValues = ""
                    'End If

                    ReportParameters.rptFile = ReportPath & "\Reports\ClosingStkBarcodeAllRate.rpt"
                Else

                    Formulas.Add("DisplayRate#N", IIf(chkDispRate.Checked, 1, 0))
                    Formulas.Add("DisplayValue#N", IIf(chkDispValue.Checked, 1, 0))
                    ReportParameters.rptFile = ReportPath & "\Reports\ClosingStkBarcode.rpt"
                End If
                ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter & PartyFltr
                ReportParameters.TotalText = True

                If DefaultSelection() Then
                    Formulas = New Hashtable

                    If rptType = ReportType.BarcodeStockSubGroup Then
                        Formulas.Add("GroupOn1#S", "U")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefSubGroup))
                        ReportParameters.rptCaption = "Barcode Stock - " & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Wise"

                    ElseIf rptType = ReportType.BarcodeStockProduct Then
                        Formulas.Add("GroupOn1#S", "P")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                        ReportParameters.rptCaption = "Barcode Stock - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    ElseIf rptType = ReportType.BarcodeStockSupplier Then
                        Formulas.Add("GroupOn1#S", "S")
                        Formulas.Add("GroupHeader#S", "Supplier")
                        ReportParameters.rptCaption = "Barcode Stock - Supplier Wise"

                    ElseIf rptType = ReportType.BarcodeStockBrand Then
                        Formulas.Add("GroupOn1#S", "B")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefBrand))
                        ReportParameters.rptCaption = "Barcode Stock - " & GetSystemCaption(SystemCaptionIdx.DefBrand) & " Wise"

                    ElseIf rptType = ReportType.BarcodeStockLocation Then
                        Formulas.Add("GroupOn1#S", "L")
                        Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefLocation))
                        ReportParameters.rptCaption = "Barcode Stock - " & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise"
                    End If

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    'Formulas.Add("Text1#S", "T")
                    'Formulas.Add("Text2#S", "Y")
                    'Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Else
                    ViewStockReportWithOptions("Barcode Stock", True)
                End If



            Case ReportType.StockAtAGlanceSubGroup, ReportType.StockAtAGlanceProduct, ReportType.StockAtAGlanceBrand, ReportType.StockAtAGlanceSupplier, ReportType.StockAtAGlanceLocation, ReportType.StockAtAGlanceCustomer
                PartyFltr = GetPartyFilter("vw_ItemSizeStock")
                StockParam = GetStockFilter("", True, True)

                If rptType = ReportType.StockAtAGlanceCustomer Then
                    ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlancePartySize.rpt"
                    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter
                Else
                    If chkSize.Checked = True Then
                        '--------------bhoomi      'Shade wise  ankita 08/02/2017
                        StockParam1 = GetStockFilter1("", True, True)

                        If cmbDisplay.SelectedIndex = 0 Then ''All

                        ElseIf cmbDisplay.SelectedIndex = 1 Then ''Equal To
                            QtyFilter1 = " HAVING      SUM(dbo.ItemStock.ClQty) = " & txtStkFrom.EditValue
                        ElseIf cmbDisplay.SelectedIndex = 2 Then ''Greater Than
                            QtyFilter1 = " HAVING      SUM(dbo.ItemStock.ClQty) > " & txtStkFrom.EditValue
                        ElseIf cmbDisplay.SelectedIndex = 3 Then ''Less Than
                            QtyFilter1 = " HAVING      SUM(dbo.ItemStock.ClQty) < " & txtStkFrom.EditValue
                        ElseIf cmbDisplay.SelectedIndex = 4 Then ''Range
                            QtyFilter1 = " HAVING      SUM(dbo.ItemStock.ClQty) > " & txtStkFrom.EditValue & "  and     SUM(dbo.ItemStock.ClQty) < " & txtStkTo.EditValue
                        End If
                        LocFilter1 = GetSelectedAttributesForStock(cmbLocation, "Loc_Key")

                        Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_ItemSizeStockqty]')) " _
                               & " Drop View [dbo].[vw_ItemSizeStockqty]"
                        Common.ExecuteQuery(Query)

                        Query = "Create View [vw_ItemSizeStockqty] as " _
                        & " SELECT     ItemStock.CoBr_Id, ItemStock.FcYr_Id,ItemStock.Item_Key, ItemStock.Style_Key, ItemStock.Type_Key, ItemStock.Shade_Key, " _
                        & " ItemStock.Loc_Key,  SUM(ItemStock.ClQty) AS ClQty " _
                        & " FROM  Style INNER JOIN Quality ON Style.Qlty_Key = Quality.Qlty_Key RIGHT  JOIN " _
                        & " ItemStock ON Style.Style_Key = ItemStock.Style_Key LEFT  JOIN Type ON ItemStock.Type_Key = Type.Type_Key LEFT  JOIN " _
                        & " ItemGrp INNER JOIN Item ON ItemGrp.ItemGrp_Key = Item.ItemGrp_Key INNER JOIN ItemSubGrp ON Item.ItemSubGrp_Key = ItemSubGrp.ItemSubGrp_Key ON ItemStock.Item_Key = Item.Item_Key LEFT  JOIN " _
                        & " StyleSize ON ItemStock.StyleSize_Id = StyleSize.StyleSize_Id " _
                        & " WHERE     (ItemStock.Stk_Id > 0) and ItemStock.CoBr_Id ='" & SelBranchStkId & "'" _
                        & LocFilter1 & StockParam1 _
                        & " GROUP BY ItemStock.CoBr_Id, ItemStock.FcYr_Id ,ItemStock.Item_Key, ItemStock.Style_Key, ItemStock.Type_Key, ItemStock.Shade_Key,ItemStock.Loc_Key" _
                        & QtyFilter1
                        Common.ExecuteQuery(Query)
                        '-------------------------bhoomi
                        ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlanceSizeQty.rpt"
                        'ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter
                        ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & Series & LocFilter

                    Else
                        If GetSettingAsPerId(ApplnSettingsIdx.RateDisplayInStockAtGlanceReport) = "1" Then
                            ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlanceSizeMRPWise.rpt"
                            ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter
                        Else
                            If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForBodysize)) = 1 Then 'suraj
                                If rptType = ReportType.StockAtAGlanceProduct Then
                                    If chkDispRate.Checked = True Then
                                        ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlanceSizedozens.rpt"
                                        ReportParameters.rptFilter = "{vw_ItemsizestockDozens.StkType} ='F' And {vw_ItemsizestockDozens.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & Series & LocFilter
                                    Else
                                        ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlanceSizeBodySize.rpt"
                                        ReportParameters.rptFilter = "{vw_ItemSizeStock1.StkType} ='F' And {vw_ItemSizeStock1.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter
                                    End If
                                End If
                            Else
                                ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlanceSize.rpt"
                                ReportParameters.rptFilter = "{vw_ItemSizeStock.StkType} ='F' And {vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "'" & StockParam & QtyFilter & Series & LocFilter

                            End If

                            End If
                        End If


                    End If

                    If DefaultSelection() Then
                        'Formulas = New Hashtable

                        If rptType = ReportType.StockAtAGlanceSubGroup Then
                            Formulas.Add("GroupOn1#S", "U")
                            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefSubGroup))
                            ReportParameters.rptCaption = "Stock At A Glance - " & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Wise"

                        ElseIf rptType = ReportType.StockAtAGlanceProduct Then
                            Formulas.Add("GroupOn1#S", "P")
                            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                            ReportParameters.rptCaption = "Stock At A Glance - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                        ElseIf rptType = ReportType.StockAtAGlanceSupplier Then
                            Formulas.Add("GroupOn1#S", "S")
                            Formulas.Add("GroupHeader#S", "Supplier")
                            ReportParameters.rptCaption = "Stock At A Glance - Supplier Wise"

                        ElseIf rptType = ReportType.StockAtAGlanceCustomer Then

                            Formulas.Add("GroupOn1#S", "R")
                            Formulas.Add("GroupHeader#S", "Customer")
                            ReportParameters.rptCaption = "Stock At A Glance - Customer Wise"

                        ElseIf rptType = ReportType.StockAtAGlanceBrand Then
                            Formulas.Add("GroupOn1#S", "B")
                            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefBrand))
                            ReportParameters.rptCaption = "Stock At A Glance - " & GetSystemCaption(SystemCaptionIdx.DefBrand) & " Wise"

                        ElseIf rptType = ReportType.StockAtAGlanceLocation Then
                            Formulas.Add("GroupOn1#S", "L")
                            Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefLocation))
                            ReportParameters.rptCaption = "Stock At A Glance - " & GetSystemCaption(SystemCaptionIdx.DefLocation) & " Wise"
                        End If

                        Formulas.Add("GroupOn2#S", "")
                        'Formulas.Add("GroupOn3#S", "")

                        Formulas.Add("Text1#S", "T")
                        Formulas.Add("Text2#S", "Y")
                        Formulas.Add("Text3#S", "H")

                        Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                    Else
                        ViewStockReportWithOptions("Stock At A Glance", True)
                    End If


            Case ReportType.StockAgingSubGroup, ReportType.StockAgingProduct, ReportType.StockAgingBrand, ReportType.StockAgingSupplier
                PartyFltr = GetPartyFilter("vw_ItemSizeStock")
                StockParam = GetStockFilter("", True)

                If rdMRP.Checked Then
                    Formulas.Add("RateFlag#S", "M")
                ElseIf rdSP.Checked Then
                    Formulas.Add("RateFlag#S", "S")
                Else
                    Formulas.Add("RateFlag#S", "P")
                End If
                Formulas.Add("OnQty#N", IIf(rdAgeQty.Checked, 1, 0))
                Formulas.Add("AsOn#S", dtpFrom.Value)
                ReportParameters.rptFile = ReportPath & "\Reports\StockAgingProduct.rpt"
                ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "' And {vw_ItemSizeStock.PurDoc_Dt} <= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ")" & StockParam & Series & PartyFltr & LocFilter

                If DefaultSelection() Then
                    'Formulas = New Hashtable

                    If rptType = ReportType.StockAgingSubGroup Then
                        Formulas.Add("GroupOn1#S", "U")
                        Formulas.Add("Text1#S", "P")
                        Formulas.Add("Header2#S", GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
                        ReportParameters.rptCaption = "Stock Aging - " & GetSystemCaption(SystemCaptionIdx.DefSubGroup) & " Wise"

                    ElseIf rptType = ReportType.StockAgingProduct Then
                        Formulas.Add("GroupOn1#S", "P")
                        Formulas.Add("Text1#S", "T")
                        Formulas.Add("Text2#S", "Y")
                        Formulas.Add("Text3#S", "H")
                        Formulas.Add("Header2#S", GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle) & "/" & GetSysCaptionAsPerId(SystemCaptionIdx.DefType) & "/" & GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
                        ReportParameters.rptCaption = "Stock Aging - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    ElseIf rptType = ReportType.StockAgingSupplier Then
                        Formulas.Add("GroupOn1#S", "S")
                        Formulas.Add("Text1#S", "P")
                        Formulas.Add("Header2#S", GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
                        ReportParameters.rptCaption = "Stock Aging - Supplier Wise"

                    ElseIf rptType = ReportType.StockAgingBrand Then
                        Formulas.Add("GroupOn1#S", "B")
                        Formulas.Add("Text1#S", "P")
                        Formulas.Add("Header2#S", GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
                        ReportParameters.rptCaption = "Stock Aging - " & GetSystemCaption(SystemCaptionIdx.DefBrand) & " Wise"
                    End If

                    'Formulas.Add("GroupOn2#S", "")
                    'Formulas.Add("GroupOn3#S", "")

                    If rptType <> ReportType.StockAgingProduct Then
                        Formulas.Add("Text2#S", "")
                        Formulas.Add("Text3#S", "")
                    End If

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Else
                    ViewStockReportWithOptions("Stock Aging", True)

                    'Dim HeaderText As String = ""

                    'For i = 0 To lstDetails.Items.Count - 1
                    '    If i = 0 Then
                    '        HeaderText = lstDetails.Items(i)
                    '    ElseIf i = 1 Then
                    '        HeaderText = HeaderText & "/" & lstDetails.Items(i)
                    '    ElseIf i = 2 Then
                    '        HeaderText = HeaderText & "/" & lstDetails.Items(i)
                    '    End If
                    'Next i

                    'Formulas.Add("Header2#S", HeaderText)
                End If


            Case ReportType.StockAgingBarcode
                PartyFltr = GetPartyFilter("vw_ItemSizeStock")
                StockParam = GetStockFilter("", True)

                If DefaultSelection() Then
                    Formulas = New Hashtable

                    Formulas.Add("Header1#S", lstOption1.Items(0))
                    Formulas.Add("Header2#S", lstOption2.Items(0))
                    ReportParameters.rptCaption = "Stock Aging - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & "/Barcode Wise"

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Else
                    ViewStockReportWithOptions("Stock Aging " & GetSystemCaption(SystemCaptionIdx.DefProduct) & "/Barcode", True)
                End If

                If rdMRP.Checked Then
                    Formulas.Add("RateFlag#S", "M")
                ElseIf rdSP.Checked Then
                    Formulas.Add("RateFlag#S", "S")
                Else
                    Formulas.Add("RateFlag#S", "P")
                End If
                Formulas.Add("OnQty#N", IIf(rdAgeQty.Checked, 1, 0))
                Formulas.Add("AsOn#S", dtpFrom.Value)
                ReportParameters.rptFile = ReportPath & "\Reports\StockAgingBarcode.rpt"
                ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchStkId & "' And {vw_ItemSizeStock.PurDoc_Dt} <= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ")" & StockParam & Series & LocFilter & PartyFltr


            Case ReportType.ClosingStockDocument
                PartyFltr = GetPartyFilter("vw_PurchVerSale")
                FromToDt = GetFromToDateSeriesFilter("{vw_PurchVerSale.Doc_Dt}", "{vw_PurchVerSale.Bill_Sr}")

                ReportParameters.rptCaption = "Closing Stock - Document Wise"
                ReportParameters.rptFile = ReportPath & "\Reports\SupDocStock.rpt"
                ReportParameters.rptFilter = "{vw_PurchVerSale.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & PartyFltr


            Case ReportType.StockLedger
                ''SM for image report

                'Dim sql As String = "select * from vw_DesignWiseStockWithImage"
                'Dim con As String = "server=VRS9-PC\SQLEXPRESS1;Initial Catalog=Honey;User=vrs;Password=vrs0108"
                'Dim db As New SqlDataAdapter(sql, con)
                'Dim dt As New DataTable
                'db.Fill(dt)

                Dim strSOFilter1 As String = ""

                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If

                Series = ""

                If rdA.Checked Then
                    Series = " And {ItemStock.StkSr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {ItemStock.StkSr} = 'B'"
                End If

                QtyFilter = ""
                If txtText.Text.Trim.Length > 0 Then
                    QtyFilter = " And ({ItemStock.Barcode} = '" & txtText.Text & "' Or {ItemStock.AltBarcode1} = '" & txtText.Text & "' Or {ItemStock.AltBarcode2} = '" & txtText.Text & "')"
                End If
                PartyFltr = GetPartyFilter("View_StockLedger")

                StockParam = GetStockFilter("", True)
                FromToDt = " And {View_StockLedger.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"

                ReportParameters.rptFile = ReportPath & "\Reports\StockLedger.rpt"
                ReportParameters.rptFilter = "{View_StockLedger.CoBr_Id} = '" & SelBranchId & "' And {View_StockLedger.Dtl_Key} > 0" & StockParam & FromToDt & PartyFltr & QtyFilter & strSOFilter1
                ReportParameters.rptCaption = Me.Text
                ReportParameters.TotalText = True

                Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                If rdSummary.Checked Then
                    Formulas.Add("DisplayDetails#S", "0")
                    ' Formulas.Add("ProductDsp#S", "0")
                ElseIf rdDetailed.Checked Then
                    Formulas.Add("DisplayDetails#S", "1")
                End If

                If DefaultSelection() Then
                    Formulas.Add("GroupOn1#S", "P")
                    ReportParameters.rptCaption = "Stock Ledger - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", Me.Text)
                Else
                    ViewStockReportWithOptions("Stock Ledger")
                End If
                ''''''Rohit 08062017

                'add by pratibha 01-3-2020
            Case ReportType.stockledgerlocation


                Series = ""

                If rdA.Checked Then
                    Series = " And {ItemStock.StkSr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {ItemStock.StkSr} = 'B'"
                End If

                QtyFilter = ""
                If txtText.Text.Trim.Length > 0 Then
                    QtyFilter = " And ({ItemStock.Barcode} = '" & txtText.Text & "' Or {ItemStock.AltBarcode1} = '" & txtText.Text & "' Or {ItemStock.AltBarcode2} = '" & txtText.Text & "')"
                End If
                PartyFltr = GetPartyFilter("View_StockLedgerLocation")

                StockParam = GetStockFilter("", True)
                FromToDt = " And {View_StockLedgerLocation.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"


                ReportParameters.rptFile = ReportPath & "\Reports\StockLedgerLocation.rpt"
                ReportParameters.rptFilter = "{View_StockLedgerLocation.CoBr_Id} = '" & SelBranchId & "' And {View_StockLedgerLocation.Dtl_Key} > 0" & StockParam & FromToDt & PartyFltr & QtyFilter & LocFilter
                ReportParameters.rptCaption = Me.Text
                ReportParameters.TotalText = True

                Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                If rdSummary.Checked Then
                    Formulas.Add("DisplayDetails#S", "0")
                    ' Formulas.Add("ProductDsp#S", "0")
                ElseIf rdDetailed.Checked Then
                    Formulas.Add("DisplayDetails#S", "1")
                End If


                If DefaultSelection() Then
                    Formulas.Add("GroupOn1#S", "P")
                    ReportParameters.rptCaption = "Stock Ledger Location - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", Me.Text)
                Else
                    ViewStockReportWithOptions("Stock Ledger Location ")
                End If


            Case ReportType.DesignWiseStockWithImages

                If chkDispRate.Checked = True Then
                    Dim strImgFilter As String = ""
                    Dim Query1 As String = ""

                    StockParam = GetStockFilter("vw_DesignWiseStockWithImage", False)

                    StockParam = StockParam.Replace("{", "").Replace("}", "").Replace("[", "(").Replace("]", ")")
                    StockParam = StockParam.Replace(".Style", ".Style_Code")

                    If rdOthOption1.Checked = True Then
                        Query = "select * from vw_DesignWiseStockWithImage Where 1=1 " & StockParam
                        Query1 = "select isnull(sum(Clqty),0) TotQty from vw_DesignWiseStockWithImage Where 1=1 " & StockParam

                    ElseIf rdOthOption2.Checked = True Then
                        Query = "select * from vw_DesignWiseStockWithImage Where 1=1 And vw_DesignWiseStockWithImage.Ready='F' " & StockParam
                        Query1 = "select isnull(sum(Clqty),0) TotQty from vw_DesignWiseStockWithImage Where 1=1 And vw_DesignWiseStockWithImage.Ready='F' " & StockParam

                    ElseIf rdOthOption3.Checked = True Then
                        Query = "select * from vw_DesignWiseStockWithImage Where 1=1 And vw_DesignWiseStockWithImage.Ready='S' " & StockParam
                        Query1 = "select isnull(sum(Clqty),0) TotQty from vw_DesignWiseStockWithImage Where 1=1 And vw_DesignWiseStockWithImage.Ready='S' " & StockParam
                    End If

                    Dim dt As DataTable = Common.GetDataTable(Query)
                    dt.TableName = "vw_DesignWiseStockWithImage"
                    dt.Columns.Add("StyleImage", System.Type.GetType("System.Byte[]"))

                    Dim DtTotQty As DataTable = Common.GetDataTable(Query1)

                    Dim ImgFile As String = ""
                    Dim ImgFolder As String

                    For i As Short = 0 To dt.Rows.Count - 1
                        ImgFolder = GetSettingAsPerId(ApplnSettingsIdx.GenImagePath) & "\Product\"
                        ImgFile = ImgFolder & dt.Rows(i)("ImageFile")
                        Console.WriteLine(ImgFile)
                        LoadImage(dt.Rows(i), ImgFile)
                    Next

                    'If DtTotQty.Rows.Count > 0 Then
                    '    Formulas.Add("GrandTotal#N", DtTotQty.Rows(0)(0))
                    'End If

                    Dim crDoc As New CrystalDecisions.CrystalReports.Engine.ReportDocument


                    crDoc.Load(ReportPath & "\Reports\StockWithImage_Crosstab.rpt")
                    'Else
                    '    crDoc.Load(ReportPath & "\Reports\StockWithImageLarge_Crosstab.rpt")
                    'End If

                    crDoc.DataDefinition.FormulaFields("GrandTotal").Text = DtTotQty.Rows(0)(0)

                    crDoc.SetDataSource(dt)
                    dt = Nothing

                    Dim frm As New frmrptReport_WithImage
                    frm.ReportDocument = crDoc
                    frm.Show()
                    Exit Sub

                ElseIf chkDispValue.Checked = True Then
                    Dim strImgFilter As String = ""
                    Dim Query1 As String = ""

                    If chkSize.Checked = False Then
                        StockParam = GetStockFilter("vw_DesignWiseStockWithImage", False)
                    Else
                        StockParam = GetStockFilter("vw_DesignShadeWithImage", False)
                    End If

                    StockParam = StockParam.Replace("{", "").Replace("}", "").Replace("[", "(").Replace("]", ")")
                    StockParam = StockParam.Replace(".Style", ".Style_Code")

                    If chkSize.Checked = False Then
                        If rdOthOption1.Checked = True Then
                            Query = "select * from vw_DesignWiseStockWithImage Where 1=1 " & StockParam
                            Query1 = "select isnull(sum(Clqty),0) TotQty from vw_DesignWiseStockWithImage Where 1=1 " & StockParam

                        ElseIf rdOthOption2.Checked = True Then
                            Query = "select * from vw_DesignWiseStockWithImage Where 1=1 And vw_DesignWiseStockWithImage.Ready='F' " & StockParam
                            Query1 = "select isnull(sum(Clqty),0) TotQty from vw_DesignWiseStockWithImage Where 1=1 And vw_DesignWiseStockWithImage.Ready='F' " & StockParam

                        ElseIf rdOthOption3.Checked = True Then
                            Query = "select * from vw_DesignWiseStockWithImage Where 1=1 And vw_DesignWiseStockWithImage.Ready='S' " & StockParam
                            Query1 = "select isnull(sum(Clqty),0) TotQty from vw_DesignWiseStockWithImage Where 1=1 And vw_DesignWiseStockWithImage.Ready='S' " & StockParam
                        End If
                    Else
                        Query = "select * from vw_DesignShadeWithImage Where 1=1 " & StockParam
                        Query1 = "select isnull(sum(Clqty),0) TotQty from vw_DesignShadeWithImage Where 1=1 " & StockParam
                    End If

                    Dim dt As DataTable = Common.GetDataTable(Query)

                    If chkSize.Checked = False Then
                        dt.TableName = "vw_DesignWiseStockWithImage"
                    Else
                        dt.TableName = "vw_DesignShadeWithImage"
                    End If

                    dt.Columns.Add("StyleImage", System.Type.GetType("System.Byte[]"))

                    Dim DtTotQty As DataTable = Common.GetDataTable(Query1)

                    Dim ImgFile As String = ""
                    Dim ImgFolder As String

                    For i As Short = 0 To dt.Rows.Count - 1
                        ImgFolder = GetSettingAsPerId(ApplnSettingsIdx.GenImagePath) & "\Product\"
                        ImgFile = ImgFolder & dt.Rows(i)("ImageFile")
                        Console.WriteLine(ImgFile)
                        LoadImage(dt.Rows(i), ImgFile)
                    Next

                    'If DtTotQty.Rows.Count > 0 Then
                    '    Formulas.Add("GrandTotal#N", DtTotQty.Rows(0)(0))
                    'End If

                    Dim crDoc As New CrystalDecisions.CrystalReports.Engine.ReportDocument

                    'If chkSize.Checked = False Then
                    '    crDoc.Load(ReportPath & "\Reports\StockWithImage_Crosstab.rpt")
                    'Else

                    'End If
                    If chkSize.Checked = False Then
                        crDoc.Load(ReportPath & "\Reports\StockWithImageLarge_Crosstab.rpt")
                        crDoc.DataDefinition.FormulaFields("GrandTotal").Text = DtTotQty.Rows(0)(0)
                    Else
                        crDoc.Load(ReportPath & "\Reports\StyleShadeWithImageLarge_Crosstab.rpt")
                    End If

                    crDoc.SetDataSource(dt)
                    dt = Nothing

                    Dim frm As New frmrptReport_WithImage
                    frm.ReportDocument = crDoc
                    frm.Show()
                    Exit Sub

                ElseIf chkDispRate.Checked = False And chkDispValue.Checked = False Then    'Without Images

                    Dim StockFilter As String = ""
                    Dim Query1 As String = ""


                    StockParam = GetStockFilter("vw_DesignWiseStockWithImage", False)

                    'StockParam = StockParam.Replace("{", "").Replace("}", "").Replace("[", "(").Replace("]", ")")
                    StockParam = StockParam.Replace(".Style", ".Style_Code")

                    StockFilter = StockParam.Replace("{", "").Replace("}", "").Replace("[", "(").Replace("]", ")")


                    If rdOthOption2.Checked = True Then
                        StockFilter &= "  And vw_DesignWiseStockWithImage.Ready = 'F'"
                    ElseIf rdOthOption3.Checked = True Then
                        StockFilter &= "  And vw_DesignWiseStockWithImage.Ready = 'S'"
                    End If
                    Query1 = "select isnull(sum(Clqty),0) TotQty from vw_DesignWiseStockWithImage Where 1=1 " & StockFilter

                    Dim DtTotQty As DataTable = Common.GetDataTable(Query1)

                    If DtTotQty.Rows.Count > 0 Then
                        Formulas.Add("GrandTotal#N", DtTotQty.Rows(0)(0))
                    End If

                    StockFilter = ""
                    If rdOthOption2.Checked = True Then
                        StockFilter &= "  And {vw_DesignWiseStockWithImage.Ready} = 'F'"
                    ElseIf rdOthOption3.Checked = True Then
                        StockFilter &= "  And {vw_DesignWiseStockWithImage.Ready} = 'S'"
                    End If
                    'If chkDispValue.Checked = False Then
                    '    StockFilter = " And {vw_DesignWiseStockWithImage.Ready} = 'F'"
                    'End If

                    ReportParameters.rptFile = ReportPath & "\Reports\StockWithOutImage_Crosstab.rpt"
                    ReportParameters.rptFilter = "{vw_DesignWiseStockWithImage.CoBr_Id} = '" & SelBranchId & "'" & StockParam & StockFilter
                    ReportParameters.rptCaption = Me.Text
                    ReportParameters.TotalText = True

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                End If


            Case ReportType.StyleCosting
                'Series = ""

                'If rdA.Checked Then
                '    Series = " And {ItemStock.StkSr} = 'A'"
                'ElseIf rdB.Checked Then
                '    Series = " And {ItemStock.StkSr} = 'B'"
                'End If

                QtyFilter = ""
                'If txtText.Text.Trim.Length > 0 Then
                '    QtyFilter = " And ({ItemStock.Barcode} = '" & txtText.Text & "' Or {ItemStock.AltBarcode1} = '" & txtText.Text & "' Or {ItemStock.AltBarcode2} = '" & txtText.Text & "')"
                'End If
                'PartyFltr = GetPartyFilter("View_StockLedger")

                StockParam = GetStockFilter("", True)
                Dim OtherFilter As String = ""

                FromToDt = " And {CostingSoDetails.Doc_Dt} >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ")  And {CostingSoDetails.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"
                ReportParameters.rptFile = ReportPath & "\Reports\StyleCosting.rpt"
                ReportParameters.rptFilter = "{CostingSoDetails.CoBr_Id} = '" & SelBranchId & "' And {CostingSoDetails.Doc_Id} > 0" & StockParam & FromToDt
                ReportParameters.rptCaption = Me.Text
                ReportParameters.TotalText = True

                Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                'If rdSummary.Checked Then
                '    Formulas.Add("DisplayDetails#S", "0")
                '    ' Formulas.Add("ProductDsp#S", "0")
                'ElseIf rdDetailed.Checked Then
                '    Formulas.Add("DisplayDetails#S", "1")
                'End If


                'If DefaultSelection() Then
                '    Formulas.Add("GroupOn1#S", "P")
                '    ReportParameters.rptCaption = "Stock Ledger - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                '    Formulas.Add("GroupOn2#S", "")
                '    Formulas.Add("GroupOn3#S", "")

                '    Formulas.Add("Text1#S", "T")
                '    Formulas.Add("Text2#S", "Y")
                '    Formulas.Add("Text3#S", "H")

                '    Formulas.Add("ReportCaption#S", Me.Text)
                'Else
                '    ViewStockReportWithOptions("Stock Ledger")
                'End If

                '''----Rohit

            Case ReportType.StockStatement
                Series = ""

                If rdA.Checked Then
                    Series = " And {ItemStock.StkSr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {ItemStock.StkSr} = 'B'"
                End If

                'PartyFltr = ""
                'If txtText.Text.Trim.Length > 0 Then
                '    PartyFltr = " And {ItemStock.Barcode} = '" & txtText.Text & "'"
                'End If
                PartyFltr = GetPartyFilter("ItemStock")
                StockParam = GetStockFilter("", True)
                FromToDt = " And {View_StockLedger.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{View_StockLedger.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Location.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\StockStatement.rpt"
                ReportParameters.rptFilter = "{View_StockLedger.CoBr_Id} = '" & SelBranchId & "' And {View_StockLedger.Dtl_Key} > 0" & StockParam & FromToDt & LocFilter & PartyFltr & Series
                ReportParameters.rptCaption = Me.Text

                Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                If rdMRP.Checked Then
                    Formulas.Add("RateFlag#S", "M")
                ElseIf rdSP.Checked Then
                    Formulas.Add("RateFlag#S", "S")
                Else
                    Formulas.Add("RateFlag#S", "P")
                End If

                If DefaultSelection() Then
                    Formulas.Add("GroupOn1#S", "P")
                    ReportParameters.rptCaption = "Stock Statement - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", Me.Text)
                Else
                    ReportParameters.TotalText = True
                    ViewStockReportWithOptions("Stock Ledger")
                End If




            Case ReportType.StockUnsold
                StockParam = GetStockFilter("", True)
                PartyFltr = GetPartyFilter("ItemStock")
                QtyFilter = " And {vw_StockStmt.UnsoldSince} >= 0"
                FromToDt = " And Not ({@LastSaleDate} In Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") To Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")) And {vw_StockStmt.LASTSALE} <> cDate('01/01/1900')"
                Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))
                Formulas.Add("NotYetSold#N", 0)

                If DefaultSelection() Then
                    Formulas.Add("GroupOn1#S", "P")
                    Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                    ReportParameters.rptCaption = "Stock Unsold - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Else
                    ReportParameters.TotalText = True
                    ViewStockReportWithOptions("Stock Unsold")
                End If

                Series = ""

                If rdA.Checked Then
                    Series = " And {vw_StockStmt.StkSr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_StockStmt.StkSr} = 'B'"
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Location.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\NoSale.rpt"
                ReportParameters.rptFilter = "{vw_StockStmt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockParam & Series & QtyFilter & LocFilter & PartyFltr


            Case ReportType.StockNotYetSold
                StockParam = GetStockFilter("", True)
                PartyFltr = GetPartyFilter("ItemStock")
                FromToDt = " And {vw_StockStmt.LASTSALE} = cDate('01/01/1900')"
                Formulas.Add("NotYetSold#N", 1)

                If DefaultSelection() Then
                    Formulas.Add("GroupOn1#S", "P")
                    Formulas.Add("GroupHeader#S", GetSystemCaption(SystemCaptionIdx.DefProduct))
                    ReportParameters.rptCaption = "Stock Unsold - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                Else
                    ReportParameters.TotalText = True
                    ViewStockReportWithOptions("Stock Not Yet Sold")
                End If

                Series = ""

                If rdA.Checked Then
                    Series = " And {vw_StockStmt.StkSr} = 'A'"
                ElseIf rdB.Checked Then
                    Series = " And {vw_StockStmt.StkSr} = 'B'"
                End If

                LocFilter = GetSelectedAttributesForStock(cmbLocation, "{Location.Loc_Key}")
                If LocFilter.Trim.Length > 0 Then
                    LocFilter = " And " & LocFilter
                End If

                ReportParameters.rptFile = ReportPath & "\Reports\NoSale.rpt"
                ReportParameters.rptFilter = "{vw_StockStmt.CoBr_Id} = '" & SelBranchId & "'" & FromToDt & StockParam & Series & PartyFltr


                'Case ReportType.FastMovingSupplier
                '    StockParam = GetStockFilter("vw_StockStmt", True)

                '    If DefaultSelection() Then
                '        Formulas.Add("GroupOn1#S", "P")
                '        Formulas.Add("GroupHeader#S", "Product")
                '        ReportParameters.rptCaption = "Fast Moving Products - Supplier Wise"

                '        Formulas.Add("GroupOn2#S", "")
                '        Formulas.Add("GroupOn3#S", "")

                '        Formulas.Add("Text1#S", "T")
                '        Formulas.Add("Text2#S", "Y")
                '        Formulas.Add("Text3#S", "H")

                '        Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
                '    Else
                '        ViewStockReportWithOptions("Fast Moving Products")
                '    End If

                '    Series = ""

                '    If rdA.Checked Then
                '        Series = " And {vw_StockStmt.StkSr} = 'A'"
                '    ElseIf rdB.Checked Then
                '        Series = " And {vw_StockStmt.StkSr} = 'B'"
                '    End If

                '    If rdAgeQty.Checked Then
                '        Formulas.Add("SortOn#S", "Q")
                '        QtyFilter = GetQtyFilter("{@QtyVar}")

                '    ElseIf rdAgeValue.Checked Then
                '        Formulas.Add("SortOn#S", "V")
                '        QtyFilter = GetQtyFilter("{@ValueVar}")
                '    End If
                '    Formulas.Add("TopOrBottom#S", "T")

                '    ReportParameters.rptFile = ReportPath & "\Reports\MovingNonMoving.rpt"
                '    ReportParameters.rptFilter = "{vw_StockStmt.CoBr_Id} = '" & SelBranchId & "' And {@QtyVar} > 0" & StockParam & Series & QtyFilter


                'Case ReportType.CurrentStock
                '    Formulas = New Hashtable

                '    Formulas.Add("BrandFlag#N", 0)
                '    Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                '    Formulas.Add("ReportCaption#S", "Closing Stock")
                '    ReportParameters.rptFile = ReportPath & "\Reports\ClosingStock.rpt"
                '    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchId & "' And {vw_ItemSizeStock.ClQty} <> 0" & StockFltr & Series

                'Case ReportType.CurrentStockBrandWise
                '    Formulas = New Hashtable

                '    Formulas.Add("BrandFlag#N", 1)
                '    Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
                '    Formulas.Add("ReportCaption#S", "Closing Stock - Brand Wise")
                '    ReportParameters.rptFile = ReportPath & "\Reports\ClosingStock.rpt"
                '    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchId & "' And {vw_ItemSizeStock.ClQty} <> 0" & StockFltr & Series

                'Case ReportType.CurrentStockWithValue
                '    Formulas = New Hashtable

                '    Formulas.Add("BrandFlag#N", 1)
                '    Formulas.Add("ReportCaption#S", "Closing Stock With Value")

                '    Dim RateCnt As Byte

                '    If chkPurRate.Checked Then
                '        Formulas.Add("Rate1#S", "P")
                '        RateCnt += 1
                '    End If

                '    If chkMRP.Checked Then
                '        If RateCnt = 1 Then
                '            Formulas.Add("Rate2#S", "M")
                '        Else
                '            Formulas.Add("Rate1#S", "M")
                '        End If

                '        RateCnt += 1
                '    End If

                '    If RateCnt <> 2 Then
                '        If chkSalePrice.Checked Then
                '            If RateCnt = 1 Then
                '                Formulas.Add("Rate2#S", "S")
                '            Else
                '                Formulas.Add("Rate1#S", "S")
                '            End If

                '            RateCnt += 1
                '        End If
                '    End If

                '    If RateCnt <> 2 Then
                '        MsgBox("Atleast two rates should be selected for valuation !", MsgBoxStyle.Exclamation)
                '        Exit Sub
                '    End If

                '    ReportParameters.rptFile = ReportPath & "\Reports\ClosingStockWithValue.rpt"
                '    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchId & "' And {vw_ItemSizeStock.ClQty} <> 0" & StockFltr & Series

                'Case ReportType.BarcodeStock
                '    Formulas = New Hashtable

                '    Formulas.Add("BrandFlag#N", 0)
                '    Formulas.Add("ReportCaption#S", "Barcode Stock")
                '    ReportParameters.rptFile = ReportPath & "\Reports\BarcodeWiseStock.rpt"
                '    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchId & "' And {vw_ItemSizeStock.ClQty} <> 0" & StockFltr & Series

                'Case ReportType.BarcodeStockBrand
                '    Formulas = New Hashtable

                '    Formulas.Add("BrandFlag#N", 1)
                '    Formulas.Add("ReportCaption#S", "Barcode Stock - Brand Wise")
                '    ReportParameters.rptFile = ReportPath & "\Reports\BarcodeWiseStock.rpt"
                '    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchId & "' And {vw_ItemSizeStock.ClQty} <> 0" & StockFltr & Series

                'Case ReportType.StockAtAGlanceProductWise
                '    Formulas = New Hashtable

                '    If rdSummary.Checked Then
                '        Formulas.Add("GroupOn1#S", "G")
                '        Formulas.Add("GroupOn2#S", "U")
                '        Formulas.Add("ReportCaption#S", "Stock At A Glance - Product Wise")
                '        ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlanceProdSize.rpt"
                '    Else
                '        Formulas.Add("GroupOn#S", "G")
                '        Formulas.Add("ReportCaption#S", "Stock At A Glance - Product Wise")
                '        ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlanceStyleSize.rpt"
                '    End If

                '    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchId & "' And {vw_ItemSizeStock.ClQty} <> 0" & StockFltr & Series

                'Case ReportType.StockAtAGlanceBrandWise
                '    Formulas = New Hashtable

                '    If rdSummary.Checked Then
                '        Formulas.Add("GroupOn1#S", "B")
                '        Formulas.Add("GroupOn2#S", "U")
                '        Formulas.Add("ReportCaption#S", "Stock At A Glance - Brand Wise")
                '        ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlanceProdSize.rpt"
                '    Else
                '        Formulas.Add("GroupOn#S", "B")
                '        Formulas.Add("ReportCaption#S", "Stock At A Glance - Brand Wise")
                '        ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlanceStyleSize.rpt"
                '    End If

                '    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchId & "' And {vw_ItemSizeStock.ClQty} <> 0" & StockFltr & Series

                'Case ReportType.StockAtAGlanceSupplierWise
                '    Formulas = New Hashtable

                '    If rdSummary.Checked Then
                '        Formulas.Add("GroupOn1#S", "S")
                '        Formulas.Add("GroupOn2#S", "B")
                '        Formulas.Add("ReportCaption#S", "Stock At A Glance - Supplier Wise")
                '        ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlanceProdSize.rpt"
                '    Else
                '        Formulas.Add("GroupOn#S", "S")
                '        Formulas.Add("ReportCaption#S", "Stock At A Glance - Supplier Wise")
                '        ReportParameters.rptFile = ReportPath & "\Reports\StockAtAGlanceStyleSize.rpt"
                '    End If

                '    ReportParameters.rptFilter = "{vw_ItemSizeStock.CoBr_Id} = '" & SelBranchId & "' And {vw_ItemSizeStock.ClQty} <> 0" & StockFltr & Series

            Case ReportType.StockSupplierWise
                Formulas.Add("ReportCaption#S", "Closing Stock - Supplier Wise")
                ReportParameters.rptFile = ReportPath & "\Reports\SupDocStk.rpt"
                ReportParameters.rptFilter = "{vw_PurVerSale.CoBr_Id} = '" & SelBranchId & "'" & StockParam & QtyFilter & Series


            Case ReportType.Physical_Stock
                StockParam = GetStockFilter("", True)
                ReportParameters.rptFile = ReportPath & "\Reports\PhyStk.rpt"

                ReportParameters.rptFilter = "{StkTrack.CoBr_Id} = '" & SelBranchId & "' And {StkTrack.STATUS} = '1'" & StockParam
                ReportParameters.rptCaption = Me.Text
                ReportParameters.TotalText = True

            Case ReportType.Physical_StockShort
                StockParam = GetStockFilter("", True)
                ReportParameters.rptFile = ReportPath & "\Reports\PhyStkShort.rpt"

                ReportParameters.rptFilter = "{ItemStock.CoBr_Id} = '" & SelBranchId & "' And {@Shortage} > 0 and {ItemStock.ClQty} > 0 " & StockParam
                ReportParameters.rptCaption = Me.Text
                'ReportParameters.TotalText = True

            Case ReportType.Physical_StockExcess
                StockParam = GetStockFilter("", True)
                ReportParameters.rptFile = ReportPath & "\Reports\PhyStkShortInBk.rpt"

                ReportParameters.rptFilter = "{ItemStock.CoBr_Id} = '" & SelBranchId & "' And {@Shortage} < 0 " & StockParam
                ReportParameters.rptCaption = Me.Text
                ReportParameters.TotalText = True

                ''ADDED BY RAHUL ON 11/02/2019
            Case ReportType.StockLedgerFab
                If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
                    Series = ""

                    QtyFilter = ""
                    Dim strSOFilter1 As String = ""

                    If cmbSONo.SelectedIndex <> -1 Then
                        strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                    End If

                    PartyFltr = GetPartyFilter("Vw_STOCKLEDGERALL") '  View_RawStockLedger

                    'StockParam = GetStockFilter("", True)
                    ' FromToDt = " And {Vw_STOCKLEDGERALL.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"


                    ReportParameters.rptFile = ReportPath & "\Reports\GreyStockLedger.rpt"
                    ReportParameters.rptFilter = "{Vw_STOCKLEDGERALL.CoBr_Id} = '" & SelBranchId & "' " & PartyFltr & QtyFilter & strSOFilter1
                    ReportParameters.rptCaption = Me.Text ' And {View_RawStockLedger.Dtl_Key} > 0 Removed From Filter
                    ReportParameters.TotalText = True

                    'Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    'Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    'If rdSummary.Checked Then
                    '    Formulas.Add("DisplayDetails#S", "0")
                    '    ' Formulas.Add("ProductDsp#S", "0")
                    'ElseIf rdDetailed.Checked Then
                    '    Formulas.Add("DisplayDetails#S", "1")
                    'End If


                    If DefaultSelection() Then
                        Formulas.Add("GroupOn1#S", "P")
                        ReportParameters.rptCaption = "Stock Ledger - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                        Formulas.Add("GroupOn2#S", "")
                        Formulas.Add("GroupOn3#S", "")

                        Formulas.Add("Text1#S", "T")
                        Formulas.Add("Text2#S", "Y")
                        Formulas.Add("Text3#S", "H")

                        Formulas.Add("ReportCaption#S", Me.Text)
                    Else
                        ' ViewStockReportWithOptions("Stock Ledger")
                    End If
                    ''END
                Else

                    Series = ""

                    QtyFilter = ""
                    Dim strSOFilter1 As String = ""

                    If cmbSONo.SelectedIndex <> -1 Then
                        strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                    End If

                    PartyFltr = GetPartyFilter("View_RawStockLedger") '  

                    StockParam = GetStockFilter("View_RawStockLedger", True)
                    FromToDt = " And {View_RawStockLedger.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"


                    ReportParameters.rptFile = ReportPath & "\Reports\GreyStockLedger.rpt"
                    ReportParameters.rptFilter = "{View_RawStockLedger.CoBr_Id} = '" & SelBranchId & "' And {View_RawStockLedger.Dtl_Key} > 0 " & PartyFltr & FromToDt & QtyFilter & StockParam
                    ReportParameters.rptCaption = Me.Text '  Removed From Filter
                    ReportParameters.TotalText = True

                    Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                    Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                    If rdSummary.Checked Then
                        Formulas.Add("DisplayDetails#S", "0")
                        ' Formulas.Add("ProductDsp#S", "0")
                    ElseIf rdDetailed.Checked Then
                        Formulas.Add("DisplayDetails#S", "1")
                    End If


                    If DefaultSelection() Then
                        Formulas.Add("GroupOn1#S", "P")
                        ReportParameters.rptCaption = "Stock Ledger - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                        Formulas.Add("GroupOn2#S", "")
                        Formulas.Add("GroupOn3#S", "")

                        Formulas.Add("Text1#S", "T")
                        Formulas.Add("Text2#S", "Y")
                        Formulas.Add("Text3#S", "H")

                        Formulas.Add("ReportCaption#S", Me.Text)
                    Else
                        ViewStockReportWithOptions("Stock Ledger")
                    End If

                End If
                ''ADDED BY RAHUL ON 18/07/2019
            Case ReportType.StockLedgerAcc
                Series = ""

                QtyFilter = ""

                PartyFltr = GetPartyFilter("View_AccStockLedger")
                Dim strSOFilter1 As String = ""

                If cmbSONo.SelectedIndex <> -1 Then
                    strSOFilter1 = " And {SalesOrder.Doc_Id} = " & Val(cmbSONo.Value) & ""
                End If
                StockParam = GetStockFilter("", True)
                FromToDt = " And {View_AccStockLedger.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")"


                ReportParameters.rptFile = ReportPath & "\Reports\AccStockLedger.rpt"
                ReportParameters.rptFilter = "{View_AccStockLedger.CoBr_Id} = '" & SelBranchId & "' And {View_AccStockLedger.Dtl_Key} > 0" & StockParam & FromToDt & PartyFltr & QtyFilter & strSOFilter1
                ReportParameters.rptCaption = Me.Text
                ReportParameters.TotalText = True

                Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
                Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

                If rdSummary.Checked Then
                    Formulas.Add("DisplayDetails#S", "0")
                    ' Formulas.Add("ProductDsp#S", "0")
                ElseIf rdDetailed.Checked Then
                    Formulas.Add("DisplayDetails#S", "1")
                End If


                If DefaultSelection() Then
                    Formulas.Add("GroupOn1#S", "P")
                    ReportParameters.rptCaption = "Stock Ledger - " & GetSystemCaption(SystemCaptionIdx.DefProduct) & " Wise"

                    Formulas.Add("GroupOn2#S", "")
                    Formulas.Add("GroupOn3#S", "")

                    Formulas.Add("Text1#S", "T")
                    Formulas.Add("Text2#S", "Y")
                    Formulas.Add("Text3#S", "H")

                    Formulas.Add("ReportCaption#S", Me.Text)
                Else
                    ViewStockReportWithOptions("Stock Ledger")
                End If
                ''END
        End Select
    End Sub

    Private Sub cmbRegion_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbRegion.Closed
        If rptType = ReportType.SalesOrderRegister_AllInOne Or rptType = ReportType.FabPurOrderRegister_AllInOne Or rptType = ReportType.SalesOrderStatusANS Or rptType = ReportType.SalesOrderRegister_AllInOneANS Then

            If cmbRegion.IsModified Then

                cmbCountry.Properties.DataSource = Nothing
                cmbCountry.SetEditValue("")
                ClearDropDown(cmbCountry)

                cmbState.Properties.DataSource = Nothing
                cmbState.SetEditValue("")
                ClearDropDown(cmbState)

                cmbStation.Properties.DataSource = Nothing
                cmbStation.SetEditValue("")
                ClearDropDown(cmbStation)

                cmbParty.Properties.DataSource = Nothing
                cmbParty.SetEditValue("")
                ClearDropDown(cmbParty)

                If rptType = ReportType.SalesOrderRegister_AllInOne Then
                    cmbOperator.Properties.DataSource = Nothing
                    cmbOperator.SetEditValue("")
                    ClearDropDown(cmbOperator)
                End If


                'DisplayPartyHeather()
                'If cmbState.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub

                DisplayCountry()
                DisplayState()
                DisplayStation()
                DisplayPartyHeather()
                If rptType = ReportType.SalesOrderRegister_AllInOne Then
                    DisplayConsigneeHeather()
                End If
            End If
        End If

    End Sub

    Private Sub cmbParty_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbParty.Closed
        If rptType = ReportType.SalesOrderRegister_AllInOne Then
            If cmbParty.IsModified Then
                cmbOperator.Properties.DataSource = Nothing
                cmbOperator.SetEditValue("")
                ClearDropDown(cmbOperator)

                DisplayConsigneeHeather()
            
            End If
        End If
        If GetSettingAsPerId(ApplnSettingsIdx.Software_For) = "1" Then
            Dim SelectedItems As String = cmbParty.Properties.GetCheckedItems
            'Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from SalesOrder  Where DOC_ID >0  and cust_key= '" & SelectedItems & "' AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'  " _
            '        & BranchFixFilter _
            '        & " Order By DOCNO"
            'Common.FillCombo2(Query, cmbSONo, "DOCNO", "DOCID")
        End If
    End Sub

    Private Sub cmbOperator_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbOperator.Closed

    End Sub

    Private Sub rdOthOption1_CheckedChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles rdOthOption1.CheckedChanged, rdOthOption2.CheckedChanged, rdOthOption3.CheckedChanged
        If rptType = ReportType.SalesOrderRegister_AllInOne Or rptType = ReportType.FabPurOrderRegister_AllInOne Then
            If rdOthOption1.Checked Or rdOthOption2.Checked Then
                pnlDate2.Enabled = True : pnlDate.Enabled = False
            ElseIf rdOthOption3.Checked Then
                pnlDate2.Enabled = False : pnlDate.Enabled = True
            End If
        ElseIf rptType = ReportType.BuyerProgressChart Or rptType = ReportType.CountryBuyerwiseOrderAnalysis Then
            If rdOthOption1.Checked Or rdOthOption2.Checked Then
                chkDispRate.Visible = False
            End If
        ElseIf rptType = ReportType.ClosingStk_Product Or rptType = ReportType.OpeningStk_Product Or rptType = ReportType.ClosingStockProduct Then
            If rdOthOption1.Checked Then
                cmbSONo.Enabled = True
            Else
                cmbSONo.SelectedIndex = -1
                cmbSONo.Enabled = False
            End If
        End If
    End Sub

    Private Sub dtpFrom_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles cmbStation.KeyDown, cmbParty.KeyDown, cmbProductSubGrp.KeyDown, cmbProduct.KeyDown, cmbStyle.KeyDown, cmbShade.KeyDown, cmbSize.KeyDown, cmbBrand.KeyDown, cmbQuality.KeyDown, cmbOccassion.KeyDown, cmbLocation.KeyDown, chkSize.KeyDown, rdA.KeyDown, rdB.KeyDown, rdAll.KeyDown, rdOthOption1.KeyDown, rdOthOption2.KeyDown, rdOthOption3.KeyDown, cmbDisplay.KeyDown, txtStkFrom.KeyDown, txtStkTo.KeyDown, chkDispRate.KeyDown, chkDispValue.KeyDown, rdPurRate.KeyDown, rdMRP.KeyDown, rdSP.KeyDown, txtText.KeyDown, rdAgeQty.KeyDown, rdAgeValue.KeyDown, chkData.KeyDown, chkChart.KeyDown, cmbState.KeyDown, cmbDistrict.KeyDown, cmbCity.KeyDown, cmbProductGrp.KeyDown, cmbType.KeyDown, cmbSeason.KeyDown, dtpFrom.KeyDownEvent, dtpFrom1.KeyDownEvent, dtpTo1.KeyDownEvent, txtJobCardFrom.KeyDown, cmbCountry.KeyDown, cmbRegion.KeyDown, cmbOperator.KeyDown, dtpFrom2.KeyDownEvent, cmbTax.KeyDown
        MoveToNextControl(e)

        'If grpmrn.Visible = True Then
        '    If rptType = ReportType.MRN Then
        '        If dtpTo2.Focused Then
        '            If e.KeyCode = Keys.Enter Then
        '                cmbMRN.Focus()
        '            End If
        '        End If
        '    End If
        'End If

    End Sub

    Private Sub dtpTo_KeyDownEvent(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles dtpTo.KeyDownEvent
        If grpmrn.Visible = True Then
            If e.KeyCode = Keys.Enter Then
                If rptType = ReportType.MRN Then
                    cmbMRN.Focus()
                Else
                    cmbMIN.Focus()
                End If
            End If
        End If
    End Sub

    Private Sub cmbStyle_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbStyle.Closed
        If cmbStyle.IsModified Then
            cmbType.Properties.DataSource = Nothing
            cmbType.SetEditValue("")
            ClearDropDown(cmbType)

            If cmbStyle.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub

            DisplayType()
        End If
    End Sub

    Private Sub btnCloseOption_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles btnCloseOption.Click
        'lstOption1.Items.Clear() : lstOption2.Items.Clear() : lstOption3.Items.Clear()
        'lstDetails.Items.Clear()
        pnlOptions.Visible = False
    End Sub

    Private Sub btnOption_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles btnOption.Click
        'If GrpOptAdded Then Exit Sub
        lstMain.Items.Clear()

        If rptType = ReportType.PurOrderRegister_DateWise Or rptType = ReportType.PurOrderRegister_BillWise Or rptType = ReportType.PurOrderRegister_SupplierWise Or rptType = ReportType.PurOrderRegister_LocationWise Then
            With lstMain.Items
                .Add("Bill Wise")
                .Add("Date Wise")
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiLocation))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation))
                End If
                .Add("Supplier")
            End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
        End If


        If rptType = ReportType.SalesOrderRegister_DateWise Or rptType = ReportType.SalesOrderRegister_BillWise Or rptType = ReportType.SalesOrderRegister_PartyWise Or rptType = ReportType.StockReadyToDispatch Or rptType = ReportType.SalesOrderRegister_ConsigneeWise Or rptType = ReportType.SalesOrderRegister_BrokerWise Or rptType = ReportType.ServiceJobOrderRegister_BillWise Or rptType = ReportType.ServiceJobOrderRegister_DateWise Or rptType = ReportType.ServiceJobOrderRegister_PartyWise Then
            With lstMain.Items
                .Add("Bill Wise")
                .Add("Date Wise")
                .Add("Customer")
                .Add("Consignee")
                .Add("Broker")
            End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
        End If


        If rptType = ReportType.PendSalesOrderRegister_DateWise Or rptType = ReportType.PendSalesOrderRegister_BillWise Or rptType = ReportType.PendSalesOrderRegister_PartyWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeWise Or rptType = ReportType.PendSalesOrderRegister_BrokerWise Or rptType = ReportType.PendServiceJobOrderRegister_DateWise Or rptType = ReportType.PendServiceJobOrderRegister_BillWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyWise Then
            With lstMain.Items
                .Add("Bill Wise")
                .Add("Date Wise")
                .Add("Customer")
                .Add("Consignee")
                .Add("Broker")
            End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
        End If


        If rptType = ReportType.PackingRegister_DateWise Or rptType = ReportType.PackingRegister_BillWise Or rptType = ReportType.PackingRegister_PartyWise Or rptType = ReportType.PackingRegister_ConsigneeWise Or rptType = ReportType.ServiceChallanRegister_DateWise Or rptType = ReportType.ServiceChallanRegister_BillWise Or rptType = ReportType.ServiceChallanRegister_PartyWise Or rptType = ReportType.PackingRegister_Brokerwise Then
            With lstMain.Items
                .Add("Bill Wise")
                .Add("Date Wise")
                .Add("Customer")
                .Add("Consignee")
            End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
        End If


        If rptType = ReportType.SalesBillRegister_DateWise Or rptType = ReportType.SalesBillRegister_BillWise Or rptType = ReportType.SalesBillRegister_PartyWise Or rptType = ReportType.SalesBillRegister_ConsigneeWise Or rptType = ReportType.ServiceBillRegister_DateWise Or rptType = ReportType.ServiceBillRegister_BillWise Or rptType = ReportType.ServiceBillRegister_PartyWise Then
            With lstMain.Items
                .Add("Bill Wise")
                .Add("Date Wise")
                .Add("Customer")
                .Add("Consignee")
                .Add("Broker")
                .Add("Sales Person")
            End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
        End If

        If rptType = ReportType.PendPurOrderRegister_BillWise Or rptType = ReportType.PendPurOrderRegister_DateWise Or rptType = ReportType.PendPurOrderRegister_SupplierWise Then
            With lstMain.Items
                .Add("Bill Wise")
                .Add("Date Wise")
                .Add("Supplier")
            End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
        End If

        If rptType = ReportType.PurchaseRegister_BillWise Or rptType = ReportType.PurchaseRegister_CounterWise Or rptType = ReportType.PurchaseRegister_DateWise Or rptType = ReportType.PurchaseRegister_LocationWise Or rptType = ReportType.PurchaseRegister_SupplierWise Or rptType = ReportType.PurchaseRegister_OperatorWise _
            Or rptType = ReportType.PurRtnRegister_BillWise Or rptType = ReportType.PurRtnRegister_DateWise Or rptType = ReportType.PurRtnRegister_CounterWise Or rptType = ReportType.PurRtnRegister_LocationWise Or rptType = ReportType.PurRtnRegister_OperatorWise Or rptType = ReportType.PurRtnRegister_SupplierWise Then

            With lstMain.Items
                .Add("Bill Wise")
                .Add("Date Wise")
                '.Add("Operator")

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiLocation))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation))
                End If

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiCounter))) Then
                    .Add("Counter")
                End If

                .Add("Supplier")
            End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
        End If

        If rptType = ReportType.SalesRegister_BillWise Or rptType = ReportType.SalesRegister_CounterWise Or rptType = ReportType.SalesRegister_CustomerWise Or rptType = ReportType.SalesRegister_DateWise Or rptType = ReportType.SalesRegister_LocationWise Or rptType = ReportType.SalesRegister_OperatorWise _
            Or rptType = ReportType.SalesRtnRegister_BillWise Or rptType = ReportType.SalesRtnRegister_CounterWise Or rptType = ReportType.SalesRtnRegister_PartyWise Or rptType = ReportType.SalesRtnRegister_DateWise Or rptType = ReportType.SalesRtnRegister_LocationWise Or rptType = ReportType.SalesRtnRegister_OperatorWise Then

            With lstMain.Items
                .Add("Bill Wise")
                .Add("Date Wise")
                '.Add("Operator")

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiLocation))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation))
                End If

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiCounter))) Then
                    .Add("Counter")
                End If
                .Add("Customer")
            End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
        End If

        'If rptType = ReportType.DiscountGiven_Bill Or rptType = ReportType.DiscountGiven_Customer Then
        '    With lstMain.Items
        '        .Add("Bill Wise")
        '        .Add("Date Wise")
        '        .Add("Counter")
        '        .Add("Operator")
        '        .Add("Customer")
        '    End With

        '    pnlSelectOption.Visible = False
        '    pnlOptions.Visible = True

        '    Exit Sub
        'End If
        

        If rptType = ReportType.AllInOnePurchaseOrder Or rptType = ReportType.AllInOnePurchase Or rptType = ReportType.AllInOnePurchaseRtn Then
            With lstMain.Items
                '.Add("Operator")
                .Add("Date Wise")
                .Add("Bill Wise")
                .Add("Supplier")

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiLocation))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation))
                End If
            End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
            
        ElseIf rptType = ReportType.AllInOneSales Or rptType = ReportType.DiscountGiven_Bill Or rptType = ReportType.DiscountGiven_Customer Then
            With lstMain.Items
                ' .Add("Operator")
                .Add("Date Wise")
                .Add("Bill Wise")
                .Add("Customer")

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiLocation))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation))
                End If
            End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
        End If

        If rdSummary.Checked Then
            If ProdRegister Then
                lstDetails.Items.Clear()

                btnUp.Enabled = False
                btnDown.Enabled = False
                btnDetail.Enabled = False
                btnDelDetail.Enabled = False
                lstDetails.Enabled = False
            End If
        End If

        If rptType = ReportType.StockLedger Or rptType = ReportType.StockAsOnPrevDate Or rptType = ReportType.StyleCosting Then
            With lstMain.Items
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefGroup))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSize))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))
            End With

            pnlSelectOption.Visible = True
            pnlOptions.Visible = True

            Exit Sub
        End If

        If rptType = ReportType.DeadStock Then
            With lstMain.Items
                '.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSection))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefGroup))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseDesign))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                End If

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseType))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
                End If

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseShade))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
                End If

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSize))
                End If

                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseQuality))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefQuality))
                End If

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSeason))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSeason))
                End If

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseOccassion))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefOccassion))
                End If

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiLocation))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation))
                End If

                .Add("Supplier")
            End With

            pnlSelectOption.Visible = True
            pnlOptions.Visible = True

            Exit Sub
        End If

        If ProdRegister Or ProductOptions Then
            With lstMain.Items
                ''.Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSection))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefGroup))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseDesign))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
                End If

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseType))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
                End If

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseShade))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
                End If

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSize))
                End If

                .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))

                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseQuality))) Then
                    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefQuality))
                End If


                If TransType <> TransactionType.PurchaseOrder Then

                    If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSeason))) Then
                        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSeason))
                    End If

                    If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseOccassion))) Then
                        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefOccassion))
                    End If

                    If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiLocation))) Then
                        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation))
                    End If
                End If

                If TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.PurchaseRtn Or TransType = TransactionType.Stock Then
                    .Add("Supplier")
                ElseIf TransType = TransactionType.Sales Or TransType = TransactionType.SalesRtn Then
                    If rptType <> ReportType.FastMovingProduct And rptType <> ReportType.FastMovingSubGroup And rptType <> ReportType.FastMovingSupplier And rptType <> ReportType.SlowMovingProduct And rptType <> ReportType.SlowMovingSubGroup And rptType <> ReportType.SlowMovingSupplier Then
                        .Add("Customer")

                        If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiSalesPerson))) Then
                            .Add("Salesperson")
                        End If
                    End If

                    .Add("Supplier")
                End If

                If TransType = TransactionType.SalesOrder Then
                    .Add("Customer")
                    .Add("Consignee")
                    .Add("Broker")
                End If


                If TransType = TransactionType.SaleBill Then
                    .Add("Customer")
                    .Add("Consignee")
                    .Add("Broker")

                    If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiSalesPerson))) Then
                        .Add("Salesperson")
                    End If
                End If


                If TransType = TransactionType.Delivery Then
                    .Add("Customer")
                    .Add("Consignee")
                End If

                If TransType <> TransactionType.PurchaseOrder Then
                    .Add("Barcode")
                End If
            End With

            pnlSelectOption.Visible = True
            pnlOptions.Visible = True

            Exit Sub
        End If

        'If rptType = ReportType.MonthlySales Or rptType = ReportType.MonthlySalesDate Or rptType = ReportType.MonthlySalesRtn Or rptType = ReportType.MonthlySalesRtnDate Or rptType = ReportType.MonthlyPurchase Or rptType = ReportType.MonthlyPurchaseDate Or rptType = ReportType.MonthlyPurchaseRtn Or rptType = ReportType.MonthlyPurchaseDateRtn Then
        '    lstOption1.Items.Clear()

        '    With lstMain.Items
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSection))
        '        .Add("Group")
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSize))
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefQuality))
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.Defseason))
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.Defoccassion))
        '        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.Deflocation))

        '        ' If rptType = ReportType.MonthlySales Or rptType = ReportType.MonthlySalesDate Then

        '        If TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.PurchaseRtn Or TransType = TransactionType.Stock Then
        '            .Add("Supplier")
        '        ElseIf TransType = TransactionType.Sales Or TransType = TransactionType.SalesRtn Then
        '            .Add("Customer")
        '            .Add("Saleperson")
        '            .Add("Supplier")
        '        End If

        '        .Add("Barcode")

        '        ' End If
        '        pnlSelectOption.Visible = True
        '        pnlOptions.Visible = True

        '        Exit Sub
        '    End With
        'End If

        If rptType = ReportType.PurOrderRegister_SupplierWise Then
            'With lstMain.Items
            '    .Add("Date Wise")
            '    .Add("Bill Wise")
            '    .Add("Supplier")
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.Deflocation))
            'End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
        End If

        If rptType = ReportType.PurRtnRegister_SupplierWise Then
            'With lstMain.Items
            '    .Add("Operator")
            '    .Add("Date Wise")
            '    .Add("Bill Wise")
            '    .Add("Supplier")
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.Deflocation))
            'End With

            pnlSelectOption.Visible = False
            pnlOptions.Visible = True

            Exit Sub
        End If

        If rptType = ReportType.PeriodicalSales Or rptType = ReportType.PeriodicalPurchase Or rptType = ReportType.MonthlySales Or rptType = ReportType.MonthlySalesDate Or rptType = ReportType.SaleByTypeAnalysis Or rptType = ReportType.SalePersonCommission Or TransType = TransactionType.Stock Or CurrOptionType = OptionType.Supplier Or CurrOptionType = OptionType.Section Or CurrOptionType = OptionType.Group Or CurrOptionType = OptionType.SubGroup Or CurrOptionType = OptionType.Product Or CurrOptionType = OptionType.Style Or CurrOptionType = OptionType.Type Or CurrOptionType = OptionType.Shade Or CurrOptionType = OptionType.Size Or CurrOptionType = OptionType.Brand Or CurrOptionType = OptionType.Quality Or CurrOptionType = OptionType.Season Or CurrOptionType = OptionType.Occassion Or CurrOptionType = OptionType.SalePerson Or rptType = ReportType.TopSoldItems Or rptType = ReportType.BottomSoldItems Or rptType = ReportType.TopNPurchase Then
            'With lstMain.Items
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSection))
            '    .Add("Group")
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup))
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct))
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle))
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefType))
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefSize))
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand))
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefQuality))
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.Defseason))
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.Defoccassion))
            '    .Add(GetSysCaptionAsPerId(SystemCaptionIdx.Deflocation))

            '    If TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.PurchaseRtn Or TransType = TransactionType.Stock Then
            '        .Add("Supplier")
            '    ElseIf TransType = TransactionType.Sales Or TransType = TransactionType.SalesRtn Then
            '        .Add("Saleperson")
            '        .Add("Customer")
            '        .Add("Supplier")
            '    End If
            '    .Add("Barcode")
            'End With
        Else
            With lstMain.Items
                If rptType = ReportType.AllInOneSales Then
                    If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiCounter))) Then
                        .Add("Counter")
                    End If
                    '.Add("Operator")

                    If rptType = ReportType.AllInOneSales Then
                        .Add("Customer")

                    ElseIf rptType = ReportType.DiscountGiven_Bill Or rptType = ReportType.DiscountGiven_Customer Then
                        .Add("Bill Wise")
                        .Add("Customer")
                    End If
                Else
                    If TransType <> TransactionType.PurchaseOrder Then
                        '.Add("Operator")

                        If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiCounter))) Then
                            .Add("Counter")
                        End If
                    End If

                    .Add("Date Wise")
                    .Add("Bill Wise")

                    If TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.PurchaseRtn Then
                        .Add("Supplier")
                    Else
                        .Add("Customer")
                    End If

                    If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMultiLocation))) Then
                        .Add(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation))
                    End If
                    '.Add("Tax")
                End If
            End With

            pnlSelectOption.Visible = False
        End If

        pnlOptions.Visible = True
    End Sub

    Private Sub btnGrp1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnGrp1.Click
        If lstMain.SelectedIndex = -1 Then Exit Sub

        If lstOption1.Items.Count = 0 Then
            lstOption1.Items.Add(lstMain.SelectedItem)

            EnableFilters(lstOption1.Items(0), True)

            If lstOption1.Items.Count > 0 Then
                IsSupplier = False

                If UCase(lstOption1.Items(0)) = "CUSTOMER" Or UCase(lstOption1.Items(0)) = "PARTY" Or UCase(lstOption1.Items(0)) = "CONSIGNEE" Or UCase(lstOption1.Items(0)) = "BROKER" Or UCase(lstOption1.Items(0)) = "SALES PERSON" Then
                    IsSupplier = False
                    DisplayParty()
                ElseIf UCase(lstOption1.Items(0)) = "SUPPLIER" Then
                    IsSupplier = True
                    DisplayParty()
                End If
            End If
        End If
    End Sub

    Private Sub btnGrp2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnGrp2.Click
        If lstMain.SelectedIndex = -1 Then Exit Sub

        If lstOption1.Items.Count > 0 And lstOption2.Items.Count = 0 Then
            lstOption2.Items.Add(lstMain.SelectedItem)

            EnableFilters(lstOption2.Items(0), True)

            If lstOption2.Items.Count > 0 Then
                IsSupplier = False

                If UCase(lstOption2.Items(0)) = "CUSTOMER" Or UCase(lstOption2.Items(0)) = "PARTY" Or UCase(lstOption2.Items(0)) = "CONSIGNEE" Or UCase(lstOption2.Items(0)) = "BROKER" Or UCase(lstOption2.Items(0)) = "SALES PERSON" Then
                    IsSupplier = False
                    DisplayParty()
                ElseIf UCase(lstOption2.Items(0)) = "SUPPLIER" Then
                    IsSupplier = True
                    DisplayParty()
                End If
            End If
        End If
    End Sub

    Private Sub btnGrp3_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnGrp3.Click
        If lstMain.SelectedIndex = -1 Then Exit Sub

        If lstOption2.Items.Count > 0 And lstOption3.Items.Count = 0 Then
            lstOption3.Items.Add(lstMain.SelectedItem)

            'Dim Idx As Byte = lstDetails.Items.IndexOf(lstOption3.Items(0))
            EnableFilters(lstOption3.Items(0), True)

            If lstOption3.Items.Count > 0 Then
                IsSupplier = False

                If UCase(lstOption3.Items(0)) = "CUSTOMER" Or UCase(lstOption3.Items(0)) = "PARTY" Or UCase(lstOption3.Items(0)) = "CONSIGNEE" Or UCase(lstOption3.Items(0)) = "BROKER" Or UCase(lstOption3.Items(0)) = "SALES PERSON" Then
                    IsSupplier = False
                    DisplayParty()
                ElseIf UCase(lstOption3.Items(0)) = "SUPPLIER" Then
                    IsSupplier = True
                    DisplayParty()
                End If
            End If
        End If
    End Sub

    Private Sub btnDetail_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnDetail.Click
        If lstMain.SelectedIndex = -1 Then Exit Sub

        If lstDetails.Items.Count < 3 Then
            Dim Idx As Byte
            Dim Found As Boolean

            If lstDetails.Items.Count > 0 Then
                For Idx = 0 To lstDetails.Items.Count - 1
                    If UCase(lstDetails.Items(Idx)) = lstMain.Text.ToUpper Then
                        Found = True
                        Exit For
                    End If
                Next Idx
            End If

            If Not Found Then
                lstDetails.Items.Add(lstMain.SelectedItem)
            End If

            EnableFilters(lstDetails.Items(lstDetails.Items.Count - 1), True)


            If lstDetails.Items.Count > 0 Then
                IsSupplier = False

                If UCase(lstDetails.Items(lstDetails.Items.Count - 1)) = "CUSTOMER" Then
                    IsSupplier = False
                    DisplayParty()
                ElseIf UCase(lstDetails.Items(lstDetails.Items.Count - 1)) = "PARTY" Or UCase(lstDetails.Items(lstDetails.Items.Count - 1)) = "CONSIGNEE" Or UCase(lstDetails.Items(lstDetails.Items.Count - 1)) = "BROKER" Or UCase(lstDetails.Items(lstDetails.Items.Count - 1)) = "SALES PERSON" Then
                    IsSupplier = False
                    DisplayParty()
                ElseIf UCase(lstDetails.Items(lstDetails.Items.Count - 1)) = "SUPPLIER" Then
                    IsSupplier = True
                    DisplayParty()
                End If
            End If
        End If
    End Sub

    Private Sub btnUp_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnUp.Click
        If lstDetails.SelectedIndex = -1 Then Exit Sub

        Dim Idx As Byte
        If lstDetails.SelectedIndex - 1 >= 0 Then
            Idx = lstDetails.SelectedIndex
            Dim obj As String = lstDetails.Items(lstDetails.SelectedIndex - 1)

            lstDetails.Items.RemoveAt(Idx - 1)
            lstDetails.Items.Insert(Idx, obj)
        End If
    End Sub

    Private Sub btnDown_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnDown.Click
        If lstDetails.SelectedIndex = -1 Then Exit Sub

        Dim Idx As Byte
        If lstDetails.SelectedIndex + 1 <= lstDetails.Items.Count - 1 Then
            Idx = lstDetails.SelectedIndex
            Dim obj As String = lstDetails.Items(lstDetails.SelectedIndex + 1)

            lstDetails.Items.RemoveAt(Idx + 1)
            lstDetails.Items.Insert(Idx, obj)
        End If
    End Sub

    Private Sub btnDelGrp1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnDelGrp1.Click
        Dim Text As String = ""

        If lstOption1.Items.Count = 1 Then
            Text = lstOption1.Items(0)
            lstOption1.Items.Clear()
        Else
            If lstOption1.SelectedIndex = -1 Then Exit Sub

            Text = lstOption1.Items(0)
            lstOption1.Items.RemoveAt(lstOption1.SelectedIndex)
        End If

        If Text.ToUpper = "CUSTOMER" Or Text.ToUpper = "PARTY" Or Text.ToUpper = "SUPPLIER" Then
            ClearPartyFilters()
        End If
        EnableFilters(Text, False)
    End Sub

    Private Sub btnDelGrp2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnDelGrp2.Click
        Dim Text As String = ""

        If lstOption2.Items.Count = 1 Then
            Text = lstOption2.Items(0)
            lstOption2.Items.Clear()
        Else
            If lstOption2.SelectedIndex = -1 Then Exit Sub

            Text = lstOption2.Items(0)
            lstOption2.Items.RemoveAt(lstOption2.SelectedIndex)
        End If

        If Text.ToUpper = "CUSTOMER" Or Text.ToUpper = "PARTY" Or Text.ToUpper = "SUPPLIER" Then
            ClearPartyFilters()
        End If
        EnableFilters(Text, False)
    End Sub

    Private Sub btnDelGrp3_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnDelGrp3.Click
        Dim Text As String = ""

        If lstOption3.Items.Count = 1 Then
            Text = lstOption3.Items(0)
            lstOption3.Items.Clear()
        Else
            If lstOption3.SelectedIndex = -1 Then Exit Sub

            Text = lstOption3.Items(0)
            lstOption3.Items.RemoveAt(lstOption3.SelectedIndex)
        End If

        If Text.ToUpper = "CUSTOMER" Or Text.ToUpper = "PARTY" Or Text.ToUpper = "SUPPLIER" Then
            ClearPartyFilters()
        End If
        EnableFilters(Text, False)
    End Sub

    Private Sub btnDelDetail_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnDelDetail.Click
        If lstDetails.SelectedIndex = -1 Then Exit Sub

        If rptType = ReportType.StockAgingProduct Then
            If lstDetails.Items.Count = 1 Then Exit Sub
        End If

        Dim Text As String = lstDetails.Items(lstDetails.SelectedIndex)
        lstDetails.Items.RemoveAt(lstDetails.SelectedIndex)

        If Text.ToUpper = "CUSTOMER" Or Text.ToUpper = "PARTY" Or Text.ToUpper = "SUPPLIER" Then
            ClearPartyFilters()
        End If

        EnableFilters(Text, False)
    End Sub

    Private Sub SetLabelCaption()
        lblGroup.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefGroup)
        lblSubGroup.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup)
        lblProduct.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct)
        lblDesign.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle)
        lblType.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefType)
        lblShade.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefShade)
        lblSize.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefSize)
        lblBrand.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand)
        lblQuality.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefQuality)
        lblSeason.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefSeason)
        lblOccassion.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefOccassion)
        lblLocation.Text = GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation)
    End Sub

    Private Function GetFieldParameter(ByVal ListValue As String) As String
        Dim Value As String = ListValue.ToUpper

        Select Case Value
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefSection)) : Return "C"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefGroup)) : Return "G"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefSubGroup)) : Return "U"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefProduct)) : Return "P"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle)) : Return "T"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefType)) : Return "Y"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefShade)) : Return "H"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefSize)) : Return "I"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefBrand)) : Return "B"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefQuality)) : Return "Q"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefSeason)) : Return "E"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefOccassion)) : Return "O"
            Case UCase(GetSysCaptionAsPerId(SystemCaptionIdx.DefLocation)) : Return "L"
            Case "CUSTOMER" : Return "R"
            Case "PARTY" : Return "R"
            Case "SUPPLIER" : Return "S"
            Case "JOBBER" : Return "J"
            Case "PROCESS" : Return "R"
            Case "SALES PERSON" : Return "N"
            Case "USER" : Return "A"
            Case "COUNTER" : Return "D"
            Case "BARCODE" : Return "F"
            Case "BROKER" : Return "X"
            Case "CONSIGNEE" : Return "Z"
            Case Else : Return ""

                'Case "SECTION" : Return "C"
                'Case "GROUP" : Return "G"
                'Case "SUBGROUP" : Return "U"
                'Case "PRODUCT" : Return "P"
                'Case "DESIGN" : Return "T"
                'Case "TYPE" : Return "Y"
                'Case "SHADE" : Return "H"
                'Case "SIZE" : Return "I"
                'Case "BRAND" : Return "B"
                'Case "QUALITY" : Return "Q"
                'Case "SEASON" : Return "E"
                'Case "OCCASSION" : Return "O"
                'Case "LOCATION" : Return "L"
                'Case "CUSTOMER" : Return "R"
                'Case "SUPPLIER" : Return "S"
                'Case "SALESPERSON" : Return "N"
                'Case "USER" : Return "A"
                'Case "COUNTER" : Return "D"
                'Case "BARCODE" : Return "F"
                'Case Else : Return ""
        End Select
    End Function
    Private Function GetPurType(ByVal PurType As Byte) As String  ''ankita 20042019
        ''CHANGE BY RAHUL ON 23/04/2019
        If rptType = ReportType.PurRegister_DateWise Then
            Select Case PurType
                Case 0 : Return ""
                Case 1 : Return "F"
                Case 2 : Return "G"
                Case 3 : Return "A"
                Case 4 : Return "O"
            End Select
        ElseIf rptType = ReportType.PurbillRegister_DateWise Then
            Select Case PurType
                Case 0 : Return ""
                Case 1 : Return "G"
                Case 2 : Return "A"
                Case 3 : Return "L"
                Case 4 : Return "O"
                Case 5 : Return "F"
                Case 6 : Return "O"
                Case 7 : Return "M"
            End Select
        End If
        ''END

        Return ""
    End Function

    Private Sub CreateFilterForWithSaleWithRtnDtlView(ByVal TableName As String, ByRef FromToDt As String, ByRef PartyParam As String, ByRef StockParam As String)
        Dim SelState As String = ""
        Dim SelDistrict As String = ""
        Dim SelCity As String = ""
        Dim SelStation As String = ""
        Dim SelParties As String = ""

        Dim SelGroup As String = ""
        Dim SelSubGroup As String = ""
        Dim SelProducts As String = ""
        Dim SelStyle As String = ""
        Dim SelType As String = ""
        Dim SelShade As String = ""
        Dim SelSize As String = ""
        Dim SelBrand As String = ""
        Dim SelQuality As String = ""
        Dim SelSeason As String = ""
        Dim SelOccassion As String = ""
        Dim SelLocation As String = ""
        Dim SelSupplier As String = ""
        Dim SelMfr As String = ""

        SelState = GetSelectedAttributes(cmbState, "District.State_Key")
        If SelState.Trim.Length > 0 Then
            PartyParam &= " And " & SelState
        End If

        SelDistrict = GetSelectedAttributes(cmbDistrict, "District.Dist_Key")
        If SelDistrict.Trim.Length > 0 Then
            PartyParam &= " And " & SelDistrict
        End If

        SelCity = GetSelectedAttributes(cmbCity, "City.City_Key")
        If SelCity.Trim.Length > 0 Then
            PartyParam &= " And " & SelCity
        End If

        SelStation = GetSelectedAttributes(cmbStation, "Station.Stn_Key")
        If SelStation.Trim.Length > 0 Then
            PartyParam &= " And " & SelStation
        End If

        SelParties = GetSelectedAttributes(cmbParty, TableName & ".Supl_Key")
        If SelParties.Trim.Length > 0 Then
            PartyParam &= " And " & SelParties
        End If



        SelGroup = GetSelectedAttributesForStock(cmbProductGrp, "{ItemGrp.ItemGrp_Key}")
        If SelGroup.Trim.Length > 0 Then
            StockParam &= " And " & SelGroup
        End If

        SelSubGroup = GetSelectedAttributesForStock(cmbProductSubGrp, "{" & TableName & ".ItemSubGrp_Key}")
        If SelSubGroup.Trim.Length > 0 Then
            StockParam &= " And " & SelSubGroup
        End If

        SelProducts = GetSelectedAttributesForStock(cmbProduct, "{" & TableName & ".Item_Key}")
        If SelProducts.Trim.Length > 0 Then
            StockParam &= " And " & SelProducts
        End If

        SelStyle = GetSelectedAttributesForStock(cmbStyle, "{" & TableName & ".Style_Key}")
        If SelStyle.Trim.Length > 0 Then
            StockParam &= " And " & SelStyle
        End If

        SelType = GetSelectedAttributesForStock(cmbType, "{" & TableName & ".Type_Key}")
        If SelType.Trim.Length > 0 Then
            StockParam &= " And " & SelType
        End If

        SelShade = GetSelectedAttributesForStock(cmbShade, "{" & TableName & ".Shade_Key}")
        If SelShade.Trim.Length > 0 Then
            StockParam &= " And " & SelShade
        End If

        SelSize = GetSelectedAttributesForStock(cmbSize, "{" & TableName & ".ItemSize_Key}")
        If SelSize.Trim.Length > 0 Then
            StockParam &= " And " & SelSize
        End If

        SelBrand = GetSelectedAttributesForStock(cmbBrand, "{" & TableName & ".Brand_Key}")
        If SelBrand.Trim.Length > 0 Then
            StockParam &= " And " & SelBrand
        End If

        SelQuality = GetSelectedAttributesForStock(cmbQuality, "{" & TableName & ".Qlty_Key}")
        If SelQuality.Trim.Length > 0 Then
            StockParam &= " And " & SelQuality
        End If

        SelSeason = GetSelectedAttributesForStock(cmbSeason, "{" & TableName & ".Season_Key}")
        If SelSeason.Trim.Length > 0 Then
            StockParam &= " And " & SelSeason
        End If

        SelOccassion = GetSelectedAttributesForStock(cmbOccassion, "{" & TableName & ".Occn_Key}")
        If SelOccassion.Trim.Length > 0 Then
            StockParam &= " And " & SelOccassion
        End If

        SelSupplier = GetSelectedAttributesForStock(cmbParty, "{" & TableName & ".Supl_Key}")
        If SelSupplier.Trim.Length > 0 Then
            StockParam &= " And " & SelSupplier
        End If


        'Formulas = Nothing
        'Series = ""

        'If rdA.Checked Then
        '    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'A'"
        'ElseIf rdB.Checked Then
        '    Series = " And {vw_SaleWithRtn.Bill_Sr} = 'B'"
        'End If

        'FromToDt = " And {vw_SaleWithRtn.Doc_Dt} >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And {vw_SaleWithRtn.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")" & Series
    End Sub

    Private Sub CreateFilterForWithSaleWithRtnDtlSumView(ByRef FromToDt As String, ByRef PartyParam As String, ByRef StockParam As String)
        Dim SelState As String = ""
        Dim SelDistrict As String = ""
        Dim SelCity As String = ""
        Dim SelStation As String = ""
        Dim SelParties As String = ""

        Dim SelGroup As String = ""
        Dim SelSubGroup As String = ""
        Dim SelProducts As String = ""
        Dim SelStyle As String = ""
        Dim SelType As String = ""
        Dim SelShade As String = ""
        Dim SelSize As String = ""
        Dim SelBrand As String = ""
        Dim SelQuality As String = ""
        Dim SelSeason As String = ""
        Dim SelOccassion As String = ""
        Dim SelLocation As String = ""
        Dim SelSupplier As String = ""
        Dim SelMfr As String = ""

        SelState = GetSelectedAttributes(cmbState, "District.State_Key")
        If SelState.Trim.Length > 0 Then
            PartyParam &= " And " & SelState
        End If

        SelDistrict = GetSelectedAttributes(cmbDistrict, "District.Dist_Key")
        If SelDistrict.Trim.Length > 0 Then
            PartyParam &= " And " & SelDistrict
        End If

        SelCity = GetSelectedAttributes(cmbCity, "City.City_Key")
        If SelCity.Trim.Length > 0 Then
            PartyParam &= " And " & SelCity
        End If

        SelStation = GetSelectedAttributes(cmbStation, "Station.Stn_Key")
        If SelStation.Trim.Length > 0 Then
            PartyParam &= " And " & SelStation
        End If

        SelParties = GetSelectedAttributes(cmbParty, "Vw_SaleRtnRpt.Party_Key")
        If SelParties.Trim.Length > 0 Then
            PartyParam &= " And " & SelParties
        End If

        Formulas = Nothing
        Series = ""

        If rdA.Checked Then
            Series = " And {Vw_SaleRtnRpt.Bill_Sr} = 'A'"
        ElseIf rdB.Checked Then
            Series = " And {Vw_SaleRtnRpt.Bill_Sr} = 'B'"
        End If

        FromToDt = " And {Vw_SaleRtnRpt.Doc_Dt} >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And {Vw_SaleRtnRpt.Doc_Dt} <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")" & Series
    End Sub

    Private Sub ViewReportWithOptions(ByVal ForCaption As String, Optional ByVal HeaderFromDetail As Boolean = True, Optional ByVal PrnHeader As Boolean = False, Optional ByVal DisplayGraph As Boolean = False)
        Dim Param As String = ""

        Formulas = New Hashtable

        If rptType = ReportType.DiscountGiven_Product Then
            Formulas.Add("ItemFooterCaption#S", lstOption1.Items(0) & " Total")
        End If


        If lstOption1.Items.Count > 0 Then
            Param = GetFieldParameter(lstOption1.Items(0))
            If ReportParameters.TotalText Then
                Formulas.Add("Total1Text#S", lstOption1.Items(0) & " Total")
            End If
        End If
        Formulas.Add("GroupOn1#S", Param)
        If lstDetails.Items.Count = 0 Then
            If PrnHeader And lstOption1.Items.Count > 0 Then
                Formulas.Add("Header1#S", lstOption1.Items(0))
            End If
        End If


        Param = ""
        If lstOption2.Items.Count > 0 Then
            Param = GetFieldParameter(lstOption2.Items(0))
            If ReportParameters.TotalText Then
                Formulas.Add("Total2Text#S", lstOption2.Items(0) & " Total")
            End If
        End If

        Formulas.Add("GroupOn2#S", Param)
        If lstDetails.Items.Count = 0 Then
            If PrnHeader And lstOption2.Items.Count > 0 Then
                Formulas.Add("Header2#S", lstOption2.Items(0))
            End If
        End If


        Param = ""
        If lstOption3.Items.Count > 0 Then
            Param = GetFieldParameter(lstOption3.Items(0))
            If ReportParameters.TotalText Then
                Formulas.Add("Total3Text#S", lstOption3.Items(0) & " Total")
            End If
        End If

        Formulas.Add("GroupOn3#S", Param)
        If lstDetails.Items.Count = 0 Then
            If PrnHeader And lstOption3.Items.Count > 0 Then
                Formulas.Add("Header3#S", lstOption3.Items(0))
            End If
        End If
        ReportParameters.TotalText = False


        Dim i As Byte
        Dim HeaderText As String = ""

        'If HeaderFromDetail Then
        If lstDetails.Items.Count > 0 Then
            For i = 0 To lstDetails.Items.Count - 1
                Param = GetFieldParameter(lstDetails.Items(i))

                If i = 0 Then
                    Formulas.Add("Text1#S", Param)
                    HeaderText = lstDetails.Items(i)
                    If PrnHeader Then
                        Formulas.Add("Header1#S", lstDetails.Items(i))
                    End If
                ElseIf i = 1 Then
                    Formulas.Add("Text2#S", Param)
                    HeaderText = HeaderText & "/" & lstDetails.Items(i)
                    If PrnHeader Then
                        Formulas.Add("Header2#S", lstDetails.Items(i))
                    End If
                ElseIf i = 2 Then
                    Formulas.Add("Text3#S", Param)
                    HeaderText = HeaderText & "/" & lstDetails.Items(i)
                    If PrnHeader Then
                        Formulas.Add("Header3#S", lstDetails.Items(i))
                    End If
                End If
            Next i
        End If

        'Else
        If HeaderText.Trim.Length = 0 Or ReportParameters.POSummary Then
            If lstOption3.Items.Count > 0 Then
                HeaderText = lstOption3.Items(0)
            ElseIf lstOption2.Items.Count > 0 Then
                HeaderText = lstOption2.Items(0)
            ElseIf lstOption1.Items.Count > 0 Then
                HeaderText = lstOption1.Items(0)
            End If

            ReportParameters.POSummary = False
        End If
        'End If

        If rptType <> ReportType.PeriodicalSales And rptType <> ReportType.SaleByTypeAnalysis And rptType <> ReportType.DiscountGiven_Product Then
            If ReportParameters.DisplayDetails Then
                Formulas.Add("DisplayDetails#N", IIf(lstDetails.Items.Count = 0, 0, 1))
                ReportParameters.DisplayDetails = False
            End If
        End If

        If TransType <> TransactionType.JobCard And TransType <> TransactionType.ProcessIssue And TransType <> TransactionType.ProcessReceipt And TransType <> TransactionType.ProcessLedger And TransType <> TransactionType.ProcessProdnDelay And TransType <> TransactionType.ProcessStkWithParty And TransType <> TransactionType.ProcessShortage And TransType <> TransactionType.SemiProcStkAtWarehouse Then
            Formulas.Add("HeaderText#S", HeaderText)
        End If


        Dim Caption As String = ""
        Dim ChartCaption As String = ""

        'If lstOption3.Items.Count > 0 Then
        '    Caption = lstOption3.Items(0)
        'ElseIf lstOption2.Items.Count > 0 Then
        '    Caption = lstOption2.Items(0)
        'ElseIf lstOption1.Items.Count > 0 Then
        '    Caption = lstOption1.Items(0)
        'End If
        If Not rptType = ReportType.DesignWiseNetSalesRegister Then ''Satyam 05082022

            If lstOption1.Items.Count > 0 Then
                Caption = lstOption1.Items(0)
            ElseIf lstOption2.Items.Count > 0 Then
                Caption = lstOption2.Items(0)
            ElseIf lstOption3.Items.Count > 0 Then
                Caption = lstOption3.Items(0)
            End If
        End If
        If rptType = ReportType.DesignWiseNetSalesRegister Then
            Formulas.Add("ReportCaption#S", ForCaption)
        Else
            Formulas.Add("ReportCaption#S", ForCaption & " - " & Caption & " Wise")
        End If

        Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
        Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))

        If rptType = ReportType.DiscountGiven_Product Then
            Formulas.Add("IsSummary#N", IIf(rdSummary.Checked, 1, 0))
        End If

        If rptType = ReportType.Profitability Then
            Formulas.Add("DisplayMarkup#N", 1)
        ElseIf rptType = ReportType.MarginSummary_SubGroupWise Then
            Formulas.Add("DisplayMarkup#N", 0)
        End If

        If rptType = ReportType.ConsolidatedPurchase_DtProduct Then
            Formulas.Add("DateGrp#N", 1)
        End If

        If rptType = ReportType.PeriodicalPurchase Then
            Formulas.Add("DocType#S", "P")
        End If

        If rptType = ReportType.PeriodicalPurchaseRtn Then
            Formulas.Add("DocType#S", "R")
        End If

        If rptType = ReportType.BarcodeWisePurchase Then
            Formulas.Add("Size#S", GetSystemCaption(SystemCaptionIdx.DefSize))
        End If

        'If rdSummary.Checked Then
        If rptType = ReportType.SalesRegister_SubGroupWise Or rptType = ReportType.SalesRegister_ProductWise Or rptType = ReportType.SalesRegister_BrandWise Or rptType = ReportType.SalePersonCommission Then
            Formulas.Add("DocType#S", "S")
        End If

        If rptType = ReportType.SalesRtnRegister_SubGroupWise Or rptType = ReportType.SalesRtnRegister_ProductWise Or rptType = ReportType.SalesRtnRegister_BrandWise Or rptType = ReportType.SalesRtnRegister_ProdSalepersonWise Then
            Formulas.Add("DocType#S", "R")
        End If
        'End If


        If DisplayGraph Then
            Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
            Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))


            If chkChart.Checked Then
                If lstOption1.Items.Count > 0 Then
                    ChartCaption = lstOption1.Items(0)
                ElseIf lstOption2.Items.Count > 0 Then
                    ChartCaption = lstOption2.Items(0)
                ElseIf lstOption3.Items.Count > 0 Then
                    ChartCaption = lstOption3.Items(0)
                End If

                Formulas.Add("ChartCaption#S", ForCaption & " - " & ChartCaption & " Wise")
            End If
        End If

        If (rptType = ReportType.PendSalesOrderRegister_ProductWise Or rptType = ReportType.PendSalesOrderRegister_BrandWise Or rptType = ReportType.PackingRegister_ProductWise Or rptType = ReportType.PackingRegister_BrandWise Or rptType = ReportType.PendServiceJobOrderRegister_ProductWise Or rptType = ReportType.ServiceChallanRegister_ProductWise) And chkDispRate.Checked = True Then

            Formulas.Add("Text1#S", "T")
            Formulas.Add("Text2#S", "Y")
            Formulas.Add("Text3#S", "H")

            Formulas.Add("DisplayDetails#N", IIf(chkDispRate.Checked, 1, 0))

            Formulas.Add("HeaderText1#S", "Design/Type/Shade")
            'Formulas.Add("ReportCaption#S", Me.Text)
        End If

        If rptType = ReportType.SalesOrderRegister_ProductWise Or rptType = ReportType.SalesOrderRegister_BrandWise Or rptType = ReportType.SalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.SalesOrderRegister_PartyProdWise _
            Or rptType = ReportType.PendSalesOrderRegister_ProductWise Or rptType = ReportType.PendSalesOrderRegister_BrandWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PendSalesOrderRegister_PartyProdWise Or rptType = ReportType.ServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.ServiceJobOrderRegister_ProductWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.PendServiceJobOrderRegister_ProductWise Then
            If rdDetailed.Checked Then
                Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
            End If
        End If

        If rptType = ReportType.PurOrderRegister_ProductWise Or rptType = ReportType.PurOrderRegister_BrandWise Or rptType = ReportType.PurOrderRegister_SubGroupWise _
            Or rptType = ReportType.PendPurOrderRegister_ProductWise Or rptType = ReportType.PendPurOrderRegister_BrandWise Or rptType = ReportType.PendPurOrderRegister_SubGroupWise Then
            If rdDetailed.Checked Then
                Formulas.Add("ViewSize#N", IIf(chkSize.Checked, 1, 0))
            End If
        End If

        ''Added by Pooja on 17-08-17
        If rptType = ReportType.PackingRegister_Brokerwise Then

        End If
        ''END


        If IsNothing(ReportParameters.rptFile) Then Exit Sub
        If ReportParameters.rptFile.Trim.Length = 0 Then Exit Sub

        Dim frmView As Form
        ReportParameters.rptCaption = Me.Text
        frmView = New frmViewReports(Formulas)
        frmView.Show()
    End Sub

    Private Sub ViewStockReportWithOptions(ByVal ForCaption As String, Optional ByVal PrnHeader As Boolean = False, Optional ByVal DisplayGraph As Boolean = False)
        Dim Param As String = ""
        Dim GrpHead As Boolean
        If rptType = ReportType.StoresStk_ProductWise Then
        Else
            If lstOption1.Items.Count > 0 Then
                Param = GetFieldParameter(lstOption1.Items(0))
                If ReportParameters.TotalText Then
                    Formulas.Add("Total1Text#S", lstOption1.Items(0) & " Total")
                End If
            End If
        End If


        If rptType = ReportType.StockAtAGlanceProduct Then
            Param = "P"
            Formulas.Add("GroupOn1#S", "P")

        Else
            Formulas.Add("GroupOn1#S", Param)

        End If
       
        Param = ""
        If rptType = ReportType.FabricStk_JobberWise Or rptType = ReportType.FabricStk_ProductWise Or rptType = ReportType.StoresIsuReg_ProductWise Or rptType = ReportType.StoresStk_JobberWise Or rptType = ReportType.StoresIsuBkReg_JobberWise Or rptType = ReportType.StoresIsuBkReg_ProductWise Or rptType = ReportType.FabricIsuBkReg_ProductWise Then
        Else
            If lstOption2.Items.Count > 0 Then
                Param = GetFieldParameter(lstOption2.Items(0))
                If ReportParameters.TotalText Then
                    Formulas.Add("Total2Text#S", lstOption2.Items(0) & " Total")
                End If
            End If
        End If

        Formulas.Add("GroupOn2#S", Param)

        Param = ""
        If lstOption3.Items.Count > 0 Then
            Param = GetFieldParameter(lstOption3.Items(0))
            If ReportParameters.TotalText Then
                Formulas.Add("Total3Text#S", lstOption3.Items(0) & " Total")
            End If
        End If
        Formulas.Add("GroupOn3#S", Param)

        ReportParameters.TotalText = False


        If rptType <> ReportType.StockAgingSubGroup And rptType <> ReportType.StockAgingProduct And rptType <> ReportType.StockAgingBrand And rptType <> ReportType.StockAgingSupplier And rptType <> ReportType.StockAgingBarcode Then
            If lstOption3.Items.Count > 0 Then
                Formulas.Add("GroupHeader#S", lstOption3.Items(0))
                GrpHead = True
            ElseIf lstOption2.Items.Count > 0 Then
                If rptType = ReportType.StockAtAGlanceCustomer Then
                    Formulas.Add("GroupHeader#S", lstOption1.Items(0))
                Else
                    'If rptType = ReportType.FabricStk_JobberWise Or rptType = ReportType.FabricStk_ProductWise Then
                    'Else
                    Formulas.Add("GroupHeader#S", lstOption2.Items(0))
                    'End If

                End If
                GrpHead = True
            ElseIf lstOption1.Items.Count > 0 Then
                Formulas.Add("GroupHeader#S", lstOption1.Items(0))
                GrpHead = True
            End If
        End If


        If Not GrpHead Then
            If lstDetails.Items.Count = 0 Then
                If PrnHeader And lstOption1.Items.Count > 0 Then

                    Formulas.Add("Header1#S", lstOption1.Items(0))


                End If
            End If

            If lstDetails.Items.Count = 0 Then
                If PrnHeader And lstOption2.Items.Count > 0 Then
                    Formulas.Add("Header2#S", lstOption2.Items(0))
                End If
            End If

            If lstDetails.Items.Count = 0 Then
                If PrnHeader And lstOption3.Items.Count > 0 Then
                    Formulas.Add("Header3#S", lstOption3.Items(0))
                End If
            End If

            GrpHead = False
        End If

        Dim i As Byte
        Dim HeaderText As String = ""

        If lstDetails.Items.Count > 0 Then
            For i = 0 To lstDetails.Items.Count - 1
                Param = GetFieldParameter(lstDetails.Items(i))

                If i = 0 Then
                    Formulas.Add("Text1#S", Param)
                    HeaderText = lstDetails.Items(i)
                    If PrnHeader Then
                        Formulas.Add("Header1#S", lstDetails.Items(i))
                    End If
                ElseIf i = 1 Then
                    Formulas.Add("Text2#S", Param)
                    HeaderText = HeaderText & "/" & lstDetails.Items(i)
                    If PrnHeader Then
                        Formulas.Add("Header2#S", lstDetails.Items(i))
                    End If
                ElseIf i = 2 Then
                    Formulas.Add("Text3#S", Param)
                    HeaderText = HeaderText & "/" & lstDetails.Items(i)
                    If PrnHeader Then
                        Formulas.Add("Header3#S", lstDetails.Items(i))
                    End If
                End If
            Next i

        Else
            If lstOption3.Items.Count > 0 Then
                HeaderText = lstOption3.Items(0)
            ElseIf lstOption2.Items.Count > 0 Then
                HeaderText = lstOption2.Items(0)
            ElseIf lstOption1.Items.Count > 0 Then
                HeaderText = lstOption1.Items(0)
            End If
        End If

        Dim Caption As String = ""
        If lstOption3.Items.Count > 0 Then
            Caption = lstOption3.Items(0)
        ElseIf lstOption2.Items.Count > 0 Then
            If rptType = ReportType.StockAtAGlanceCustomer Then
                Caption = lstOption1.Items(0)
            ElseIf rptType = ReportType.StockAtAGlanceProduct Then
                Caption = "Product"
            Else
                Caption = lstOption2.Items(0)
            End If
        ElseIf lstOption1.Items.Count > 0 Then
            Caption = lstOption1.Items(0)
        End If

        Formulas.Add("HeaderText#S", HeaderText)


        If TransType <> TransactionType.JobCard And TransType <> TransactionType.ProcessIssue And TransType <> TransactionType.ProcessReceipt And TransType <> TransactionType.ProcessLedger And TransType <> TransactionType.ProcessProdnDelay And TransType <> TransactionType.ProcessStkWithParty And TransType <> TransactionType.ProcessShortage And TransType <> TransactionType.SemiProcStkAtWarehouse And TransType <> TransactionType.FabricIssue And TransType <> TransactionType.FabricReceive And TransType <> TransactionType.FabricIssueBack And TransType <> TransactionType.StoresIssue And TransType <> TransactionType.StoresIssueBack And TransType <> TransactionType.FabricStkWithParty And TransType <> TransactionType.StoresStkWithParty Then
            Formulas.Add("ReportCaption#S", ForCaption & " - " & Caption & " Wise")
        Else
            Formulas.Add("ReportCaption#S", ReportParameters.rptCaption)
        End If

        If rptType = ReportType.StockAgingBarcode Then
            Formulas.Add("Header3#S", GetSysCaptionAsPerId(SystemCaptionIdx.DefArticle) & "/" & GetSysCaptionAsPerId(SystemCaptionIdx.DefType) & "/" & GetSysCaptionAsPerId(SystemCaptionIdx.DefShade))
        ElseIf rptType = ReportType.StockAgingSubGroup Or rptType = ReportType.StockAgingBrand Or rptType = ReportType.StockAgingSupplier Then
            Formulas.Item("Header1#S") = lstOption1.Items(0)
            HeaderText = ""
            For i = 0 To lstDetails.Items.Count - 1
                HeaderText &= lstDetails.Items(i) & "/"
            Next i

            If HeaderText.Trim.Length > 0 Then
                HeaderText = Mid$(HeaderText, 1, Len(HeaderText) - 1)
            End If
            Formulas.Item("Header2#S") = HeaderText
        ElseIf rptType = ReportType.StockAtAGlanceProduct Then
            Formulas.Item("Header1#S") = "Prouct"
            HeaderText = ""
            For i = 0 To lstDetails.Items.Count - 1
                HeaderText &= lstDetails.Items(i) & "/"
            Next i

            If HeaderText.Trim.Length > 0 Then
                HeaderText = Mid$(HeaderText, 1, Len(HeaderText) - 1)
            End If
            Formulas.Item("Header2#S") = "Brand"
        ElseIf rptType = ReportType.StockAtAGlanceSubGroup Or rptType = ReportType.StockAtAGlanceProduct Or rptType = ReportType.StockAtAGlanceBrand Or rptType = ReportType.StockAtAGlanceSupplier Or rptType = ReportType.StockAtAGlanceLocation Or rptType = ReportType.StockAtAGlanceCustomer Then
            Formulas.Item("Header1#S") = lstOption1.Items(0)
            Formulas.Item("Header2#S") = lstOption2.Items(0)

        ElseIf rptType = ReportType.StockAsOnPrevDate Then
            If lstDetails.Items.Count > 0 Then
                HeaderText = ""
                For i = 0 To lstDetails.Items.Count - 1
                    HeaderText &= lstDetails.Items(i) & "/"
                Next i

                If HeaderText.Trim.Length > 0 Then
                    HeaderText = Mid$(HeaderText, 1, Len(HeaderText) - 1)
                End If
                Formulas.Item("Header#S") = HeaderText
            End If
        End If

        If DisplayGraph Then
            Formulas.Add("DispData#N", IIf(chkData.Checked Or (Not chkData.Checked And Not chkChart.Checked), 1, 0))
            Formulas.Add("DispGraph#N", IIf(chkChart.Checked, 1, 0))
            Formulas.Add("DispQty#N", IIf(chkDispValue.Checked, 0, 1))

            'If chkChart.Checked Then
            '    If lstOption1.Items.Count > 0 Then
            '        ChartCaption = lstOption1.Items(0)
            '    ElseIf lstOption2.Items.Count > 0 Then
            '        ChartCaption = lstOption2.Items(0)
            '    ElseIf lstOption3.Items.Count > 0 Then
            '        ChartCaption = lstOption3.Items(0)
            '    End If

            '    Formulas.Add("ChartCaption#S", ForCaption & " - " & ChartCaption & " Wise")
            'End If
        End If

        If rptType = ReportType.OpeningStk_Brand Or rptType = ReportType.OpeningStk_Location Or rptType = ReportType.OpeningStk_Product Or rptType = ReportType.OpeningStk_SubGroup Or rptType = ReportType.ClosingStk_Brand Or rptType = ReportType.ClosingStk_Location Or rptType = ReportType.ClosingStk_Product Or rptType = ReportType.ClosingStk_SubGroup Or rptType = ReportType.ClosingStk_Supplier Then
            If TransType = TransactionType.Stock Then
                Formulas.Add("DisplayDetails#N", IIf(rdSummary.Checked, 0, 1))
            End If
        Else
            'If TransType = TransactionType.Stock Then
            '    Formulas.Add("DetailDisplay#N", IIf(rdSummary.Checked, 0, 1))
            'End If
        End If

        If TransType = TransactionType.ProcessIssue Or TransType = TransactionType.ProcessReceipt Or TransType = TransactionType.ProcessProdnDelay Or TransType = TransactionType.ProcessStkWithParty Or TransType = TransactionType.SemiProcStkAtWarehouse Or TransType = TransactionType.ProcessShortage Or TransType = TransactionType.StoresIssue Then
            Dim HdrText As String = ""

            HdrText = GetSystemCaption(SystemCaptionIdx.DefArticle) & "/" & GetSystemCaption(SystemCaptionIdx.DefType) & "/" & GetSystemCaption(SystemCaptionIdx.DefShade)
            Formulas.Add("HeaderText1#S", HdrText)
        End If

        If IsNothing(ReportParameters.rptFile) Then Exit Sub
        If ReportParameters.rptFile.Trim.Length = 0 Then Exit Sub

        Dim frmView As Form
        ReportParameters.rptCaption = Me.Text
        frmView = New frmViewReports(Formulas)
        frmView.Show()
    End Sub

    Private Sub lstMain_DragDrop(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstMain.DragDrop
        'Dim lbl As ListBox = DirectCast(e.Data.GetData(GetType(ListBox)), ListBox)
        'lstMain.Text = lbl.Text
        'lstMain.BackColor = lbl.BackColor
        'lstMain.BorderStyle = BorderStyle.Fixed3D
    End Sub


    Private Function GetPartyFilter(ByVal Table As String, Optional ByVal ActualTable As Boolean = False) As String
        Dim SelState As String = ""
        Dim SelDistrict As String = ""
        Dim SelCity As String = ""
        Dim SelStation As String = ""
        Dim SelParties As String = ""
        Dim PartyFltr As String = ""
        Dim selCountry As String = ""
        Dim SelRegion As String = ""
        Dim SelectedItems As String = ""
        Dim SelSo As String = ""
        ''ankita18122018
        selCountry = GetSelectedAttributes(cmbCountry, "Country.Cont_Key")
        If selCountry.Trim.Length > 0 Then
            PartyFltr &= " And " & selCountry
        End If
        ''end ankita 18122018
        SelState = GetSelectedAttributes(cmbState, "State.State_Key")
        If SelState.Trim.Length > 0 Then
            PartyFltr &= " And " & SelState
        End If

        SelDistrict = GetSelectedAttributes(cmbDistrict, "District.Dist_Key")
        If SelDistrict.Trim.Length > 0 Then
            PartyFltr &= " And " & SelDistrict
        End If

        SelCity = GetSelectedAttributes(cmbCity, "City.City_Key")
        If SelCity.Trim.Length > 0 Then
            PartyFltr &= " And " & SelCity
        End If

        'SelSo = GetSelectedAttributes(cmbSONo, "SalesOrderDtl.Doc_ID")
        'If SelSo.Trim.Length > 0 Then
        '    PartyFltr &= " And " & SelSo
        'End If
        'SelRegion = GetSelectedAttributes(cmbRegion, "Region.Regn_ID)
        'If SelRegion.Trim.Length > 0 Then
        '    PartyFltr &= " And " & SelRegion
        'End If
        SelectedItems = cmbRegion.Properties.GetCheckedItems
        Dim AllRegion As String = SelectedList(cmbRegion, SelectedItems, True)

        If AllRegion <> "" Then
            'PartyFltr &= " And Region.Regn_Id In (" & AllRegion & ")"
            PartyFltr &= " And { Region.Regn_ID} In [" & AllRegion & "]"
        Else
            PartyFltr &= ""
        End If

        SelStation = GetSelectedAttributes(cmbStation, "Station.Stn_Key")
        If SelStation.Trim.Length > 0 Then
            PartyFltr &= " And " & SelStation
        End If
        If rptType = ReportType.FabricStk_JobberWise Then
            IsSupplier = True
        End If

        If ActualTable Then
            If Table.Trim.Length > 0 Then
                If IsSupplier Then
                    SelParties = GetSelectedAttributes(cmbParty, Table & ".Supl_Key")
                Else
                    If rptType = ReportType.FabricLedgerAtJobber Or rptType = ReportType.StockLedgerAtJobber Or rptType = ReportType.AccStockLedgerAtJobber Then
                        SelParties = GetSelectedAttributes(cmbParty, Table & ".Jobber_id")
                    ElseIf rptType = ReportType.Karigar_Salary Then
                        SelParties = GetSelectedAttributes(cmbParty, Table & ".Party_Key")
                    ElseIf rptType = ReportType.ProcessDateWise Or rptType = ReportType.ProcessDocWise Or rptType = rptType.ProcessSumWise Then
                        SelParties = GetSelectedAttributes(cmbPartyHoney, Table & ".Party_Key")
                    Else
                        If TransType = TransactionType.StoresStkWithParty And rptType = ReportType.StoresStk_JobberWise Then
                            SelParties = GetSelectedAttributes(cmbParty, Table & ".supl_key")
                        Else
                            SelParties = GetSelectedAttributes(cmbParty, Table & ".Party_Key")
                        End If
                    End If
                End If
            Else
                SelParties = GetSelectedAttributes(cmbParty, "Bill.Party_Key")
            End If
        Else
            If TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseRtn Or TransType = TransactionType.Stock Then
                SelParties = GetSelectedAttributes(cmbParty, Table & ".Supl_Key")
            ElseIf TransType = TransactionType.SalesOrder Or TransType = TransactionType.Delivery Or TransType = TransactionType.SaleBill Or TransType = TransactionType.PendAgstPack Or TransType = TransactionType.SalesRtn Then
                SelParties = GetSelectedAttributes(cmbParty, Table & ".Cust_Key")
            ElseIf TransType = TransactionType.PurchaseBill Then ''ankita 24042019
                SelParties = GetSelectedAttributes(cmbParty, Table & ".Party_Id")
            Else
                SelParties = GetSelectedAttributes(cmbParty, Table & ".Led_Key")

            End If
        End If

        If SelParties.Trim.Length > 0 Then
            PartyFltr &= " And " & SelParties
        End If

        Return PartyFltr
    End Function
   

    Private Function GetStockFilter(ByVal Table As String, Optional ByVal ActualTable As Boolean = False, Optional ByVal SupplierWise As Boolean = False) As String
        Dim SelGroup As String = ""
        Dim SelSubGroup As String = ""
        Dim SelProducts As String = ""
        Dim SelStyle As String = ""
        Dim SelType As String = ""
        Dim SelShade As String = ""
        Dim SelSize As String = ""
        Dim SelBrand As String = ""
        Dim SelQuality As String = ""
        Dim SelSeason As String = ""
        Dim SelOccassion As String = ""
        Dim SelLocation As String = ""
        Dim SelSupplier As String = ""
        Dim SelRate As String = ""
        'Dim SelMfr As String = ""
        Dim StockFltr As String = ""
        Dim FieldParam As String = ""
        Dim SelSO As String = ""
        If rptType <> ReportType.RetailerWiseSaleOrder_design Then
            If SupplierWise Then
                If ActualTable Then
                    FieldParam = "{Supplier.Led_Key}"
                Else
                    FieldParam = "{" & Table & ".Supl_Key}"
                End If

                SelSupplier = GetSelectedAttributesForStock(cmbParty, FieldParam)
                If SelSupplier.Trim.Length > 0 Then
                    StockFltr &= " And " & SelSupplier
                End If
            End If

        End If

        'If ActualTable Then
        '    FieldParam = "{Location.Loc_Key}"
        'Else
        '    FieldParam = "{" & Table & ".Loc_Key}"
        'End If

        'SelLocation = GetSelectedAttributesForStock(cmbLocation, "{Location.Loc_Key}")
        'If SelLocation.Trim.Length > 0 Then
        '    StockFltr &= " And " & SelLocation
        'End If


        If rptType <> ReportType.MonthlySales_ProductWise And rptType <> ReportType.DesignWiseStockWithImages Then
            SelGroup = GetSelectedAttributesForStock(cmbProductGrp, "{ItemGrp.ItemGrp_Key}")
            If SelGroup.Trim.Length > 0 Then
                StockFltr &= " And " & SelGroup
            End If
        End If

        If ActualTable Then
            FieldParam = "{ItemSubGrp.ItemSubGrp_Key}"
        Else
            If rptType = ReportType.FabPurOrderRegister_AllInOne Then
                FieldParam = "{ItemSubGrp.ItemSubGrp_Key}"
            Else
                FieldParam = "{" & Table & ".ItemSubGrp_Key}"
            End If
        End If

            SelSubGroup = GetSelectedAttributesForStock(cmbProductSubGrp, FieldParam)
            If SelSubGroup.Trim.Length > 0 Then
                StockFltr &= " And " & SelSubGroup
            End If

            If ActualTable Then
                FieldParam = "{Item.Item_Key}"
            Else
                FieldParam = "{" & Table & ".Item_Key}"
            End If

            SelProducts = GetSelectedAttributesForStock(cmbProduct, FieldParam)
            If SelProducts.Trim.Length > 0 Then
                StockFltr &= " And " & SelProducts
            End If

        If ActualTable Then
            FieldParam = "{Style.Style_Code}"
        Else
            If rptType = ReportType.DesignWiseNetSalesRegister Then
                FieldParam = "{Style.Style_Code}"
            Else
                FieldParam = "{" & Table & ".Style}"
            End If
        End If

        SelStyle = GetSelectedAttributesForStock(cmbStyle, FieldParam)
        If SelStyle.Trim.Length > 0 Then
            StockFltr &= " And " & SelStyle
        End If

        If ActualTable Then
            FieldParam = "{Type.Type_Key}"
        Else
            FieldParam = "{" & Table & ".Type_Key}"
        End If

        SelType = GetSelectedAttributesForStock(cmbType, FieldParam)
        If SelType.Trim.Length > 0 Then
            StockFltr &= " And " & SelType
        End If

        If ActualTable Then
            FieldParam = "{Shade.Shade_Key}"
        Else
            FieldParam = "{" & Table & ".Shade_Key}"
        End If

        SelShade = GetSelectedAttributesForStock(cmbShade, FieldParam)
        If SelShade.Trim.Length > 0 Then
            StockFltr &= " And " & SelShade
        End If


        'If ActualTable Then
        '    FieldParam = "{ItemSize.ItemSize_Key}"
        'Else
        '    FieldParam = "{" & Table & ".ItemSize_Key}"
        'End If
        If rptType <> ReportType.MonthlySales_ProductWise Then

            If ActualTable Then
                If ReportType.OpeningStockSubGroup Or ReportType.OpeningStockProduct Or ReportType.OpeningStockBrand Or ReportType.OpeningStockLocation Then
                    FieldParam = "{StyleSize.Size_Name}"
                Else
                    FieldParam = "{ItemSize.Size_Name}"
                End If
            Else
                FieldParam = "{" & Table & ".Size_Name}"
            End If

            SelSize = GetSelectedAttributesForStock(cmbSize, FieldParam)
            If SelSize.Trim.Length > 0 Then
                StockFltr &= " And " & SelSize
            End If


            If ActualTable Then
                FieldParam = "{Brand.Brand_Key}"
            Else
                FieldParam = "{" & Table & ".Brand_Key}"
            End If
            'If ActualTable Then
            '    FieldParam = "{Item.Item_name}"
            'Else
            '    FieldParam = "{" & Table & ".Item_name}"
            'End If

            SelBrand = GetSelectedAttributesForStock(cmbBrand, FieldParam)
            If SelBrand.Trim.Length > 0 Then
                StockFltr &= " And " & SelBrand
            End If



            If ActualTable Then
                FieldParam = "{Quality.Qlty_Key}"
            Else
                FieldParam = "{" & Table & ".Qlty_Key}"
            End If

            SelQuality = GetSelectedAttributesForStock(cmbQuality, FieldParam)
            If SelQuality.Trim.Length > 0 Then
                StockFltr &= " And " & SelQuality
            End If

            If ActualTable Then
                FieldParam = "{Season.Season_Key}"
            Else
                FieldParam = "{" & Table & ".Season_Key}"
            End If

            SelSeason = GetSelectedAttributesForStock(cmbSeason, FieldParam)
            If SelSeason.Trim.Length > 0 Then
                StockFltr &= " And " & SelSeason
            End If

            If ActualTable Then
                FieldParam = "{Occassion.Occn_Key}"
            Else
                FieldParam = "{" & Table & ".Occn_Key}"
            End If

            SelOccassion = GetSelectedAttributesForStock(cmbOccassion, FieldParam)
            If SelOccassion.Trim.Length > 0 Then
                StockFltr &= " And " & SelOccassion
            End If

        End If

        Return StockFltr
    End Function
    Private Function GetStockFilter1(ByVal Table As String, Optional ByVal ActualTable As Boolean = False, Optional ByVal SupplierWise As Boolean = False) As String
        Dim SelGroup As String = ""
        Dim SelSubGroup As String = ""
        Dim SelProducts As String = ""
        Dim SelStyle As String = ""
        Dim SelType As String = ""
        Dim SelShade As String = ""
        Dim SelSize As String = ""
        Dim SelBrand As String = ""
        Dim SelQuality As String = ""
        Dim SelSeason As String = ""
        Dim SelOccassion As String = ""
        Dim SelLocation As String = ""
        Dim SelSupplier As String = ""
        Dim SelRate As String = ""
        'Dim SelMfr As String = ""
        Dim StockFltr As String = ""
        Dim FieldParam As String = ""

        'If rptType <> ReportType.RetailerWiseSaleOrder_design Then
        '    If SupplierWise Then
        '        If ActualTable Then
        '            FieldParam = "Supplier.Led_Key"
        '        Else
        '            FieldParam = "" & Table & ".Supl_Key"
        '        End If

        '        SelSupplier = GetSelectedAttributesForStock(cmbParty, FieldParam)
        '        If SelSupplier.Trim.Length > 0 Then
        '            StockFltr &= " And " & SelSupplier
        '        End If
        '    End If

        'End If

        ''If ActualTable Then
        ''    FieldParam = "{Location.Loc_Key}"
        ''Else
        ''    FieldParam = "{" & Table & ".Loc_Key}"
        ''End If

        ''SelLocation = GetSelectedAttributesForStock(cmbLocation, "{Location.Loc_Key}")
        ''If SelLocation.Trim.Length > 0 Then
        ''    StockFltr &= " And " & SelLocation
        ''End If


        If rptType <> ReportType.MonthlySales_ProductWise Then
            SelGroup = GetSelectedAttributesForStock1(cmbProductGrp, "ItemGrp.ItemGrp_Key")
            If SelGroup.Trim.Length > 0 Then
                StockFltr &= " And " & SelGroup
            End If
        End If

        If ActualTable Then
            FieldParam = "ItemSubGrp.ItemSubGrp_Key"
        Else
            FieldParam = Table & ".ItemSubGrp_Key"
        End If

        SelSubGroup = GetSelectedAttributesForStock1(cmbProductSubGrp, FieldParam)
        If SelSubGroup.Trim.Length > 0 Then
            StockFltr &= " And " & SelSubGroup
        End If

        If ActualTable Then
            FieldParam = "Item.Item_Key"
        Else
            FieldParam = Table & ".Item_Key"
        End If

        SelProducts = GetSelectedAttributesForStock1(cmbProduct, FieldParam)
        If SelProducts.Trim.Length > 0 Then
            StockFltr &= " And " & SelProducts
        End If

        If ActualTable Then
            FieldParam = "Style.Style_Code"
        Else
            FieldParam = Table & ".Style"
        End If

        SelStyle = GetSelectedAttributesForStock1(cmbStyle, FieldParam)
        If SelStyle.Trim.Length > 0 Then
            StockFltr &= " And " & SelStyle
        End If

        If ActualTable Then
            FieldParam = "Type.Type_Key"
        Else
            FieldParam = Table & ".Type_Key"
        End If

        SelType = GetSelectedAttributesForStock1(cmbType, FieldParam)
        If SelType.Trim.Length > 0 Then
            StockFltr &= " And " & SelType
        End If

        If ActualTable Then
            FieldParam = "Shade.Shade_Key"
        Else
            FieldParam = Table & ".Shade_Key"
        End If

        SelShade = GetSelectedAttributesForStock1(cmbShade, FieldParam)
        If SelShade.Trim.Length > 0 Then
            StockFltr &= " And " & SelShade
        End If


        'If ActualTable Then
        '    FieldParam = "{ItemSize.ItemSize_Key}"
        'Else
        '    FieldParam = "{" & Table & ".ItemSize_Key}"
        'End If
        If rptType <> ReportType.MonthlySales_ProductWise Then

            If ActualTable Then
                If ReportType.OpeningStockSubGroup Or ReportType.OpeningStockProduct Or ReportType.OpeningStockBrand Or ReportType.OpeningStockLocation Then
                    FieldParam = "StyleSize.Size_Name"
                Else
                    FieldParam = "ItemSize.Size_Name"
                End If
            Else
                FieldParam = Table & ".Size_Name"
            End If

            SelSize = GetSelectedAttributesForStock1(cmbSize, FieldParam)
            If SelSize.Trim.Length > 0 Then
                StockFltr &= " And " & SelSize
            End If


            If ActualTable Then
                FieldParam = "Brand.Brand_Key"
            Else
                FieldParam = Table & ".Brand_Key"
            End If
            'If ActualTable Then
            '    FieldParam = "{Item.Item_name}"
            'Else
            '    FieldParam = "{" & Table & ".Item_name}"
            'End If

            SelBrand = GetSelectedAttributesForStock1(cmbBrand, FieldParam)
            If SelBrand.Trim.Length > 0 Then
                StockFltr &= " And " & SelBrand
            End If

            If ActualTable Then
                FieldParam = "Quality.Qlty_Key"
            Else
                FieldParam = Table & ".Qlty_Key"
            End If

            SelQuality = GetSelectedAttributesForStock1(cmbQuality, FieldParam)
            If SelQuality.Trim.Length > 0 Then
                StockFltr &= " And " & SelQuality
            End If

            'If ActualTable Then
            '    FieldParam = "Season.Season_Key}"
            'Else
            '    FieldParam = "{" & Table & ".Season_Key}"
            'End If

            'SelSeason = GetSelectedAttributesForStock(cmbSeason, FieldParam)
            'If SelSeason.Trim.Length > 0 Then
            '    StockFltr &= " And " & SelSeason
            'End If

            'If ActualTable Then
            '    FieldParam = "{Occassion.Occn_Key}"
            'Else
            '    FieldParam = "{" & Table & ".Occn_Key}"
            'End If

            'SelOccassion = GetSelectedAttributesForStock(cmbOccassion, FieldParam)
            'If SelOccassion.Trim.Length > 0 Then
            '    StockFltr &= " And " & SelOccassion
            'End If

        End If

        Return StockFltr
    End Function
    Private Function GetStockFilterForQuery(ByVal Table As String, Optional ByVal ActualTable As Boolean = False, Optional ByVal SupplierWise As Boolean = True) As String
        Dim SelGroup As String = ""
        Dim SelSubGroup As String = ""
        Dim SelProducts As String = ""
        Dim SelStyle As String = ""
        Dim SelType As String = ""
        Dim SelShade As String = ""
        Dim SelSize As String = ""
        Dim SelBrand As String = ""
        Dim SelQuality As String = ""
        Dim SelSeason As String = ""
        Dim SelOccassion As String = ""
        Dim SelLocation As String = ""
        Dim SelSupplier As String = ""
        Dim StockFltr As String = ""
        Dim FieldParam As String = ""


        If SupplierWise Then
            If ActualTable Then
                FieldParam = "Supplier.Led_Key"
            Else
                FieldParam = "(" & Table & ".Supl_Key)"
            End If

            SelSupplier = GetSelectedAttributesForQuery(cmbParty, FieldParam)
            If SelSupplier.Trim.Length > 0 Then
                StockFltr &= " And " & SelSupplier
            End If
        End If

        If ActualTable Then
            FieldParam = "Location.Loc_Key"
        Else
            FieldParam = "(" & Table & ".Loc_Key)"
        End If

        SelLocation = GetSelectedAttributesForQuery(cmbLocation, FieldParam)
        If SelLocation.Trim.Length > 0 Then
            StockFltr &= " And " & SelLocation
        End If


        SelGroup = GetSelectedAttributesForQuery(cmbProductGrp, "(ItemGrp.ItemGrp_Key)")
        If SelGroup.Trim.Length > 0 Then
            StockFltr &= " And " & SelGroup
        End If

        If ActualTable Then
            FieldParam = "(ItemSubGrp.ItemSubGrp_Key)"
        Else
            FieldParam = "(" & Table & ".ItemSubGrp_Key)"
        End If

        SelSubGroup = GetSelectedAttributesForQuery(cmbProductSubGrp, FieldParam)
        If SelSubGroup.Trim.Length > 0 Then
            StockFltr &= " And " & SelSubGroup
        End If


        If ActualTable Then
            FieldParam = "(Item.Item_Key)"
        Else
            FieldParam = "(" & Table & ".Item_Key)"
        End If

        SelProducts = GetSelectedAttributesForQuery(cmbProduct, FieldParam)
        If SelProducts.Trim.Length > 0 Then
            StockFltr &= " And " & SelProducts
        End If

        If ActualTable Then
            FieldParam = "(Style.Style_Code)"
        Else
            FieldParam = "(" & Table & ".Style_Code)"
        End If

        SelStyle = GetSelectedAttributesForQuery(cmbStyle, FieldParam)
        If SelStyle.Trim.Length > 0 Then
            StockFltr &= " And " & SelStyle
        End If


        If ActualTable Then
            FieldParam = "(Type.Type_Key)"
        Else
            FieldParam = "(" & Table & ".Type_Key)"
        End If

        SelType = GetSelectedAttributesForQuery(cmbType, FieldParam)
        If SelType.Trim.Length > 0 Then
            StockFltr &= " And " & SelType
        End If


        If ActualTable Then
            FieldParam = "(Shade.Shade_Key)"
        Else
            FieldParam = "(" & Table & ".Shade_Key)"
        End If

        SelShade = GetSelectedAttributesForQuery(cmbShade, FieldParam)
        If SelShade.Trim.Length > 0 Then
            StockFltr &= " And " & SelShade
        End If


        If ActualTable Then
            FieldParam = "(ItemSize.Size_Name)"
        Else
            FieldParam = "(" & Table & ".Size_Name)"
        End If

        SelSize = GetSelectedAttributesForQuery(cmbSize, FieldParam)
        If SelSize.Trim.Length > 0 Then
            StockFltr &= " And " & SelSize
        End If


        If ActualTable Then
            FieldParam = "(Brand.Brand_Key)"
        Else
            FieldParam = "(" & Table & ".Brand_Key)"
        End If

        SelBrand = GetSelectedAttributesForQuery(cmbBrand, FieldParam)
        If SelBrand.Trim.Length > 0 Then
            StockFltr &= " And " & SelBrand
        End If


        If ActualTable Then
            FieldParam = "(Quality.Qlty_Key)"
        Else
            FieldParam = "(" & Table & ".Qlty_Key)"
        End If

        SelQuality = GetSelectedAttributesForQuery(cmbQuality, FieldParam)
        If SelQuality.Trim.Length > 0 Then
            StockFltr &= " And " & SelQuality
        End If


        If ActualTable Then
            FieldParam = "(Season.Season_Key)"
        Else
            FieldParam = "(" & Table & ".Season_Key)"
        End If

        SelSeason = GetSelectedAttributesForQuery(cmbSeason, FieldParam)
        If SelSeason.Trim.Length > 0 Then
            StockFltr &= " And " & SelSeason
        End If


        If ActualTable Then
            FieldParam = "(Occassion.Occn_Key)"
        Else
            FieldParam = "(" & Table & ".Occn_Key)"
        End If

        SelOccassion = GetSelectedAttributesForQuery(cmbOccassion, FieldParam)
        If SelOccassion.Trim.Length > 0 Then
            StockFltr &= " And " & SelOccassion
        End If

        Return StockFltr
    End Function

    Private Function GetFromToDateSeriesFilter(ByVal DateField As String, ByVal SeriesField As String, Optional ByVal AddParam As Boolean = True, Optional ByVal SeriesFltr As Boolean = True) As String

        Dim Series As String = ""
        Dim FromToDate As String = ""
        Formulas = New Hashtable

        If SeriesFltr Then
            If rdA.Checked Then
                Series = " And " & SeriesField & " = 'A'"
            ElseIf rdB.Checked Then
                Series = " And " & SeriesField & " = 'B'"
            End If
        End If

        If AddParam Then
            Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
            Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))
        End If

        FromToDate = " And " & DateField & " >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And " & DateField & " <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")" & Series

        Return FromToDate
    End Function
    Private Function GetFromToDateSeriesFilter1(ByVal DateField As String, ByVal SeriesField As String, Optional ByVal AddParam As Boolean = True, Optional ByVal SeriesFltr As Boolean = True) As String
        Dim Series As String = ""
        Dim FromToDate As String = ""

        If SeriesFltr Then
            If rdA.Checked Then
                Series = " And " & SeriesField & " = 'A'"
            ElseIf rdB.Checked Then
                Series = " And " & SeriesField & " = 'B'"
            End If
        End If

        If AddParam Then
            Formulas.Add("FromDate#S", Format$(dtpFrom.Value, "dd/MM/yyyy"))
            Formulas.Add("ToDate#S", Format$(dtpTo.Value, "dd/MM/yyyy"))
        End If

        FromToDate = " And (" & DateField & " >= Date(" & Format$(dtpFrom.Value, "yyyy,MM,dd") & ") And " & DateField & " <= Date(" & Format$(dtpTo.Value, "yyyy,MM,dd") & ")" & Series

        Return FromToDate
    End Function

    Private Function GetFrom2To2DateSeriesFilter(ByVal DateField As String, ByVal SeriesField As String, Optional ByVal AddParam As Boolean = True, Optional ByVal SeriesFltr As Boolean = True) As String

        Dim Series As String = ""
        Dim FromToDate As String = ""
        Formulas = New Hashtable

        If SeriesFltr Then
            If rdA.Checked Then
                Series = " And " & SeriesField & " = 'A'"
            ElseIf rdB.Checked Then
                Series = " And " & SeriesField & " = 'B'"
            End If
        End If

        If AddParam Then
            Formulas.Add("FromDate#S", Format$(dtpFrom2.Value, "dd/MM/yyyy"))
            Formulas.Add("ToDate#S", Format$(dtpTo2.Value, "dd/MM/yyyy"))
        End If

        FromToDate = " And " & DateField & " >= Date(" & Format$(dtpFrom2.Value, "yyyy,MM,dd") & ") And " & DateField & " <= Date(" & Format$(dtpTo2.Value, "yyyy,MM,dd") & ")" & Series

        Return FromToDate
    End Function

    Private Function GetFrom1To1DateSeriesFilter(ByVal DateField As String, ByVal SeriesField As String, Optional ByVal AddParam As Boolean = True, Optional ByVal SeriesFltr As Boolean = True) As String

        Dim Series As String = ""
        Dim FromToDate As String = ""
        Formulas = New Hashtable

        If SeriesFltr Then
            If rdA.Checked Then
                Series = " And " & SeriesField & " = 'A'"
            ElseIf rdB.Checked Then
                Series = " And " & SeriesField & " = 'B'"
            End If
        End If

        If AddParam Then
            Formulas.Add("FromDate#S", Format$(dtpFrom1.Value, "dd/MM/yyyy"))
            Formulas.Add("ToDate#S", Format$(dtpTo1.Value, "dd/MM/yyyy"))
        End If

        FromToDate = " And " & DateField & " >= Date(" & Format$(dtpFrom1.Value, "yyyy,MM,dd") & ") And " & DateField & " <= Date(" & Format$(dtpTo1.Value, "yyyy,MM,dd") & ")" & Series

        Return FromToDate
    End Function

    Private Function GetTaxFilter(ByVal Table As String) As String
        Dim TaxFilter As String = GetSelectedAttributesForStock(cmbOperator, "{" & Table & ".Tax_Key}")
        If TaxFilter.Trim.Length > 0 Then
            TaxFilter &= " And " & TaxFilter
        End If

        Return TaxFilter
    End Function

    Private Function DefaultSelection() As Boolean
        Return (lstOption1.Items.Count = 0 And lstOption2.Items.Count = 0 And lstOption3.Items.Count = 0 And lstDetails.Items.Count = 0)
    End Function

    Private Sub chkDispRate_CheckedChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles chkDispRate.CheckedChanged
        pnlRateType.Enabled = chkDispRate.Checked

        If Not chkDispValue.Checked And chkDispRate.Checked Then
            rdPurRate.Checked = True

        End If
        If Not chkDispRate.Checked Then
            cmbrate.Enabled = True
        Else
            cmbrate.Enabled = False
        End If

        ''CHANGE BY RAHUL ON 23/04/2019
        If rptType = ReportType.PurRegister_DateWise Or rptType = ReportType.PurbillRegister_DateWise Then
            If chkDispRate.Checked = True Then
                chkDispValue.Checked = False
            End If
        End If

        If rptType = ReportType.ProductCategorywiseBuyerwiseOrderAnal Then
            'If chkDispRate.Checked = True Then
            '    chkDispValue.Checked = True
            'Else
            chkDispValue.Checked = True
            'End If
        End If
        'END
    End Sub

    Private Sub chkDispValue_CheckedChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles chkDispValue.CheckedChanged
        pnlRateType.Enabled = chkDispValue.Checked

        If Not chkDispRate.Checked And chkDispValue.Checked Then
            rdPurRate.Checked = True

        End If

        If Not chkDispValue.Checked Then
            cmbrate.Enabled = True
        Else
            cmbrate.Enabled = False
        End If

        ''CHANGE BY RAHUL ON 23/04/2019
        If rptType = ReportType.PurRegister_DateWise Or rptType = ReportType.PurbillRegister_DateWise Then
            If chkDispValue.Checked = True Then
                chkDispRate.Checked = False
            End If
        End If

        If rptType = ReportType.DesignWiseStockWithImages Then
            chkSize.Checked = False
            If Not chkDispValue.Checked Then
                chkSize.Visible = False
            Else
                chkSize.Visible = True
            End If
        End If

        ''END
    End Sub

    Private Sub cmbDisplay_EditValueChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmbDisplay.EditValueChanged
        txtStkTo.Visible = False
        txtStkFrom.Visible = True
        If cmbDisplay.SelectedIndex = 0 Then
            txtStkFrom.Visible = False
        End If

        If cmbDisplay.SelectedIndex = 4 Then
            txtStkTo.Visible = True
        End If
    End Sub

    Private Sub EnableDisableOptions(ByVal OptType As OptionType)
        Select Case OptType
            Case OptionType.DateWise, OptionType.Bill
                pnlDate.Enabled = True : pnlParty.Enabled = False : pnlProduct.Enabled = False

            Case OptionType.Counter

            Case OptionType.OperatorWise


        End Select
    End Sub

    'Private Sub lstMain_DragEnter(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstMain.DragEnter
    '    If e.Data.GetDataPresent(GetType(ListBox)) Then
    '        ' There is Label data. Allow copy.
    '        e.Effect = DragDropEffects.Copy

    '        ' Highlight the control.
    '        lstMain.BorderStyle = BorderStyle.FixedSingle
    '    Else
    '        ' There is no Label. Prohibit drop.
    '        e.Effect = DragDropEffects.None
    '    End If
    'End Sub

    'Private Sub lstMain_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles lstMain.MouseDown
    '    lstMain.DoDragDrop(lstMain, DragDropEffects.Copy)
    'End Sub

    'Private Sub lstOption1_DragDrop(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstOption1.DragDrop
    '    If lstOption1.Items.Count > 0 Then Exit Sub

    '    Dim lbl As ListBox = DirectCast(e.Data.GetData(GetType(ListBox)), ListBox)
    '    lstOption1.Items.Add(lbl.Text)
    '    lstOption1.BackColor = lbl.BackColor
    '    lstOption1.BorderStyle = BorderStyle.Fixed3D
    'End Sub

    'Private Sub lstOption1_DragLeave(ByVal sender As Object, ByVal e As System.EventArgs) Handles lstOption1.DragLeave
    '    lstOption1.BorderStyle = BorderStyle.Fixed3D
    'End Sub

    Private Sub EnableFilters(ByVal SelectedText As String, ByVal EnableDisable As Boolean)
        If rptType = ReportType.TopSoldItems Or rptType = ReportType.BottomSoldItems Or rptType = ReportType.RetailerWiseSaleOrder Then
            pnlProduct.Enabled = False
            Exit Sub
        End If

        Select Case SelectedText.ToUpper
            'Case "SECTION", "GROUP", "SUBGROUP", "PRODUCT", "DESIGN", "TYPE", "SHADE", "SIZE", "BRAND", "QUALITY", "SEASON", "OCCASSION"
            Case UCase(GetSystemCaption(SystemCaptionIdx.DefSection)), UCase(GetSystemCaption(SystemCaptionIdx.DefGroup)), UCase(GetSystemCaption(SystemCaptionIdx.DefSubGroup)), UCase(GetSystemCaption(SystemCaptionIdx.DefProduct)), UCase(GetSystemCaption(SystemCaptionIdx.DefArticle)), UCase(GetSystemCaption(SystemCaptionIdx.DefType)), UCase(GetSystemCaption(SystemCaptionIdx.DefShade)), UCase(GetSystemCaption(SystemCaptionIdx.DefSize)), UCase(GetSystemCaption(SystemCaptionIdx.DefBrand)), UCase(GetSystemCaption(SystemCaptionIdx.DefQuality)), UCase(GetSystemCaption(SystemCaptionIdx.DefSeason)), UCase(GetSystemCaption(SystemCaptionIdx.DefOccassion))
                pnlProduct.Enabled = EnableDisable

                If Not pnlProduct.Enabled Then
                    cmbProductGrp.SetEditValue("")
                    cmbProductSubGrp.SetEditValue("")
                    cmbProduct.SetEditValue("")
                    cmbStyle.SetEditValue("")
                    cmbType.SetEditValue("")
                    cmbShade.SetEditValue("")
                    cmbSize.SetEditValue("")
                    cmbBrand.SetEditValue("")
                    cmbQuality.SetEditValue("")
                    cmbSeason.SetEditValue("")
                    cmbOccassion.SetEditValue("")
                End If

            Case "CUSTOMER", "SUPPLIER", "PARTY"
                pnlParty.Enabled = EnableDisable

                If Not pnlParty.Enabled Then
                    cmbState.SetEditValue("")
                    cmbDistrict.SetEditValue("")
                    cmbCity.SetEditValue("")
                    cmbStation.SetEditValue("")
                    cmbParty.SetEditValue("")
                End If

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefLocation))
                cmbLocation.Enabled = EnableDisable
                cmbLocation.SetEditValue("")

            Case "SALEPERSON"
                If rptType = ReportType.MonthlySalesSaleperson Then
                    If EnableDisable Then
                        Query = "Select LED_KEY, LED_NAME " _
                            & " From Ledger " _
                            & " Where Status = '1' And Led_Name <> '' " _
                            & " And Led_Cat = 'S' " & BranchLedFixFilter _
                            & " Order By Led_Name"
                        Common.FillCheckBoxCombo(Query, cmbTax, "LED_NAME", "LED_KEY")

                        cmbTax.Enabled = True
                        lblTax.Text = "Saleperson"
                        cmbTax.Tag = "Saleperson"
                    Else
                        cmbTax.Enabled = False
                    End If

                Else
                    If EnableDisable Then
                        Query = "Select LED_KEY, LED_NAME " _
                           & " From Ledger " _
                           & " Where Led_Cat = 'S' And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                           & " Order By Led_Name"
                        Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")

                        cmbOperator.Enabled = True
                        lblOperator.Text = "Saleperson"
                        cmbOperator.Tag = "Saleperson"
                    Else
                        cmbOperator.Enabled = False
                    End If
                End If


            Case "CONSIGNEE"

                pnlParty.Enabled = EnableDisable

                If Not pnlParty.Enabled Then
                    cmbState.SetEditValue("")
                    cmbDistrict.SetEditValue("")
                    cmbCity.SetEditValue("")
                    cmbStation.SetEditValue("")
                    cmbParty.SetEditValue("")
                End If

                If EnableDisable Then

                    lblOperator.Text = "Consignee"
                    cmbOperator.Tag = "Consignee"

                    Query = "Select LED_KEY, LED_NAME " _
                         & " From Ledger " _
                         & " Where Led_Cat In('C','D') And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                         & " Order By Led_Name"
                    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")

                    cmbOperator.Enabled = True

                Else
                    cmbOperator.Enabled = False
                End If

            Case "BROKER"

                pnlParty.Enabled = EnableDisable

                If Not pnlParty.Enabled Then
                    cmbState.SetEditValue("")
                    cmbDistrict.SetEditValue("")
                    cmbCity.SetEditValue("")
                    cmbStation.SetEditValue("")
                    cmbParty.SetEditValue("")
                End If

                If EnableDisable Then

                    lblOperator.Text = "Broker"
                    cmbOperator.Tag = "Broker"

                    Query = "Select LED_KEY, LED_NAME " _
                         & " From Ledger " _
                         & " Where Led_Cat = 'B' And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                         & " Order By Led_Name"
                    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")

                    cmbOperator.Enabled = True

                Else
                    cmbOperator.Enabled = False
                End If

        End Select


        If Not EnableDisable Then
            If lstOption1.Items.Count > 0 Then
                If HasProduct(lstOption1.Items(0)) Then
                    pnlProduct.Enabled = True
                End If

                If HasParty(lstOption1.Items(0)) Then
                    pnlParty.Enabled = True
                End If

                If UCase(lstOption1.Items(0)) = UCase(GetSystemCaption(SystemCaptionIdx.DefLocation)) Then
                    cmbLocation.Enabled = True
                End If

                If UCase(lstOption1.Items(0)) = "SALESPERSON" Then
                    If rptType = ReportType.MonthlySalesSaleperson Then
                        cmbTax.Enabled = True
                    Else
                        cmbOperator.Enabled = True
                    End If
                End If
            End If

            If lstOption2.Items.Count > 0 Then
                If HasProduct(lstOption2.Items(0)) Then
                    pnlProduct.Enabled = True
                End If

                If HasParty(lstOption2.Items(0)) Then
                    pnlParty.Enabled = True
                End If

                If UCase(lstOption2.Items(0)) = UCase(GetSystemCaption(SystemCaptionIdx.DefLocation)) Then
                    cmbLocation.Enabled = True
                End If

                If UCase(lstOption2.Items(0)) = "SALESPERSON" Then
                    If rptType = ReportType.MonthlySalesSaleperson Then
                        cmbTax.Enabled = True
                    Else
                        cmbOperator.Enabled = True
                    End If
                End If
            End If

            If lstOption3.Items.Count > 0 Then
                If HasProduct(lstOption3.Items(0)) Then
                    pnlProduct.Enabled = True
                End If

                If HasParty(lstOption3.Items(0)) Then
                    pnlParty.Enabled = True
                End If

                If UCase(lstOption3.Items(0)) = UCase(GetSystemCaption(SystemCaptionIdx.DefLocation)) Then
                    cmbLocation.Enabled = True
                End If

                If UCase(lstOption3.Items(0)) = "SALESPERSON" Then
                    If rptType = ReportType.MonthlySalesSaleperson Then
                        cmbTax.Enabled = True
                    Else
                        cmbOperator.Enabled = True
                    End If
                End If
            End If

            If lstDetails.Items.Count > 0 Then
                If HasProduct(lstDetails.Items(0)) Then
                    pnlProduct.Enabled = True
                End If

                If HasParty(lstDetails.Items(0)) Then
                    pnlParty.Enabled = True
                End If

                If UCase(lstDetails.Items(0)) = UCase(GetSystemCaption(SystemCaptionIdx.DefLocation)) Then
                    cmbLocation.Enabled = True
                End If

                If UCase(lstDetails.Items(0)) = "SALESPERSON" Then
                    If rptType = ReportType.MonthlySalesSaleperson Then
                        cmbTax.Enabled = True
                    Else
                        cmbOperator.Enabled = True
                    End If
                End If
            End If

            If lstDetails.Items.Count > 1 Then
                If HasProduct(lstDetails.Items(1)) Then
                    pnlProduct.Enabled = True
                End If

                If HasParty(lstDetails.Items(1)) Then
                    pnlParty.Enabled = True
                End If

                If UCase(lstDetails.Items(1)) = UCase(GetSystemCaption(SystemCaptionIdx.DefLocation)) Then
                    cmbLocation.Enabled = True
                End If

                If UCase(lstDetails.Items(1)) = "SALESPERSON" Then
                    If rptType = ReportType.MonthlySalesSaleperson Then
                        cmbTax.Enabled = True
                    Else
                        cmbOperator.Enabled = True
                    End If
                End If
            End If

            If lstDetails.Items.Count > 2 Then
                If HasProduct(lstDetails.Items(2)) Then
                    pnlProduct.Enabled = True
                End If

                If HasParty(lstDetails.Items(2)) Then
                    pnlParty.Enabled = True
                End If

                If UCase(lstDetails.Items(2)) = UCase(GetSystemCaption(SystemCaptionIdx.DefLocation)) Then
                    cmbLocation.Enabled = True
                End If

                If UCase(lstDetails.Items(2)) = "SALESPERSON" Then
                    If rptType = ReportType.MonthlySalesSaleperson Then
                        cmbTax.Enabled = True
                    Else
                        cmbOperator.Enabled = True
                    End If
                End If
            End If
        End If
    End Sub

    Private Function HasProduct(ByVal Text As String) As Boolean
        Text = Text.ToUpper

        If Text = UCase(GetSystemCaption(SystemCaptionIdx.DefSection)) Or Text = UCase(GetSystemCaption(SystemCaptionIdx.DefGroup)) Or Text = UCase(GetSystemCaption(SystemCaptionIdx.DefSubGroup)) Or Text = UCase(GetSystemCaption(SystemCaptionIdx.DefProduct)) Or Text = UCase(GetSystemCaption(SystemCaptionIdx.DefArticle)) Or Text = UCase(GetSystemCaption(SystemCaptionIdx.DefType)) Or Text = UCase(GetSystemCaption(SystemCaptionIdx.DefShade)) Or Text = UCase(GetSystemCaption(SystemCaptionIdx.DefSize)) Or Text = UCase(GetSystemCaption(SystemCaptionIdx.DefBrand)) Or Text = UCase(GetSystemCaption(SystemCaptionIdx.DefQuality)) Or Text = UCase(GetSystemCaption(SystemCaptionIdx.DefSeason)) Or Text = UCase(GetSystemCaption(SystemCaptionIdx.DefOccassion)) Or Text = "BARCODE" Then
            Return True
        End If

        Return False
    End Function

    Private Function HasParty(ByVal Text As String) As Boolean
        Text = Text.ToUpper

        If Text = "SUPPLIER" Or Text = "CUSTOMER" Or Text = "PARTY" Or Text = "CONSIGNEE" Or Text = "BROKER" Or Text = "SALES PERSON" Then
            Return True
        End If

        Return False
    End Function

    Private Function ProductType() As OptionType
        Return CurrOptionType = OptionType.Section _
            Or CurrOptionType = OptionType.Group Or CurrOptionType = OptionType.SubGroup _
            Or CurrOptionType = OptionType.Product Or CurrOptionType = OptionType.Style _
            Or CurrOptionType = OptionType.Type Or CurrOptionType = OptionType.Shade _
            Or CurrOptionType = OptionType.Size Or CurrOptionType = OptionType.Brand _
            Or CurrOptionType = OptionType.Quality _
            Or CurrOptionType = OptionType.Season Or CurrOptionType = OptionType.Occassion _
            Or CurrOptionType = OptionType.Location
    End Function

    Private Sub lstMain_MouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles lstMain.MouseDown
        ' Set a flag to show that the mouse is down.
        MouseIsDown = True
    End Sub

    Private Sub lstMain_MouseMove(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles lstMain.MouseMove
        If MouseIsDown Then
            ' Initiate dragging.
            lstMain.DoDragDrop(lstMain.Text, DragDropEffects.Copy)
        End If
        MouseIsDown = False
    End Sub

    Private Sub lstOption1_DragEnter(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstOption1.DragEnter
        ' Check the format of the data being dropped.
        If (e.Data.GetDataPresent(DataFormats.Text)) Then
            ' Display the copy cursor.
            e.Effect = DragDropEffects.Copy
        Else
            ' Display the no-drop cursor.
            e.Effect = DragDropEffects.None
        End If
    End Sub

    Private Sub lstoption1_DragDrop(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstOption1.DragDrop
        If lstOption1.Items.Count > 0 Or Not btnGrp1.Enabled Then Exit Sub

        lstOption1.Items.Add(e.Data.GetData(DataFormats.Text))
        EnableFilters(e.Data.GetData(DataFormats.Text), True)

        If lstOption1.Items.Count > 0 Then
            IsSupplier = False

            If UCase(lstOption1.Items(0)) = "CUSTOMER" Or UCase(lstOption1.Items(0)) = "PARTY" Or UCase(lstOption1.Items(0)) = "CONSIGNEE" Or UCase(lstOption1.Items(0)) = "BROKER" Or UCase(lstOption1.Items(0)) = "SALES PERSON" Then
                IsSupplier = False
                DisplayParty()
            ElseIf UCase(lstOption1.Items(0)) = "SUPPLIER" Then
                IsSupplier = True
                DisplayParty()
            End If
        End If
    End Sub

    Private Sub lstOption2_DragEnter(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstOption2.DragEnter
        ' Check the format of the data being dropped.
        If (e.Data.GetDataPresent(DataFormats.Text)) Then
            ' Display the copy cursor.
            e.Effect = DragDropEffects.Copy
        Else
            ' Display the no-drop cursor.
            e.Effect = DragDropEffects.None
        End If
    End Sub

    Private Sub lstoption2_DragDrop(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstOption2.DragDrop
        If lstOption2.Items.Count > 0 Or Not btnGrp2.Enabled Then Exit Sub

        lstOption2.Items.Add(e.Data.GetData(DataFormats.Text))
        EnableFilters(e.Data.GetData(DataFormats.Text), True)

        If lstOption2.Items.Count > 0 Then
            IsSupplier = False

            If UCase(lstOption2.Items(0)) = "CUSTOMER" Or UCase(lstOption2.Items(0)) = "PARTY" Or UCase(lstOption2.Items(0)) = "CONSIGNEE" Or UCase(lstOption2.Items(0)) = "BROKER" Or UCase(lstOption2.Items(0)) = "SALES PERSON" Then
                IsSupplier = False
                DisplayParty()
            ElseIf UCase(lstOption2.Items(0)) = "SUPPLIER" Then
                IsSupplier = True
                DisplayParty()
            End If
        End If
    End Sub

    Private Sub lstOption3_DragEnter(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstOption3.DragEnter
        ' Check the format of the data being dropped.
        If (e.Data.GetDataPresent(DataFormats.Text)) Then
            ' Display the copy cursor.
            e.Effect = DragDropEffects.Copy
        Else
            ' Display the no-drop cursor.
            e.Effect = DragDropEffects.None
        End If
    End Sub

    Private Sub lstoption3_DragDrop(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstOption3.DragDrop
        If lstOption3.Items.Count > 0 Or Not btnGrp3.Enabled Then Exit Sub

        'Dim Add As Boolean
        'If lstOption1.Enabled Then
        '    If UCase(lstOption1.Items(0)) <> UCase(e.Data.GetData(DataFormats.Text)) Then
        '        Add = True
        '    End If
        'End If

        'If lstOption2.Enabled Then
        '    If UCase(lstOption2.Items(0)) <> UCase(e.Data.GetData(DataFormats.Text)) Then
        '        Add = True
        '    End If
        'End If

        lstOption3.Items.Add(e.Data.GetData(DataFormats.Text))
        EnableFilters(e.Data.GetData(DataFormats.Text), True)

        If lstOption3.Items.Count > 0 Then
            IsSupplier = False

            If UCase(lstOption3.Items(0)) = "CUSTOMER" Or UCase(lstOption3.Items(0)) = "PARTY" Or UCase(lstOption3.Items(0)) = "CONSIGNEE" Or UCase(lstOption3.Items(0)) = "BROKER" Or UCase(lstOption2.Items(0)) = "SALES PERSON" Then
                IsSupplier = False
                DisplayParty()
            ElseIf UCase(lstOption3.Items(0)) = "SUPPLIER" Then
                IsSupplier = True
                DisplayParty()
            End If
        End If
    End Sub

    Private Sub lstDetails_DragEnter(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstDetails.DragEnter
        ' Check the format of the data being dropped.
        If (e.Data.GetDataPresent(DataFormats.Text)) Then
            ' Display the copy cursor.
            e.Effect = DragDropEffects.Copy
        Else
            ' Display the no-drop cursor.
            e.Effect = DragDropEffects.None
        End If
    End Sub

    Private Sub lstDetails_DragDrop(ByVal sender As Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles lstDetails.DragDrop
        If lstDetails.Items.Count = 3 Or Not btnDetail.Enabled Then Exit Sub

        If lstDetails.Items.Count < 3 Then
            Dim Idx As Byte
            Dim Found As Boolean
            Dim Text As String = e.Data.GetData(DataFormats.Text)

            If lstDetails.Items.Count > 0 Then
                For Idx = 0 To lstDetails.Items.Count - 1
                    If UCase(lstDetails.Items(Idx)) = Text.ToUpper Then
                        Found = True
                        Exit For
                    End If
                Next Idx
            End If

            If Not Found Then
                'lstDetails.Items.Add(lstMain.SelectedItem)
                lstDetails.Items.Add(e.Data.GetData(DataFormats.Text))

                If lstDetails.Items.Count > 0 Then
                    For Idx = 0 To lstDetails.Items.Count - 1
                        If UCase(lstDetails.Items(Idx)) = "CUSTOMER" Or UCase(lstDetails.Items(Idx)) = "PARTY" Or UCase(lstDetails.Items(Idx)) = "CONSIGNEE" Or UCase(lstDetails.Items(Idx)) = "BROKER" Or UCase(lstOption2.Items(0)) = "SALES PERSON" Then
                            IsSupplier = False
                            DisplayParty()
                        ElseIf UCase(lstDetails.Items(Idx)) = "SUPPLIER" Then
                            IsSupplier = True
                            DisplayParty()
                        End If
                    Next Idx
                End If

                EnableFilters(lstDetails.Items(lstDetails.Items.Count - 1), True)
            End If
        End If
    End Sub

    Private Sub rdDetailed_CheckedChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles rdDetailed.CheckedChanged
        If rdDetailed.Checked And (TransType = TransactionType.ProcessIssue Or TransType = TransactionType.ProcessReceipt Or TransType = TransactionType.ProcessShortage Or TransType = TransactionType.SemiProcStkAtWarehouse Or TransType = TransactionType.ProcessStkWithParty Or TransType = TransactionType.Purchase) Then  'TransType = TransactionType.JobCard Or 
            If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                chkSize.Visible = True
            End If
        Else
            chkSize.Visible = False
        End If

        If rptType = ReportType.PurchaseRegister_OperatorWise Or rptType = ReportType.PurchaseRegister_CounterWise Or rptType = ReportType.PurchaseRegister_SupplierWise Or rptType = ReportType.PurchaseRegister_DateWise Or rptType = ReportType.PurchaseRegister_BillWise Or rptType = ReportType.PurchaseRegister_LocationWise Then
            If TypeOfEdition <> Edition.Standard Then
                If rdDetailed.Checked Then
                    pnlOtherOptions.Visible = True
                    rdOthOption3.Checked = True
                End If
            End If
        End If

        If rdDetailed.Checked And Not Loading Then
            If ProdRegister Then
                If lstDetails.Items.Count = 0 Then
                    If IsFabric Or TransType = TransactionType.FabricIssue Or TransType = TransactionType.FabricIssueBack Or TransType = TransactionType.FabricStkWithParty Then
                        ''CHANGE BY RAHUL ON 30/09/2019
                        ''lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefArticle))
                        ''lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefShade))
                        If rptType <> ReportType.StockLedgerAtJobber Then
                            lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefArticle))
                            lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefShade))
                        End If
                        ''END
                        

                    ElseIf IsStores Or TransType = TransactionType.StoresIssue Or TransType = TransactionType.StoresIssueBack Then
                        lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefShade))
                    Else
                        lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefArticle))
                        lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefType))
                        lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefShade))
                    End If

                    btnUp.Enabled = True
                    btnDown.Enabled = True
                    btnDetail.Enabled = True
                    btnDelDetail.Enabled = True
                    lstDetails.Enabled = True
                End If
            End If

            If StockRegister Then
                If IsFabric And TransType = TransactionType.Stock Then
                    lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefArticle))
                    lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefShade))

                ElseIf (IsStores Or IsPacking) And TransType = TransactionType.Stock Then
                    lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefProduct))
                    lstDetails.Items.Add(GetSystemCaption(SystemCaptionIdx.DefShade))
                End If

                If rptType = ReportType.OpeningStk_SubGroup Or rptType = ReportType.OpeningStk_Product Or rptType = ReportType.OpeningStk_Brand Or rptType = ReportType.OpeningStk_Location Or rptType = ReportType.ClosingStk_SubGroup Or rptType = ReportType.ClosingStk_Product Or rptType = ReportType.ClosingStk_Brand Or rptType = ReportType.ClosingStk_Location Or rptType = ReportType.ClosingStk_Supplier Then
                    chkSize.Visible = True
                    chkSize.Text = "Bale wise"
                End If

                btnUp.Enabled = True
                btnDown.Enabled = True
                btnDetail.Enabled = True
                btnDelDetail.Enabled = True
                lstDetails.Enabled = True
            End If
        ElseIf rdSummary.Checked And Not Loading Then
            If ProdRegister Then
                lstDetails.Items.Clear()

                btnUp.Enabled = False
                btnDown.Enabled = False
                btnDetail.Enabled = False
                btnDelDetail.Enabled = False
                lstDetails.Enabled = False
            End If
        End If

        If TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseRtn Or TransType = TransactionType.Sales Or TransType = TransactionType.SalesRtn Or TransType = TransactionType.SalesOrder Or TransType = TransactionType.Delivery Or TransType = TransactionType.SaleBill Then
            If rdDetailed.Checked Then
                chkDispRate.Checked = False
                chkDispRate.Visible = False
            Else
                If rdDetailed.Enabled Then chkDispRate.Visible = True
            End If
        End If

        If rptType = ReportType.SalesRegister_SupplierWise Then
            If rdDetailed.Checked Then
                chkData.Checked = False
                chkChart.Checked = False

                chkData.Visible = False
                chkChart.Visible = False
            Else
                chkData.Checked = True
                chkChart.Checked = False

                chkData.Visible = True
                chkChart.Visible = True
            End If
        End If

        If rptType = ReportType.SalesOrderRegister_BillWise Or rptType = ReportType.SalesOrderRegister_DateWise Or rptType = ReportType.SalesOrderRegister_PartyWise Or rptType = ReportType.StockReadyToDispatch Or rptType = ReportType.SalesOrderRegister_ProductWise Or rptType = ReportType.SalesOrderRegister_PartyProdWise Or rptType = ReportType.SalesOrderRegister_ConsigneeWise Or rptType = ReportType.SalesOrderRegister_ConsigneeProdWise _
          Or rptType = ReportType.SalesOrderRegister_BrandWise Or rptType = ReportType.SalesOrderRegister_BrokerWise Or rptType = ReportType.PendSalesOrderRegister_BillWise Or rptType = ReportType.PendSalesOrderRegister_BrandWise Or rptType = ReportType.PendSalesOrderRegister_BrokerWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeProdWise Or rptType = ReportType.PendSalesOrderRegister_ConsigneeWise _
           Or rptType = ReportType.PendSalesOrderRegister_DateWise Or rptType = ReportType.PendSalesOrderRegister_PartyProdWise Or rptType = ReportType.PendSalesOrderRegister_PartyWise Or rptType = ReportType.PendSalesOrderRegister_ProductWise Then 'Or rptType = ReportType.ServiceJobOrderRegister_DateWise Or rptType = ReportType.ServiceJobOrderRegister_BillWise Or rptType = ReportType.ServiceJobOrderRegister_PartyWise Or rptType = ReportType.ServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.ServiceJobOrderRegister_ProductWise Or rptType = ReportType.PendServiceJobOrderRegister_DateWise Or rptType = ReportType.PendServiceJobOrderRegister_BillWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyWise Or rptType = ReportType.PendServiceJobOrderRegister_PartyProdWise Or rptType = ReportType.PendServiceJobOrderRegister_ProductWise
            If rdDetailed.Checked = True Then
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                    chkSize.Visible = True
                End If
            End If
        End If

        If rptType = ReportType.PurOrderRegister_BillWise Or rptType = ReportType.PurOrderRegister_DateWise Or rptType = ReportType.PurOrderRegister_SupplierWise _
         Or rptType = ReportType.PurOrderRegister_BrandWise Or rptType = ReportType.PurOrderRegister_ProductWise Or rptType = ReportType.PurOrderRegister_SubGroupWise _
         Or rptType = ReportType.PendPurOrderRegister_BillWise Or rptType = ReportType.PendPurOrderRegister_DateWise Or rptType = ReportType.PendPurOrderRegister_SupplierWise _
         Or rptType = ReportType.PendPurOrderRegister_BrandWise Or rptType = ReportType.PendPurOrderRegister_ProductWise Or rptType = ReportType.PendPurOrderRegister_SubGroupWise Then
            If rdDetailed.Checked = True Then
                If CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenUseSize))) = True Then
                    chkSize.Visible = True
                End If
                If IsFabric = True Then
                    If rptType = ReportType.PurOrderRegister_BillWise Or rptType = ReportType.PurOrderRegister_DateWise Or rptType = ReportType.PurOrderRegister_SupplierWise Or rptType = ReportType.PendPurOrderRegister_BillWise Or rptType = ReportType.PendPurOrderRegister_DateWise Or rptType = ReportType.PendPurOrderRegister_SupplierWise Then
                        chkSize.Text = "View Remark"
                    Else
                        chkSize.Visible = False
                    End If
                End If
                If IsPacking = True Then
                    chkSize.Visible = False
                End If
            End If
        End If

        'If rptType <> ReportType.SalesTaxRegister_DocWise Then
        '    chkDispRate.Visible = Not rdDetailed.Checked
        'End If

        If rptType = ReportType.Karigar_Salary Then
            chkSize.Visible = True
            chkSize.Checked = False
            chkSize.Text = "Zero Rate"
        End If

        If rptType = ReportType.PurbillRegister_DateWise Then ''ankita 25042019
            If rdDetailed.Checked Then
                chkDispRate.Visible = False
                chkDispValue.Visible = False

                '' CHANGE BY RAHUL ON 10/06/2019
                IsFabric = False
                pnlProduct.Enabled = True
                lblDesign.Enabled = False : cmbStyle.Enabled = False
                lblShade.Enabled = False : cmbShade.Enabled = False
                lblType.Enabled = False : cmbType.Enabled = False
                lblSize.Enabled = False : cmbSize.Enabled = False
                lblQuality.Enabled = False : cmbQuality.Enabled = False
                lblSeason.Enabled = False : cmbSeason.Enabled = False
                lblOccassion.Enabled = False : cmbOccassion.Enabled = False
                lblLocation.Enabled = False : cmbLocation.Enabled = False
                lblBrand.Enabled = False : cmbBrand.Enabled = False
                FillProductAttribCombos()
                '' END
            Else
                chkDispRate.Visible = True
                chkDispValue.Visible = True

                '' CHANGE BY RAHUL ON 10/06/2019
                IsFabric = True
                pnlProduct.Enabled = False
                ClearDropDown(cmbProduct) : ClearDropDown(cmbProductSubGrp) : ClearDropDown(cmbProductGrp)
                '' END
            End If
        End If

        If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForTJS)) = 1 Then
            If rptType = ReportType.SalesBillRegister_BrokerWise Then 'Suraj 08 04 2024
                If rdDetailed.Checked Then
                    pnlProduct.Enabled = True
                    lblSize.Enabled = False : cmbSize.Enabled = False
                    lblBrand.Enabled = False : cmbBrand.Enabled = False
                Else
                    pnlProduct.Enabled = False
                End If
            End If

        End If

    End Sub

    Private Sub rdSummary_CheckedChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles rdSummary.CheckedChanged
        If rptType = ReportType.PurchaseRegister_OperatorWise Or rptType = ReportType.PurchaseRegister_CounterWise Or rptType = ReportType.PurchaseRegister_SupplierWise Or rptType = ReportType.PurchaseRegister_DateWise Or rptType = ReportType.PurchaseRegister_BillWise Or rptType = ReportType.PurchaseRegister_LocationWise Or rptType = ReportType.PurRegister_DateWise Then
            pnlOtherOptions.Visible = False
        End If

        If rptType = ReportType.Karigar_Salary Then
            chkSize.Visible = False
            chkSize.Checked = False
            chkSize.Text = ""
        End If

        If rptType = ReportType.StockLedgerAtJobber Then
            chkSize.Visible = True
        End If
        If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
            chkSize.Visible = True
        End If

        If Val(GetSettingAsPerId(ApplnSettingsIdx.HetherGrey)) = 1 And rptType = ReportType.SalesOrderReport Or rptType = ReportType.SalesInvoiceReport Then  'Rajashri-28-01-2022
            chkSize.Visible = True
            chkSize.Enabled = True
        End If

        DisplayDetailsCheck()
        If rptType = ReportType.OpeningStk_SubGroup Or rptType = ReportType.OpeningStk_Product Or rptType = ReportType.OpeningStk_Brand Or rptType = ReportType.OpeningStk_Location Or rptType = ReportType.ClosingStk_SubGroup Or rptType = ReportType.ClosingStk_Product Or rptType = ReportType.ClosingStk_Brand Or rptType = ReportType.ClosingStk_Location Or rptType = ReportType.ClosingStk_Supplier Then
            chkSize.Visible = True
            chkSize.Text = "Bale wise"
        End If
        If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
            If rptType = ReportType.PurOrderRegister_SupplierWise Then
                chkDispRate.Visible = False
            End If
        End If
    End Sub

    Private Function GetQtyFilter(ByVal Field As String) As String
        Dim QtyFilter As String = ""

        If cmbDisplay.SelectedIndex = 0 Then ''All

        ElseIf cmbDisplay.SelectedIndex = 1 Then ''Equal To
            QtyFilter = " And " & Field & " = " & txtStkFrom.EditValue
        ElseIf cmbDisplay.SelectedIndex = 2 Then ''Greater Than
            QtyFilter = " And " & Field & " > " & txtStkFrom.EditValue
        ElseIf cmbDisplay.SelectedIndex = 3 Then ''Less Than
            QtyFilter = " And " & Field & " < " & txtStkFrom.EditValue
        ElseIf cmbDisplay.SelectedIndex = 4 Then ''Range
            QtyFilter = " And (" & Field & " >= " & txtStkFrom.EditValue & " And " & Field & " <= " & txtStkTo.EditValue & ")"
        End If

        Return QtyFilter
    End Function


    '''''''''''''''Added by Pooja on 30-10-2017--------------------------
    Private Function GetConsignnFltr(ByVal Combo As Object, ByVal FieldName As String)
        Dim SelectedItems As String = ""
        Dim AllItems As String = ""
        Dim SelValues As String = ""

        SelectedItems = Combo.Properties.GetCheckedItems
        AllItems = SelectedList(Combo, SelectedItems)

        If AllItems <> "" Then
            SelValues = " And " & FieldName & " In [" & AllItems & "]"
        Else
            SelValues = ""
        End If

        Return SelValues
    End Function



    Private Function SelectedMonth() As String
        Dim CurrMth As String = ""
        Dim i As Byte

        If cmbOperator.Properties.GetItems.GetCheckedValues.Count = 0 Then Return "[1,2,3,4,5,6,7,8,9,10,11,12]"

        For i = 0 To cmbOperator.Properties.Items.Count - 1
            If cmbOperator.Properties.Items(i).CheckState = CheckState.Checked Then
                If cmbOperator.Properties.Items(i).Value.ToUpper = "JANUARY" Then
                    CurrMth &= "1,"
                ElseIf cmbOperator.Properties.Items(i).Value.ToUpper = "FEBRUARY" Then
                    CurrMth &= "2,"
                ElseIf cmbOperator.Properties.Items(i).Value.ToUpper = "MARCH" Then
                    CurrMth &= "3,"
                ElseIf cmbOperator.Properties.Items(i).Value.ToUpper = "APRIL" Then
                    CurrMth &= "4,"
                ElseIf cmbOperator.Properties.Items(i).Value.ToUpper = "MAY" Then
                    CurrMth &= "5,"
                ElseIf cmbOperator.Properties.Items(i).Value.ToUpper = "JUNE" Then
                    CurrMth &= "6,"
                ElseIf cmbOperator.Properties.Items(i).Value.ToUpper = "JULY" Then
                    CurrMth &= "7,"
                ElseIf cmbOperator.Properties.Items(i).Value.ToUpper = "AUGUST" Then
                    CurrMth &= "8,"
                ElseIf cmbOperator.Properties.Items(i).Value.ToUpper = "SEPTEMBER" Then
                    CurrMth &= "9,"
                ElseIf cmbOperator.Properties.Items(i).Value.ToUpper = "OCTOBER" Then
                    CurrMth &= "10,"
                ElseIf cmbOperator.Properties.Items(i).Value.ToUpper = "NOVEMBER" Then
                    CurrMth &= "11,"
                ElseIf cmbOperator.Properties.Items(i).Value.ToUpper = "DECEMBER" Then
                    CurrMth &= "12,"
                End If
            End If
        Next i

        If CurrMth.Trim.Length > 0 Then
            CurrMth = "[" & Mid$(CurrMth, 1, Len(CurrMth) - 1) & "]"
        End If

        Return CurrMth
    End Function

    Private Function GetSelectFields(ByVal Field As String, ByRef GroupBy As String) As String
        Dim NewCaption As String = ""

        Select Case Field.ToUpper
            Case UCase(GetSystemCaption(SystemCaptionIdx.DefSection))
                GroupBy = "Sect.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefSection)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "Sect.Abbr " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefGroup))
                GroupBy = "ItemGrp.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefGroup)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "ItemGrp.Abbr " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefSubGroup))
                GroupBy = "ItemSubGrp.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefSubGroup)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "ItemSubGrp.Abbr " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefProduct))
                GroupBy = "Item.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefProduct)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "Item.Abbr " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefArticle))
                GroupBy = "Style.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefArticle)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "Style.Abbr " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefType))
                GroupBy = "Type.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefType)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "Type.Abbr " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefShade))
                GroupBy = "Shade.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefShade)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "Shade.Abbr " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefSize))
                GroupBy = "ItemSize.Size_Name"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefSize)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "ItemSize.Size_Name " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefBrand))
                GroupBy = "Brand.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefBrand)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "Brand.Abbr " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefQuality))
                GroupBy = "Quality.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefQuality)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "Quality.Abbr " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefSeason))
                GroupBy = "Season.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefSeason)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "Season.Abbr " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefOccassion))
                GroupBy = "Occassion.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefOccassion)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "Occassion.Abbr " & NewCaption

            Case UCase(GetSystemCaption(SystemCaptionIdx.DefLocation))
                GroupBy = "Location.Abbr"
                NewCaption = GetSystemCaption(SystemCaptionIdx.DefLocation)
                NewCaption = "[" & NewCaption & "]"
                'NewCaption = Replace(NewCaption, "-", "")
                'NewCaption = Replace(NewCaption, "_", "")
                'NewCaption = Replace(NewCaption, " ", "")
                Return "Location.Abbr " & NewCaption

            Case "SUPPLIER"
                GroupBy = "Supplier.Abbr"
                Return "Supplier.Abbr Supplier"

            Case "BARCODE"
                GroupBy = "ItemStock.Barcode"
                Return "ItemStock.Barcode"

            Case "CUSTOMER"
                GroupBy = "Supplier.Abbr"
                Return "Supplier.Abbr Supplier"

            Case "PARTY"
                GroupBy = "Supplier.Abbr"
                Return "Supplier.Abbr Supplier"



        End Select
        Return Nothing
    End Function

    Private Sub lstMain_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles lstMain.SelectedIndexChanged
        If lstMain.SelectedIndex = -1 Then Exit Sub

        'If lstMain.Text.ToUpper = "DATE WISE" Then
        '    chkDispValue.Visible = False
        '    Exit Sub
        'Else
        '    chkDispValue.Visible = True
        'End If

        Try
            Me.Cursor = Cursors.WaitCursor

            If IsRegister Then
                pnlDate.Enabled = True
                cmbTax.Enabled = False : cmbLocation.Enabled = False
                cmbOperator.Enabled = False
                pnlParty.Enabled = False

                If DispDetailSummary = DetailSummary.Yes Then
                    pnlSummaryDetail.Enabled = True
                    Plnitemdetils.Enabled = True
                Else
                    pnlSummaryDetail.Enabled = False
                    Plnitemdetils.Enabled = False
                End If

                cmbState.SetEditValue("")
                'cmbDistrict.SetEditValue("")
                'cmbCity.SetEditValue("")
                'cmbStation.SetEditValue("")
                'cmbParty.SetEditValue("")

                cmbDistrict.Properties.DataSource = Nothing
                cmbDistrict.SetEditValue("")
                ClearDropDown(cmbDistrict)

                cmbCity.Properties.DataSource = Nothing
                cmbCity.SetEditValue("")
                ClearDropDown(cmbCity)

                cmbStation.Properties.DataSource = Nothing
                cmbStation.SetEditValue("")
                ClearDropDown(cmbStation)

                cmbParty.Properties.DataSource = Nothing
                cmbParty.SetEditValue("")
                ClearDropDown(cmbParty)

                cmbOperator.SetEditValue("")
                cmbLocation.SetEditValue("")

                If lstMain.Text.ToUpper = "DATE WISE" Then
                    chkDispValue.Visible = False
                Else
                    If DisplayRateValue Then
                        chkDispValue.Visible = True
                    End If
                End If

                If lstMain.Text.ToUpper = "OPERATOR" Then
                    lblOperator.Text = "Operator"
                    cmbOperator.Enabled = True

                    Query = "Select USER_ID, LED_NAME " _
                        & " From Users Inner Join Ledger On Users.Led_Key = Ledger.Led_Key " _
                        & " Where Users.Status = '1' And Users.Login_Name <> '' " & BranchLedFixFilter _
                        & " Order By Ledger.Led_Name"
                    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "USER_ID")

                ElseIf lstMain.Text.ToUpper = UCase(GetSystemCaption(SystemCaptionIdx.DefLocation)) Then
                    cmbLocation.Enabled = True

                ElseIf lstMain.Text.ToUpper = "COUNTER" Then
                    lblOperator.Text = "Counter"
                    cmbOperator.Enabled = True

                    Query = "Select CTR_KEY, ABBR From Counter " _
                        & " Where Status = '1' And Abbr <> '' " _
                        & BranchFilter _
                        & " Order By Abbr"
                    Common.FillCheckBoxCombo(Query, cmbOperator, "ABBR", "CTR_KEY")

                ElseIf lstMain.Text.ToUpper = "SUPPLIER" Or lstMain.Text.ToUpper = "CUSTOMER" Or lstMain.Text.ToUpper = "PARTY" Then
                    pnlParty.Enabled = True
                    DisplayParty()

                ElseIf lstMain.Text.ToUpper = "CONSIGNEE" Then
                    pnlParty.Enabled = True
                    DisplayParty()

                    lblOperator.Text = "Consignee"
                    cmbOperator.Tag = "Consignee"
                    cmbOperator.Enabled = True

                    Query = "Select LED_KEY, LED_NAME " _
                          & " From Ledger " _
                          & " Where Led_Cat In('C','D') And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                          & " Order By Led_Name"
                    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")

                ElseIf lstMain.Text.ToUpper = "BROKER" Then
                    pnlParty.Enabled = True
                    DisplayParty()

                    lblOperator.Text = "Broker"
                    cmbOperator.Tag = "Broker"
                    cmbOperator.Enabled = True

                    Query = "Select LED_KEY, LED_NAME " _
                          & " From Ledger " _
                          & " Where Led_Cat = 'B' And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                          & " Order By Led_Name"
                    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")

                ElseIf lstMain.Text.ToUpper = "SALES PERSON" Then
                    pnlParty.Enabled = True
                    DisplayParty()

                    lblOperator.Text = "Sales Person"
                    cmbOperator.Tag = "SalesPerson"
                    cmbOperator.Enabled = True

                    Query = "Select LED_KEY, LED_NAME " _
                          & " From Ledger " _
                          & " Where Led_Cat ='S' And Status =  '1' And Led_Name <> '' " & BranchLedFixFilter _
                          & " Order By Led_Name"
                    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")


                End If

                DisplayDetailsCheck()

            ElseIf StockRegister Then
                'cmbState.SetEditValue("")

                'cmbDistrict.Properties.DataSource = Nothing
                'cmbDistrict.SetEditValue("")
                'ClearDropDown(cmbDistrict)

                'cmbCity.Properties.DataSource = Nothing
                'cmbCity.SetEditValue("")
                'ClearDropDown(cmbCity)

                'cmbStation.Properties.DataSource = Nothing
                'cmbStation.SetEditValue("")
                'ClearDropDown(cmbStation)

                'cmbParty.Properties.DataSource = Nothing
                'cmbParty.SetEditValue("")
                'ClearDropDown(cmbParty)

                'cmbOperator.SetEditValue("")
                'cmbLocation.SetEditValue("")

                'If lstMain.Text.ToUpper = "OPERATOR" Then
                '    lblOperator.Text = "Operator"
                '    cmbOperator.Enabled = True

                '    Query = "Select USER_ID, LED_NAME " _
                '        & " From Users Inner Join Ledger On Users.Led_Key = Ledger.Led_Key " _
                '        & " Where Users.Status = '1' And Users.Login_Name <> '' " _
                '        & " Order By Ledger.Led_Name"
                '    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "USER_ID")

                'ElseIf lstMain.Text.ToUpper = UCase(GetSystemCaption(SystemCaptionIdx.DefLocation)) Then
                '    cmbLocation.Enabled = True

                'ElseIf lstMain.Text.ToUpper = "COUNTER" Then
                '    lblOperator.Text = "Counter"
                '    cmbOperator.Enabled = True

                '    Query = "Select CTR_KEY, ABBR From Counter " _
                '        & " Where Status = '1' And Abbr <> '' " _
                '        & BranchFilter _
                '        & " Order By Abbr"
                '    Common.FillCheckBoxCombo(Query, cmbOperator, "ABBR", "CTR_KEY")

                'ElseIf lstMain.Text.ToUpper = "SUPPLIER" Or lstMain.Text.ToUpper = "CUSTOMER" Then
                '    pnlParty.Enabled = True
                '    DisplayParty()
                'End If

                Exit Sub
            End If

        Finally
            Me.Cursor = Cursors.Default
        End Try

        'If lstMain.Text.ToUpper = "OPERATOR" Then
        '    pnlDate.Enabled = True
        '    'pnlUserCounter.Enabled = True
        '    '27/12/2011
        '    cmbOperator.Enabled = True
        '    pnlParty.Enabled = False
        '    cmbTax.Enabled = False
        '    pnlSummaryDetail.Enabled = True
        '    lblOperator.Visible = True : cmbOperator.Visible = True
        '    lblOperator.Text = "Operator"
        '    pnlProduct.Enabled = False

        '    Query = "Select USER_ID, LED_NAME " _
        '        & " From Users Inner Join Ledger On Users.Led_Key = Ledger.Led_Key " _
        '        & " Where Users.Status = '1' And Users.Login_Name <> '' " _
        '        & " Order By Ledger.Led_Name"
        '    Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "USER_ID")

        'ElseIf lstMain.Text.ToUpper = "COUNTER" Then
        '    pnlDate.Enabled = True
        '    pnlParty.Enabled = False
        '    cmbTax.Enabled = False
        '    pnlSummaryDetail.Enabled = True
        '    lblOperator.Visible = True : cmbOperator.Visible = True
        '    lblOperator.Text = "Counter"
        '    pnlProduct.Enabled = False

        '    Query = "Select CTR_KEY, ABBR From Counter " _
        '        & " Where Status = '1' And Abbr <> '' " _
        '        & BranchFilter _
        '        & " Order By Abbr"
        '    Common.FillCheckBoxCombo(Query, cmbOperator, "ABBR", "CTR_KEY")

        '    If Not CBool(Val(GetSettingAsPerId(ApplnSettingsIdx.GenMutiCounter))) Then
        '        'pnlUserCounter.Enabled = False
        '        '27/12/2011
        '        cmbOperator.Enabled = False
        '    Else
        '        'pnlUserCounter.Enabled = True
        '        '27/12/2011
        '        cmbOperator.Enabled = True
        '    End If

        'ElseIf lstMain.Text.ToUpper = "CUSTOMER" Then
        '    If CurrOptionType <> OptionType.Product And CurrOptionType <> OptionType.Tax Then
        '        pnlDate.Enabled = True
        '        'pnlUserCounter.Enabled = False
        '        '27/12/2011
        '        cmbOperator.Enabled = False
        '        pnlParty.Enabled = True
        '        cmbTax.Enabled = False
        '        pnlSummaryDetail.Enabled = True
        '        pnlProduct.Enabled = False
        '    End If

        'ElseIf lstMain.Text.ToUpper = "SUPPLIER" Then
        '    pnlDate.Enabled = True
        '    'pnlUserCounter.Enabled = False
        '    '27/12/2011
        '    cmbOperator.Enabled = False
        '    pnlParty.Enabled = True
        '    cmbTax.Enabled = False
        '    pnlSummaryDetail.Enabled = True
        '    pnlProduct.Enabled = False

        'ElseIf lstMain.Text.ToUpper = "BILL WISE" Or lstMain.Text.ToUpper = "DATE WISE" Or lstMain.Text.ToUpper = "LOCATION" Then
        '    pnlDate.Enabled = True
        '    'pnlUserCounter.Enabled = False
        '    '27/12/2011
        '    cmbOperator.Enabled = False
        '    pnlParty.Enabled = False
        '    pnlProduct.Enabled = False

        'ElseIf lstMain.Text.ToUpper = "SECTION" Or lstMain.Text.ToUpper = "GROUP" Or lstMain.Text.ToUpper = "SUBGROUP" Or lstMain.Text.ToUpper = "PRODUCT" Or lstMain.Text.ToUpper = "DESIGN" Or lstMain.Text.ToUpper = "TYPE" Or lstMain.Text.ToUpper = "SHADE" Or lstMain.Text.ToUpper = "SIZE" Or lstMain.Text.ToUpper = "BRAND" Or lstMain.Text.ToUpper = "QUALITY" Or lstMain.Text.ToUpper = "SEASON" Or lstMain.Text.ToUpper = "OCCASSION" Or lstMain.Text.ToUpper = "LOCATION" Then
        '    pnlDate.Enabled = True
        '    'pnlUserCounter.Enabled = False
        '    '27/12/2011
        '    cmbOperator.Enabled = False
        '    pnlParty.Enabled = False
        '    pnlProduct.Enabled = True
        'End If
    End Sub

    Private Sub OptionForFilter()

        If btnGrp1.Enabled Then
            If lstOption1.Items.Count > 0 Then
                If UCase(lstOption1.Items(0)) = "CUSTOMER" Or UCase(lstOption1.Items(0)) = "PARTY" Then
                    IsSupplier = False
                ElseIf UCase(lstOption1.Items(0)) = "SUPPLIER" Then
                    IsSupplier = True
                End If
            End If
        End If

        If btnGrp2.Enabled Then
            If lstOption2.Items.Count > 0 Then
                If UCase(lstOption2.Items(0)) = "CUSTOMER" Or UCase(lstOption2.Items(0)) = "PARTY" Then
                    IsSupplier = False
                ElseIf UCase(lstOption2.Items(0)) = "SUPPLIER" Then
                    IsSupplier = True
                End If
            End If
        End If

        If btnGrp3.Enabled Then
            If lstOption3.Items.Count > 0 Then
                If UCase(lstOption3.Items(0)) = "CUSTOMER" Or UCase(lstOption3.Items(0)) = "PARTY" Then
                    IsSupplier = False
                ElseIf UCase(lstOption3.Items(0)) = "SUPPLIER" Then
                    IsSupplier = True
                End If
            End If
        End If

        If btnDetail.Enabled Then
            If lstDetails.Items.Count > 0 Then
                For i As Byte = 0 To lstDetails.Items.Count - 1
                    If UCase(lstDetails.Items(0)) = "CUSTOMER" Or UCase(lstDetails.Items(0)) = "PARTY" Then
                        IsSupplier = False
                    ElseIf UCase(lstDetails.Items(0)) = "SUPPLIER" Then
                        IsSupplier = True
                    End If
                Next i
            End If
        End If

    End Sub

    Private Sub ClearPartyFilters()
        cmbDistrict.Properties.DataSource = Nothing
        cmbDistrict.SetEditValue("")
        ClearDropDown(cmbDistrict)

        cmbCity.Properties.DataSource = Nothing
        cmbCity.SetEditValue("")
        ClearDropDown(cmbCity)

        cmbStation.Properties.DataSource = Nothing
        cmbStation.SetEditValue("")
        ClearDropDown(cmbStation)

        cmbParty.Properties.DataSource = Nothing
        cmbParty.SetEditValue("")
        ClearDropDown(cmbParty)
    End Sub

    Private Sub DisplayDetailsCheck()
        If rptType = ReportType.PurOrderRegister_BillWise Or rptType = ReportType.PendPurOrderRegister_BillWise Or rptType = ReportType.PurchaseRegister_BillWise Or rptType = ReportType.PurRtnRegister_BillWise Or rptType = ReportType.SalesRegister_BillWise Or rptType = ReportType.SalesRtnRegister_BillWise Or rptType = ReportType.SalesOrderRegister_BillWise Or rptType = ReportType.PendSalesOrderRegister_BillWise Or rptType = ReportType.PackingRegister_BillWise Or rptType = ReportType.SalesBillRegister_BillWise Or rptType = ReportType.ServiceJobOrderRegister_BillWise Or rptType = ReportType.PendServiceJobOrderRegister_BillWise Or rptType = ReportType.ServiceChallanRegister_BillWise Or rptType = ReportType.ServiceBillRegister_BillWise Then
            chkDispRate.Visible = False
        Else
            'chkDispRate.Visible = True
        End If
        If rptType = ReportType.PendingOrderReport Then
            chkDispRate.Visible = False
        End If
        If lstMain.Visible Then
            If lstMain.SelectedIndex <> -1 Then
                If lstMain.Items(lstMain.SelectedIndex) = "Bill Wise" Then
                    chkDispRate.Visible = False
                Else
                    If rdSummary.Checked Then
                        chkDispRate.Visible = True
                    Else
                        chkDispRate.Visible = False
                    End If
                End If
            End If
        End If
    End Sub

    Private Sub rdAgeQty_CheckedChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles rdAgeQty.CheckedChanged, rdAgeValue.CheckedChanged
        If rptType = ReportType.StockAgingBrand Or rptType = ReportType.StockAgingBarcode Or rptType = ReportType.StockAgingLocation Or rptType = ReportType.StockAgingProduct Or rptType = ReportType.StockAgingSubGroup Or rptType = ReportType.StockAgingSupplier Then
            chkDispValue.Enabled = True

            If rdAgeQty.Checked Then
                chkDispValue.Enabled = False
            End If
        End If
    End Sub

    Private Sub DisplayChartOption()
        If TypeOfEdition = Edition.Enterprise Then
            chkData.Visible = True
            chkChart.Visible = True
            chkData.Checked = True
            chkChart.Checked = False
        End If
    End Sub

    Private Sub rdSummary_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles rdSummary.KeyDown, rdDetailed.KeyDown
        MoveToNextControl(e)
    End Sub

    Private Sub cmbSelection_LostFocus(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmbSelection.LostFocus
        ' MoveToNextControl(e)
    End Sub



    Private Sub cmbSelection_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmbSelection.SelectedIndexChanged
        chkSize.Checked = False
        If cmbSelection.Text = "B2C(Small)" Then
            chkSize.Visible = True
            chkSize.Text = "Include Return"
        Else
            chkSize.Visible = False
        End If
    End Sub

    Private Sub cmbProcessHoney_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbProcessHoney.Closed
        If cmbProcessHoney.IsModified Then
            cmbPartyHoney.Properties.DataSource = Nothing
            cmbPartyHoney.SetEditValue("")
            ClearDropDown(cmbPartyHoney)
            If cmbProcessHoney.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub
            DisplayPartyHoney()
        Else
            Query = "Select LED_KEY, LED_NAME " _
      & " From Ledger Where Led_Cat In ('J','A') And Status = '1' " _
      & BranchFixFilter _
      & " Order By Led_Name"
            Common.FillCheckBoxCombo(Query, cmbPartyHoney, "LED_NAME", "LED_KEY")
        End If
    End Sub


    Private Sub cmbOrderNo_Validated(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmbOrderNo.Validated
        'If cmbOrderNo.SelectedIndex = -1 Then cmbOrderNo.SelectedIndex = 0
    End Sub

    Private Sub cmbCountry_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbCountry.Closed ''ankita
        If cmbCountry.IsModified Then
            cmbState.Properties.DataSource = Nothing
            cmbState.SetEditValue("")
            ClearDropDown(cmbState)



            cmbStation.Properties.DataSource = Nothing
            cmbStation.SetEditValue("")
            ClearDropDown(cmbStation)

            cmbParty.Properties.DataSource = Nothing
            cmbParty.SetEditValue("")
            ClearDropDown(cmbParty)

            If rptType = ReportType.SalesOrderRegister_AllInOne Then
                cmbOperator.Properties.DataSource = Nothing
                cmbOperator.SetEditValue("")
                ClearDropDown(cmbOperator)
            End If

            'DisplayPartyHeather()
            'If cmbCountry.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub
            DisplayState()
            DisplayStation()
            DisplayPartyHeather()

            If rptType = ReportType.SalesOrderRegister_AllInOne Then
                DisplayConsigneeHeather()
            End If
        End If
    End Sub

    Private Sub ExportSalesorderDetailsNew(ByVal filter As String)
        'If CurrIntId = 0 Then Exit Sub

        'If MsgBox("Export Sales Order data ", MsgBoxStyle.Question + MsgBoxStyle.YesNo) = MsgBoxResult.No Then Exit Sub

        Try
            Query = " SELECT * FROM vw_SalesOrderDetails where " & filter & " Order by SaleOrder "


            Dim dt As DataTable = Common.GetDataTable(Query)

            If dt.Rows.Count > 0 Then

                Dim onlyfilename As String = "SalesOrderDetail_" + DateTime.Now.ToString("ddMMyyyyHHmmss") + ".xlsx"
                Dim downloadfolder As String = Application.StartupPath
                Dim excelfile As String = downloadfolder + "/" + onlyfilename
                Dim fl As New FileInfo(excelfile)

                ' If you are a commercial business and have
                ' purchased commercial licenses use the static property
                ' LicenseContext of the ExcelPackage class :

                'ExcelPackage.LicenseContext = LicenseContext.NonCommercial
                Dim pck As New ExcelPackage(fl)
                Dim ws As ExcelWorksheet = pck.Workbook.Worksheets.Add("Sales Order")
                ws.Cells("A1:Z1").Style.Font.Bold = True
                ws.Cells("A1").LoadFromDataTable(dt, True)
                'ws.Column(11).Style.Numberformat.Format = "0.00"
                'ws.Column(12).Style.Numberformat.Format = "0.00"
                'ws.Column(13).Style.Numberformat.Format = "0.00"
                'ws.Column(14).Style.Numberformat.Format = "0.00"
                'ws.Column(15).Style.Numberformat.Format = "0.00"
                'ws.Column(16).Style.Numberformat.Format = "0.00"
                'ws.Column(17).Style.Numberformat.Format = "0.00"
                'ws.Column(18).Style.Numberformat.Format = "0.00"
                'ws.Column(19).Style.Numberformat.Format = "0.00"
                'ws.Column(20).Style.Numberformat.Format = "0.00"
                'ws.Column(21).Style.Numberformat.Format = "dd/MM/yyyy"
                'ws.Column(2).Style.Numberformat.Format = "dd/MM/yyyy"
                ws.Cells(ws.Dimension.Address).AutoFitColumns()
                pck.Save()

                MsgBox("Data successfully exported." & excelfile, MsgBoxStyle.Information)



            End If

        Catch sqlEx As SqlException
            Common.LogAndDisplayException(sqlEx)
        Catch ex As Exception
            Common.LogAndDisplayException(ex)
        Finally
            Me.Cursor = Cursors.Default
        End Try


    End Sub



    Private Sub ExportSalesorderDetails(ByVal filter As String)
        Dim Trans As SqlTransaction
        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
        Dim xlApp As New Excel.Application
        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
        Dim Reg As String = ""
        'xlSheet.Cells(1, 1) = "Sr No."
        'xlSheet.Cells(1, 2) = "Company"
        'xlSheet.Cells(1, 3) = "STATUS"
        'xlSheet.Cells(1, 4) = "SaleOrder"
        'xlSheet.Cells(1, 5) = "Vertical"
        'xlSheet.Cells(1, 6) = "Order_Date"
        'xlSheet.Cells(1, 7) = "Username"
        'xlSheet.Cells(1, 8) = "Buyer Po_No"
        'xlSheet.Cells(1, 9) = "Buyer"
        'xlSheet.Cells(1, 10) = "Country"
        'xlSheet.Cells(1, 11) = "Sales Ledger"
        'xlSheet.Cells(1, 12) = "Consignee"
        'xlSheet.Cells(1, 13) = "Consignee Country"
        'xlSheet.Cells(1, 14) = "MfgTrd"
        'xlSheet.Cells(1, 15) = "Product"
        'xlSheet.Cells(1, 16) = "Style Code"
        'xlSheet.Cells(1, 17) = "Type Name"
        'xlSheet.Cells(1, 18) = "Shade Name"
        'xlSheet.Cells(1, 19) = "Gender"
        'xlSheet.Cells(1, 20) = "Brand Name"
        'xlSheet.Cells(1, 21) = "Qty"
        'xlSheet.Cells(1, 22) = "UOM"
        'xlSheet.Cells(1, 23) = "Rate"
        'xlSheet.Cells(1, 24) = "Amount"
        'xlSheet.Cells(1, 25) = "NetAmt"
        'xlSheet.Cells(1, 26) = "Currency"
        'xlSheet.Cells(1, 27) = "Payment Terms"
        'xlSheet.Cells(1, 28) = "DeliveryDate"

        'RAJASHRI-24-01-2022
        xlSheet.Cells(1, 1) = "Sr No."
        xlSheet.Cells(1, 2) = "Company"
        xlSheet.Cells(1, 3) = "Fin_Year"
        xlSheet.Cells(1, 4) = "Status"
        xlSheet.Cells(1, 5) = "Sales Order"
        xlSheet.Cells(1, 6) = "Vertical"
        xlSheet.Cells(1, 7) = "Order_Date"
        xlSheet.Cells(1, 8) = "User_Name"
        xlSheet.Cells(1, 9) = "Buyer Po_No"
        xlSheet.Cells(1, 10) = "Buyer"
        xlSheet.Cells(1, 11) = "Country"
        xlSheet.Cells(1, 12) = "Sales Ledger"
        xlSheet.Cells(1, 13) = "Consignee"
        xlSheet.Cells(1, 14) = "Consignee_Country"
        xlSheet.Cells(1, 15) = "MfgTrd"
        xlSheet.Cells(1, 16) = "Item_Name"
        xlSheet.Cells(1, 17) = "Style_Code"
        xlSheet.Cells(1, 18) = "Type_Name"
        xlSheet.Cells(1, 19) = "Shade_Name"
        xlSheet.Cells(1, 20) = "Gender"
        xlSheet.Cells(1, 21) = "Brand_Name"
        xlSheet.Cells(1, 22) = "Qty"
        xlSheet.Cells(1, 23) = "BalQty"
        xlSheet.Cells(1, 24) = "UOM"
        xlSheet.Cells(1, 25) = "Rate"
        xlSheet.Cells(1, 26) = "Amount"
        xlSheet.Cells(1, 27) = "NetAmt"
        xlSheet.Cells(1, 28) = "Currency"
        xlSheet.Cells(1, 29) = "ETA"
        xlSheet.Cells(1, 30) = "Payment Terms"
        xlSheet.Cells(1, 31) = "DeliveryDate"
        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 31)).Font.Bold = True

        Query = " SELECT * FROM vw_SalesOrderDetails where " & filter & " Order by SaleOrder "

        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
        Dim recrow As DataRow
        If dtb3CSmall.Rows.Count > 0 Then
            Dim i As Integer = 2
            Dim j As Integer = 2
            Dim k As Integer = 1
            For Each recrow In dtb3CSmall.Rows
                xlSheet.Cells(j, 1) = k
                'xlSheet.Cells(i, 2) = recrow("Company")
                'xlSheet.Cells(i, 3) = recrow("STATUS")
                'xlSheet.Cells(i, 4) = recrow("SaleOrder")
                'xlSheet.Cells(i, 5) = recrow("Vertical")
                'xlSheet.Cells(i, 6) = recrow("Doc_Dt") 'IIf(recrow("Doc_Dt").ToString <> "", recrow("Doc_Dt").ToString("dd/MM/yyyy"), "")
                'xlSheet.Cells(i, 7) = recrow("Username")
                'xlSheet.Cells(i, 8) = recrow("Buyer_Po_No")
                'xlSheet.Cells(i, 9) = recrow("Buyer")
                'xlSheet.Cells(i, 10) = recrow("Country")
                'xlSheet.Cells(i, 11) = recrow("Sales_Ledger")
                'xlSheet.Cells(i, 12) = recrow("Consignee")
                'xlSheet.Cells(i, 13) = recrow("Consignee_Country")
                'xlSheet.Cells(i, 14) = recrow("MfgTrd")
                'xlSheet.Cells(i, 15) = recrow("item_name")
                'xlSheet.Cells(i, 16) = recrow("style_code")
                'xlSheet.Cells(i, 17) = recrow("type_name")
                'xlSheet.Cells(i, 18) = recrow("shade_name")
                'xlSheet.Cells(i, 19) = recrow("Gender")
                'xlSheet.Cells(i, 20) = recrow("brand_name")
                'xlSheet.Cells(i, 21) = recrow("qty")
                'xlSheet.Cells(i, 22) = recrow("UOM")
                'xlSheet.Cells(i, 23) = recrow("rate")
                'xlSheet.Cells(i, 24) = recrow("amount")
                'xlSheet.Cells(i, 25) = recrow("netamt")
                'xlSheet.Cells(i, 26) = recrow("Currency")
                'xlSheet.Cells(i, 27) = recrow("Payment_Terms")

                'RAJASHRI-24-01-2022
                xlSheet.Cells(i, 2) = recrow("Company")
                xlSheet.Cells(i, 3) = recrow("Fin_Year")
                xlSheet.Cells(i, 4) = recrow("Status")
                xlSheet.Cells(i, 5) = recrow("SaleOrder")
                xlSheet.Cells(i, 6) = recrow("Vertical")
                xlSheet.Cells(i, 7) = recrow("Order_Date")
                xlSheet.Cells(i, 8) = recrow("UserName")
                xlSheet.Cells(i, 9) = recrow("Buyer Po_No")
                xlSheet.Cells(i, 10) = recrow("Buyer")
                xlSheet.Cells(i, 11) = recrow("Country")
                xlSheet.Cells(i, 12) = recrow("Sales Ledger")
                xlSheet.Cells(i, 13) = recrow("Consignee")
                xlSheet.Cells(i, 14) = recrow("Consignee_Country")
                xlSheet.Cells(i, 15) = recrow("MfgTrd")
                xlSheet.Cells(i, 16) = recrow("Item_Name")
                xlSheet.Cells(i, 17) = recrow("Style_Code")
                xlSheet.Cells(i, 18) = recrow("Type_Name")
                xlSheet.Cells(i, 19) = recrow("Shade_Name")
                xlSheet.Cells(i, 20) = recrow("Gender")
                xlSheet.Cells(i, 21) = recrow("Brand_Name")
                xlSheet.Cells(i, 22) = recrow("Qty")
                xlSheet.Cells(i, 23) = recrow("BalQty")
                xlSheet.Cells(i, 24) = recrow("UOM")
                xlSheet.Cells(i, 25) = recrow("Rate")
                xlSheet.Cells(i, 26) = recrow("Amount")
                xlSheet.Cells(i, 27) = recrow("NetAmt")
                xlSheet.Cells(i, 28) = recrow("Currency")
                xlSheet.Cells(i, 29) = recrow("ETA")
                xlSheet.Cells(i, 30) = recrow("Payment Terms")
                xlSheet.Cells(i, 31) = recrow("DeliveryDate")
                'xlSheet.Cells(i, 23) = recrow("dlvdate") 'IIf(recrow("dlvdate").ToString <> "", recrow("dlvdate").ToString("dd/MM/yyyy"), "")


                i += 1
                j += 1
                k += 1
            Next recrow
            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
        End If

        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
        xlSheet.Columns.AutoFit()

        Try
            xlSheet.SaveAs(Application.StartupPath & "Sales Order Report Details" & "-" & Today & ".xlsx")
        Catch ex As Exception
            Exit Sub
        End Try

        xlApp.Visible = True
        Exit Sub
    End Sub

    Private Sub ExportSalesorderSummarySizeWiseNew(ByVal filter As String)
        'If CurrIntId = 0 Then Exit Sub

        'If MsgBox("Export Sales Order data ", MsgBoxStyle.Question + MsgBoxStyle.YesNo) = MsgBoxResult.No Then Exit Sub

        Try
            Query = " SELECT * FROM vw_SalesOrderSummarySizeWise where " & filter & " Order by SaleOrder "


            Dim dt As DataTable = Common.GetDataTable(Query)

            If dt.Rows.Count > 0 Then

                Dim onlyfilename As String = "SalesOrderSizeWise_" + DateTime.Now.ToString("ddMMyyyyHHmmss") + ".xlsx"
                Dim downloadfolder As String = Application.StartupPath
                Dim excelfile As String = downloadfolder + "/" + onlyfilename
                Dim fl As New FileInfo(excelfile)

                ' If you are a commercial business and have
                ' purchased commercial licenses use the static property
                ' LicenseContext of the ExcelPackage class :

                'ExcelPackage.LicenseContext = LicenseContext.NonCommercial
                Dim pck As New ExcelPackage(fl)
                Dim ws As ExcelWorksheet = pck.Workbook.Worksheets.Add("Sales Order")
                ws.Cells("A1:Z1").Style.Font.Bold = True
                ws.Cells("A1").LoadFromDataTable(dt, True)
                'ws.Column(11).Style.Numberformat.Format = "0.00"
                'ws.Column(12).Style.Numberformat.Format = "0.00"
                'ws.Column(13).Style.Numberformat.Format = "0.00"
                'ws.Column(14).Style.Numberformat.Format = "0.00"
                'ws.Column(15).Style.Numberformat.Format = "0.00"
                'ws.Column(16).Style.Numberformat.Format = "0.00"
                'ws.Column(17).Style.Numberformat.Format = "0.00"
                'ws.Column(18).Style.Numberformat.Format = "0.00"
                'ws.Column(19).Style.Numberformat.Format = "0.00"
                'ws.Column(20).Style.Numberformat.Format = "0.00"
                'ws.Column(21).Style.Numberformat.Format = "dd/MM/yyyy"
                'ws.Column(2).Style.Numberformat.Format = "dd/MM/yyyy"
                ws.Cells(ws.Dimension.Address).AutoFitColumns()
                pck.Save()

                MsgBox("Data successfully exported." & excelfile, MsgBoxStyle.Information)



            End If

        Catch sqlEx As SqlException
            Common.LogAndDisplayException(sqlEx)
        Catch ex As Exception
            Common.LogAndDisplayException(ex)
        Finally
            Me.Cursor = Cursors.Default
        End Try



    End Sub



    Private Sub ExportSalesorderSummarySizeWise(ByVal filter As String)
        Dim Trans As SqlTransaction
        Dim Today As String = Date.Now.ToString("dd/MM/YYYY") 'dd/MM/YYYY
        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
        Dim xlApp As New Excel.Application
        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
        Dim Reg As String = ""

        If chkSize.Checked = True Then      'Rajashri-28-01-2022-Sizewise
            xlSheet.Cells(1, 1) = "Sr No."
            xlSheet.Cells(1, 2) = "Company"
            xlSheet.Cells(1, 3) = "FcYr_id"
            xlSheet.Cells(1, 4) = "SaleOrder"
            xlSheet.Cells(1, 5) = "Order_Date"
            xlSheet.Cells(1, 6) = "BuyerPo_No"
            xlSheet.Cells(1, 7) = "Sales_Ledger"
            xlSheet.Cells(1, 8) = "Buyer"
            xlSheet.Cells(1, 9) = "Brand_name"
            xlSheet.Cells(1, 10) = "Stn_Name"
            xlSheet.Cells(1, 11) = "state_Name"
            xlSheet.Cells(1, 12) = "Style_Code"
            xlSheet.Cells(1, 13) = "Shade_Name"
            xlSheet.Cells(1, 14) = "Item_Name"
            xlSheet.Cells(1, 15) = "Type_Name"
            xlSheet.Cells(1, 16) = "Size_Name"
            xlSheet.Cells(1, 17) = "Qty"
            xlSheet.Cells(1, 18) = "BalQty"
            xlSheet.Cells(1, 19) = "UOM"
            xlSheet.Cells(1, 20) = "Gross_Amt"
            xlSheet.Cells(1, 21) = "Tax_Amt"
            xlSheet.Cells(1, 22) = "Currency"

            'xlSheet.Cells(1, 1) = "Sr No."
            'xlSheet.Cells(1, 2) = "Company"
            'xlSheet.Cells(1, 3) = "Executed By"
            'xlSheet.Cells(1, 4) = "Financial Year"
            'xlSheet.Cells(1, 5) = "SaleOrder"
            'xlSheet.Cells(1, 6) = "Order Date"
            'xlSheet.Cells(1, 7) = "User Name"
            'xlSheet.Cells(1, 8) = "Buyer Po_No"
            'xlSheet.Cells(1, 9) = "Buyer"
            'xlSheet.Cells(1, 10) = "Place"
            'xlSheet.Cells(1, 11) = "Sales Ledger"
            'xlSheet.Cells(1, 12) = "Quantity"
            'xlSheet.Cells(1, 13) = "Net Amount"
            'xlSheet.Cells(1, 14) = "Currency"
            'xlSheet.Cells(1, 15) = "Payment Terms"
            'xlSheet.Cells(1, 16) = "Delivary Date"
            Query = " SELECT * FROM vw_SalesOrderSummarySizeWise where " & filter & " Order by SaleOrder "

        Else
            xlSheet.Cell(1, 1) = "Sr No."   'Rajashri--22-01-2022 Start
            xlSheet.Cells(1, 2) = "Company"
            xlSheet.Cells(1, 3) = "Executed By"
            xlSheet.Cells(1, 4) = "Financial Year"
            xlSheet.Cells(1, 5) = "User_Name"
            xlSheet.Cells(1, 6) = "SaleOrder"
            xlSheet.Cells(1, 7) = "Order_Date"
            xlSheet.Cells(1, 8) = "Buyer Po_No"
            xlSheet.Cells(1, 9) = "Buyer"
            xlSheet.Cells(1, 10) = "Brand_Name"
            xlSheet.Cells(1, 11) = "Place"
            xlSheet.Cells(1, 12) = "Country"
            xlSheet.Cells(1, 13) = "Consignee_Name"
            xlSheet.Cells(1, 14) = "CoPlace"
            xlSheet.Cells(1, 15) = "Consignee_Country"
            xlSheet.Cells(1, 16) = "Sales Ledger"
            xlSheet.Cells(1, 17) = "TotQty"
            xlSheet.Cells(1, 18) = "Gross_amt"
            xlSheet.Cells(1, 19) = "Billdisc_amt"
            xlSheet.Cells(1, 20) = "Taxable_Amt"
            xlSheet.Cells(1, 21) = "Tax_Amt"
            xlSheet.Cells(1, 22) = "Othchgs_amt"
            xlSheet.Cells(1, 23) = "Net_amt"
            xlSheet.Cells(1, 24) = "Currency"
            xlSheet.Cells(1, 25) = "Payment Terms"     'Rajashri--22-01-2022 End
            ' xlSheet.Cells(1, 31) = "Delivery Date"  
            xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 25)).Font.Bold = True


            Query = " SELECT * FROM vw_SalesOrderSummary where " & filter & " Order by SaleOrder "
        End If

        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
        Dim recrow As DataRow
        If dtb3CSmall.Rows.Count > 0 Then
            Dim i As Integer = 2
            Dim j As Integer = 2
            Dim k As Integer = 1
            For Each recrow In dtb3CSmall.Rows

                If chkSize.Checked = True Then
                    xlSheet.Cells(j, 1) = k
                    xlSheet.Cells(i, 2) = recrow("Company")
                    xlSheet.Cells(i, 3) = recrow("FcYr_id")
                    xlSheet.Cells(i, 4) = recrow("SaleOrder")
                    xlSheet.Cells(i, 5) = recrow("Order_Date")
                    xlSheet.Cells(i, 6) = recrow("BuyerPo_No")
                    xlSheet.Cells(i, 7) = recrow("Sales_Ledger")
                    xlSheet.Cells(i, 8) = recrow("Buyer")
                    xlSheet.Cells(i, 9) = recrow("Brand_name")
                    xlSheet.Cells(i, 10) = recrow("Stn_Name")
                    xlSheet.Cells(i, 11) = recrow("state_Name")
                    xlSheet.Cells(i, 12) = recrow("Style_Code")
                    xlSheet.Cells(i, 13) = recrow("Shade_Name")
                    xlSheet.Cells(i, 14) = recrow("Item_Name")
                    xlSheet.Cells(i, 15) = recrow("Type_Name")
                    xlSheet.Cells(i, 16) = recrow("Size_Name")
                    xlSheet.Cells(i, 17) = recrow("Qty")
                    xlSheet.Cells(i, 18) = recrow("BalQty")
                    xlSheet.Cells(i, 19) = recrow("UOM")
                    xlSheet.Cells(i, 20) = recrow("Gross_Amt")
                    xlSheet.Cells(i, 21) = recrow("Tax_Amt")
                    xlSheet.Cells(i, 22) = recrow("Currency")

                    'xlSheet.Cells(j, 1) = k
                    'xlSheet.Cells(i, 2) = recrow("Company")
                    'xlSheet.Cells(i, 3) = recrow("Executed_By")
                    'xlSheet.Cells(i, 4) = recrow("Financial_Year")
                    'xlSheet.Cells(i, 5) = recrow("SaleOrder")
                    'xlSheet.Cells(i, 6) = recrow("Order_Date")
                    'xlSheet.Cells(i, 7) = recrow("Username")
                    'xlSheet.Cells(i, 8) = recrow("Buyer_Po_No")
                    'xlSheet.Cells(i, 9) = recrow("Buyer")
                    'xlSheet.Cells(i, 10) = recrow("Place")
                    'xlSheet.Cells(i, 11) = recrow("Sales_Ledger")
                    'xlSheet.Cells(i, 12) = recrow("totqty")
                    'xlSheet.Cells(i, 13) = recrow("Net_Amt")
                    'xlSheet.Cells(i, 14) = recrow("Currency")
                    'xlSheet.Cells(i, 15) = recrow("Payment_Terms")
                    'xlSheet.Cells(i, 16) = recrow("dlvdate")
                Else
                    xlSheet.Cells(j, 1) = k
                    xlSheet.Cells(i, 2) = recrow("Company") 'Rajashri--22-01-2022 Start
                    xlSheet.Cells(i, 3) = recrow("Executed By")
                    xlSheet.Cells(i, 4) = recrow("Financial Year")
                    xlSheet.Cells(i, 5) = recrow("User_Name")
                    xlSheet.Cells(i, 6) = recrow("SaleOrder")
                    xlSheet.Cells(i, 7) = recrow("Order_Date")
                    xlSheet.Cells(i, 8) = recrow("Buyer Po_No")
                    xlSheet.Cells(i, 9) = recrow("Buyer")
                    xlSheet.Cells(i, 10) = recrow("Brand_Name")
                    xlSheet.Cells(i, 11) = recrow("Place")
                    xlSheet.Cells(i, 12) = recrow("Country")
                    xlSheet.Cells(i, 13) = recrow("Consignee_Name")
                    xlSheet.Cells(i, 14) = recrow("CoPlace")
                    xlSheet.Cells(i, 15) = recrow("Consignee_Country")
                    xlSheet.Cells(i, 16) = recrow("Sales Ledger")
                    xlSheet.Cells(i, 17) = recrow("TotQty")
                    xlSheet.Cells(i, 18) = recrow("Gross_amt")
                    xlSheet.Cells(i, 19) = recrow("Billdisc_amt")
                    xlSheet.Cells(i, 20) = recrow("Taxable_Amt")
                    xlSheet.Cells(i, 21) = recrow("Tax_Amt")
                    xlSheet.Cells(i, 22) = recrow("Othchgs_amt")
                    xlSheet.Cells(i, 23) = recrow("Net_amt")
                    xlSheet.Cells(i, 24) = recrow("Currency")
                    xlSheet.Cells(i, 25) = recrow("Payment Terms")
                    'xlSheet.Cells(1, 32) = recrow("Delivery Date") 'Rajashri--22-01-2022 End
                End If
                i += 1
                j += 1
                k += 1
            Next recrow
            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
        End If

        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
        xlSheet.Columns.AutoFit()

        Try
            xlSheet.SaveAs(Application.StartupPath & "Sales Order Report Details" & "-" & Today & ".xlsx")
        Catch ex As Exception
            Exit Sub
        End Try

        xlApp.Visible = True
        Exit Sub
    End Sub

    Private Sub ExportSalesorderSummaryNew(ByVal filter As String)
        'If CurrIntId = 0 Then Exit Sub
       
        ' If MsgBox("Export Sales Order data ", MsgBoxStyle.Question + MsgBoxStyle.YesNo) = MsgBoxResult.No Then Exit Sub

        Try
            Query = " SELECT * FROM vw_SalesOrderSummary where " & filter & " Order by SaleOrder "
            

            Dim dt As DataTable = Common.GetDataTable(Query)

            If dt.Rows.Count > 0 Then

                Dim onlyfilename As String = "SalesOrder_" + DateTime.Now.ToString("ddMMyyyyHHmmss") + ".xlsx"
                Dim downloadfolder As String = Application.StartupPath
                Dim excelfile As String = downloadfolder + "/" + onlyfilename
                Dim fl As New FileInfo(excelfile)

                ' If you are a commercial business and have
                ' purchased commercial licenses use the static property
                ' LicenseContext of the ExcelPackage class :

                'ExcelPackage.LicenseContext = LicenseContext.NonCommercial
                Dim pck As New ExcelPackage(fl)
                Dim ws As ExcelWorksheet = pck.Workbook.Worksheets.Add("Sales Order")
                ws.Cells("A1:Z1").Style.Font.Bold = True
                ws.Cells("A1").LoadFromDataTable(dt, True)
                'ws.Column(11).Style.Numberformat.Format = "0.00"
                'ws.Column(12).Style.Numberformat.Format = "0.00"
                'ws.Column(13).Style.Numberformat.Format = "0.00"
                'ws.Column(14).Style.Numberformat.Format = "0.00"
                'ws.Column(15).Style.Numberformat.Format = "0.00"
                'ws.Column(16).Style.Numberformat.Format = "0.00"
                'ws.Column(17).Style.Numberformat.Format = "0.00"
                'ws.Column(18).Style.Numberformat.Format = "0.00"
                'ws.Column(19).Style.Numberformat.Format = "0.00"
                'ws.Column(20).Style.Numberformat.Format = "0.00"
                'ws.Column(21).Style.Numberformat.Format = "dd/MM/yyyy"
                'ws.Column(2).Style.Numberformat.Format = "dd/MM/yyyy"
                ws.Cells(ws.Dimension.Address).AutoFitColumns()
                pck.Save()

               MsgBox("Data successfully exported." & excelfile, MsgBoxStyle.Information)


            End If

        Catch sqlEx As SqlException
            Common.LogAndDisplayException(sqlEx)
        Catch ex As Exception
            Common.LogAndDisplayException(ex)
        Finally
            Me.Cursor = Cursors.Default
        End Try

    End Sub


    Private Sub ExportSalesorderSummary(ByVal filter As String)
        Dim Trans As SqlTransaction
        Dim Today As String = Date.Now.ToString("dd/MM/YYYY") 'dd/MM/YYYY
        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
        Dim xlApp As New Excel.Application
        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
        Dim Reg As String = ""

        If chkSize.Checked = True Then      'Rajashri-28-01-2022-Sizewise
            xlSheet.Cells(1, 1) = "Sr No."
            xlSheet.Cells(1, 2) = "Company"
            xlSheet.Cells(1, 3) = "FcYr_id"
            xlSheet.Cells(1, 4) = "SaleOrder"
            xlSheet.Cells(1, 5) = "Order_Date"
            xlSheet.Cells(1, 6) = "BuyerPo_No"
            xlSheet.Cells(1, 7) = "Sales_Ledger"
            xlSheet.Cells(1, 8) = "Buyer"
            xlSheet.Cells(1, 9) = "Brand_name"
            xlSheet.Cells(1, 10) = "Stn_Name"
            xlSheet.Cells(1, 11) = "state_Name"
            xlSheet.Cells(1, 12) = "Style_Code"
            xlSheet.Cells(1, 13) = "Shade_Name"
            xlSheet.Cells(1, 14) = "Item_Name"
            xlSheet.Cells(1, 15) = "Type_Name"
            xlSheet.Cells(1, 16) = "Size_Name"
            xlSheet.Cells(1, 17) = "Qty"
            xlSheet.Cells(1, 18) = "BalQty"
            xlSheet.Cells(1, 19) = "UOM"
            xlSheet.Cells(1, 20) = "Gross_Amt"
            xlSheet.Cells(1, 21) = "TaxAmount"
            xlSheet.Cells(1, 22) = "Currency"
        End If
        'xlSheet.Cells(1, 1) = "Sr No."
        'xlSheet.Cells(1, 2) = "Company"
        'xlSheet.Cells(1, 3) = "Executed By"
        'xlSheet.Cells(1, 4) = "Financial Year"
        'xlSheet.Cells(1, 5) = "SaleOrder"
        'xlSheet.Cells(1, 6) = "Order Date"
        'xlSheet.Cells(1, 7) = "User Name"
        'xlSheet.Cells(1, 8) = "Buyer Po_No"
        'xlSheet.Cells(1, 9) = "Buyer"
        'xlSheet.Cells(1, 10) = "Place"
        'xlSheet.Cells(1, 11) = "Sales Ledger"
        'xlSheet.Cells(1, 12) = "Quantity"
        'xlSheet.Cells(1, 13) = "Net Amount"
        'xlSheet.Cells(1, 14) = "Currency"
        'xlSheet.Cells(1, 15) = "Payment Terms"
        'xlSheet.Cells(1, 16) = "Delivary Date"

        xlSheet.Cells(1, 1) = "Sr No."   'Rajashri--22-01-2022 Start
        xlSheet.Cells(1, 2) = "Company"
        xlSheet.Cells(1, 3) = "Executed By"
        xlSheet.Cells(1, 4) = "Financial Year"
        xlSheet.Cells(1, 5) = "User_Name"
        xlSheet.Cells(1, 6) = "SaleOrder"
        xlSheet.Cells(1, 7) = "Order_Date"
        xlSheet.Cells(1, 8) = "Buyer Po_No"
        xlSheet.Cells(1, 9) = "Buyer"
        xlSheet.Cells(1, 10) = "Brand_Name"
        xlSheet.Cells(1, 11) = "Place"
        xlSheet.Cells(1, 12) = "Country"
        xlSheet.Cells(1, 13) = "Consignee_Name"
        xlSheet.Cells(1, 14) = "CoPlace"
        xlSheet.Cells(1, 15) = "Consignee_Country"
        xlSheet.Cells(1, 16) = "Sales Ledger"
        xlSheet.Cells(1, 17) = "TotQty"
        xlSheet.Cells(1, 18) = "Gross_amt"
        xlSheet.Cells(1, 19) = "Billdisc_amt"
        xlSheet.Cells(1, 20) = "Taxable_Amt"
        xlSheet.Cells(1, 21) = "Tax_Amt"
        xlSheet.Cells(1, 22) = "Othchgs_amt"
        xlSheet.Cells(1, 23) = "Net_amt"
        xlSheet.Cells(1, 24) = "Currency"
        xlSheet.Cells(1, 25) = "Payment Terms"     'Rajashri--22-01-2022 End
        ' xlSheet.Cells(1, 31) = "Delivery Date"  
        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 25)).Font.Bold = True

        Query = " SELECT * FROM vw_SalesOrderSummary where " & filter & " Order by SaleOrder "

        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
        Dim recrow As DataRow
        If dtb3CSmall.Rows.Count > 0 Then
            Dim i As Integer = 2
            Dim j As Integer = 2
            Dim k As Integer = 1
            For Each recrow In dtb3CSmall.Rows

                If chkSize.Checked = True Then
                    xlSheet.Cells(j, 1) = k
                    xlSheet.Cells(i, 2) = recrow("Company")
                    xlSheet.Cells(i, 3) = recrow("FcYr_id")
                    xlSheet.Cells(i, 4) = recrow("SalesOrder")
                    xlSheet.Cells(i, 5) = recrow("Order_Date")
                    xlSheet.Cells(i, 6) = recrow("BuyerPo_No")
                    xlSheet.Cells(i, 7) = recrow("Sales_Ledger")
                    xlSheet.Cells(i, 8) = recrow("Buyer")
                    xlSheet.Cells(i, 9) = recrow("Brand_name")
                    xlSheet.Cells(i, 10) = recrow("Stn_Name")
                    xlSheet.Cells(i, 11) = recrow("state_Name")
                    xlSheet.Cells(i, 12) = recrow("Style_Code")
                    xlSheet.Cells(i, 13) = recrow("Shade_Name")
                    xlSheet.Cells(i, 14) = recrow("Item_Name")
                    xlSheet.Cells(i, 15) = recrow("Type_Name")
                    xlSheet.Cells(i, 16) = recrow("Size_Name")
                    xlSheet.Cells(i, 17) = recrow("Qty")
                    xlSheet.Cells(i, 18) = recrow("BalQty")
                    xlSheet.Cells(i, 19) = recrow("UOM")
                    xlSheet.Cells(i, 20) = recrow("Gross_Amt")
                    xlSheet.Cells(i, 21) = recrow("TaxAmount")
                    xlSheet.Cells(i, 22) = recrow("Currency")
                End If
                'xlSheet.Cells(j, 1) = k
                'xlSheet.Cells(i, 2) = recrow("Company")
                'xlSheet.Cells(i, 3) = recrow("Executed_By")
                'xlSheet.Cells(i, 4) = recrow("Financial_Year")
                'xlSheet.Cells(i, 5) = recrow("SaleOrder")
                'xlSheet.Cells(i, 6) = recrow("Order_Date")
                'xlSheet.Cells(i, 7) = recrow("Username")
                'xlSheet.Cells(i, 8) = recrow("Buyer_Po_No")
                'xlSheet.Cells(i, 9) = recrow("Buyer")
                'xlSheet.Cells(i, 10) = recrow("Place")
                'xlSheet.Cells(i, 11) = recrow("Sales_Ledger")
                'xlSheet.Cells(i, 12) = recrow("totqty")
                'xlSheet.Cells(i, 13) = recrow("Net_Amt")
                'xlSheet.Cells(i, 14) = recrow("Currency")
                'xlSheet.Cells(i, 15) = recrow("Payment_Terms")
                'xlSheet.Cells(i, 16) = recrow("dlvdate")
                xlSheet.Cells(j, 1) = k
                xlSheet.Cells(i, 2) = recrow("Company") 'Rajashri--22-01-2022 Start
                xlSheet.Cells(i, 3) = recrow("Executed By")
                xlSheet.Cells(i, 4) = recrow("Financial Year")
                xlSheet.Cells(i, 5) = recrow("User_Name")
                xlSheet.Cells(i, 6) = recrow("SaleOrder")
                xlSheet.Cells(i, 7) = recrow("Order_Date")
                xlSheet.Cells(i, 8) = recrow("Buyer Po_No")
                xlSheet.Cells(i, 9) = recrow("Buyer")
                xlSheet.Cells(i, 10) = recrow("Brand_Name")
                xlSheet.Cells(i, 11) = recrow("Place")
                xlSheet.Cells(i, 12) = recrow("Country")
                xlSheet.Cells(i, 13) = recrow("Consignee_Name")
                xlSheet.Cells(i, 14) = recrow("CoPlace")
                xlSheet.Cells(i, 15) = recrow("Consignee_Country")
                xlSheet.Cells(i, 16) = recrow("Sales Ledger")
                xlSheet.Cells(i, 17) = recrow("TotQty")
                xlSheet.Cells(i, 18) = recrow("Gross_amt")
                xlSheet.Cells(i, 19) = recrow("Billdisc_amt")
                xlSheet.Cells(i, 20) = recrow("Taxable_Amt")
                xlSheet.Cells(i, 21) = recrow("Tax_Amt")
                xlSheet.Cells(i, 22) = recrow("Othchgs_amt")
                xlSheet.Cells(i, 23) = recrow("Net_amt")
                xlSheet.Cells(i, 24) = recrow("Currency")
                xlSheet.Cells(i, 25) = recrow("Payment Terms")
                'xlSheet.Cells(1, 32) = recrow("Delivery Date") 'Rajashri--22-01-2022 End
                i += 1
                j += 1
                k += 1
            Next recrow
            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
        End If

        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
        xlSheet.Columns.AutoFit()

        Try
            xlSheet.SaveAs(Application.StartupPath & "Sales Order Report Details" & "-" & Today & ".xlsx")
        Catch ex As Exception
            Exit Sub
        End Try

        xlApp.Visible = True
        Exit Sub
    End Sub
    'prashant 02/12/2019
    Private Sub ExportSalesPendingFabricIssueAgtJobWorkorder(ByVal FromToDt As String)
        Dim Trans As SqlTransaction
        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
        Dim xlApp As New Excel.Application
        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
        Dim Reg As String = ""
        xlSheet.Cells(1, 1) = "Sr No."
        xlSheet.Cells(1, 2) = "JobOrder_No"
        xlSheet.Cells(1, 3) = "JW_Date"
        xlSheet.Cells(1, 4) = "Create_by"
        xlSheet.Cells(1, 5) = "Item_Name"
        xlSheet.Cells(1, 6) = "Shade_Name"
        xlSheet.Cells(1, 7) = "Jobber"
        'xlSheet.Cells(1, 8) = "Buyer Po_No"
        'xlSheet.Cells(1, 9) = "Buyer"
        'xlSheet.Cells(1, 10) = "Place"
        'xlSheet.Cells(1, 11) = "Sales Ledger"
        'xlSheet.Cells(1, 12) = "Quantity"
        'xlSheet.Cells(1, 13) = "Net Amount"
        'xlSheet.Cells(1, 14) = "Currency"
        'xlSheet.Cells(1, 15) = "Payment Terms"
        'xlSheet.Cells(1, 16) = "Delivary Date"


        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 24)).Font.Bold = True
        Query = " SELECT * FROM vw_PendFabIssueAgstJobOrder where vw_PendFabIssueAgstJobOrder.JW_Date >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' And vw_PendFabIssueAgstJobOrder.JW_Date <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'"


        'Query = " SELECT * FROM vw_PendFabIssueAgstJobOrder where vw_PendFabIssueAgstJobOrder.JW_Date >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' And vw_PendFabIssueAgstJobOrder.JW_Date <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'"

        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
        Dim recrow As DataRow
        If dtb3CSmall.Rows.Count > 0 Then
            Dim i As Integer = 2
            Dim j As Integer = 2
            Dim k As Integer = 1
            For Each recrow In dtb3CSmall.Rows
                xlSheet.Cells(j, 1) = k
                xlSheet.Cells(i, 2) = recrow("JobOrder_No")
                xlSheet.Cells(i, 3) = recrow("JW_Date")
                xlSheet.Cells(i, 4) = recrow("Create_by")
                xlSheet.Cells(i, 5) = recrow("Item_Name")
                xlSheet.Cells(i, 6) = recrow("Shade_Name")
                xlSheet.Cells(i, 7) = recrow("Jobber")
                'xlSheet.Cells(i, 8) = recrow("Buyer_Po_No")
                'xlSheet.Cells(i, 9) = recrow("Buyer")
                'xlSheet.Cells(i, 10) = recrow("Place")
                'xlSheet.Cells(i, 11) = recrow("Sales_Ledger")
                'xlSheet.Cells(i, 12) = recrow("totqty")
                'xlSheet.Cells(i, 13) = recrow("Net_Amt")
                'xlSheet.Cells(i, 14) = recrow("Currency")
                'xlSheet.Cells(i, 15) = recrow("Payment_Terms")
                'xlSheet.Cells(i, 16) = recrow("dlvdate")
                i += 1
                j += 1
                k += 1
            Next recrow
            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
        End If

        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
        xlSheet.Columns.AutoFit()

        Try
            xlSheet.SaveAs(Application.StartupPath & "Pending Fabric Issue AgtJob Work Order" & "-" & Today & ".xlsx")
        Catch ex As Exception
            Exit Sub
        End Try

        xlApp.Visible = True
        Exit Sub
    End Sub
    'End prashant

    Private Sub ExportInvoiceSummaryDetailsNew(ByVal filter As String, ByVal Rpttype As String, ByVal TableName As String, ByVal OrderBy As String)

        'If CurrIntId = 0 Then Exit Sub

        'If MsgBox("Export Sales Order data ", MsgBoxStyle.Question + MsgBoxStyle.YesNo) = MsgBoxResult.No Then Exit Sub

        Try
            ' Query = " SELECT * FROM vw_SalesOrderDetails where " & filter & " Order by SaleOrder "

            If Rpttype.ToString = "D" Then
                'Query = " SELECT * FROM " & TableName.Trim & " where " & filter & " Order by " & OrderBy & " "
                Query = " SELECT * FROM " & TableName.Trim & " where " & filter & " Order by " & OrderBy & " "
            ElseIf Rpttype.ToString = "S" Then
                Query = " SELECT * FROM " & TableName.Trim & " where " & filter
                '" Order by " & OrderBy & " "
            End If

            'Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)

            Dim onlyfilename As String
            Dim dt As DataTable = Common.GetDataTable(Query)

            If dt.Rows.Count > 0 Then
                If Rpttype.ToString = "D" Then
                    onlyfilename = "SalesInvoiceDetail_" + DateTime.Now.ToString("ddMMyyyyHHmmss") + ".xlsx"
                ElseIf Rpttype.ToString = "S" Then
                    onlyfilename = "SalesInvoiceSummary_" + DateTime.Now.ToString("ddMMyyyyHHmmss") + ".xlsx"
                ElseIf chkSize.Checked And Rpttype.ToString = "S" Then
                    onlyfilename = "SalesInvoiceSizeWise_" + DateTime.Now.ToString("ddMMyyyyHHmmss") + ".xlsx"
                End If
                Dim downloadfolder As String = Application.StartupPath
                Dim excelfile As String = downloadfolder + "/" + onlyfilename
                Dim fl As New FileInfo(excelfile)

                ' If you are a commercial business and have
                ' purchased commercial licenses use the static property
                ' LicenseContext of the ExcelPackage class :

                'ExcelPackage.LicenseContext = LicenseContext.NonCommercial
                Dim pck As New ExcelPackage(fl)
                Dim ws As ExcelWorksheet = pck.Workbook.Worksheets.Add("Invoice")
                ws.Cells("A1:Z1").Style.Font.Bold = True
                ws.Cells("A1").LoadFromDataTable(dt, True)
                'ws.Column(11).Style.Numberformat.Format = "0.00"
                'ws.Column(12).Style.Numberformat.Format = "0.00"
                'ws.Column(13).Style.Numberformat.Format = "0.00"
                'ws.Column(14).Style.Numberformat.Format = "0.00"
                'ws.Column(15).Style.Numberformat.Format = "0.00"
                'ws.Column(16).Style.Numberformat.Format = "0.00"
                'ws.Column(17).Style.Numberformat.Format = "0.00"
                'ws.Column(18).Style.Numberformat.Format = "0.00"
                'ws.Column(19).Style.Numberformat.Format = "0.00"
                'ws.Column(20).Style.Numberformat.Format = "0.00"
                'ws.Column(21).Style.Numberformat.Format = "dd/MM/yyyy"
                'ws.Column(2).Style.Numberformat.Format = "dd/MM/yyyy"
                ws.Cells(ws.Dimension.Address).AutoFitColumns()
                pck.Save()

                MsgBox("Data successfully exported." & excelfile, MsgBoxStyle.Information)



            End If

        Catch sqlEx As SqlException
            Common.LogAndDisplayException(sqlEx)
        Catch ex As Exception
            Common.LogAndDisplayException(ex)
        Finally
            Me.Cursor = Cursors.Default
        End Try


    End Sub


    Private Sub ExportInvoiceSummaryDetails(ByVal filter As String, ByVal Rpttype As String, ByVal TableName As String, ByVal OrderBy As String)
        Dim Trans As SqlTransaction
        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
        Dim xlApp As New Excel.Application
        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
        Dim Reg As String = ""

        'xlSheet.Cells(1, 1) = "Sr No."
        'xlSheet.Cells(1, 2) = "Company"
        'xlSheet.Cells(1, 3) = "Sale Bill"
        'xlSheet.Cells(1, 4) = "Invoice Date"
        'xlSheet.Cells(1, 5) = "Sale Order"
        'xlSheet.Cells(1, 6) = "Buyer Po_No"
        'xlSheet.Cells(1, 7) = "Buyer"
        'If Rpttype.ToString = "D" Then
        '    xlSheet.Cells(1, 8) = "Place"
        '    xlSheet.Cells(1, 9) = "Sales Ledger"
        '    xlSheet.Cells(1, 10) = "Item"
        '    xlSheet.Cells(1, 11) = "Style"
        '    xlSheet.Cells(1, 12) = "Type"
        '    xlSheet.Cells(1, 13) = "Shade"
        '    xlSheet.Cells(1, 14) = "Gender"
        '    xlSheet.Cells(1, 15) = "Brand"
        '    xlSheet.Cells(1, 16) = "Quantity"
        '    xlSheet.Cells(1, 17) = "UOM"
        '    xlSheet.Cells(1, 18) = "Rate"
        '    xlSheet.Cells(1, 19) = "Amount"
        '    xlSheet.Cells(1, 20) = "Tax Perc"
        '    xlSheet.Cells(1, 21) = "Tax Amount"
        '    xlSheet.Cells(1, 22) = "Amount"
        '    xlSheet.Cells(1, 23) = "Currency"
        '    xlSheet.Cells(1, 24) = "Payment Terms"
        'ElseIf Rpttype.ToString = "S" Then
        '    xlSheet.Cells(1, 8) = "Brand"
        '    xlSheet.Cells(1, 9) = "Country"
        '    xlSheet.Cells(1, 10) = "Sales Ledger"
        '    xlSheet.Cells(1, 11) = "Quantity"
        '    xlSheet.Cells(1, 12) = "Net Amount"
        '    xlSheet.Cells(1, 13) = "Currency"
        '    xlSheet.Cells(1, 14) = "Payment Terms"

        'Rajashri-24-01-2020 

        If chkSize.Checked = True Then 'Rajashri-25-01-2022 sizewise

            xlSheet.Cells(1, 1) = "Sr No."
            xlSheet.Cells(1, 2) = "Company"
            xlSheet.Cells(1, 3) = "Sale_Bill"
            xlSheet.Cells(1, 4) = "Invoice_Date"
            xlSheet.Cells(1, 5) = "SalesOrder"
            xlSheet.Cells(1, 6) = "Order_Date"
            xlSheet.Cells(1, 7) = "BuyerPo_No"
            xlSheet.Cells(1, 8) = "Sales_Ledger"
            xlSheet.Cells(1, 9) = "Buyer"
            xlSheet.Cells(1, 10) = "Brand_name"
            xlSheet.Cells(1, 11) = "Place"
            xlSheet.Cells(1, 12) = "state_Name"
            xlSheet.Cells(1, 13) = "Country"
            xlSheet.Cells(1, 14) = "Style_Code"
            xlSheet.Cells(1, 15) = "Shade_Name"
            xlSheet.Cells(1, 16) = "Item_Name"
            xlSheet.Cells(1, 17) = "Type_Name"
            xlSheet.Cells(1, 18) = "Size_Name"
            xlSheet.Cells(1, 19) = "Qty"
            xlSheet.Cells(1, 20) = "UOM"
            xlSheet.Cells(1, 21) = "Gross_Amt"
            xlSheet.Cells(1, 22) = "TaxAmount"
            xlSheet.Cells(1, 23) = "Currency"

        ElseIf Rpttype.ToString = "D" Then
            xlSheet.Cells(1, 1) = "Sr No."
            xlSheet.Cells(1, 2) = "Company"
            xlSheet.Cells(1, 3) = "Vertical"
            xlSheet.Cells(1, 4) = "FinancialYear"
            xlSheet.Cells(1, 5) = "Invoice_NO"
            xlSheet.Cells(1, 6) = "Invoice_Date"
            xlSheet.Cells(1, 7) = "SalesOrder"
            xlSheet.Cells(1, 8) = "Order_Date"
            xlSheet.Cells(1, 9) = "BuyerPo_No"
            xlSheet.Cells(1, 10) = "Buyer"
            xlSheet.Cells(1, 11) = "GSTNo"
            xlSheet.Cells(1, 12) = "Brand_Name"
            xlSheet.Cells(1, 13) = "Place"
            xlSheet.Cells(1, 14) = "State_Name"
            xlSheet.Cells(1, 15) = "Country"
            xlSheet.Cells(1, 16) = "Consignee_Name"
            xlSheet.Cells(1, 17) = "Consignee_Place"
            xlSheet.Cells(1, 18) = "Consignee_Country"
            xlSheet.Cells(1, 19) = "Sales Ledger"
            xlSheet.Cells(1, 20) = "Item_Name"
            xlSheet.Cells(1, 21) = "Style_Code"
            xlSheet.Cells(1, 22) = "Type_Name"
            xlSheet.Cells(1, 23) = "Shade_Name"
            xlSheet.Cells(1, 24) = "Gender"
            xlSheet.Cells(1, 25) = "HSNCode"
            xlSheet.Cells(1, 26) = "Qty"
            xlSheet.Cells(1, 27) = "UOM"
            xlSheet.Cells(1, 28) = "Rate"
            xlSheet.Cells(1, 29) = "Amount"
            xlSheet.Cells(1, 30) = "Discount"
            xlSheet.Cells(1, 31) = "Discount_Amt"
            xlSheet.Cells(1, 32) = "Taxable"
            xlSheet.Cells(1, 33) = "TaxPerc"
            xlSheet.Cells(1, 34) = "Tax_Amount"
            xlSheet.Cells(1, 35) = "NetAmt"
            xlSheet.Cells(1, 36) = "Currency"
            xlSheet.Cells(1, 37) = "Exchgrate"
            xlSheet.Cells(1, 38) = "Payment Terms"

        ElseIf Rpttype.ToString = "S" Then
            'xlSheet.Cells(1, 1) = "Sr No."
            'xlSheet.Cells(1, 2) = "Company"
            'xlSheet.Cells(1, 3) = "Sale_Bill"
            'xlSheet.Cells(1, 4) = "InvoiceDate"
            'xlSheet.Cells(1, 5) = "Sales_Order"
            'xlSheet.Cells(1, 6) = "BuyerPo_No"
            'xlSheet.Cells(1, 7) = "Buyer"
            'xlSheet.Cells(1, 8) = "Brand"
            'xlSheet.Cells(1, 9) = "Country"
            'xlSheet.Cells(1, 10) = "SalesLedger"
            'xlSheet.Cells(1, 11) = "TotQty"
            'xlSheet.Cells(1, 12) = "Net_Amt"
            'xlSheet.Cells(1, 13) = "Currency"
            'xlSheet.Cells(1, 14) = "Payment Terms"

            'Rajashri-25-01-2022

            xlSheet.Cells(1, 1) = "Sr No."
            xlSheet.Cells(1, 2) = "Company"
            xlSheet.Cells(1, 3) = "Vertical"
            xlSheet.Cells(1, 4) = "FinancialYear"
            xlSheet.Cells(1, 5) = "SaleBill"
            xlSheet.Cells(1, 6) = "Invoice_Date"
            xlSheet.Cells(1, 7) = "BuyerPoNo"
            xlSheet.Cells(1, 8) = "Buyer"
            xlSheet.Cells(1, 9) = "Brand"
            xlSheet.Cells(1, 10) = "Place"
            xlSheet.Cells(1, 11) = "State_Name"
            xlSheet.Cells(1, 12) = "Country"
            xlSheet.Cells(1, 13) = "Sales Ledger"
            xlSheet.Cells(1, 14) = "TotQty"
            xlSheet.Cells(1, 15) = "Gross_Amt"
            xlSheet.Cells(1, 16) = "Discount"
            xlSheet.Cells(1, 17) = "BillDisc_Amt"
            xlSheet.Cells(1, 18) = "Taxable_Amt"
            xlSheet.Cells(1, 19) = "Tax_Amt"
            xlSheet.Cells(1, 20) = "Other_Amt"
            xlSheet.Cells(1, 21) = "Net_Amt"
            xlSheet.Cells(1, 22) = "Currency"
            xlSheet.Cells(1, 23) = "ExchgRate"
            xlSheet.Cells(1, 24) = "RsNet_Amt"
            xlSheet.Cells(1, 25) = "Payment Terms"


        End If

        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 40)).Font.Bold = True

        If Rpttype.ToString = "D" Then
            'Query = " SELECT * FROM " & TableName.Trim & " where " & filter & " Order by " & OrderBy & " "
            Query = " SELECT * FROM " & TableName.Trim & " where " & filter & " Order by " & OrderBy & " "
        ElseIf Rpttype.ToString = "S" Then
            Query = " SELECT * FROM " & TableName.Trim & " where " & filter
            '" Order by " & OrderBy & " "
        End If

        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
        Dim recrow As DataRow
        If dtb3CSmall.Rows.Count > 0 Then
            Dim i As Integer = 2
            Dim j As Integer = 2
            Dim k As Integer = 1
            For Each recrow In dtb3CSmall.Rows

                If chkSize.Checked = True Then
                    xlSheet.Cells(j, 1) = k
                    xlSheet.Cells(i, 2) = recrow("Company")
                    xlSheet.Cells(i, 3) = recrow("Sale_Bill")
                    xlSheet.Cells(i, 4) = recrow("Invoice_Date")
                    xlSheet.Cells(i, 5) = recrow("SalesOrder")
                    xlSheet.Cells(i, 6) = recrow("Order_Date")
                    xlSheet.Cells(i, 7) = recrow("BuyerPo_No")
                    xlSheet.Cells(i, 8) = recrow("Sales_Ledger")
                    xlSheet.Cells(i, 9) = recrow("Buyer")
                    xlSheet.Cells(i, 10) = recrow("Brand_name")
                    xlSheet.Cells(i, 11) = recrow("Place")
                    xlSheet.Cells(i, 12) = recrow("state_Name")
                    xlSheet.Cells(i, 13) = recrow("Country")
                    xlSheet.Cells(i, 14) = recrow("Style_Code")
                    xlSheet.Cells(i, 15) = recrow("Shade_Name")
                    xlSheet.Cells(i, 16) = recrow("Item_Name")
                    xlSheet.Cells(i, 17) = recrow("Type_Name")
                    xlSheet.Cells(i, 18) = recrow("Size_Name")
                    xlSheet.Cells(i, 19) = recrow("Qty")
                    xlSheet.Cells(i, 20) = recrow("UOM")
                    xlSheet.Cells(i, 21) = recrow("Gross_Amt")
                    xlSheet.Cells(i, 22) = recrow("TaxAmount")
                    xlSheet.Cells(i, 23) = recrow("Currency")




                    'xlSheet.Cells(j, 1) = k
                    'xlSheet.Cells(i, 2) = recrow("Company")
                    'xlSheet.Cells(i, 3) = recrow("Invoice_NO")
                    'If Rpttype.ToString = "D" Then
                    '    xlSheet.Cells(i, 4) = recrow("Invoice_Date")
                    'ElseIf Rpttype.ToString = "S" Then
                    '    xlSheet.Cells(i, 4) = recrow("InvoiceDate")
                    'End If
                    'xlSheet.Cells(i, 5) = recrow("SalesOrder")
                    'xlSheet.Cells(i, 6) = recrow("BuyerPo_No")
                    'xlSheet.Cells(i, 7) = recrow("Buyer")
                    'If Rpttype.ToString = "D" Then
                    '    xlSheet.Cells(i, 8) = recrow("Place")
                    '    xlSheet.Cells(i, 9) = recrow("Sales_Ledger")
                    '    xlSheet.Cells(i, 10) = recrow("Item_Name")
                    '    xlSheet.Cells(i, 11) = recrow("Style_Code")
                    '    xlSheet.Cells(i, 12) = recrow("Type_Name")
                    '    xlSheet.Cells(i, 13) = recrow("Shade_Name")
                    '    xlSheet.Cells(i, 14) = recrow("Gender")
                    '    xlSheet.Cells(i, 15) = recrow("Brand_Name")
                    '    xlSheet.Cells(i, 16) = recrow("Qty")
                    '    xlSheet.Cells(i, 17) = recrow("UOM")
                    '    xlSheet.Cells(i, 18) = recrow("Rate")
                    '    xlSheet.Cells(i, 19) = recrow("Amount")
                    '    xlSheet.Cells(i, 20) = recrow("TaxPerc")
                    '    xlSheet.Cells(i, 21) = recrow("Tax_Amount")
                    '    xlSheet.Cells(i, 22) = recrow("NetAmt")
                    '    xlSheet.Cells(i, 23) = recrow("Currency")
                    '    xlSheet.Cells(i, 24) = recrow("Payment_Terms")

                    'ElseIf Rpttype.ToString = "S" Then

                    '    xlSheet.Cells(i, 8) = recrow("Brand")
                    '    xlSheet.Cells(i, 9) = recrow("Country")
                    '    xlSheet.Cells(i, 10) = recrow("SalesLedger")
                    '    xlSheet.Cells(i, 11) = recrow("TotQty")
                    '    xlSheet.Cells(i, 12) = recrow("Net_Amt")
                    '    xlSheet.Cells(i, 13) = recrow("Currency")
                    '    xlSheet.Cells(i, 14) = recrow("Payment_Terms")

                    'Rajashri--24-01-2022

                ElseIf Rpttype.ToString = "D" Then
                    xlSheet.Cells(j, 1) = k
                    'xlSheet.Cells(i, 2) = recrow("Sr No.")
                    xlSheet.Cells(i, 2) = recrow("Company")
                    xlSheet.Cells(i, 3) = recrow("Vertical")
                    xlSheet.Cells(i, 4) = recrow("FinancialYear")
                    xlSheet.Cells(i, 5) = recrow("Invoice_NO")
                    xlSheet.Cells(i, 6) = recrow("Invoice_Date")
                    xlSheet.Cells(i, 7) = recrow("SalesOrder")
                    xlSheet.Cells(i, 8) = recrow("Order_Date")
                    xlSheet.Cells(i, 9) = recrow("BuyerPo_No")
                    xlSheet.Cells(i, 10) = recrow("Buyer")
                    xlSheet.Cells(i, 11) = recrow("GSTNo")
                    xlSheet.Cells(i, 12) = recrow("Brand_Name")
                    xlSheet.Cells(i, 13) = recrow("Place")
                    xlSheet.Cells(i, 14) = recrow("State_Name")
                    xlSheet.Cells(i, 15) = recrow("Country")
                    xlSheet.Cells(i, 16) = recrow("Consignee_Name")
                    xlSheet.Cells(i, 17) = recrow("Consignee_Place")
                    xlSheet.Cells(i, 18) = recrow("Consignee_Country")
                    xlSheet.Cells(i, 19) = recrow("Sales_Ledger")
                    xlSheet.Cells(i, 20) = recrow("Item_Name")
                    xlSheet.Cells(i, 21) = recrow("Style_Code")
                    xlSheet.Cells(i, 22) = recrow("Type_Name")
                    xlSheet.Cells(i, 23) = recrow("Shade_Name")
                    xlSheet.Cells(i, 24) = recrow("Gender")
                    xlSheet.Cells(i, 25) = recrow("HSNCode")
                    xlSheet.Cells(i, 26) = recrow("Qty")
                    xlSheet.Cells(i, 27) = recrow("UOM")
                    xlSheet.Cells(i, 28) = recrow("Rate")
                    xlSheet.Cells(i, 29) = recrow("Amount")
                    xlSheet.Cells(i, 30) = recrow("Discount")
                    xlSheet.Cells(i, 31) = recrow("Discount_Amt")
                    xlSheet.Cells(i, 32) = recrow("Taxable")
                    xlSheet.Cells(i, 33) = recrow("TaxPerc")
                    xlSheet.Cells(i, 34) = recrow("Tax_Amount")
                    xlSheet.Cells(i, 35) = recrow("NetAmt")
                    xlSheet.Cells(i, 36) = recrow("Currency")
                    xlSheet.Cells(i, 37) = recrow("Exchgrate")
                    xlSheet.Cells(i, 38) = recrow("Payment_Terms")

                ElseIf Rpttype.ToString = "S" Then
                    xlSheet.Cells(j, 1) = k
                    'xlSheet.Cells(i, 2) = recrow("Company")
                    'xlSheet.Cells(i, 3) = recrow("Sale_Bill")
                    'xlSheet.Cells(i, 4) = recrow("InvoiceDate")
                    'xlSheet.Cells(i, 5) = recrow("Sales_Order")
                    'xlSheet.Cells(i, 6) = recrow("BuyerPo_No")
                    'xlSheet.Cells(i, 7) = recrow("Buyer")
                    'xlSheet.Cells(i, 8) = recrow("Brand")
                    'xlSheet.Cells(i, 9) = recrow("Country")
                    'xlSheet.Cells(i, 10) = recrow("SalesLedger")
                    'xlSheet.Cells(i, 11) = recrow("TotQty")
                    'xlSheet.Cells(i, 12) = recrow("Net_Amt")
                    'xlSheet.Cells(i, 13) = recrow("Currency")
                    'xlSheet.Cells(i, 14) = recrow("Payment_Terms")

                    ' Rajashri-25-01-2022

                    xlSheet.Cells(i, 2) = recrow("Company")
                    xlSheet.Cells(i, 3) = recrow("Vertical")
                    xlSheet.Cells(i, 4) = recrow("FinancialYear")
                    xlSheet.Cells(i, 5) = recrow("SaleBill")
                    xlSheet.Cells(i, 6) = recrow("Invoice_Date")
                    xlSheet.Cells(i, 7) = recrow("BuyerPoNo")
                    xlSheet.Cells(i, 8) = recrow("Buyer")
                    xlSheet.Cells(i, 9) = recrow("Brand")
                    xlSheet.Cells(i, 10) = recrow("Place")
                    xlSheet.Cells(i, 11) = recrow("State_Name")
                    xlSheet.Cells(i, 12) = recrow("Country")
                    xlSheet.Cells(i, 13) = recrow("Sales Ledger")
                    xlSheet.Cells(i, 14) = recrow("TotQty")
                    xlSheet.Cells(i, 15) = recrow("Gross_Amt")
                    xlSheet.Cells(i, 16) = recrow("Discount")
                    xlSheet.Cells(i, 17) = recrow("BillDisc_Amt")
                    xlSheet.Cells(i, 18) = recrow("Taxable_Amt")
                    xlSheet.Cells(i, 19) = recrow("Tax_Amt")
                    xlSheet.Cells(i, 20) = recrow("Other_Amt")
                    xlSheet.Cells(i, 21) = recrow("Net_Amt")
                    xlSheet.Cells(i, 22) = recrow("Currency")
                    xlSheet.Cells(i, 23) = recrow("ExchgRate")
                    xlSheet.Cells(i, 24) = recrow("RsNet_Amt")
                    xlSheet.Cells(i, 25) = recrow("Payment Terms")
                End If


                i += 1
                j += 1
                k += 1
            Next recrow
            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
        End If

        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
        xlSheet.Columns.AutoFit()

        Try
            xlSheet.SaveAs(Application.StartupPath & "Invoice Report Details" & "-" & Today & ".xlsx")
        Catch ex As Exception
            Exit Sub
        End Try

        xlApp.Visible = True
        Exit Sub
    End Sub


    Private Sub ExportJobWorkPPDetails(ByVal filter As String, ByVal TableName As String, ByVal OrderBy As String)
        Dim Trans As SqlTransaction
        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
        Dim xlApp As New Excel.Application
        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
        Dim Reg As String = ""
        xlSheet.Cells(1, 1) = "Sr No."
        xlSheet.Cells(1, 2) = "JOB ORDER"
        xlSheet.Cells(1, 3) = "User Name"
        xlSheet.Cells(1, 4) = "JW Date"
        xlSheet.Cells(1, 5) = "PP NO"
        xlSheet.Cells(1, 6) = "SO NO"
        xlSheet.Cells(1, 7) = "Style"
        xlSheet.Cells(1, 8) = "Brand"
        xlSheet.Cells(1, 9) = "Job Worker"
        xlSheet.Cells(1, 10) = "Place"
        xlSheet.Cells(1, 11) = "Items"
        xlSheet.Cells(1, 12) = "Type"
        xlSheet.Cells(1, 13) = "Shade"
        xlSheet.Cells(1, 14) = "Gender"




        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 24)).Font.Bold = True

        Query = " SELECT * FROM " & TableName.Trim & " where " & filter & " Order by " & OrderBy & " "

        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
        Dim recrow As DataRow
        If dtb3CSmall.Rows.Count > 0 Then
            Dim i As Integer = 2
            Dim j As Integer = 2
            Dim k As Integer = 1
            For Each recrow In dtb3CSmall.Rows
                xlSheet.Cells(j, 1) = k
                xlSheet.Cells(i, 2) = recrow("JOBORDER")
                xlSheet.Cells(i, 3) = recrow("Username")
                xlSheet.Cells(i, 4) = recrow("JW_Date")
                xlSheet.Cells(i, 5) = recrow("PP_NO")
                xlSheet.Cells(i, 6) = recrow("SO_NO")
                xlSheet.Cells(i, 7) = recrow("Style_Code")
                xlSheet.Cells(i, 8) = recrow("Brand")
                xlSheet.Cells(i, 9) = recrow("Job_Worker")
                xlSheet.Cells(i, 10) = recrow("Place")
                xlSheet.Cells(i, 11) = recrow("Item_Name")
                xlSheet.Cells(i, 12) = recrow("Type_Name")
                xlSheet.Cells(i, 13) = recrow("Shade_Name")
                xlSheet.Cells(i, 14) = recrow("Gender")

                i += 1
                j += 1
                k += 1
            Next recrow
            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
        End If

        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
        xlSheet.Columns.AutoFit()

        Try
            xlSheet.SaveAs(Application.StartupPath & "Job Work PPWise" & "-" & Today & ".xlsx")
        Catch ex As Exception
            Exit Sub
        End Try

        xlApp.Visible = True
        Exit Sub
    End Sub


    Private Sub ExportPPStatusNew(ByVal filter As String, ByVal TableName As String, ByVal OrderBy As String)

        'If CurrIntId = 0 Then Exit Sub

        'If MsgBox("Export Sales Order data ", MsgBoxStyle.Question + MsgBoxStyle.YesNo) = MsgBoxResult.No Then Exit Sub

        Try
            Query = " SELECT * FROM " & TableName.Trim & " where " & filter & " Order by " & OrderBy & " "



            Dim dt As DataTable = Common.GetDataTable(Query)

            If dt.Rows.Count > 0 Then

                Dim onlyfilename As String = "PPStatus_" + DateTime.Now.ToString("ddMMyyyyHHmmss") + ".xlsx"
                Dim downloadfolder As String = Application.StartupPath
                Dim excelfile As String = downloadfolder + "/" + onlyfilename
                Dim fl As New FileInfo(excelfile)

                ' If you are a commercial business and have
                ' purchased commercial licenses use the static property
                ' LicenseContext of the ExcelPackage class :

                'ExcelPackage.LicenseContext = LicenseContext.NonCommercial
                Dim pck As New ExcelPackage(fl)
                Dim ws As ExcelWorksheet = pck.Workbook.Worksheets.Add("PPStatus")
                ws.Cells("A1:Z1").Style.Font.Bold = True
                ws.Cells("A1").LoadFromDataTable(dt, True)
                'ws.Column(11).Style.Numberformat.Format = "0.00"
                'ws.Column(12).Style.Numberformat.Format = "0.00"
                'ws.Column(13).Style.Numberformat.Format = "0.00"
                'ws.Column(14).Style.Numberformat.Format = "0.00"
                'ws.Column(15).Style.Numberformat.Format = "0.00"
                'ws.Column(16).Style.Numberformat.Format = "0.00"
                'ws.Column(17).Style.Numberformat.Format = "0.00"
                'ws.Column(18).Style.Numberformat.Format = "0.00"
                'ws.Column(19).Style.Numberformat.Format = "0.00"
                'ws.Column(20).Style.Numberformat.Format = "0.00"
                'ws.Column(21).Style.Numberformat.Format = "dd/MM/yyyy"
                'ws.Column(2).Style.Numberformat.Format = "dd/MM/yyyy"
                ws.Cells(ws.Dimension.Address).AutoFitColumns()
                pck.Save()


                'xlSheet.SaveAs(Application.StartupPath & "PP Status" & "-" & Today & ".xlsx")
                MsgBox("Data successfully exported." & excelfile, MsgBoxStyle.Information)



            End If

        Catch sqlEx As SqlException
            Common.LogAndDisplayException(sqlEx)
        Catch ex As Exception
            Common.LogAndDisplayException(ex)
        Finally
            Me.Cursor = Cursors.Default
        End Try



    End Sub


    Private Sub ExportPPStatus(ByVal filter As String, ByVal TableName As String, ByVal OrderBy As String)
        Dim Trans As SqlTransaction
        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
        Dim xlApp As New Excel.Application
        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
        Dim Reg As String = ""
        xlSheet.Cells(1, 1) = "Sr No."
        xlSheet.Cells(1, 2) = "Vertical"
        xlSheet.Cells(1, 3) = "Status"
        xlSheet.Cells(1, 4) = "PP No."
        xlSheet.Cells(1, 5) = "PP Date"
        xlSheet.Cells(1, 6) = "PPApproval Date"
        xlSheet.Cells(1, 7) = "Username"
        xlSheet.Cells(1, 8) = "Vendor"
        xlSheet.Cells(1, 9) = "ItemSubGrp Name"
        xlSheet.Cells(1, 10) = "Item Name"
        xlSheet.Cells(1, 11) = "Shade Name"
        xlSheet.Cells(1, 12) = "Require Qty"
        xlSheet.Cells(1, 13) = "Bal Qty"
        xlSheet.Cells(1, 14) = "UOM"
        xlSheet.Cells(1, 15) = "PO No"
        xlSheet.Cells(1, 16) = "PO Date"
        xlSheet.Cells(1, 17) = "PO Qty"
        xlSheet.Cells(1, 18) = "Bal Qty"
        xlSheet.Cells(1, 19) = "GRN No"
        xlSheet.Cells(1, 20) = "SalesOrder No"
        xlSheet.Cells(1, 21) = "SO Date"
        xlSheet.Cells(1, 22) = "Brand Name"
        xlSheet.Cells(1, 23) = "COUNTRY"
        xlSheet.Cells(1, 24) = "FName"


        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 24)).Font.Bold = True

        Query = " SELECT * FROM " & TableName.Trim & " where " & filter & " Order by " & OrderBy & " "

        'changed by rajshri 19/01/2022

        ' Query = " SELECT 1,Vertical,Status,PP_No,PPApprovalDate,Username,Vendor,ITEMSUBGRP_NAME,ITEM_NAME,SHADE_NAME,Require_Qty,Bal_Qty,UOM,PO_No,PO_Date,PO_Qty,BalQty,GRN_No,SalesOrder_No,SO_Date,Brand_Name,COUNTRY,FName, FROM " & TableName.Trim & " where " & filter & " Order by " & OrderBy & " "


        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
        Dim recrow As DataRow
        If dtb3CSmall.Rows.Count > 0 Then
            Dim i As Integer = 2
            Dim j As Integer = 2
            Dim k As Integer = 1
            For Each recrow In dtb3CSmall.Rows
                xlSheet.Cells(j, 1) = k
                xlSheet.Cells(i, 2) = recrow("Vertical")
                xlSheet.Cells(i, 3) = recrow("Status")
                xlSheet.Cells(i, 4) = recrow("PP_No")
                xlSheet.Cells(i, 5) = recrow("PP_Date")
                xlSheet.Cells(i, 6) = recrow("PPApprovalDate")
                xlSheet.Cells(i, 7) = recrow("Username")
                xlSheet.Cells(i, 8) = recrow("Vendor")
                xlSheet.Cells(i, 9) = recrow("ITEMSUBGRP_NAME")
                xlSheet.Cells(i, 10) = recrow("ITEM_NAME")
                xlSheet.Cells(i, 11) = recrow("SHADE_NAME")
                xlSheet.Cells(i, 12) = recrow("Require_Qty")
                xlSheet.Cells(i, 13) = recrow("Bal_Qty")
                xlSheet.Cells(i, 14) = recrow("UOM")
                xlSheet.Cells(i, 15) = recrow("PO_No")
                xlSheet.Cells(i, 16) = recrow("PO_Date")
                xlSheet.Cells(i, 17) = recrow("PO_Qty")
                xlSheet.Cells(i, 18) = recrow("BalQty")
                xlSheet.Cells(i, 19) = recrow("GRN_No")
                xlSheet.Cells(i, 20) = recrow("SalesOrder_No")
                xlSheet.Cells(i, 21) = recrow("SO_Date")
                xlSheet.Cells(i, 22) = recrow("Brand_Name")
                xlSheet.Cells(i, 23) = recrow("COUNTRY")
                xlSheet.Cells(i, 24) = recrow("FName")
                i += 1
                j += 1
                k += 1
                'Dim onlyfilename As String = "PP Status_" + DateTime.Now.ToString("ddMMyyyyHHmmss") + ".xlsx"
                'Dim downloadfolder As String = Application.StartupPath
                'Dim excelfile As String = downloadfolder + "/" + onlyfilename
                'Dim fl As New FileInfo(excelfile)

                ''If you are a commercial business and have
                '' purchased commercial licenses use the static property
                ''LicenseContext of the ExcelPackage class :

                'ExcelPackage.LicenseConte = LicenseContext.NonCommercial
                'Dim pck As New ExcelPackage(fl)
                'Dim ws As ExcelWorksheet = pck.Workbook.Worksheets.Add("PP Status")

                ' ws.Cells("A1:O1").Style.Font.Bold = True
                'ws.Cells("A1").LoadFromDataTable(dt, True)
                'ws.Column(11).Style.Numberformat.Format = "0.00"
                'ws.Column(12).Style.Numberformat.Format = "0.00"
                'ws.Column(13).Style.Numberformat.Format = "0.00"
                'ws.Column(14).Style.Numberformat.Format = "0.00"
                'ws.Column(15).Style.Numberformat.Format = "0.00"
                'ws.Column(16).Style.Numberformat.Format = "0.00"
                'ws.Column(17).Style.Numberformat.Format = "0.00"
                'ws.Column(18).Style.Numberformat.Format = "0.00"
                'ws.Column(19).Style.Numberformat.Format = "0.00"
                'ws.Column(20).Style.Numberformat.Format = "0.00"
                'ws.Column(21).Style.Numberformat.Format = "dd/MM/yyyy"
                'ws.Column(2).Style.Numberformat.Format = "dd/MM/yyyy"
                'ws.Cells(ws.Dimension.Address).AutoFitColumns()
                'pck.Save()
            Next recrow
            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
        End If

        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
        xlSheet.Columns.AutoFit()

        Try
            xlSheet.SaveAs(Application.StartupPath & "PP Status" & "-" & Today & ".xlsx")
        Catch ex As Exception
            Exit Sub
        End Try

        xlApp.Visible = True
        Exit Sub
    End Sub

    Private Sub ExportPendingGRNAgainstPO(ByVal filter As String, ByVal TableName As String, ByVal OrderBy As String)
        Dim Trans As SqlTransaction
        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
        Dim xlApp As New Excel.Application
        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
        Dim Reg As String = ""
        xlSheet.Cells(1, 1) = "Sr No."
        xlSheet.Cells(1, 2) = "Doc No"
        xlSheet.Cells(1, 3) = "PO Date"
        xlSheet.Cells(1, 4) = "User Name"
        xlSheet.Cells(1, 5) = "PP NO"
        xlSheet.Cells(1, 6) = "PP Date"
        xlSheet.Cells(1, 7) = "SO No"
        xlSheet.Cells(1, 8) = "Buyer"
        xlSheet.Cells(1, 9) = "Country"
        xlSheet.Cells(1, 10) = "Consignee"
        xlSheet.Cells(1, 11) = "Consignee Country"
        xlSheet.Cells(1, 12) = "Brand"
        xlSheet.Cells(1, 13) = "Style Code"
        xlSheet.Cells(1, 14) = "Type"
        xlSheet.Cells(1, 15) = "Style Shade"
        xlSheet.Cells(1, 16) = "Vendor"
        xlSheet.Cells(1, 17) = "Material Type"
        xlSheet.Cells(1, 18) = "Item Group"
        xlSheet.Cells(1, 19) = "Item Name"
        xlSheet.Cells(1, 20) = "SHADE NAME"
        xlSheet.Cells(1, 21) = "Order Qty"
        xlSheet.Cells(1, 22) = "Bal Qty"
        xlSheet.Cells(1, 23) = "UOM"
        
        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 24)).Font.Bold = True

        Query = " SELECT * FROM " & TableName.Trim & " where " & filter & " Order by " & OrderBy & " "

        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
        Dim recrow As DataRow
        If dtb3CSmall.Rows.Count > 0 Then
            Dim i As Integer = 2
            Dim j As Integer = 2
            Dim k As Integer = 1
            For Each recrow In dtb3CSmall.Rows
                xlSheet.Cells(j, 1) = k
                xlSheet.Cells(i, 2) = recrow("Doc_No")
                xlSheet.Cells(i, 3) = recrow("PO_Date")
                xlSheet.Cells(i, 4) = recrow("Username")
                xlSheet.Cells(i, 5) = recrow("PPNO")
                xlSheet.Cells(i, 6) = recrow("PP_Date")
                xlSheet.Cells(i, 7) = recrow("SONo")
                xlSheet.Cells(i, 8) = recrow("Buyer")
                xlSheet.Cells(i, 9) = recrow("Country")
                xlSheet.Cells(i, 10) = recrow("Consignee")
                xlSheet.Cells(i, 11) = recrow("Consignee_Country")
                xlSheet.Cells(i, 12) = recrow("Brand_Name")
                xlSheet.Cells(i, 13) = recrow("Style_Code")
                xlSheet.Cells(i, 14) = recrow("Type_Name")
                xlSheet.Cells(i, 15) = recrow("StyleShade")
                xlSheet.Cells(i, 16) = recrow("Vendor")
                xlSheet.Cells(i, 17) = recrow("Material_Type")
                xlSheet.Cells(i, 18) = recrow("Item_Group")
                xlSheet.Cells(i, 19) = recrow("Item_Name")
                xlSheet.Cells(i, 20) = recrow("SHADE_NAME")
                xlSheet.Cells(i, 21) = recrow("Order_Qty")
                xlSheet.Cells(i, 22) = recrow("BalQty")
                xlSheet.Cells(i, 23) = recrow("UOM")
                i += 1
                j += 1
                k += 1
            Next recrow
            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
        End If

        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
        xlSheet.Columns.AutoFit()

        Try
            xlSheet.SaveAs(Application.StartupPath & "Pending GRN Against PO" & "-" & Today & ".xlsx")
        Catch ex As Exception
            Exit Sub
        End Try

        xlApp.Visible = True
        Exit Sub
    End Sub

    Private Sub ExportItemStockSummaryDetails(ByVal filter As String, ByVal Rpttype As String, ByVal TableName As String, ByVal OrderBy As String)
        Dim Trans As SqlTransaction
        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
        Dim xlApp As New Excel.Application
        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
        Dim Reg As String = ""
        xlSheet.Cells(1, 1) = "Sr No."
        xlSheet.Cells(1, 2) = "Company"
        xlSheet.Cells(1, 3) = "Vertical"
        xlSheet.Cells(1, 4) = "Product"
        xlSheet.Cells(1, 5) = "Style"
        xlSheet.Cells(1, 6) = "Type"
        xlSheet.Cells(1, 7) = "Shade"
        xlSheet.Cells(1, 8) = "User"
        xlSheet.Cells(1, 9) = "Gender"
        xlSheet.Cells(1, 10) = "HSNCode"
        xlSheet.Cells(1, 11) = "Mfg/Trd"
        xlSheet.Cells(1, 12) = "Brand"
        xlSheet.Cells(1, 13) = "Stock"
        If Rpttype.ToString = "D" Then
            xlSheet.Cells(1, 14) = "Size"
        End If

        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 24)).Font.Bold = True

        Query = " SELECT * FROM " & TableName.Trim & " where " & filter & " Order by " & OrderBy & " "

        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
        Dim recrow As DataRow
        If dtb3CSmall.Rows.Count > 0 Then
            Dim i As Integer = 2
            Dim j As Integer = 2
            Dim k As Integer = 1
            For Each recrow In dtb3CSmall.Rows
                xlSheet.Cells(j, 1) = k
                xlSheet.Cells(i, 2) = recrow("Cobr_Name")
                xlSheet.Cells(i, 3) = recrow("Vertical")
                xlSheet.Cells(i, 4) = recrow("Product")
                xlSheet.Cells(i, 5) = recrow("Style_Code")
                xlSheet.Cells(i, 6) = recrow("Type_Name")
                xlSheet.Cells(i, 7) = recrow("Shade_Name")
                xlSheet.Cells(i, 8) = recrow("User")
                xlSheet.Cells(i, 9) = recrow("Gender")
                xlSheet.Cells(i, 10) = recrow("HSNCode")
                xlSheet.Cells(i, 11) = recrow("MfgTrd")
                xlSheet.Cells(i, 12) = recrow("Brand_name")
                xlSheet.Cells(i, 13) = recrow("Actual_Stock")
                If Rpttype.ToString = "D" Then
                    xlSheet.Cells(i, 14) = "'" & recrow("Size_Name")
                End If

                i += 1
                j += 1
                k += 1
            Next recrow
            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
        End If

        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
        xlSheet.Columns.AutoFit()

        Try
            xlSheet.SaveAs(Application.StartupPath & "Invoice Report Details" & "-" & Today & ".xlsx")
        Catch ex As Exception
            Exit Sub
        End Try

        xlApp.Visible = True
        Exit Sub
    End Sub


    Private Sub ExportSalesOrderBalance(ByVal filter As String, ByVal Rpttype As String, ByVal TableName As String, ByVal OrderBy As String)
        Dim Trans As SqlTransaction
        Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
        Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
        Dim xlApp As New Excel.Application
        Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
        Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet
        Dim Reg As String = ""
        xlSheet.Cells(1, 1) = "Sr No."
        xlSheet.Cells(1, 2) = "Company"
        xlSheet.Cells(1, 3) = "Status"
        xlSheet.Cells(1, 4) = "Vertical"
        xlSheet.Cells(1, 5) = "Sales Order"
        xlSheet.Cells(1, 6) = "Order Date"
        xlSheet.Cells(1, 7) = "Year"
        xlSheet.Cells(1, 8) = "Buyer PO"
        xlSheet.Cells(1, 9) = "User Name"
        xlSheet.Cells(1, 10) = "Buyer"
        xlSheet.Cells(1, 11) = "Brand"
        xlSheet.Cells(1, 12) = "Country"
        xlSheet.Cells(1, 13) = "Style"
        xlSheet.Cells(1, 14) = "Shade"
        xlSheet.Cells(1, 15) = "Product"
        xlSheet.Cells(1, 16) = "Type"
        xlSheet.Cells(1, 17) = "SO Quantity"
        xlSheet.Cells(1, 18) = "UOM"
        xlSheet.Cells(1, 19) = "Amount"
        xlSheet.Cells(1, 20) = "Currency"
        xlSheet.Cells(1, 21) = "Sale Bill"
        xlSheet.Cells(1, 22) = "Dispatch Qty"
        xlSheet.Cells(1, 23) = "Dispatch Amt"

        'If Rpttype.ToString = "D" Then
        '    xlSheet.Cells(1, 14) = "Size"
        'End If

        xlSheet.Range(xlSheet.Cells(1, 1), xlSheet.Cells(1, 24)).Font.Bold = True

        Query = " SELECT * FROM " & TableName.Trim & " where " & filter & " Order by " & OrderBy & " "

        Dim dtb3CSmall As DataTable = Common.GetDataTable(Query)
        Dim recrow As DataRow
        If dtb3CSmall.Rows.Count > 0 Then
            Dim i As Integer = 2
            Dim j As Integer = 2
            Dim k As Integer = 1
            For Each recrow In dtb3CSmall.Rows
                xlSheet.Cells(j, 1) = k
                xlSheet.Cells(i, 2) = recrow("Company")
                xlSheet.Cells(i, 3) = recrow("Status")
                xlSheet.Cells(i, 4) = recrow("Vertical")
                xlSheet.Cells(i, 5) = recrow("SoDoc_No")
                xlSheet.Cells(i, 6) = recrow("Order_Date")
                xlSheet.Cells(i, 7) = recrow("fcyr_id")
                xlSheet.Cells(i, 8) = recrow("BuyerPo_No")
                xlSheet.Cells(i, 9) = recrow("Username")
                xlSheet.Cells(i, 10) = recrow("Buyer")
                xlSheet.Cells(i, 11) = recrow("Brand_name")
                xlSheet.Cells(i, 12) = recrow("Country")
                xlSheet.Cells(i, 13) = recrow("Style_Code")
                xlSheet.Cells(i, 14) = recrow("Shade_Name")
                xlSheet.Cells(i, 15) = recrow("Item_Name")
                xlSheet.Cells(i, 16) = recrow("Type_Name")
                xlSheet.Cells(i, 17) = recrow("SO_Qty")
                xlSheet.Cells(i, 18) = recrow("UOM")
                xlSheet.Cells(i, 19) = recrow("SO_Amt")
                xlSheet.Cells(i, 20) = recrow("Currency")
                xlSheet.Cells(i, 21) = recrow("SaleBill")
                xlSheet.Cells(i, 22) = recrow("Dispatch_Qty")
                xlSheet.Cells(i, 23) = recrow("Dispatch_Amt")

                
                'If Rpttype.ToString = "D" Then
                '    xlSheet.Cells(i, 14) = "'" & recrow("Size_Name")
                'End If

                i += 1
                j += 1
                k += 1
            Next recrow
            xlSheet.Range("A1", "O1").HorizontalAlignment = Excel.XlHAlign.xlHAlignLeft
        End If

        xlSheet.Rows(1).HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
        xlSheet.Columns.AutoFit()

        Try
            xlSheet.SaveAs(Application.StartupPath & "Invoice Report Details" & "-" & Today & ".xlsx")
        Catch ex As Exception
            Exit Sub
        End Try

        xlApp.Visible = True
        Exit Sub
    End Sub

    Private Sub btnGSTR1NEW_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnGstR1New.Click
        Try
            If GetSettingAsPerId(ApplnSettingsIdx.DisplayStateinGSTR) = "1" Then

                If cmbStateGSTR.ItemIndex = -1 Then
                    MsgBox("State has not been provided !", MsgBoxStyle.Exclamation)
                    cmbStateGSTR.Focus()
                    Exit Sub
                End If

                If cmbStateGSTR.ItemIndex = -1 Then
                    MsgBox("Store has not been provided !", MsgBoxStyle.Exclamation)
                    cmbStateGSTR.Focus()
                    Exit Sub
                End If
            End If


            If MsgBox("Do You Want To Continue GSTR1 , It Will Take Some Time", MsgBoxStyle.Question + MsgBoxStyle.YesNo) = MsgBoxResult.No Then

                Exit Sub
            End If
            btnGstR1New.Enabled = False
            Cursor = Cursors.WaitCursor
            Dim DocB2B As Integer = 0
            Dim DocB2CL As Integer = 0
            Dim DocB2CS As Integer = 0
            Dim DocCDNR As Integer = 0
            Dim DocCDNU As Integer = 0

            If (Not System.IO.Directory.Exists(System.Windows.Forms.Application.StartupPath & "\GSTR-1")) Then
                System.IO.Directory.CreateDirectory(System.Windows.Forms.Application.StartupPath & "\GSTR-1")
                MsgBox("GSTR-1 Excel file Not Found  !", MsgBoxStyle.Exclamation)
                Cursor = Cursors.Default
                btnGSTR1Excel.Enabled = True
                Exit Sub
            End If
            If (Not System.IO.File.Exists(System.Windows.Forms.Application.StartupPath & "\GSTR-1\MyGstCafe_Format.xlsx")) Then
                MsgBox("GSTR-1 Excel file Not Found  !", MsgBoxStyle.Exclamation)
                Cursor = Cursors.Default
                btnGSTR1Excel.Enabled = True
                Exit Sub
            End If
            'If System.IO.File.Open(System.Windows.Forms.Application.StartupPath & "\GSTR-1\SAT5.xlsx", System.IO.File.Open) Then
            '    System.IO.File.Delete(System.Windows.Forms.Application.StartupPath & "GSTR-1\SAT5.xlsx")
            '    Exit Sub
            'End If
            Dim xlApp As New Excel.Application
            Dim xlBook As Excel.Workbook = xlApp.Workbooks.Open(System.Windows.Forms.Application.StartupPath & "\GSTR-1\MyGstCafe_Format.xlsx", , False)
            'xlBook.Activate()

            Dim Trans As SqlTransaction
            Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
            Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
            Query = "Select GSTNo from cobr where cobr_id=  " & SelBranchId
            Dim GST As String = Common.ExecuteScalar(Query, Nothing)


            Dim StateCode As String = ""
            If GST.Trim.Length > 0 Then
                StateCode = Mid$(GST, 1, 2)
            End If

            Dim b2b As Integer = 0
            Dim cdnr As Integer = 0
            Dim StateName As String = ""
            If GetSettingAsPerId(ApplnSettingsIdx.DisplayStateinGSTR) = "1" Then
                Query = "  Select STATE.STATE_Name from cobr LEFT JOIN STATION ON STATION.STN_KEY = cobr.STN_KEY   " _
                & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  where cobr.cobr_id= " & SelBranchId
                Dim StateN As String = Common.ExecuteScalar(Query, Nothing)
                If StateN.Trim.Length > 0 Then
                    If cmbStateGSTR.Text <> StateN Then
                        b2b = 1
                        cdnr = 1
                        If cmbStateGSTR.ItemIndex <> -1 And chkStatewise.Checked = True Then
                            StateName = "And STATE.STATE_KEY= '" & cmbStateGSTR.EditValue & "'"
                        ElseIf cmbStore.EditValue <> -1 And chkStorewise.Checked = True Then
                            StateName += "And Ledger.Led_KEY= '" & cmbStore.EditValue & "'"
                        End If

                    End If

                End If

            End If
            Dim strSrch As String = ""
            Dim xlSheet As Excel.Worksheet
            If b2b = 0 Then


                '-----------B2B-------Ecel------------------------------
                xlSheet = xlBook.Worksheets("B2B")
                'xlSheet = xlBook.ActiveSheet


                'xlBook("exemp").Range("A").Clear()
                'If xlSheet.Protection.AllowInsertingRows = False Then
                '    'xlBook.Protect(AllowInsertingRow:=True) 
                '    xlSheet.Protect(AllowInsertingRows:=False)
                'End If






                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_B2BInvoices]')) " _
                                   & " Drop View [dbo].[vw_B2BInvoices]"
                Common.ExecuteQuery(Query)

                Query = "Create View vw_B2BInvoices As  " _
                                 & " Select State.Alt_code,SalebillTxTm.TaxTerm_Perc, SaleBill.Net_Amt, SalebillTxTm.Tax_Amt,SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc,SaleBill.Doc_Id,Ledger.GSTNo,State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Doc_Dt ," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm INNER JOIN TaxTermsTDS ON TaxTerm_Key=TxTmTDS_Key WHere salebilltxtm.AddSubTract='+' and TaxTerm_Perc in (2.5,5,0.00) AND TaxTermsTDS.TxTmTDS_Flag ='X' And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (0.05,0.1)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.1 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                                 & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                                 & "LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                & " Left Join SalebillTxTm on SalebillTxTm.Doc_Id=SaleBill.Doc_Id " _
                                 & " Where SaleBill.Status = '1' And Ledger.GSTNo<>'' " _
                                 & " AND SaleBill.Doc_Type='A' and SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' And SaleBill.FcYr_Id ='" & SelYearId & "' "
                '   & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt" _
                '  & strSrch

                'Query = "Create View vw_B2BInvoices As  " _
                '              & " Select SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc,SaleBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Doc_Dt ," _
                '              & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm INNER JOIN TaxTermsTDS ON TaxTerm_Key=TxTmTDS_Key WHere salebilltxtm.AddSubTract='+' and TaxTerm_Perc in (2.5,5,0.00) AND TaxTermsTDS.TxTmTDS_Flag ='X' And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                '              & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                '              & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                '              & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (0.05,0.1)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.1 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                '              & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                '              & "LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                '             & " Left Join SalebillTxTm on SalebillTxTm.Doc_Id=SaleBill.Doc_Id " _
                '              & " Where SaleBill.Status = '1' And Ledger.GSTNo<>'' " _
                '              & " AND SaleBill.Doc_Type='A' and SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' "
                Common.ExecuteQuery(Query)

                Query = "SELECT  Taxable_Amt,Net_Amt,Tax_Amt ,Tax1_Perc, GSTNo,Party,InvoiceNo,convert(varchar, Doc_Dt, 103)as Doc_Dt,PlaceofSupply,Taxable_Amt,(GST5+CGST +SGST+IGST5+GST12+CGST6+SGST6+IGST12+GST18+CGST9+SGST9+IGST18+GST28+CGST14+SGST14+IGST28)as Gross_Total,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28 , cast(Tax1_perc*taxable_amt/100 as decimal(10,2) ) IGST_TOT,cast(Tax1_perc*taxable_amt/100 as decimal(10,2)) cgst_tot,cast(Tax1_perc*taxable_amt/100 as decimal(10,2) ) sgst_tot,Alt_Code FROM vw_B2BInvoices " _
                       & "where Tax1_Perc> 0 group by Taxable_Amt,Net_Amt,Tax_Amt, Taxable_Amt,Tax1_Perc,GSTNo,Party,InvoiceNo, Doc_Dt,PlaceofSupply,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28 ,Alt_Code Order by  InvoiceNo Asc"

                Dim dtb2CSmall As System.Data.DataTable = Common.GetDataTable(Query)
                Dim recrow As DataRow


             



                If dtb2CSmall.Rows.Count > 0 Then


                    Dim i As Integer = 5

                    For Each recrow In dtb2CSmall.Rows

                        If Val(GetSettingAsPerId(ApplnSettingsIdx.NewSoftWare)) = 0 Then
                       
                            xlSheet.Cells(i, 1) = recrow("GSTNo")
                            xlSheet.Cells(i, 2) = recrow("InvoiceNo") & ""
                            xlSheet.Cells(i, 3) = recrow("Doc_Dt")
                            xlSheet.Cells(i, 4) = Val(recrow("Net_Amt"))
                            xlSheet.Cells(i, 5) = recrow("PlaceofSupply") & ""
                            xlSheet.Cells(i, 6) = "N"
                            xlSheet.Cells(i, 7) = ""
                            xlSheet.Cells(i, 8) = "Regular" 'recrow("PlaceofSupply")
                            xlSheet.Cells(i, 9) = ""
                            If Val(recrow("Tax1_Perc")) = 2.5 Then  'Tax1_Perc
                                xlSheet.Cells(i, 10) = 5
                            ElseIf Val(recrow("Tax1_Perc")) = 6 Then
                                xlSheet.Cells(i, 10) = 12
                            ElseIf Val(recrow("Tax1_Perc")) = 9 Then
                                xlSheet.Cells(i, 10) = 18
                            ElseIf Val(recrow("Tax1_Perc")) = 14 Then
                                xlSheet.Cells(i, 10) = 28
                            Else
                                xlSheet.Cells(i, 10) = ""
                                xlSheet.Cells(i, 10) = recrow("Tax1_Perc") & "" 'Tax1_Perc
                            End If

                            xlSheet.Cells(i, 11) = recrow("Taxable_Amt")
                            xlSheet.Cells(i, 12) = "" ' 0


                        Else
                            xlSheet.Cells(i, 1) = recrow("Party")


                            xlSheet.Cells(i, 2) = recrow("GSTNo")
                            xlSheet.Cells(i, 3) = recrow("InvoiceNo") & ""
                            xlSheet.Cells(i, 4) = recrow("Doc_Dt")
                            xlSheet.Cells(i, 5) = Val(recrow("Net_Amt"))
                            xlSheet.Cells(i, 6) = recrow("PlaceofSupply") & ""
                            xlSheet.Cells(i, 7) = "N"
                            xlSheet.Cells(i, 8) = "N"
                            xlSheet.Cells(i, 9) = "Regular" 'recrow("PlaceofSupply")

                            xlSheet.Cells(i, 10) = ""
                            xlSheet.Cells(i, 11) = ""
                            xlSheet.Cells(i, 12) = ""
                           
                            xlSheet.Cells(i, 13) = recrow("Taxable_Amt")


                            If Val(recrow("Tax1_Perc")) = 2.5 Then  'Tax1_Perc
                                xlSheet.Cells(i, 14) = 5
                            ElseIf Val(recrow("Tax1_Perc")) = 6 Then
                                xlSheet.Cells(i, 14) = 12
                            ElseIf Val(recrow("Tax1_Perc")) = 9 Then
                                xlSheet.Cells(i, 14) = 18
                            ElseIf Val(recrow("Tax1_Perc")) = 14 Then
                                xlSheet.Cells(i, 14) = 28
                            Else
                                xlSheet.Cells(i, 14) = ""
                                xlSheet.Cells(i, 14) = recrow("Tax1_Perc") & "" 'Tax1_Perc
                            End If

                            If StateCode = recrow("Alt_code") Then ' 

                                xlSheet.Cells(i, 15) = ""
                                xlSheet.Cells(i, 16) = recrow("CGST_TOT")
                                xlSheet.Cells(i, 17) = recrow("SGST_TOT")
                            Else
                                xlSheet.Cells(i, 15) = recrow("IGST_TOT")
                                xlSheet.Cells(i, 16) = ""
                                xlSheet.Cells(i, 17) = ""

                            End If

                           ' 
                            ' 0
                            ' 
                            xlSheet.Cells(i, 18) = ""  ' 0
                            xlSheet.Cells(i, 19) = ""  ' 0

                        End If





                            i += 1
                            DocB2B += 1
                    Next

                End If





                'HSN Summary...................HSN Summary................
                Dim HSNSheet As Excel.Worksheet = xlBook.Worksheets("HSN")

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_HSN]')) " _
                                 & " Drop View [dbo].[vw_HSN]"
                Common.ExecuteQuery(Query)

               

                If GetSettingAsPerId(ApplnSettingsIdx.GenUseSize) = "1" Then
                    Query = "Create View [vw_HSN] as " _
                        & " Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                        & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt " _
                        & "  from salebilldtl" _
                        & " Inner Join Style On Style.Style_Key=salebilldtl.Style_Key " _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "'  And SaleBill.FcYr_Id ='" & SelYearId & "' Group by HsnCode,UNIT_NAME " _
                        & " Union All " _
                        & " Select HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(Taxable)Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                        & " -Sum(salesrtndtl.Tax1_Amt)CGSTAmt,-Sum(salesrtndtl.Tax2_Amt)SGSTAmt,-Sum(salesrtndtl.Tax3_Amt)IGSTAmt " _
                        & " from salesrtndtl  " _
                        & " Inner Join Style On Style.Style_Key=salesrtndtl.Style_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY   " _
                        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "'  And salesrtn.FcYr_Id ='" & SelYearId & "' Group by HsnCode,UNIT_NAME " _
                        & " Union All " _
                        & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                        & " -Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt,-Sum(Tax3_Amt)IGSTAmt   from cndtl Inner Join Style On Style.Style_Key=cndtl.Style_Key   " _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id   " _
                       & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' And cn.FcYr_Id ='" & SelYearId & "' Group by HsnCode,UNIT_NAME" _
                        & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' And   salebill.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve  " _
                & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' And CN.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve  " _
                & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                & " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' And SalesRtn.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve  " _
                & "Union All  select Item.HsnCode,'' UNIT_NAME,-sum(Qty) Qty,-sum(Taxable) Taxable ,-sum(salebilltxtm.Tax_Amt)TaxAmt , -(case when salebilltxtm.TaxTerm_Perc in (2.5,6,9,14) then sum(salebilltxtm.Tax_Amt) else sum(0) end) CGSTAmt,     " _
                 & " -(case when salebilltxtm.TaxTerm_Perc in (2.5,6,9,14) then sum(salebilltxtm.Tax_Amt) else sum(0) end) SGSTAmt,   " _
              & " -(case when salebilltxtm.TaxTerm_Perc in (5,12,18,28) then sum(salebilltxtm.Tax_Amt) else sum(0) end) IGSTAmt  from salebill Left join salebilldtl on salebilldtl.Doc_Id=salebill.Doc_Id    " _
              & " Left join salebilltxtm on salebilltxtm.Doc_Id=salebill.Doc_Id  left join Item On Item.Item_Key=salebilldtl.Item_Key  " _
              & " where  salebill.Doc_Id<>0 And salebill.Doc_Id in (select vchrdtlref.SaleBill_Id from vchr inner join vchrdtlref on vchrdtlref.Doc_Id=vchr.Doc_Id " _
              & " where  vchr.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And vchr.CoBr_Id='" & SelBranchId & "'  And " _
              & " vchr.FcYr_Id='" & SelYearId & "' ) group by HsnCode,TaxTerm_Perc "
                Else
                    Query = "Create View [vw_HSN] as " _
                        & " Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100 Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                        & " case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((Sum(salebilldtl.TotAmtAftDisc)-(Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt " _
                        & "  from salebilldtl Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                        & " Inner Join Item On Item.Item_Key=salebilldtl.Item_Key Inner join Ledger on Ledger.Led_key=SaleBill.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key" _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY  " _
                        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' And salebill.FcYr_Id ='" & SelYearId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME,LedType.Type_Inve,Item.GSTPerc " _
                        & " Union All " _
                        & " Select HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100 Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(salesrtndtl.TotAmtAftDisc)-(Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt  " _
                        & " from salesrtndtl  " _
                        & " Inner Join Item On Item.Item_Key=salesrtndtl.Item_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join Ledger on Ledger.Led_key=salesrtn.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key  " _
                        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' And salesrtn.FcYr_Id ='" & SelYearId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve ,Item.GSTPerc" _
                        & " Union All " _
                        & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100 Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(cndtl.TotAmtAftDisc)-(Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt   from cndtl Inner Join Item On Item.Item_Key=cndtl.Item_Key   " _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  Inner join Ledger on Ledger.Led_key=CN.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                       & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve,Item.GSTPerc " _
                        & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' And salebill.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve  " _
                & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' And CN.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve  " _
                 & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                & " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' And SalesRtn.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve  " _
                & "  Union All  select Item.HsnCode,'' UNIT_NAME,-sum(Qty) Qty,-sum(Taxable) Taxable ,-sum(salebilltxtm.Tax_Amt)TaxAmt , -(case when salebilltxtm.TaxTerm_Perc in (2.5,6,9,14) then sum(salebilltxtm.Tax_Amt) else sum(0) end) CGSTAmt,     " _
                  & " -(case when salebilltxtm.TaxTerm_Perc in (2.5,6,9,14) then sum(salebilltxtm.Tax_Amt) else sum(0) end) SGSTAmt,   " _
              & " -(case when salebilltxtm.TaxTerm_Perc in (5,12,18,28) then sum(salebilltxtm.Tax_Amt) else sum(0) end) IGSTAmt  from salebill Left join salebilldtl on salebilldtl.Doc_Id=salebill.Doc_Id    " _
              & " Left join salebilltxtm on salebilltxtm.Doc_Id=salebill.Doc_Id  left join Item On Item.Item_Key=salebilldtl.Item_Key  " _
              & " where  salebill.Doc_Id<>0 And salebill.Doc_Id in (select vchrdtlref.SaleBill_Id from vchr inner join vchrdtlref on vchrdtlref.Doc_Id=vchr.Doc_Id " _
              & " where  vchr.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And vchr.CoBr_Id='" & SelBranchId & "'  And " _
              & " vchr.FcYr_Id='" & SelYearId & "' ) group by HsnCode,TaxTerm_Perc "
                End If


                Common.ExecuteQuery(Query)

                'Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_HSNCreditnote]')) " _
                '                & " Drop View [dbo].[vw_HSNCreditnote]"
                'Common.ExecuteQuery(Query)

                'Query = " Create View [vw_HSNCreditnote] as select Item.HsnCode,'' UNIT_NAME,sum(Qty) Qty,sum(Taxable) Taxable , " _
                '        & " (case when salebilltxtm.TaxTerm_Perc in (2.5,6,9,14) then sum(salebilltxtm.Tax_Amt) else sum(0) end) Cgst,    " _
                '        & " (case when salebilltxtm.TaxTerm_Perc in (5,12,18,28) then sum(salebilltxtm.Tax_Amt) else sum(0) end) Igst " _
                '        & " from salebill Left join salebilldtl on salebilldtl.Doc_Id=salebill.Doc_Id   " _
                '        & " Left join salebilltxtm on salebilltxtm.Doc_Id=salebill.Doc_Id  left join Item On Item.Item_Key=salebilldtl.Item_Key " _
                '        & " where salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "'  group by HsnCode,TaxTerm_Perc "
                'Common.ExecuteQuery(Query)

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_hsnB2cs]')) " _
                         & " Drop View [dbo].[vw_hsnB2cs]"
                Common.ExecuteQuery(Query)
                Query = " Create view [vw_hsnB2cs] as  Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(SalebillOutletsdtl.Tax_Amt)TaxAmt,  Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt, " _
                    & " Sum(Tax3_Amt)IGSTAmt   from SalebillOutletsdtl Inner Join Style On Style.Style_Key=SalebillOutletsdtl.Style_Key  LEFT JOIN UNIT  " _
                    & " ON UNIT.UNIT_KEY = SalebillOutletsdtl.UNIT_KEY Inner Join SalebillOutlets on SalebillOutlets.DOc_id=SalebillOutletsdtl.DOc_id   " _
                    & " LEFT JOIN STATION ON STATION.STN_KEY = SalebillOutlets.STN_KEY    " _
                    & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                      & "  inner JOIN Ledger ON Ledger.Led_KEY = SalebillOutlets.Cust_Key " _
                    & " where SalebillOutlets.Doc_Type='A' and SalebillOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalebillOutlets.COBR_ID ='" & SelBranchId & "'  " _
                    & " And SalebillOutlets.FcYr_Id ='" & SelYearId & "' And Ledger.Franchisee_code<>'' " & StateName & " Group by HsnCode,UNIT_NAME " _
                    & "Union All " _
                    & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(SalesRtnOutletsdtl.Tax_Amt)TaxAmt, - Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt, " _
                    & " -Sum(Tax3_Amt)IGSTAmt   from SalesRtnOutletsdtl Inner Join Style On Style.Style_Key=SalesRtnOutletsdtl.Style_Key  LEFT JOIN UNIT  " _
                    & " ON UNIT.UNIT_KEY = SalesRtnOutletsdtl.UNIT_KEY Inner Join SalesRtnOutlets on SalesRtnOutlets.DOc_id=SalesRtnOutletsdtl.DOc_id   " _
                    & " LEFT JOIN STATION ON STATION.STN_KEY = SalesRtnOutlets.STN_KEY    " _
                    & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                      & "  inner JOIN Ledger ON Ledger.Led_KEY = SalesRtnOutlets.Cust_Key " _
                    & " where SalesRtnOutlets.Doc_Type='A' and SalesRtnOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtnOutlets.COBR_ID ='" & SelBranchId & "'  " _
                    & " And SalesRtnOutlets.FcYr_Id ='" & SelYearId & "' And Ledger.Franchisee_code<>'' " & StateName & " Group by HsnCode,UNIT_NAME "

                Common.ExecuteQuery(Query)
                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[AllHSN]')) " _
                       & " Drop View [dbo].[AllHSN]"
                Common.ExecuteQuery(Query)
                Query = "Create view [AllHSN] as  SELECT HSNCODE,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                                  & ",SUM(Taxamt) tax_amt FROM vw_HSN " _
                                                  & " Group By HSNCODE " _
                & " Union All SELECT HSNCODE,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                                 & ",SUM(Taxamt) tax_amt FROM vw_hsnB2cs " _
                                                 & " Group By HSNCODE "
                Common.ExecuteQuery(Query)
                Query = "  SELECT HSNCODE,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGST) IGST, sum(SGST) SGST,sum(CGST) CGST,SUM(Tax_amt) tax_amt,cast((SUM(Tax_amt)/ SUM(TAXABLE))*100 as decimal(10,2)) Rate " _
                                                   & " FROM AllHSN " _
                                                   & " Group By HSNCODE "

                Dim dtHSNWise As System.Data.DataTable = Common.GetDataTable(Query)
                Dim HsnCountCN As Integer = 0
                If dtHSNWise.Rows.Count > 0 Then
                    Dim HSNCount As Integer = 5
                    For Each recrow In dtHSNWise.Rows



                        HSNSheet.Cells(HSNCount, 1) = recrow("HSNCODE")



                        Query = "select Item.Item_Desc,unit.Abbr from unit Inner join Item on Item.Unit_Key=unit.Unit_Key where HSNCode='" & recrow("HSNCode") & "'"
                        Dim BillDtl1 As System.Data.DataTable = Common.GetDataTable(Query)
                        If BillDtl1.Rows.Count > 0 Then
                            HSNSheet.Cells(HSNCount, 2) = BillDtl1.Rows(0)("Item_Desc") & ""
                            HSNSheet.Cells(HSNCount, 3) = BillDtl1.Rows(0)("Abbr") & ""

                        Else
                            HSNSheet.Cells(HSNCount, 2) = ""
                            HSNSheet.Cells(HSNCount, 3) = ""

                        End If

                        ' HSNSheet.Cells(HSNCount, 2) = "" 'recrow("SrTo")
                        '  HSNSheet.Cells(HSNCount, 3) = "" 'recrow("SrFrom")
                        HSNSheet.Cells(HSNCount, 4) = recrow("Qty")
                        HSNSheet.Cells(HSNCount, 5) = Val(Val(recrow("TAXABLE")) + Val(recrow("IGST")) + Val(recrow("SGST")) + Val(recrow("CGST")))


                        HSNSheet.Cells(HSNCount, 6) = recrow("Rate")



                        HSNSheet.Cells(HSNCount, 7) = recrow("TAXABLE")
                        HSNSheet.Cells(HSNCount, 8) = recrow("IGST")
                        HSNSheet.Cells(HSNCount, 9) = recrow("CGST")
                        HSNSheet.Cells(HSNCount, 10) = recrow("SGST")
                        HSNSheet.Cells(HSNCount, 11) = "" '0 'recrow("SrTo")

                        HSNCount += 1
                    Next recrow
                    HsnCountCN = HSNCount
                End If



                '----------' 'B2CL....................B2CL..................------------------------------------
                Dim B2CLSheet As Excel.Worksheet = xlBook.Worksheets("B2CL")
                'B2CLSheet = xlBook.ActiveSheet
                'xlBook("exemp").Range("A").Clear()
                'If B2CLSheet.Protection.AllowInsertingRows = False Then
                '    'xlBook.Protect(AllowInsertingRow:=True)
                '    B2CLSheet.Protect(AllowInsertingRows:=False)
                'End If



                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_B2CLarge]')) " _
                                & " Drop View [dbo].[vw_B2CLarge]"
                Common.ExecuteQuery(Query)

                Query = "Create View vw_B2CLarge As  " _
                                   & " Select state.alt_code, SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc,SaleBill.Doc_Id,Ledger.GSTNo,State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Taxable_Amt+salebill.Tax_Amt+salebill.OthChgs_Amt Gross_Total,salebill.Doc_Dt ," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                                   & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                                   & " Left Join SalebillTxTm on SalebillTxTm.Doc_Id=SaleBill.Doc_Id LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                   & " Where SaleBill.Status = '1' and State.Alt_Code<>'" & StateCode & "' And Ledger.GSTNo='' And Salebill.Taxable_Amt>250000  " _
                                   & " AND SaleBill.Doc_Type='A' and SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' And SaleBill.FcYr_Id ='" & SelYearId & "' " _
                                   & " Group by SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc,State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt"


                Common.ExecuteQuery(Query)
                Query = "SELECT  party,Taxable_Amt,Tax1_Perc,GSTNo,InvoiceNo,Gross_Total,convert(varchar, Doc_Dt, 105)as Doc_Dt,PlaceofSupply,Sum(GST5)GST5,Sum(CGST)CGST,Sum(SGST)SGST,sum(IGST5)IGST5,Sum(GST12)GST12,Sum(CGST6)CGST6,Sum(SGST6)SGST6,Sum(IGST12)IGST12,Sum(GST18)GST18,Sum(CGST9)CGST9,Sum(SGST9)SGST9,Sum(IGST18)IGST18,Sum(GST28)GST28,Sum(CGST14)CGST14,Sum(SGST14)SGST14,Sum(IGST28)IGST28,  cast(Tax1_perc*taxable_amt/100 as decimal(10,2) ) IGST_TOT,Alt_Code  FROM vw_B2CLarge " _
                      & " Group By Taxable_Amt,Tax1_Perc,GSTNo,InvoiceNo,Gross_Total,Doc_Dt,PlaceofSupply,Alt_Code,party "
                Dim dtb2CSLarge As System.Data.DataTable = Common.GetDataTable(Query)



                If dtb2CSLarge.Rows.Count > 0 Then
                    Dim b2cl As Integer = 5
                    For Each recrow In dtb2CSLarge.Rows
                        B2CLSheet.Cells(b2cl, 1) = recrow("Party")




                        B2CLSheet.Cells(b2cl, 2) = recrow("InvoiceNo")
                        B2CLSheet.Cells(b2cl, 3) = recrow("Doc_Dt")
                        B2CLSheet.Cells(b2cl, 4) = recrow("Gross_Total")
                        B2CLSheet.Cells(b2cl, 5) = recrow("PlaceofSupply")

                        B2CLSheet.Cells(b2cl, 6) = ""
                      
                        B2CLSheet.Cells(b2cl, 7) = ""
                        B2CLSheet.Cells(b2cl, 8) = ""

                        B2CLSheet.Cells(b2cl, 9) = recrow("Taxable_Amt") 'recrow("GST5") + recrow("GST12") + recrow("GST18") + recrow("GST28")


                        If recrow("Tax1_Perc") > 1 Or recrow("Tax1_Perc") < 4 Then
                            B2CLSheet.Cells(b2cl, 10) = 5
                        ElseIf recrow("Tax1_Perc") > 5 Or recrow("Tax1_Perc") < 8 Then
                            B2CLSheet.Cells(b2cl, 10) = 12
                        ElseIf recrow("Tax1_Perc") > 8 Or recrow("Tax1_Perc") < 10 Then
                            B2CLSheet.Cells(b2cl, 10) = 18
                        ElseIf recrow("Tax1_Perc") > 12 Or recrow("Tax1_Perc") < 15 Then
                            B2CLSheet.Cells(b2cl, 10) = 28
                        Else
                            B2CLSheet.Cells(b2cl, 10) = recrow("Tax1_Perc")
                        End If

                        If recrow("Alt_Code") <> StateCode Then
                            B2CLSheet.Cells(b2cl, 11) = recrow("IGST_TOT") 'IGST
                        Else
                            B2CLSheet.Cells(b2cl, 11) = "" 'IGST
                        End If

                        B2CLSheet.Cells(b2cl, 12) = "" '0
                        B2CLSheet.Cells(b2cl, 13) = ""
                        b2cl += 1
                        DocB2CL += 1
                    Next recrow

                End If

            End If
            'xlBook.Save()

            ' 'B2CS excel creation................B2CS excel creation.............
            Dim B2CSSheet As Excel.Worksheet = xlBook.Worksheets("B2CS")
            If b2b = 0 Then


                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_B2CSmall]')) " _
                                   & " Drop View [dbo].[vw_B2CSmall]"
                Common.ExecuteQuery(Query)


                Query = "Create View vw_B2CSmall As  " _
                                   & " Select STATE.ALT_CODE,SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc, SaleBill.Doc_Id,Ledger.GSTNo,State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Taxable_Amt+salebill.Tax_Amt+salebill.OthChgs_Amt Gross_Total,salebill.Doc_Dt ," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                                   & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                                   & " Left Join SalebillTxTm on SalebillTxTm.Doc_Id=SaleBill.Doc_Id LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                   & " Where SaleBill.Status = '1' and State.Alt_Code='" & StateCode & "' And  Ledger.GSTNo='' " _
                                   & " AND SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' And SaleBill.FcYr_Id ='" & SelYearId & "'" _
                                   & " Group by SalebillTxTm.Taxable_Amt, SalebillTxTm.Tax1_Perc ,State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt" _
                                   & " Union All  " _
                                   & " Select STATE.ALT_CODE,SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc ,SaleBill.Doc_Id,Ledger.GSTNo,State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Taxable_Amt+salebill.Tax_Amt+salebill.OthChgs_Amt Gross_Total,salebill.Doc_Dt ," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                                   & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                                   & " Left Join SalebillTxTm on SalebillTxTm.Doc_Id=SaleBill.Doc_Id LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                   & " Where SaleBill.Status = '1' and State.Alt_Code<>'" & StateCode & "' And Salebill.Taxable_Amt<=250000 And  Ledger.GSTNo='' " _
                                   & " AND SaleBill.Doc_Type='A' And SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' And SaleBill.FcYr_Id ='" & SelYearId & "'" _
                                   & " Group by SalebillTxTm.Taxable_Amt, SalebillTxTm.Tax1_Perc, State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt" _
                                   & strSrch
                Common.ExecuteQuery(Query)

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[B2CS]')) " _
                                 & " Drop View [dbo].[B2CS]"
                Common.ExecuteQuery(Query)



                Query = "  Create view B2CS as  select STATE.Alt_Code,sum(SalebillOutletsdtl.Taxable)Taxable_Amt,SalebillOutletsdtl.TaxPerc,(STATE.State_Name)Statename from SalebillOutlets " _
                        & " left join SalebillOutletsdtl on SalebillOutletsdtl.Doc_Id=SalebillOutlets.Doc_Id " _
                        & " LEFT JOIN STATION ON STATION.STN_KEY = SalebillOutlets.STN_KEY    " _
                        & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                        & "  inner JOIN Ledger ON Ledger.Led_KEY = SalebillOutlets.Cust_Key " _
                        & " Where SalebillOutlets.Status = '1'   AND SalebillOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND " _
                        & " SalebillOutlets.COBR_ID ='" & SelBranchId & "'  And Ledger.Franchisee_code<>'' And SalebillOutletsdtl.TaxPerc > 0 And SalebillOutlets.FcYr_Id ='" & SelYearId & "' " & StateName & " " _
                        & " Group by  SalebillOutletsdtl.TaxPerc ,State.Alt_Code,STATE.State_Name " _
                        & " Union All " _
                        & "  select STATE.Alt_Code,-sum(SalesRtnOutletsdtl.Taxable)Taxable_Amt,SalesRtnOutletsdtl.TaxPerc,(STATE.State_Name)Statename from SalesRtnOutlets " _
                        & " left join SalesRtnOutletsdtl on SalesRtnOutletsdtl.Doc_Id=SalesRtnOutlets.Doc_Id " _
                        & " LEFT JOIN STATION ON STATION.STN_KEY = SalesRtnOutlets.STN_KEY    " _
                        & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                        & "  inner JOIN Ledger ON Ledger.Led_KEY = SalesRtnOutlets.Cust_Key " _
                        & " Where SalesRtnOutlets.Status = '1'   AND SalesRtnOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND " _
                        & " SalesRtnOutlets.COBR_ID ='" & SelBranchId & "'  And Ledger.Franchisee_code<>'' And SalesRtnOutletsdtl.TaxPerc > 0 And SalesRtnOutlets.FcYr_Id ='" & SelYearId & "' " & StateName & " " _
                        & " Group by  SalesRtnOutletsdtl.TaxPerc ,State.Alt_Code,STATE.State_Name "

                Common.ExecuteQuery(Query)

                ' Query = "SELECT PlaceofSupply , sum(GST5+GST18+GST12+GST28)as TaxableAmt,Gross_Total,Doc_Id,GSTNo , SUM(GST5) GST5, sum(CGST) CGST25, sum(SGST) SGST25,Sum(IGST5)IGST5,  sum(GST18) GST18,sum(CGST9) CGST9,sum(SGST9) SGST9,Sum(IGST18)IGST18,Sum(GST12)GST12, Sum(GST28)GST28 FROM vw_B2CSmall  Group By PlaceofSupply, Gross_Total, Doc_Id ,GSTNo "
                Query = "SELECT sum(Taxable_Amt)Taxable_Amt,Tax1_Perc,PlaceofSupply ,  cast(Tax1_perc*sum(Taxable_Amt)/100 as decimal(10,2) ) IGST_TOT,cast(Tax1_perc*sum(Taxable_Amt)/100 as decimal(10,2) ) CGST_TOT,cast(Tax1_perc*sum(Taxable_Amt)/100 as decimal(10,2) ) SGST_TOT,ALT_CODE  FROM vw_B2CSmall " _
                & " Group By PlaceofSupply,Tax1_Perc,ALT_CODE " _
                & " Union All select sum(Taxable_Amt)Taxable_Amt,TaxPerc,Statename  ,  cast(Taxperc*sum(Taxable_Amt)/100 as decimal(10,2) ) IGST_TOT,cast(Taxperc*sum(Taxable_Amt)/100 as decimal(10,2) ) CGST_TOT,cast(Taxperc*sum(Taxable_Amt)/100 as decimal(10,2) ) SGST_TOT ,ALT_CODE  from B2CS group by TaxPerc, Statename,ALT_CODE "

                Dim b2CSmall As System.Data.DataTable = Common.GetDataTable(Query)


                If b2CSmall.Rows.Count > 0 Then
                    Dim b2cS As Integer = 5
                    For Each recrow In b2CSmall.Rows

                        B2CSSheet.Cells(b2cS, 1) = "OE"
                        B2CSSheet.Cells(b2cS, 2) = recrow("PlaceofSupply")

                        B2CSSheet.Cells(b2cS, 3) = Val(recrow("Taxable_Amt")) 'Val(recrow("GST5")) + Val(recrow("GST18") + recrow("GST12")) + Val(recrow("GST28"))

                        If recrow("Tax1_Perc") = "2.5" Then
                            xlSheet.Cells(b2cS, 4) = 5
                        ElseIf recrow("Tax1_Perc") = "6" Then
                            xlSheet.Cells(b2cS, 4) = 12
                        ElseIf recrow("Tax1_Perc") = "9" Then
                            xlSheet.Cells(b2cS, 4) = 18
                        ElseIf recrow("Tax1_Perc") = "14" Then
                            xlSheet.Cells(b2cS, 4) = 28
                        Else
                            B2CSSheet.Cells(b2cS, 4) = recrow("Tax1_Perc")
                        End If

                        If recrow("ALT_CODE") <> StateCode Then
                            B2CSSheet.Cells(b2cS, 5) = recrow("IGST_TOT") 'IGST '0
                            B2CSSheet.Cells(b2cS, 6) = "" 'CGST
                            B2CSSheet.Cells(b2cS, 7) = "" 'SGST
                        Else
                            B2CSSheet.Cells(b2cS, 5) = "" 'IGST '0
                            B2CSSheet.Cells(b2cS, 6) = recrow("CGST_TOT") 'CGST
                            B2CSSheet.Cells(b2cS, 7) = recrow("SGST_TOT") 'SGST
                        End If

                        B2CSSheet.Cells(b2cS, 8) = "" '0
                        B2CSSheet.Cells(b2cS, 9) = ""
                        B2CSSheet.Cells(b2cS, 10) = ""

                        b2cS += 1
                        DocB2CS += 1
                    Next recrow
                End If
                'xlBook.Save()
            End If
            If GetSettingAsPerId(ApplnSettingsIdx.DisplayStateinGSTR) = "1" Then

                If b2b = 1 Then
                    Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[B2CS]')) " _
                                      & " Drop View [dbo].[B2CS]"
                    Common.ExecuteQuery(Query)



                    Query = "  Create view B2CS as  select sum(SalebillOutletsdtl.Taxable)Taxable_Amt,SalebillOutletsdtl.TaxPerc,(STATE.State_Name)Statename from SalebillOutlets " _
                            & " left join SalebillOutletsdtl on SalebillOutletsdtl.Doc_Id=SalebillOutlets.Doc_Id " _
                            & " LEFT JOIN STATION ON STATION.STN_KEY = SalebillOutlets.STN_KEY    " _
                            & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                            & "  inner JOIN Ledger ON Ledger.Led_KEY = SalebillOutlets.Cust_Key " _
                            & " Where SalebillOutlets.Status = '1'   AND SalebillOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND " _
                            & " SalebillOutlets.COBR_ID ='" & SelBranchId & "'  And Ledger.Franchisee_code<>'' And SalebillOutletsdtl.TaxPerc > 0 And SalebillOutlets.FcYr_Id ='" & SelYearId & "' " & StateName & " " _
                            & " Group by  SalebillOutletsdtl.TaxPerc ,State.Alt_Code,STATE.State_Name " _
                            & " Union All " _
                            & "  select -sum(SalesRtnOutletsdtl.Taxable)Taxable_Amt,SalesRtnOutletsdtl.TaxPerc,(STATE.State_Name)Statename from SalesRtnOutlets " _
                            & " left join SalesRtnOutletsdtl on SalesRtnOutletsdtl.Doc_Id=SalesRtnOutlets.Doc_Id " _
                            & " LEFT JOIN STATION ON STATION.STN_KEY = SalesRtnOutlets.STN_KEY    " _
                            & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                            & "  inner JOIN Ledger ON Ledger.Led_KEY = SalesRtnOutlets.Cust_Key " _
                            & " Where SalesRtnOutlets.Status = '1'   AND SalesRtnOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND " _
                            & " SalesRtnOutlets.COBR_ID ='" & SelBranchId & "'  And Ledger.Franchisee_code<>'' And SalesRtnOutletsdtl.TaxPerc > 0 And SalesRtnOutlets.FcYr_Id ='" & SelYearId & "' " & StateName & " " _
                            & " Group by  SalesRtnOutletsdtl.TaxPerc ,State.Alt_Code,STATE.State_Name "

                    Common.ExecuteQuery(Query)

                    Query = "select sum(Taxable_Amt)Taxable_Amt , TaxPerc, Statename from B2CS group by TaxPerc, Statename"
                    Dim b2CSDB As System.Data.DataTable = Common.GetDataTable(Query)


                    If b2CSDB.Rows.Count > 0 Then
                        Dim b2cS As Integer = 5
                        For Each recrow In b2CSDB.Rows

                            B2CSSheet.Cells(b2cS, 1) = "OE"
                            B2CSSheet.Cells(b2cS, 2) = recrow("Statename")



                            If recrow("TaxPerc") = "2.5" Then
                                B2CSSheet.Cells(b2cS, 3) = 5
                            ElseIf recrow("TaxPerc") = "6" Then
                                B2CSSheet.Cells(b2cS, 3) = 12
                            ElseIf recrow("TaxPerc") = "9" Then
                                B2CSSheet.Cells(b2cS, 3) = 18
                            ElseIf recrow("TaxPerc") = "14" Then
                                B2CSSheet.Cells(b2cS, 3) = 28
                            Else
                                B2CSSheet.Cells(b2cS, 3) = recrow("TaxPerc")
                            End If

                            B2CSSheet.Cells(b2cS, 4) = Val(recrow("Taxable_Amt")) 'Val(recrow("GST5")) + Val(recrow("GST18") + recrow("GST12")) + Val(recrow("GST28"))
                            B2CSSheet.Cells(b2cS, 5) = "" '0
                            B2CSSheet.Cells(b2cS, 6) = ""
                            b2cS += 1
                            DocB2CS += 1
                        Next recrow
                    End If

                    Dim HSNSheet As Excel.Worksheet = xlBook.Worksheets("HSN")

                    Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_hsnB2cs]')) " _
                           & " Drop View [dbo].[vw_hsnB2cs]"
                    Common.ExecuteQuery(Query)
                    Query = " Create view [vw_hsnB2cs] as  Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(SalebillOutletsdtl.Tax_Amt)TaxAmt,  Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt, " _
                        & " Sum(Tax3_Amt)IGSTAmt   from SalebillOutletsdtl Inner Join Style On Style.Style_Key=SalebillOutletsdtl.Style_Key  LEFT JOIN UNIT  " _
                        & " ON UNIT.UNIT_KEY = SalebillOutletsdtl.UNIT_KEY Inner Join SalebillOutlets on SalebillOutlets.DOc_id=SalebillOutletsdtl.DOc_id   " _
                        & " LEFT JOIN STATION ON STATION.STN_KEY = SalebillOutlets.STN_KEY    " _
                        & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                          & "  inner JOIN Ledger ON Ledger.Led_KEY = SalebillOutlets.Cust_Key " _
                        & " where SalebillOutlets.Doc_Type='A' and SalebillOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalebillOutlets.COBR_ID ='" & SelBranchId & "'  " _
                        & " And SalebillOutlets.FcYr_Id ='" & SelYearId & "' And Ledger.Franchisee_code<>'' " & StateName & " Group by HsnCode,UNIT_NAME " _
                        & "Union All " _
                        & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(SalesRtnOutletsdtl.Tax_Amt)TaxAmt, - Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt, " _
                        & " -Sum(Tax3_Amt)IGSTAmt   from SalesRtnOutletsdtl Inner Join Style On Style.Style_Key=SalesRtnOutletsdtl.Style_Key  LEFT JOIN UNIT  " _
                        & " ON UNIT.UNIT_KEY = SalesRtnOutletsdtl.UNIT_KEY Inner Join SalesRtnOutlets on SalesRtnOutlets.DOc_id=SalesRtnOutletsdtl.DOc_id   " _
                        & " LEFT JOIN STATION ON STATION.STN_KEY = SalesRtnOutlets.STN_KEY    " _
                        & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                          & "  inner JOIN Ledger ON Ledger.Led_KEY = SalesRtnOutlets.Cust_Key " _
                        & " where SalesRtnOutlets.Doc_Type='A' and SalesRtnOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtnOutlets.COBR_ID ='" & SelBranchId & "'  " _
                        & " And SalesRtnOutlets.FcYr_Id ='" & SelYearId & "' And Ledger.Franchisee_code<>''  " & StateName & " Group by HsnCode,UNIT_NAME "

                    Common.ExecuteQuery(Query)
                    Query = "SELECT HSNCODE,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                                    & " FROM vw_hsnB2cs " _
                                                    & " Group By HSNCODE "
                    Dim dtHSNWise As System.Data.DataTable = Common.GetDataTable(Query)
                    Dim HsnCountCN As Integer = 0
                    If dtHSNWise.Rows.Count > 0 Then
                        Dim HSNCount As Integer = 5
                        For Each recrow In dtHSNWise.Rows



                            HSNSheet.Cells(HSNCount, 1) = recrow("HSNCODE")

                            Query = "select Item.Item_Desc,unit.Abbr from unit Inner join Item on Item.Unit_Key=unit.Unit_Key where HSNCode='" & recrow("HSNCode") & "'"
                            Dim BillDtl1 As System.Data.DataTable = Common.GetDataTable(Query)
                            If BillDtl1.Rows.Count > 0 Then
                                HSNSheet.Cells(HSNCount, 3) = BillDtl1.Rows(0)("Abbr") & ""
                                HSNSheet.Cells(HSNCount, 2) = BillDtl1.Rows(0)("Item_Desc") & ""
                            Else
                                HSNSheet.Cells(HSNCount, 3) = ""
                                HSNSheet.Cells(HSNCount, 2) = ""
                            End If

                            ' HSNSheet.Cells(HSNCount, 2) = "" 'recrow("SrTo")
                            '  HSNSheet.Cells(HSNCount, 3) = "" 'recrow("SrFrom")
                            HSNSheet.Cells(HSNCount, 4) = recrow("Qty")
                            HSNSheet.Cells(HSNCount, 5) = Val(Val(recrow("TAXABLE")) + Val(recrow("IGST")) + Val(recrow("SGST")) + Val(recrow("CGST")))
                            HSNSheet.Cells(HSNCount, 6) = recrow("TAXABLE")
                            HSNSheet.Cells(HSNCount, 7) = recrow("IGST")
                            HSNSheet.Cells(HSNCount, 8) = recrow("CGST")
                            HSNSheet.Cells(HSNCount, 9) = recrow("SGST")
                            HSNSheet.Cells(HSNCount, 10) = "" '0 'recrow("SrTo")

                            HSNCount += 1
                        Next recrow
                        HsnCountCN = HSNCount
                    End If

                End If
            End If


            'CDNR Ecel creation................CDNR Ecel creation.............
            If cdnr = 0 Then


                Dim CDNRSheet As Excel.Worksheet = xlBook.Worksheets("cdnr")


                Dim strFilter As String = ""
                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_CNRegistered]')) " _
                         & " Drop View [dbo].[vw_CNRegistered]"
                Common.ExecuteQuery(Query)
                strFilter = "And  Ledger.GSTNo<>''"

                Query = " Create View [vw_CNRegistered] as Select Salesrtn.Taxable_Amt as Taxable_Amt1 ,Salesrtn.tax_amt, State.Alt_code,Salesrtn.Doc_Id,Ledger.GSTNo,State_Name PlaceofSupply,Ledger.Abbr as Party,Salesrtn.Doc_no AS InvoiceNo,Salesrtn.Taxable_Amt+Salesrtn.Tax_Amt+Salesrtn.OthChgs_Amt Gross_Total,Salesrtn.Doc_Dt ," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST5," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST5," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST12," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST6," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST6," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST12," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST18," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST9," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST9," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST18," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST28," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST14," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST14," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST28" _
                                 & " from Salesrtn Left Join Ledger on Ledger.Led_Key=Salesrtn.Cust_Key  " _
                                 & "  LEFT JOIN Salesrtntxtm ON Salesrtn.Doc_Id = Salesrtntxtm.Doc_Id  LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                 & " Where Salesrtn.Status = '1' and  Direct_CN=1 " _
                                 & " AND Salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Salesrtn.COBR_ID ='" & SelBranchId & "' And Salesrtn.FcYr_Id ='" & SelYearId & "'" _
                                 & strFilter _
                                 & " Group by Salesrtntxtm.Taxable_Amt,Salesrtntxtm.TaxTerm_Perc,State.Alt_Code,STATE.State_Name,Ledger.Abbr,Salesrtn.Doc_no  ,Salesrtn.Doc_Dt ,Ledger.GSTNo ,Salesrtn.Doc_Id,Salesrtn.Taxable_Amt,Salesrtn.Tax_Amt,Salesrtn.OthChgs_Amt" _
                                 & "  UNION ALL " _
                                 & " Select cn.taxable_amt as Taxable_Amt1, cn.tax_amt , State.Alt_code,CN.Doc_Id,Ledger.GSTNo,State_Name PlaceofSupply,Ledger.Abbr as Party,CN.Doc_no AS InvoiceNo,CN.Taxable_Amt+CN.Tax_Amt+CN.OthChgs_Amt Gross_Total,CN.Doc_Dt ,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST5,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST5,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST12,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST12,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST18," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST9," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST9," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST18," _
                                 & " (Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST28," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST14," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST14," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST28 " _
                                 & " from CN Left Join Ledger on Ledger.Led_Key=CN.Cust_Key   LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY   " _
                                 & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY   Where CN.Status = '1' " _
                                 & " AND CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "'  And CN.FcYr_Id ='" & SelYearId & "' " _
                                 & strFilter _
                                 & "	Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,CN.Doc_no  ,CN.Doc_Dt ,Ledger.GSTNo , " _
                                 & "	CN.Doc_Id,CN.Taxable_Amt,CN.Tax_Amt,CN.OthChgs_Amt"


                Common.ExecuteQuery(Query)

                Query = "SELECT Taxable_Amt1,tax_amt,Doc_Id,GSTNo,Party,InvoiceNo,Alt_code StateCode,convert(varchar, Doc_Dt,105)as Doc_Dt,sum(Gross_Total)Gross_Total,PlaceofSupply,sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28, " _
                    & " cast(tax_amt/nullif(Taxable_amt1,0)*100 as decimal(10,2) ) tax_rate FROM vw_CNRegistered " _
                    & " Group By Taxable_Amt1,tax_amt,Doc_Id,GSTNo,Alt_code,Party,InvoiceNo,Doc_Dt,PlaceofSupply Order by  InvoiceNo Asc"

                Dim dtCNRegistered As System.Data.DataTable = Common.GetDataTable(Query)
                Dim countcdnr As Integer = 5
                If dtCNRegistered.Rows.Count > 0 Then

                    For Each recrow In dtCNRegistered.Rows

                        CDNRSheet.Cells(countcdnr, 1) = recrow("GSTNo")

                        'Query = "select  Party_RefNo, convert(varchar, Party_RefDt, 6)as Doc_Dt from Salesrtn where Salesrtn.Doc_Id=" & Val(recrow("Doc_Id"))
                        'Dim BillDtl As System.Data.DataTable = Common.GetDataTable(Query)
                        'If BillDtl.Rows.Count > 0 Then

                        '    CDNRSheet.Cells(countcdnr, 2) = BillDtl.Rows(0)("Party_RefNo")
                        '    CDNRSheet.Cells(countcdnr, 3) = BillDtl.Rows(0)("Doc_Dt")
                        'Else

                        '    CDNRSheet.Cells(countcdnr, 2) = "" 'BillDtl.Rows(0)(0)("Bill_No")
                        '    CDNRSheet.Cells(countcdnr, 3) = "" 'BillDtl.Rows(0)(0)("Bill_Dt")
                        'End If

                        CDNRSheet.Cells(countcdnr, 2) = recrow("InvoiceNo")
                        CDNRSheet.Cells(countcdnr, 3) = recrow("Doc_Dt")

                        CDNRSheet.Cells(countcdnr, 4) = ""

                        CDNRSheet.Cells(countcdnr, 5) = "C"
                        ' CDNRSheet.Cells(countcdnr, 7) = ""
                        CDNRSheet.Cells(countcdnr, 6) = recrow("PlaceofSupply")

                        CDNRSheet.Cells(countcdnr, 7) = "Regular"
                        CDNRSheet.Cells(countcdnr, 8) = "N"



                        CDNRSheet.Cells(countcdnr, 9) = recrow("Gross_Total") '+ recrow("CGST25") + recrow("SGST25") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18")
                        '  CDNRSheet.Cells(countcdnr, 7) = ""



                        'If recrow("CGST") > 0 Or recrow("IGST5") > 0 Then
                        '    xlSheet.Cells(countcdnr, 10) = 5
                        'ElseIf recrow("CGST6") > 0 Or recrow("IGST12") > 0 Then
                        '    xlSheet.Cells(countcdnr, 10) = 12
                        'ElseIf recrow("CGST9") > 0 Or recrow("IGST18") > 0 Then
                        '    xlSheet.Cells(countcdnr, 10) = 18
                        'ElseIf recrow("CGST14") > 0 Or recrow("IGST28") > 0 Then
                        '    xlSheet.Cells(countcdnr, 10) = 28
                        'Else
                        CDNRSheet.Cells(countcdnr, 10) = recrow("tax_rate")
                        'End If

                        CDNRSheet.Cells(countcdnr, 11) = Val(recrow("Taxable_Amt1")) 'Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18") + Val(recrow("GST28"))))

                        If recrow("StateCode") = StateCode Then
                            CDNRSheet.Cells(countcdnr, 12) = ""
                            CDNRSheet.Cells(countcdnr, 13) = Format(recrow("Tax_Amt") / 2, "0.00")
                            CDNRSheet.Cells(countcdnr, 14) = Format(recrow("Tax_Amt") / 2, "0.00")
                        Else
                            CDNRSheet.Cells(countcdnr, 12) = Format(recrow("Tax_Amt"), "0.00")
                            CDNRSheet.Cells(countcdnr, 13) = "" '0
                            CDNRSheet.Cells(countcdnr, 14) = ""
                        End If

                      


                        CDNRSheet.Cells(countcdnr, 15) = ""
                        CDNRSheet.Cells(countcdnr, 16) = ""

                        countcdnr += 1

                        DocCDNR += 1


                    Next recrow

                End If

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_CNRegisteredSAT]')) " _
                               & " Drop View [dbo].[vw_CNRegisteredSAT]"
                Common.ExecuteQuery(Query)

                '---for CDNR Vchr------------------------------
                Query = "Create View [vw_CNRegisteredSAT] as " _
                & " select ( select top 1 VchrdtlRef.Doc_No from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id) as  billNo,( select top 1 convert(varchar, VchrdtlRef.Doc_Dt,103)  from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id)as BillDt,Ledger.Tax_Perc,Vchrdtl.AmtFlag,Vchr.Doc_Id,convert(varchar, Vchr.Doc_Dt, 6) as Doc_Dt,Vchr.PDoc_No as Doc_No,Vchr.VchrRefNo ,Vchr.Amount as Net_Amt,Vchrdtl.GST_On_Amt ,(select Top 1 Vchrdtl.Amount from Vchrdtl  " _
                & " left join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key  where V.Doc_Id=Vchr.Doc_Id And Vchrdtl.AmtFlag = 'D' ) as TaxableAmt,     " _
                & " (select Top 1 Ledger.Led_Name from Vchrdtl left join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key JOIN STATION ON STATION.STN_Id = Ledger.OSTN_Key  LEFT JOIN STATE ON STATE.STATE_Id = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0  And Vchrdtl.AmtFlag = 'C')as Led_Name, " _
                & " (select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id)) as GSTNo, " _
                & " (select Top 1  State.Alt_code+'-' +STATE.State_Name  from Vchrdtl Inner join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  Inner join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key Inner JOIN STATION ON STATION.STN_Id = Ledger.OSTN_Key  Inner JOIN STATE ON STATE.STATE_Id = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0 )as PlaceofSupply " _
                & " from Vchrdtl " _
                & " left join Vchr on Vchr.Doc_Id=Vchrdtl.Doc_Id " _
                & " left join VchrdtlRef on VchrdtlRef.Doc_Id=Vchrdtl.Doc_Id " _
                & " left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key " _
                & " where   Ledger.Tax_Perc > 0 And Vchr.Doc_Dt BETWEEN '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'    and Vchrdtl.GST_On_Amt<> 0 " _
                & " And  Vchr.PDoc_No <> '' AND Vchr.Cobr_Id='" & SelBranchId & "'  And FcYr_Id = '" & SelYearId & "' And VchrType ='CN' " _
                & "  group by  VchrdtlRef.Doc_Dt, Ledger.Tax_Perc,Vchrdtl.AmtFlag,Vchr.Doc_Id,Vchr.Doc_Dt,Vchr.PDoc_No,Vchr.VchrRefNo ,Vchr.Amount ,Vchrdtl.GST_On_Amt "

                Common.ExecuteQuery(Query)

                Query = "select * from vw_CNRegisteredSAT"

                dtCNRegistered = Common.GetDataTable(Query)

                If dtCNRegistered.Rows.Count > 0 Then

                    For Each recrow In dtCNRegistered.Rows

                        'Dim perc As Double = 0
                        'If Val(recrow("Taxable_Amt") & "") > 0 Then
                        '    perc = Val(Val(Val(Val(recrow("Tax_Amount")) / recrow("Taxable_Amt"))) * 100)
                        'Else
                        '    Continue For
                        'End If
                        CDNRSheet.Cells(countcdnr, 1) = recrow("GSTNO")
                        'Query = "select Top 1 bill.Doc_No,convert(varchar, bill.Doc_Dt, 6) as  Doc_Dt from salesrtndtl " _
                        '    & " left join billDtl on billdtl.DocDtl_Id=salesrtndtl.BillDtl_Id " _
                        '    & " left join bill on bill.Doc_Id=BillDtl.Doc_Id " _
                        ' & " where salesrtndtl.Doc_Id =  " & recrow("Doc_Id")
                        'Dim BillDtl As System.Data.DataTable = Common.GetDataTable(Query)
                        'If BillDtl.Rows.Count > 0 Then

                        '    CDNRSheet.Cells(countcdnr, 2) = BillDtl.Rows(0)("Doc_No")
                        '    CDNRSheet.Cells(countcdnr, 3) = BillDtl.Rows(0)("Doc_Dt")
                        'Else

                        'CDNRSheet.Cells(countcdnr, 2) = BillDtl.Rows(0)(0)("Bill_No")
                        'CDNRSheet.Cells(countcdnr, 3) = BillDtl.Rows(0)(0)("Bill_Dt")
                        ' End If




                        CDNRSheet.Cells(countcdnr, 2) = recrow("BillNo")
                        CDNRSheet.Cells(countcdnr, 3) = recrow("BillDt")


                        CDNRSheet.Cells(countcdnr, 4) = recrow("Doc_No")
                        CDNRSheet.Cells(countcdnr, 5) = recrow("Doc_Dt")

                        CDNRSheet.Cells(countcdnr, 6) = ""

                        CDNRSheet.Cells(countcdnr, 7) = "C"

                        CDNRSheet.Cells(countcdnr, 8) = recrow("PlaceofSupply")
                        CDNRSheet.Cells(countcdnr, 9) = recrow("Net_Amt") 'recrow("GST5") + recrow("CGST25") + recrow("SGST25") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18")
                        CDNRSheet.Cells(countcdnr, 10) = ""
                        'If perc > 1 And perc < 6 Then
                        CDNRSheet.Cells(countcdnr, 11) = Val(recrow("Tax_Perc"))
                        'ElseIf perc > 6 And perc < 13 Then
                        '    CDNRSheet.Cells(countcdnr, 10) = Val(12)
                        'ElseIf perc > 13 And perc < 19 Then
                        '    CDNRSheet.Cells(countcdnr, 10) = Val(18)
                        'ElseIf perc > 19 And perc < 29 Then
                        '    B2CSSheet.Cells(countcdnr, 10) = 28
                        'Else
                        '    CDNRSheet.Cells(countcdnr, 10) = Val(0)
                        'End If

                        CDNRSheet.Cells(countcdnr, 12) = Val(recrow("GST_On_Amt") & "") 'Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18")))
                        CDNRSheet.Cells(countcdnr, 13) = "" '0
                        CDNRSheet.Cells(countcdnr, 14) = ""


                        CDNRSheet.Cells(countcdnr, 15) = "" '0
                        CDNRSheet.Cells(countcdnr, 16) = ""

                        countcdnr += 1

                        DocCDNR += 1
                    Next recrow

                End If


                ''---------Debit CDNR Excel------------------------------------
                'Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_DNRegistered]')) " _
                '           & " Drop View [dbo].[vw_DNRegistered]"

                ''Satyam added 14082023

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_DNRegistered]')) " _
                      & " Drop View [dbo].[vw_DNRegistered]"
                Common.ExecuteQuery(Query)
                Query = " Create View [vw_DNRegistered] as Select PurchaseRtn.TAXABLE_AMT,PurchaseRtn.TAX_AMT,State.Alt_code,PurchaseRtn.Doc_Id,Ledger.GSTNo,State_Name PlaceofSupply,Ledger.Abbr as Party,PurchaseRtn.Doc_no AS InvoiceNo,PurchaseRtn.Taxable_Amt+PurchaseRtn.Tax_Amt+PurchaseRtn.OthChgs_Amt Gross_Total,PurchaseRtn.Doc_Dt ," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST5," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST5," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST12," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST6," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST6," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST12," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST18," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST9," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST9," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST18," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST28," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST14," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST14," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST28" _
                            & " from PurchaseRtn Left Join Ledger on Ledger.Led_Key=PurchaseRtn.Supl_Key  " _
                            & " LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                            & " Where PurchaseRtn.Status = '1'  " _
                            & " AND PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' " _
                            & strFilter _
                            & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,PurchaseRtn.Doc_no  ,PurchaseRtn.Doc_Dt ,Ledger.GSTNo ,PurchaseRtn.Doc_Id,PurchaseRtn.Taxable_Amt,PurchaseRtn.Tax_Amt,PurchaseRtn.OthChgs_Amt"

                Common.ExecuteQuery(Query)
                Query = "SELECT TAXABLE_AMT,TAX_AMT, GSTNo,Party,InvoiceNo,Alt_code StateCode,Doc_Dt,sum(Gross_Total)Gross_Total,PlaceofSupply,sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28 ," _
            & " cast(TAX_AMT/nullif(TAXABLE_AMT,0)*100 as decimal(10,2) ) TAX_RATE FROM vw_DNRegistered " _
            & " Group By GSTNo,Alt_code,Party,InvoiceNo,Doc_Dt,PlaceofSupply,TAXABLE_AMT,TAX_AMT Order by  InvoiceNo Asc"
                Dim dtDNRegistered As DataTable = Common.GetDataTable(Query)

                'Common.ExecuteQuery(Query)
                'strFilter = "And  Ledger.GSTNo<>''"

                If dtDNRegistered.Rows.Count > 0 Then

                    For Each recrow In dtDNRegistered.Rows

                        CDNRSheet.Cells(countcdnr, 1) = recrow("GSTNo")

                        'Query = "select  Party_RefNo, convert(varchar, Party_RefDt, 6)as Doc_Dt from Salesrtn where Salesrtn.Doc_Id=" & Val(recrow("Doc_Id"))
                        'Dim BillDtl As System.Data.DataTable = Common.GetDataTable(Query)
                        'If BillDtl.Rows.Count > 0 Then

                        '    CDNRSheet.Cells(countcdnr, 2) = BillDtl.Rows(0)("Party_RefNo")
                        '    CDNRSheet.Cells(countcdnr, 3) = BillDtl.Rows(0)("Doc_Dt")
                        'Else

                        '    CDNRSheet.Cells(countcdnr, 2) = "" 'BillDtl.Rows(0)(0)("Bill_No")
                        '    CDNRSheet.Cells(countcdnr, 3) = "" 'BillDtl.Rows(0)(0)("Bill_Dt")
                        'End If

                        CDNRSheet.Cells(countcdnr, 2) = recrow("InvoiceNo")
                        CDNRSheet.Cells(countcdnr, 3) = recrow("Doc_Dt")

                        CDNRSheet.Cells(countcdnr, 4) = ""

                        CDNRSheet.Cells(countcdnr, 5) = "D"
                        ' CDNRSheet.Cells(countcdnr, 7) = ""
                        CDNRSheet.Cells(countcdnr, 6) = recrow("PlaceofSupply")

                        CDNRSheet.Cells(countcdnr, 7) = "Regular"
                        CDNRSheet.Cells(countcdnr, 8) = "N"



                        CDNRSheet.Cells(countcdnr, 9) = recrow("Gross_Total") '+ recrow("CGST25") + recrow("SGST25") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18")
                        '  CDNRSheet.Cells(countcdnr, 7) = ""



                        'If recrow("CGST") > 0 Or recrow("IGST5") > 0 Then
                        '    xlSheet.Cells(countcdnr, 10) = 5
                        'ElseIf recrow("CGST6") > 0 Or recrow("IGST12") > 0 Then
                        '    xlSheet.Cells(countcdnr, 10) = 12
                        'ElseIf recrow("CGST9") > 0 Or recrow("IGST18") > 0 Then
                        '    xlSheet.Cells(countcdnr, 10) = 18
                        'ElseIf recrow("CGST14") > 0 Or recrow("IGST28") > 0 Then
                        '    xlSheet.Cells(countcdnr, 10) = 28
                        'Else
                        CDNRSheet.Cells(countcdnr, 10) = recrow("TAX_RATE")
                        'End If

                        CDNRSheet.Cells(countcdnr, 11) = Val(recrow("Taxable_Amt")) 'Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18") + Val(recrow("GST28"))))

                        If recrow("StateCode") = StateCode Then
                            CDNRSheet.Cells(countcdnr, 12) = ""
                            CDNRSheet.Cells(countcdnr, 13) = Format(("TAX_AMT") / 2, "0.00")
                            CDNRSheet.Cells(countcdnr, 14) = Format(("TAX_AMT") / 2, "0.00")
                        Else
                            CDNRSheet.Cells(countcdnr, 12) = recrow("TAX_AMT")
                            CDNRSheet.Cells(countcdnr, 13) = "" '0
                            CDNRSheet.Cells(countcdnr, 14) = ""
                        End If




                        CDNRSheet.Cells(countcdnr, 15) = ""
                        CDNRSheet.Cells(countcdnr, 16) = ""

                        countcdnr += 1

                        DocCDNR += 1


                    Next recrow



                End If









                'CDNRU Ecel creation................CDNRU Exce creation.............
                Dim CDNURSheet As Excel.Worksheet = xlBook.Worksheets("CDNUR")
                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_CNURegistered]')) " _
                             & " Drop View [dbo].[vw_CNURegistered]"
                Common.ExecuteQuery(Query)

                strFilter = " And  Ledger.GSTNo = ''"

                Query = " Create View [vw_CNURegistered] as Select Salesrtn.Doc_Number,State.Alt_code,Salesrtn.Doc_Id,Ledger.GSTNo,State_Name PlaceofSupply,Ledger.Abbr as Party,Salesrtn.Doc_no AS InvoiceNo,Salesrtn.Taxable_Amt+Salesrtn.Tax_Amt+Salesrtn.OthChgs_Amt Gross_Total,Salesrtn.Doc_Dt ," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST5," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST5," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST12," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST12," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST18," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST18," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST28," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST28" _
                                   & " from Salesrtn Left Join Ledger on Ledger.Led_Key=Salesrtn.Cust_Key  " _
                                   & " LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                   & " Where Salesrtn.Status = '1' and  Direct_CN=1 " _
                                   & " AND Salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Salesrtn.COBR_ID ='" & SelBranchId & "' " _
                                   & strFilter _
                                   & " Group by Doc_Number, State.Alt_Code,STATE.State_Name,Ledger.Abbr,Salesrtn.Doc_no  ,Salesrtn.Doc_Dt ,Ledger.GSTNo ,Salesrtn.Doc_Id,Salesrtn.Taxable_Amt,Salesrtn.Tax_Amt,Salesrtn.OthChgs_Amt" _
                                   & "  UNION ALL " _
                                   & " Select CN.Doc_Number,State.Alt_code,CN.Doc_Id,Ledger.GSTNo,State.State_Name PlaceofSupply,Ledger.Abbr as Party,CN.Doc_no AS InvoiceNo,CN.Taxable_Amt+CN.Tax_Amt+CN.OthChgs_Amt Gross_Total,CN.Doc_Dt ,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST5,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST5,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST12,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST12,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST18," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST9," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST9," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST18," _
                                   & " (Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST28," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST14," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST14," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST28 " _
                                   & " from CN Left Join Ledger on Ledger.Led_Key=CN.Cust_Key   LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY   " _
                                   & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY   Where CN.Status = '1' " _
                                   & " AND CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' " _
                                   & strFilter _
                                   & "	Group by Doc_Number, State.Alt_Code,STATE.State_Name,Ledger.Abbr,CN.Doc_no  ,CN.Doc_Dt ,Ledger.GSTNo ," _
                                   & "	CN.Doc_Id,CN.Taxable_Amt,CN.Tax_Amt,CN.OthChgs_Amt"


                Common.ExecuteQuery(Query)
                Query = "SELECT GSTNo,Party,InvoiceNo,Alt_code StateCode,convert(varchar, Doc_Dt, 103)as Doc_Dt,sum(Gross_Total)Gross_Total,PlaceofSupply,sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28 FROM vw_CNURegistered " _
                      & " Group By GSTNo,Alt_code,Party,InvoiceNo,Doc_Dt,PlaceofSupply Order by  InvoiceNo Asc"

                Dim dtCNUnRegistered As System.Data.DataTable = Common.GetDataTable(Query)


                'Dim ObjcdnurDtl As cdnurDtl = New cdnurDtl()
                Dim CDNURCount As Integer = 5
                If dtCNUnRegistered.Rows.Count > 0 Then

                    For Each recrow In dtCNUnRegistered.Rows
                        Dim taxRate As Decimal = 0
                        Dim taxableAmt As Double = 0



                        CDNURSheet.Cells(CDNURCount, 1) = "b2cl" 'recrow("GSTNo")
                        CDNURSheet.Cells(CDNURCount, 2) = recrow("InvoiceNo")

                        CDNURSheet.Cells(CDNURCount, 3) = recrow("DOC_DT")
                        CDNURSheet.Cells(CDNURCount, 4) = "C"
                        'CDNURSheet.Cells(CDNURCount, 5) = recrow("Bill_No")
                        'CDNURSheet.Cells(CDNURCount, 6) = recrow("Bill_Dt")
                        CDNURSheet.Cells(CDNURCount, 5) = ""

                        CDNURSheet.Cells(CDNURCount, 6) = recrow("PLACEOFSUPPLY")
                        CDNURSheet.Cells(CDNURCount, 7) = recrow("Gross_Total") '+ recrow("CGST25") + recrow("SGST25") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18")




                        If recrow("CGST") > 0 Or recrow("IGST5") > 0 Then
                            xlSheet.Cells(CDNURCount, 8) = 5
                            taxRate = 5

                        ElseIf recrow("CGST6") > 0 Or recrow("IGST12") > 0 Then
                            xlSheet.Cells(CDNURCount, 8) = 12
                            taxRate = 12

                        ElseIf recrow("CGST9") > 0 Or recrow("IGST18") > 0 Then
                            xlSheet.Cells(CDNURCount, 8) = 18
                            taxRate = 18

                        ElseIf recrow("CGST14") > 0 Or recrow("IGST28") > 0 Then
                            xlSheet.Cells(CDNURCount, 8) = 28
                            taxRate = 28

                        Else
                            xlSheet.Cells(CDNURCount, 8) = 0
                        End If

                        CDNURSheet.Cells(CDNURCount, 9) = Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18")) + Val(recrow("GST28")))
                        taxableAmt = Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18")) + Val(recrow("GST28")))


                        If StateCode <> recrow("StateCode") Then
                            CDNURSheet.Cells(CDNURCount, 10) = Format(taxableAmt * taxRate / 100, "0.00") 'IGST
                            CDNURSheet.Cells(CDNURCount, 11) = "" 'CGST
                            CDNURSheet.Cells(CDNURCount, 12) = "" 'SGST
                        Else
                            CDNURSheet.Cells(CDNURCount, 10) = "" 'IGST
                            CDNURSheet.Cells(CDNURCount, 11) = Format((taxableAmt * taxRate / 100) / 2, "0.00")  'CGST
                            CDNURSheet.Cells(CDNURCount, 12) = Format((taxableAmt * taxRate / 100) / 2, "0.00")  'SGST
                        End If
                       
                        CDNURSheet.Cells(CDNURCount, 13) = ""
                        CDNURSheet.Cells(CDNURCount, 14) = ""

                        CDNURCount += 1

                        DocCDNU += 1

                    Next recrow

                End If

                ''CDNUR DEBIT
                '''SATYAM ADDED 12082023


                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_DNURegistered]')) " _
                  & " Drop View [dbo].[vw_DNURegistered]"
                Common.ExecuteQuery(Query)
                Query = " Create View [vw_DNURegistered] as Select PurchaseRtn.TAXABLE_AMT,PurchaseRtn.TAX_AMT,State.Alt_code,PurchaseRtn.Doc_Id,Ledger.GSTNo,State_Name PlaceofSupply,Ledger.Abbr as Party,PurchaseRtn.Doc_no AS InvoiceNo,PurchaseRtn.Taxable_Amt+PurchaseRtn.Tax_Amt+PurchaseRtn.OthChgs_Amt Gross_Total,PurchaseRtn.Doc_Dt ," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST5," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST5," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST12," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST6," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST6," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST12," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST18," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST9," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST9," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST18," _
                            & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST28," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST14," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST14," _
                            & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST28" _
                            & " from PurchaseRtn Left Join Ledger on Ledger.Led_Key=PurchaseRtn.Supl_Key  " _
                            & " LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                            & " Where PurchaseRtn.Status = '1'  " _
                            & " AND PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' " _
                            & strFilter _
                            & " Group by  State.Alt_Code,STATE.State_Name,Ledger.Abbr,PurchaseRtn.Doc_no  ,PurchaseRtn.Doc_Dt ,Ledger.GSTNo ,PurchaseRtn.Doc_Id,PurchaseRtn.Taxable_Amt,PurchaseRtn.Tax_Amt,PurchaseRtn.OthChgs_Amt"

                Common.ExecuteQuery(Query)
                Query = "SELECT TAXABLE_AMT,TAX_AMT,GSTNo,Party,InvoiceNo,Alt_code StateCode,Doc_Dt,sum(Gross_Total)Gross_Total,PlaceofSupply,sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28, " _
            & " cast(TAX_AMT/nullif(TAXABLE_AMT,0)*100 as decimal(10,2) ) TAX_RATE FROM vw_DNURegistered " _
            & " Group By GSTNo,Alt_code,Party,InvoiceNo,Doc_Dt,PlaceofSupply, TAXABLE_AMT,TAX_AMT Order by  InvoiceNo Asc"
                Dim dtDNUNRegistered As DataTable = Common.GetDataTable(Query)


                If dtDNUNRegistered.Rows.Count > 0 Then

                    For Each recrow In dtDNUNRegistered.Rows
                        Dim taxRate As Decimal = 0
                        Dim taxableAmt As Double = 0



                        CDNURSheet.Cells(CDNURCount, 1) = "b2cl" 'recrow("GSTNo")
                        CDNURSheet.Cells(CDNURCount, 2) = recrow("InvoiceNo")

                        CDNURSheet.Cells(CDNURCount, 3) = recrow("DOC_DT")
                        CDNURSheet.Cells(CDNURCount, 4) = "D"
                        'CDNURSheet.Cells(CDNURCount, 5) = recrow("Bill_No")
                        'CDNURSheet.Cells(CDNURCount, 6) = recrow("Bill_Dt")
                        CDNURSheet.Cells(CDNURCount, 5) = ""

                        CDNURSheet.Cells(CDNURCount, 6) = recrow("PLACEOFSUPPLY")
                        CDNURSheet.Cells(CDNURCount, 7) = recrow("Gross_Total") '+ recrow("CGST25") + recrow("SGST25") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18")




                        'If recrow("CGST") > 0 Or recrow("IGST5") > 0 Then
                        '    xlSheet.Cells(CDNURCount, 8) = 5
                        '    taxRate = 5

                        'ElseIf recrow("CGST6") > 0 Or recrow("IGST12") > 0 Then
                        '    xlSheet.Cells(CDNURCount, 8) = 12
                        '    taxRate = 12

                        'ElseIf recrow("CGST9") > 0 Or recrow("IGST18") > 0 Then
                        '    xlSheet.Cells(CDNURCount, 8) = 18
                        '    taxRate = 18

                        'ElseIf recrow("CGST14") > 0 Or recrow("IGST28") > 0 Then
                        '    xlSheet.Cells(CDNURCount, 8) = 28
                        '    taxRate = 28

                        'Else
                        '    xlSheet.Cells(CDNURCount, 8) = 0
                        'End If

                        ' CDNURSheet.Cells(CDNURCount, 9) = Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18")) + Val(recrow("GST28")))
                        '   taxableAmt = Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18")) + Val(recrow("GST28")))


                        CDNURSheet.Cells(CDNURCount, 8) = recrow("Taxable_Amt")
                        CDNURSheet.Cells(CDNURCount, 9) = recrow("TAX_RATE")


                        If StateCode <> recrow("StateCode") Then
                            CDNURSheet.Cells(CDNURCount, 10) = Format(recrow("TAX_AMT"), "0.00") 'IGST
                            CDNURSheet.Cells(CDNURCount, 11) = "" 'CGST
                            CDNURSheet.Cells(CDNURCount, 12) = "" 'SGST
                        Else
                            CDNURSheet.Cells(CDNURCount, 10) = "" 'IGST
                            CDNURSheet.Cells(CDNURCount, 11) = Format(recrow("TAX_AMT") / 2, "0.00")  'CGST
                            CDNURSheet.Cells(CDNURCount, 12) = Format(recrow("TAX_AMT") / 2, "0.00")  'SGST
                        End If

                        CDNURSheet.Cells(CDNURCount, 13) = ""
                        CDNURSheet.Cells(CDNURCount, 14) = ""

                        CDNURCount += 1

                        DocCDNU += 1

                    Next recrow

                End If


                '------------Debit ----------CDNU excel----------------------------------

                'Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_DNURegistered]')) " _
                '           & " Drop View [dbo].[vw_DNURegistered]"
                'Common.ExecuteQuery(Query)


                'strFilter = " And  Ledger.GSTNo=''"


                'Query = " Create View [vw_DNURegistered] as Select State.Alt_code,PurchaseRtn.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,PurchaseRtn.Doc_no AS InvoiceNo,PurchaseRtn.Taxable_Amt+PurchaseRtn.Tax_Amt+PurchaseRtn.OthChgs_Amt Gross_Total,PurchaseRtn.Doc_Dt ," _
                '                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST5," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST5," _
                '                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST12," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST6," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST6," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST12," _
                '                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST18," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST9," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST9," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST18," _
                '                & "(Select Isnull(max(Taxable_Amt),0)from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as GST28," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as CGST14," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as SGST14," _
                '                & "(Select Isnull(max(Tax_Amt),0) from PurchaseRtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And PurchaseRtntxTm.Doc_Id=PurchaseRtn.Doc_Id) as IGST28" _
                '                & " from PurchaseRtn Left Join Ledger on Ledger.Led_Key=PurchaseRtn.Supl_Key  " _
                '                & " LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                '                & " Where PurchaseRtn.Status = '1'  " _
                '                & " AND PurchaseRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND PurchaseRtn.COBR_ID ='" & SelBranchId & "' " _
                '                & strFilter _
                '                & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,PurchaseRtn.Doc_no  ,PurchaseRtn.Doc_Dt ,Ledger.GSTNo ,PurchaseRtn.Doc_Id,PurchaseRtn.Taxable_Amt,PurchaseRtn.Tax_Amt,PurchaseRtn.OthChgs_Amt"
                'Common.ExecuteQuery(Query)

                'Query = "SELECT GSTNo,Party,InvoiceNo,Alt_code StateCode,convert(varchar, Doc_Dt, 6)as Doc_Dt,sum(Gross_Total)Gross_Total,PlaceofSupply,sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28 FROM vw_DNRegistered " _
                '   & " Group By GSTNo,Alt_code,Party,InvoiceNo,Doc_Dt,PlaceofSupply Order by  InvoiceNo Asc"


                'dtCNUnRegistered = Common.GetDataTable(Query)

                'If dtCNUnRegistered.Rows.Count > 0 Then

                '    For Each recrow In dtCNUnRegistered.Rows

                '        CDNURSheet.Cells(CDNURCount, 1) = "b2cl" 'recrow("GSTNo")
                '        CDNURSheet.Cells(CDNURCount, 2) = recrow("InvoiceNo")

                '        CDNURSheet.Cells(CDNURCount, 3) = recrow("DOC_DT")
                '        CDNURSheet.Cells(CDNURCount, 4) = "D"
                '        'CDNURSheet.Cells(CDNURCount, 5) = recrow("Bill_No")
                '        'CDNURSheet.Cells(CDNURCount, 6) = recrow("Bill_Dt")
                '        CDNURSheet.Cells(CDNURCount, 7) = "" 'recrow("PlaceofSupply")
                '        CDNURSheet.Cells(CDNURCount, 8) = recrow("PLACEOFSUPPLY")
                '        CDNURSheet.Cells(CDNURCount, 9) = recrow("GST5") + recrow("CGST") + recrow("SGST") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18")

                '        If recrow("CGST") > 0 Or recrow("IGST5") > 0 Then
                '            xlSheet.Cells(CDNURCount, 10) = 5
                '        ElseIf recrow("CGST6") > 0 Or recrow("IGST12") > 0 Then
                '            xlSheet.Cells(CDNURCount, 10) = 12
                '        ElseIf recrow("CGST9") > 0 Or recrow("IGST18") > 0 Then
                '            xlSheet.Cells(CDNURCount, 10) = 18
                '        ElseIf recrow("CGST14") > 0 Or recrow("IGST28") > 0 Then
                '            xlSheet.Cells(CDNURCount, 10) = 28
                '        Else
                '            xlSheet.Cells(CDNURCount, 10) = 0
                '        End If

                '        CDNURSheet.Cells(CDNURCount, 11) = Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18")) + Val(recrow("GST28")))
                '        CDNURSheet.Cells(CDNURCount, 12) = 0
                '        CDNURSheet.Cells(CDNURCount, 13) = "N"

                '        CDNURCount += 1


                '        DocCDNU += 1
                '    Next recrow

                'End If



                '--------------Export------Doc--24062019---------------------------------
                Dim ExpSheet As Excel.Worksheet = xlBook.Worksheets("exp")

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_exp]')) " _
                               & " Drop View [dbo].[vw_exp]"
                Common.ExecuteQuery(Query)

                Query = "CREATE View [vw_exp] AS  " _
                        & " select convert(varchar, salebill.Doc_Dt, 103)as Doc_Dt,ledger.Led_Name,salebill.Doc_No,salebill.Taxable_Amt,salebill.Net_Amt from salebill  " _
                        & " Left join Ledger on Ledger.Led_Key=salebill.Cust_Key  where Doc_Dt between  '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And salebill.Led_Key='0126' And salebill.COBR_ID ='" & SelBranchId & "'"
                Common.ExecuteQuery(Query)

                Query = "SELECT * from vw_exp "
                Dim dtExp As System.Data.DataTable = Common.GetDataTable(Query)
                If dtExp.Rows.Count > 0 Then
                    Dim ExpCount As Integer = 5
                    For Each recrow In dtExp.Rows

                        'If recrow("Type") = "C" Then
                        ExpSheet.Cells(ExpCount, 1) = "WOPAY"
                        'Else
                        ExpSheet.Cells(ExpCount, 2) = recrow("Doc_No")
                        ExpSheet.Cells(ExpCount, 3) = recrow("Doc_Dt")
                        ExpSheet.Cells(ExpCount, 4) = recrow("Net_Amt")
                        ExpSheet.Cells(ExpCount, 5) = ""
                        ExpSheet.Cells(ExpCount, 6) = ""
                        ExpSheet.Cells(ExpCount, 7) = ""
                        ExpSheet.Cells(ExpCount, 8) = 0
                        ExpSheet.Cells(ExpCount, 9) = recrow("Taxable_Amt")


                        ExpSheet.Cells(ExpCount, 10) = ""
                        ExpSheet.Cells(ExpCount, 11) = ""
                        ExpSheet.Cells(ExpCount, 12) = ""

                        ExpCount += 1

                    Next recrow

                End If

            End If
            '-----------------Doc_Issue................

            Dim DocsSheet As Excel.Worksheet = xlBook.Worksheets("DOCS")

            Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_DocSummary]')) " _
                           & " Drop View [dbo].[vw_DocSummary]"
            Common.ExecuteQuery(Query)
            If b2b = 0 Then


                Query = "CREATE View [vw_DocSummary] AS  " _
                        & " SELECT  Doc_No,'B' Type FROM SaleBill WHERE Doc_Dt BETWEEN  '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND COBR_ID ='" & SelBranchId & "'    " _
                        & " UNION ALL  SELECT Doc_No,'C' Type FROM [vw_CNRegisteredSAT] WHERE TaxableAmt <> 0   " _
                        & " UNION ALL  SELECT InvoiceNo Doc_No,'C' Type FROM vw_CNRegistered    " _
                & " UNION ALL SELECT InvoiceNo ,'D' TYPE FROM [vw_DNRegistered] WHERE TAXABLE_AMT<>0 " _
                & " UNION ALL SELECT InvoiceNo ,'D' TYPE FROM [vw_DNURegistered] WHERE TAXABLE_AMT<>0 "

                Common.ExecuteQuery(Query)
                Query = "SELECT MIN(Doc_No) SrFrom,MAX(Doc_No) SrTo,COUNT(distinct Doc_No) Tot_Doc,Type FROM vw_DocSummary GROUP BY Type "
                Dim dtDoc As System.Data.DataTable = Common.GetDataTable(Query)
                If dtDoc.Rows.Count > 0 Then
                    Dim DocsCount As Integer = 5
                    For Each recrow In dtDoc.Rows

                        If recrow("Type") = "C" Then
                            DocsSheet.Cells(DocsCount, 1) = "Credit Note"
                        ElseIf recrow("Type") = "D" Then
                            DocsSheet.Cells(DocsCount, 1) = "Debit Note"
                        Else
                            DocsSheet.Cells(DocsCount, 1) = "Invoices for outward supply"
                        End If

                        Dim formatRange As Excel.Range

                        DocsSheet.Cells(DocsCount, 2) = recrow("SrFrom") & ""
                        DocsSheet.Cells(DocsCount, 3) = recrow("SrTo") & ""

                        DocsSheet.Cells(DocsCount, 4) = recrow("Tot_Doc")

                        DocsSheet.Cells(DocsCount, 5) = 0
                        DocsCount += 1

                    Next recrow

                End If

            Else
                Query = "CREATE View [vw_DocSummary] AS  " _
                 & " select  Doc_Sr, PDoc_No as Doc_No,'B' as Type  from BillSync where BillSync.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CoBr_Id in( " _
                    & " select Franchisee_code from ledger where Franchisee_code <> '' And Led_Key in ( " _
                    & " select Cust_Key from SalebillOutlets " _
                    & " LEFT JOIN STATION ON STATION.STN_KEY = SalebillOutlets.STN_KEY    " _
                    & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                    & " Where SalebillOutlets.Status = '1'   AND SalebillOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND " _
                    & " SalebillOutlets.COBR_ID ='" & SelBranchId & "' " & StateName & " And   SalebillOutlets.FcYr_Id ='" & SelYearId & "' ))  "

                Common.ExecuteQuery(Query)
                Query = "SELECT MIN(Doc_No) SrFrom,MAX(Doc_No) SrTo,COUNT(distinct Doc_No) Tot_Doc,Type FROM vw_DocSummary GROUP BY Type,Doc_Sr "
                Dim dtDoc As System.Data.DataTable = Common.GetDataTable(Query)
                If dtDoc.Rows.Count > 0 Then
                    Dim DocsCount As Integer = 5
                    For Each recrow In dtDoc.Rows

                        If recrow("Type") = "C" Then
                            DocsSheet.Cells(DocsCount, 1) = "Credit Note"
                        Else
                            DocsSheet.Cells(DocsCount, 1) = "Invoices for outward supply"
                        End If

                        Dim formatRange As Excel.Range

                        DocsSheet.Cells(DocsCount, 2) = recrow("SrFrom") & ""
                        DocsSheet.Cells(DocsCount, 3) = recrow("SrTo") & ""

                        DocsSheet.Cells(DocsCount, 4) = recrow("Tot_Doc")

                        DocsSheet.Cells(DocsCount, 5) = 0
                        DocsCount += 1

                    Next recrow

                End If

            End If





            '---------------------------------------------end--------------------------------------------------

            If (Not System.IO.Directory.Exists(Environment.GetFolderPath(Environment.SpecialFolder.Desktop) & "\GSTR-1")) Then
                System.IO.Directory.CreateDirectory(Environment.GetFolderPath(Environment.SpecialFolder.Desktop) & "\GSTR-1")
            End If
            Dim strExportFile As String = ""
            strExportFile = Environment.GetFolderPath(Environment.SpecialFolder.Desktop) & "\GSTR-1\GSTR1-" & Format$(dtpFrom.Value, "MMddyyyy") & ".xlsx"
            MsgBox("GSTR-1 Excel Generated Successfully On Path : " & strExportFile, MsgBoxStyle.Exclamation)
            xlBook.SaveAs(strExportFile)
            xlBook.Close()

            System.Diagnostics.Process.Start(strExportFile)

            '------------------------END Ecel------------------------------------
            btnGSTR1Excel.Enabled = True
            Cursor = Cursors.Default
        Catch ex As Exception
            Common.LogAndDisplayException(ex)
            btnGSTR1Excel.Enabled = True
            Cursor = Cursors.Default
        End Try




    End Sub


    Private Sub btnGSTR1Excel_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnGSTR1Excel.Click
        Try
            If GetSettingAsPerId(ApplnSettingsIdx.DisplayStateinGSTR) = "1" Then

                If cmbStateGSTR.ItemIndex = -1 Then
                    MsgBox("State has not been provided !", MsgBoxStyle.Exclamation)
                    cmbStateGSTR.Focus()
                    Exit Sub
                End If

                If cmbStateGSTR.ItemIndex = -1 Then
                    MsgBox("Store has not been provided !", MsgBoxStyle.Exclamation)
                    cmbStateGSTR.Focus()
                    Exit Sub
                End If
            End If


            If MsgBox("Do You Want To Continue GSTR1 , It Will Take Some Time", MsgBoxStyle.Question + MsgBoxStyle.YesNo) = MsgBoxResult.No Then

                Exit Sub
            End If
            btnGSTR1Excel.Enabled = False
            Cursor = Cursors.WaitCursor
            Dim DocB2B As Integer = 0
            Dim DocB2CL As Integer = 0
            Dim DocB2CS As Integer = 0
            Dim DocCDNR As Integer = 0
            Dim DocCDNU As Integer = 0

            If (Not System.IO.Directory.Exists(System.Windows.Forms.Application.StartupPath & "\GSTR-1")) Then
                System.IO.Directory.CreateDirectory(System.Windows.Forms.Application.StartupPath & "\GSTR-1")
                MsgBox("GSTR-1 Excel file Not Found  !", MsgBoxStyle.Exclamation)
                Cursor = Cursors.Default
                btnGSTR1Excel.Enabled = True
                Exit Sub
            End If
            If (Not System.IO.File.Exists(System.Windows.Forms.Application.StartupPath & "\GSTR-1\SAT1.xlsx")) Then
                MsgBox("GSTR-1 Excel file Not Found  !", MsgBoxStyle.Exclamation)
                Cursor = Cursors.Default
                btnGSTR1Excel.Enabled = True
                Exit Sub
            End If
            'If System.IO.File.Open(System.Windows.Forms.Application.StartupPath & "\GSTR-1\SAT5.xlsx", System.IO.File.Open) Then
            '    System.IO.File.Delete(System.Windows.Forms.Application.StartupPath & "GSTR-1\SAT5.xlsx")
            '    Exit Sub
            'End If
            Dim xlApp As New Excel.Application
            Dim xlBook As Excel.Workbook = xlApp.Workbooks.Open(System.Windows.Forms.Application.StartupPath & "\GSTR-1\SAT1.xlsx", , False)
            'xlBook.Activate()

            Dim Trans As SqlTransaction
            Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
            Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
            Query = "Select GSTNo from cobr where cobr_id=  " & SelBranchId
            Dim GST As String = Common.ExecuteScalar(Query, Nothing)


            Dim StateCode As String = ""
            If GST.Trim.Length > 0 Then
                StateCode = Mid$(GST, 1, 2)
            End If

            Dim b2b As Integer = 0
            Dim cdnr As Integer = 0
            Dim StateName As String = ""
            If GetSettingAsPerId(ApplnSettingsIdx.DisplayStateinGSTR) = "1" Then
                Query = "  Select STATE.STATE_Name from cobr LEFT JOIN STATION ON STATION.STN_KEY = cobr.STN_KEY   " _
                & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  where cobr.cobr_id= " & SelBranchId
                Dim StateN As String = Common.ExecuteScalar(Query, Nothing)
                If StateN.Trim.Length > 0 Then
                    If cmbStateGSTR.Text <> StateN Then
                        b2b = 1
                        cdnr = 1
                        If cmbStateGSTR.ItemIndex <> -1 And chkStatewise.Checked = True Then
                            StateName = "And STATE.STATE_KEY= '" & cmbStateGSTR.EditValue & "'"
                        ElseIf cmbStore.EditValue <> -1 And chkStorewise.Checked = True Then
                            StateName += "And Ledger.Led_KEY= '" & cmbStore.EditValue & "'"
                        End If

                    End If

                End If

            End If
            Dim strSrch As String = ""
            Dim xlSheet As Excel.Worksheet
            If b2b = 0 Then


                '-----------B2B-------Ecel------------------------------
                xlSheet = xlBook.Worksheets("B2B")
                'xlSheet = xlBook.ActiveSheet


                'xlBook("exemp").Range("A").Clear()
                'If xlSheet.Protection.AllowInsertingRows = False Then
                '    'xlBook.Protect(AllowInsertingRow:=True) 
                '    xlSheet.Protect(AllowInsertingRows:=False)
                'End If






                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_B2BInvoices]')) " _
                                   & " Drop View [dbo].[vw_B2BInvoices]"
                Common.ExecuteQuery(Query)

                Query = "Create View vw_B2BInvoices As  " _
                                 & " Select SalebillTxTm.TaxTerm_Perc, SaleBill.Net_Amt, SalebillTxTm.Tax_Amt,SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc,SaleBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Doc_Dt ," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm INNER JOIN TaxTermsTDS ON TaxTerm_Key=TxTmTDS_Key WHere salebilltxtm.AddSubTract='+' and TaxTerm_Perc in (2.5,5,0.00) AND TaxTermsTDS.TxTmTDS_Flag ='X' And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (0.05,0.1)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                                 & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.1 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                                 & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                                 & "LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                & " Left Join SalebillTxTm on SalebillTxTm.Doc_Id=SaleBill.Doc_Id " _
                                 & " Where SaleBill.Status = '1' And Ledger.GSTNo<>'' " _
                                 & " AND SaleBill.Doc_Type='A' and SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' And SaleBill.FcYr_Id ='" & SelYearId & "' "
                '   & " Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt" _
                '  & strSrch

                'Query = "Create View vw_B2BInvoices As  " _
                '              & " Select SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc,SaleBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Doc_Dt ," _
                '              & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm INNER JOIN TaxTermsTDS ON TaxTerm_Key=TxTmTDS_Key WHere salebilltxtm.AddSubTract='+' and TaxTerm_Perc in (2.5,5,0.00) AND TaxTermsTDS.TxTmTDS_Flag ='X' And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                '              & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                '              & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                '              & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (0.05,0.1)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.05 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                '              & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=0.1 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                '              & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                '              & "LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                '             & " Left Join SalebillTxTm on SalebillTxTm.Doc_Id=SaleBill.Doc_Id " _
                '              & " Where SaleBill.Status = '1' And Ledger.GSTNo<>'' " _
                '              & " AND SaleBill.Doc_Type='A' and SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' "
                Common.ExecuteQuery(Query)

                Query = "SELECT  Taxable_Amt,Net_Amt,Tax_Amt ,Tax1_Perc, GSTNo,Party,InvoiceNo,convert(varchar, Doc_Dt, 6)as Doc_Dt,PlaceofSupply,Taxable_Amt,(GST5+CGST +SGST+IGST5+GST12+CGST6+SGST6+IGST12+GST18+CGST9+SGST9+IGST18+GST28+CGST14+SGST14+IGST28)as Gross_Total,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28 FROM vw_B2BInvoices " _
                       & "where Tax1_Perc> 0 group by Taxable_Amt,Net_Amt,Tax_Amt, Taxable_Amt,Tax1_Perc,GSTNo,Party,InvoiceNo, Doc_Dt,PlaceofSupply,GST5,CGST,SGST,IGST5,GST12,CGST6,SGST6,IGST12,GST18,CGST9,SGST9,IGST18,GST28,CGST14,SGST14,IGST28  Order by  InvoiceNo Asc"

                Dim dtb2CSmall As System.Data.DataTable = Common.GetDataTable(Query)
                Dim recrow As DataRow

                If dtb2CSmall.Rows.Count > 0 Then


                    Dim i As Integer = 5

                    For Each recrow In dtb2CSmall.Rows




                        xlSheet.Cells(i, 1) = recrow("GSTNo")
                        xlSheet.Cells(i, 2) = recrow("InvoiceNo") & ""
                        xlSheet.Cells(i, 3) = recrow("Doc_Dt")
                        xlSheet.Cells(i, 4) = Val(recrow("Net_Amt"))
                        xlSheet.Cells(i, 5) = recrow("PlaceofSupply") & ""
                        xlSheet.Cells(i, 6) = "N"
                        xlSheet.Cells(i, 7) = ""
                        xlSheet.Cells(i, 8) = "Regular" 'recrow("PlaceofSupply")
                        xlSheet.Cells(i, 9) = ""
                        If Val(recrow("Tax1_Perc")) = 2.5 Then  'Tax1_Perc
                            xlSheet.Cells(i, 10) = 5
                        ElseIf Val(recrow("Tax1_Perc")) = 6 Then
                            xlSheet.Cells(i, 10) = 12
                        ElseIf Val(recrow("Tax1_Perc")) = 9 Then
                            xlSheet.Cells(i, 10) = 18
                        ElseIf Val(recrow("Tax1_Perc")) = 14 Then
                            xlSheet.Cells(i, 10) = 28
                        Else
                            xlSheet.Cells(i, 10) = ""
                            xlSheet.Cells(i, 10) = recrow("Tax1_Perc") & "" 'Tax1_Perc
                        End If

                        xlSheet.Cells(i, 11) = recrow("Taxable_Amt")
                        xlSheet.Cells(i, 12) = "" ' 0






                i += 1
                DocB2B += 1
                    Next

                End If





                'HSN Summary...................HSN Summary................
                Dim HSNSheet As Excel.Worksheet = xlBook.Worksheets("HSN")

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_HSN]')) " _
                                 & " Drop View [dbo].[vw_HSN]"
                Common.ExecuteQuery(Query)

        

                If GetSettingAsPerId(ApplnSettingsIdx.GenUseSize) = "1" Then
                    Query = "Create View [vw_HSN] as " _
                        & " Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                        & " Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt,Sum(Tax3_Amt)IGSTAmt " _
                        & "  from salebilldtl" _
                        & " Inner Join Style On Style.Style_Key=salebilldtl.Style_Key " _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "'  And SaleBill.FcYr_Id ='" & SelYearId & "' Group by HsnCode,UNIT_NAME " _
                        & " Union All " _
                        & " Select HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(Taxable)Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                        & " -Sum(salesrtndtl.Tax1_Amt)CGSTAmt,-Sum(salesrtndtl.Tax2_Amt)SGSTAmt,-Sum(salesrtndtl.Tax3_Amt)IGSTAmt " _
                        & " from salesrtndtl  " _
                        & " Inner Join Style On Style.Style_Key=salesrtndtl.Style_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY   " _
                        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "'  And salesrtn.FcYr_Id ='" & SelYearId & "' Group by HsnCode,UNIT_NAME " _
                        & " Union All " _
                        & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                        & " -Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt,-Sum(Tax3_Amt)IGSTAmt   from cndtl Inner Join Style On Style.Style_Key=cndtl.Style_Key   " _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id   " _
                       & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' And cn.FcYr_Id ='" & SelYearId & "' Group by HsnCode,UNIT_NAME" _
                        & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' And   salebill.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve  " _
                & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' And CN.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve  " _
                & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                & " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' And SalesRtn.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve  " _
                & "Union All  select Item.HsnCode,'' UNIT_NAME,-sum(Qty) Qty,-sum(Taxable) Taxable ,-sum(salebilltxtm.Tax_Amt)TaxAmt , -(case when salebilltxtm.TaxTerm_Perc in (2.5,6,9,14) then sum(salebilltxtm.Tax_Amt) else sum(0) end) CGSTAmt,     " _
                 & " -(case when salebilltxtm.TaxTerm_Perc in (2.5,6,9,14) then sum(salebilltxtm.Tax_Amt) else sum(0) end) SGSTAmt,   " _
              & " -(case when salebilltxtm.TaxTerm_Perc in (5,12,18,28) then sum(salebilltxtm.Tax_Amt) else sum(0) end) IGSTAmt  from salebill Left join salebilldtl on salebilldtl.Doc_Id=salebill.Doc_Id    " _
              & " Left join salebilltxtm on salebilltxtm.Doc_Id=salebill.Doc_Id  left join Item On Item.Item_Key=salebilldtl.Item_Key  " _
              & " where  salebill.Doc_Id<>0 And salebill.Doc_Id in (select vchrdtlref.SaleBill_Id from vchr inner join vchrdtlref on vchrdtlref.Doc_Id=vchr.Doc_Id " _
              & " where  vchr.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And vchr.CoBr_Id='" & SelBranchId & "'  And " _
              & " vchr.FcYr_Id='" & SelYearId & "' ) group by HsnCode,TaxTerm_Perc "
                Else
                    Query = "Create View [vw_HSN] as " _
                        & " Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100 Taxable,Sum(salebilldtl.Tax_Amt)TaxAmt, " _
                        & " case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((Sum(salebilldtl.TotAmtAftDisc)-Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((Sum(salebilldtl.TotAmtAftDisc)-(Sum(salebilldtl.TotAmtAftDisc)*Salebill.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt " _
                        & "  from salebilldtl Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                        & " Inner Join Item On Item.Item_Key=salebilldtl.Item_Key Inner join Ledger on Ledger.Led_key=SaleBill.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key" _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salebilldtl.UNIT_KEY  " _
                        & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' And salebill.FcYr_Id ='" & SelYearId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME,LedType.Type_Inve,Item.GSTPerc " _
                        & " Union All " _
                        & " Select HsnCode,UNIT_NAME,-Sum(ABS(Qty))Qty,-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100 Taxable,-Sum(salesrtndtl.Tax_Amt)TaxAmt, " _
                        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(salesrtndtl.TotAmtAftDisc)-Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(salesrtndtl.TotAmtAftDisc)-(Sum(salesrtndtl.TotAmtAftDisc)*salesrtn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt  " _
                        & " from salesrtndtl  " _
                        & " Inner Join Item On Item.Item_Key=salesrtndtl.Item_Key Inner join salesrtn on salesrtndtl.DOc_id=salesrtn.doc_id" _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = salesrtndtl.UNIT_KEY  Inner join Ledger on Ledger.Led_key=salesrtn.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key  " _
                        & " where Direct_CN=1 AND salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesrtn.COBR_ID ='" & SelBranchId & "' And salesrtn.FcYr_Id ='" & SelYearId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve ,Item.GSTPerc" _
                        & " Union All " _
                        & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100 Taxable,-Sum(cndtl.Tax_Amt)TaxAmt,  " _
                        & " case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0 End as CGSTAmt,case WHen LedType.Type_Inve='R' Then (((((-Sum(cndtl.TotAmtAftDisc)-Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100)/2) else 0  End as  SGSTAmt,case WHen LedType.Type_Inve='I' Then (((-Sum(cndtl.TotAmtAftDisc)-(Sum(cndtl.TotAmtAftDisc)*cn.BillDisc_Perc/100))*Item.GSTPerc)/100) else 0  End as IGSTAmt   from cndtl Inner Join Item On Item.Item_Key=cndtl.Item_Key   " _
                        & " LEFT JOIN UNIT ON UNIT.UNIT_KEY = cndtl.UNIT_KEY  Inner JOIN cn ON CN.Doc_ID = cndtl.Doc_Id  Inner join Ledger on Ledger.Led_key=CN.Cust_Key Inner Join Ledger LedType on LedType.Led_key=Ledger.Sales_Led_Key " _
                       & " Where cn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND cn.COBR_ID ='" & SelBranchId & "' Group by BillDisc_Perc,HsnCode,UNIT_NAME ,LedType.Type_Inve,Item.GSTPerc " _
                        & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else (Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where TxTmTDS_Flag='X'  And salebilltxtm.Doc_id=Salebill.Doc_id)< (Select DocTxTm_Id from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=salebilltxtm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and salebilltxtm.Doc_id=Salebill.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(Tax_Amt) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where HSNCode<>'' and salebilltxtm.doc_id=Salebill.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from salebilltxtm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key Where  salebilltxtm.doc_id=Salebill.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from salebilldtl  Inner Join SaleBill on Salebill.DOc_id=SalebillDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key= case When SaleBill.DlvParty_Key ='' then SaleBill.Led_Key Else SaleBill.DlvParty_Key End Inner Join salebilltxtm on salebilltxtm.Doc_Id=Salebill.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=salebilltxtm.TaxTerm_Key " _
                & " where SaleBill.Doc_Type='A' and salebill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' And salebill.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, Salebill.Doc_id,Type_Inve  " _
                & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And CNTxTm.Doc_id=CN.Doc_id)< (Select DocTxTm_Id from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=CNTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and CNTxTm.Doc_id=CN.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where HSNCode<>'' and CNTxTm.doc_id=CN.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from CNTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key Where  CNTxTm.doc_id=CN.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from CNdtl  Inner Join CN on CN.DOc_id=CNDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key=CN.Led_Key Inner Join CNTxTm on CNTxTm.Doc_Id=CN.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=CNTxTm.TaxTerm_Key " _
                & " where CN.Doc_Type='A' and CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' And CN.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, CN.Doc_id,Type_Inve  " _
                 & " Union All " _
                & "  Select TaxTermsTds.HsnCode,'' As UNIT_NAME,0 Qty," _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )ENd Taxable, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else (Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id ) End TaxAmt,  " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+' ))/100) Else 0 End END As CGSTAmt, " _
                & " case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='R'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End END As SGSTAmt, " _
                & "  case When (Select max(DocTxTm_Id)DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on  TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where TxTmTDS_Flag='X'  And SalesRtnTxTm.Doc_id=SalesRtn.Doc_id)< (Select DocTxTm_Id from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_key=SalesRtnTxTm.TaxTerm_key Where    TaxTermsTds.HSNCode<>'' and SalesRtnTxTm.Doc_id=SalesRtn.Doc_id) Then 0 else  Case When Type_Inve='I'Then (((Select Sum(-Tax_Amt) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where HSNCode<>'' and SalesRtnTxTm.doc_id=SalesRtn.Doc_id )* " _
                & " (Select Max(TaxTerm_Perc) from SalesRtnTxTm  Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key Where  SalesRtnTxTm.doc_id=SalesRtn.Doc_id and TaxTermsTds.TxTmTDS_Flag='X' and TaxTermsTds.AddSubtract='+'))/100)  Else 0 End ENd  As IGSTAmt " _
                & " from SalesRtndtl  Inner Join SalesRtn on SalesRtn.DOc_id=SalesRtnDtl.DOc_id " _
                & " Inner Join Ledger on Ledger.Led_Key=SalesRtn.Led_Key Inner Join SalesRtnTxTm on SalesRtnTxTm.Doc_Id=SalesRtn.DOc_id " _
                & " Inner Join TaxTermsTds on TaxTermsTds.TxTmTDS_Key=SalesRtnTxTm.TaxTerm_Key " _
                & " where SalesRtn.Doc_Type='A'   And Direct_CN =1 and SalesRtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtn.COBR_ID ='" & SelBranchId & "' And SalesRtn.FcYr_Id ='" & SelYearId & "' ANd TaxTermsTds.HSNCOde<>'' Group by TaxTermsTds.HsnCode, SalesRtn.Doc_id,Type_Inve  " _
                & "Union All  select Item.HsnCode,'' UNIT_NAME,-sum(Qty) Qty,-sum(Taxable) Taxable ,-sum(salebilltxtm.Tax_Amt)TaxAmt , -(case when salebilltxtm.TaxTerm_Perc in (2.5,6,9,14) then sum(salebilltxtm.Tax_Amt) else sum(0) end) CGSTAmt,     " _
                  & " -(case when salebilltxtm.TaxTerm_Perc in (2.5,6,9,14) then sum(salebilltxtm.Tax_Amt) else sum(0) end) SGSTAmt,   " _
              & " -(case when salebilltxtm.TaxTerm_Perc in (5,12,18,28) then sum(salebilltxtm.Tax_Amt) else sum(0) end) IGSTAmt  from salebill Left join salebilldtl on salebilldtl.Doc_Id=salebill.Doc_Id    " _
              & " Left join salebilltxtm on salebilltxtm.Doc_Id=salebill.Doc_Id  left join Item On Item.Item_Key=salebilldtl.Item_Key  " _
              & " where  salebill.Doc_Id<>0 And salebill.Doc_Id in (select vchrdtlref.SaleBill_Id from vchr inner join vchrdtlref on vchrdtlref.Doc_Id=vchr.Doc_Id " _
              & " where  vchr.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And vchr.CoBr_Id='" & SelBranchId & "'  And " _
              & " vchr.FcYr_Id='" & SelYearId & "' ) group by HsnCode,TaxTerm_Perc "
                End If


                Common.ExecuteQuery(Query)

               

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_hsnB2cs]')) " _
                         & " Drop View [dbo].[vw_hsnB2cs]"
                Common.ExecuteQuery(Query)
                Query = " Create view [vw_hsnB2cs] as  Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(SalebillOutletsdtl.Tax_Amt)TaxAmt,  Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt, " _
                    & " Sum(Tax3_Amt)IGSTAmt   from SalebillOutletsdtl Inner Join Style On Style.Style_Key=SalebillOutletsdtl.Style_Key  LEFT JOIN UNIT  " _
                    & " ON UNIT.UNIT_KEY = SalebillOutletsdtl.UNIT_KEY Inner Join SalebillOutlets on SalebillOutlets.DOc_id=SalebillOutletsdtl.DOc_id   " _
                    & " LEFT JOIN STATION ON STATION.STN_KEY = SalebillOutlets.STN_KEY    " _
                    & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                      & "  inner JOIN Ledger ON Ledger.Led_KEY = SalebillOutlets.Cust_Key " _
                    & " where SalebillOutlets.Doc_Type='A' and SalebillOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalebillOutlets.COBR_ID ='" & SelBranchId & "'  " _
                    & " And SalebillOutlets.FcYr_Id ='" & SelYearId & "' And Ledger.Franchisee_code<>'' " & StateName & " Group by HsnCode,UNIT_NAME " _
                    & "Union All " _
                    & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(SalesRtnOutletsdtl.Tax_Amt)TaxAmt, - Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt, " _
                    & " -Sum(Tax3_Amt)IGSTAmt   from SalesRtnOutletsdtl Inner Join Style On Style.Style_Key=SalesRtnOutletsdtl.Style_Key  LEFT JOIN UNIT  " _
                    & " ON UNIT.UNIT_KEY = SalesRtnOutletsdtl.UNIT_KEY Inner Join SalesRtnOutlets on SalesRtnOutlets.DOc_id=SalesRtnOutletsdtl.DOc_id   " _
                    & " LEFT JOIN STATION ON STATION.STN_KEY = SalesRtnOutlets.STN_KEY    " _
                    & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                      & "  inner JOIN Ledger ON Ledger.Led_KEY = SalesRtnOutlets.Cust_Key " _
                    & " where SalesRtnOutlets.Doc_Type='A' and SalesRtnOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtnOutlets.COBR_ID ='" & SelBranchId & "'  " _
                    & " And SalesRtnOutlets.FcYr_Id ='" & SelYearId & "' And Ledger.Franchisee_code<>'' " & StateName & " Group by HsnCode,UNIT_NAME "

                Common.ExecuteQuery(Query)
                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[AllHSN]')) " _
                       & " Drop View [dbo].[AllHSN]"
                Common.ExecuteQuery(Query)
                Query = "Create view [AllHSN] as  SELECT HSNCODE,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                                  & " FROM vw_HSN " _
                                                  & " Group By HSNCODE " _
                & " Union All SELECT HSNCODE,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                                 & " FROM vw_hsnB2cs " _
                                                 & " Group By HSNCODE "
                Common.ExecuteQuery(Query)
                Query = "  SELECT HSNCODE,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGST) IGST, sum(SGST) SGST,sum(CGST) CGST " _
                                                   & " FROM AllHSN " _
                                                   & " Group By HSNCODE "

                Dim dtHSNWise As System.Data.DataTable = Common.GetDataTable(Query)
                Dim HsnCountCN As Integer = 0
                If dtHSNWise.Rows.Count > 0 Then
                    Dim HSNCount As Integer = 5
                    For Each recrow In dtHSNWise.Rows



                        HSNSheet.Cells(HSNCount, 1) = recrow("HSNCODE")

                        Query = "select Item.Item_Desc,unit.Abbr from unit Inner join Item on Item.Unit_Key=unit.Unit_Key where HSNCode='" & recrow("HSNCode") & "'"
                        Dim BillDtl1 As System.Data.DataTable = Common.GetDataTable(Query)
                        If BillDtl1.Rows.Count > 0 Then
                            HSNSheet.Cells(HSNCount, 3) = BillDtl1.Rows(0)("Abbr") & ""
                            HSNSheet.Cells(HSNCount, 2) = BillDtl1.Rows(0)("Item_Desc") & ""
                        Else
                            HSNSheet.Cells(HSNCount, 3) = ""
                            HSNSheet.Cells(HSNCount, 2) = ""
                        End If

                        ' HSNSheet.Cells(HSNCount, 2) = "" 'recrow("SrTo")
                        '  HSNSheet.Cells(HSNCount, 3) = "" 'recrow("SrFrom")
                        HSNSheet.Cells(HSNCount, 4) = recrow("Qty")
                        HSNSheet.Cells(HSNCount, 5) = Val(Val(recrow("TAXABLE")) + Val(recrow("IGST")) + Val(recrow("SGST")) + Val(recrow("CGST")))
                        HSNSheet.Cells(HSNCount, 6) = recrow("TAXABLE")
                        HSNSheet.Cells(HSNCount, 7) = recrow("IGST")
                        HSNSheet.Cells(HSNCount, 8) = recrow("CGST")
                        HSNSheet.Cells(HSNCount, 9) = recrow("SGST")
                        HSNSheet.Cells(HSNCount, 10) = "" '0 'recrow("SrTo")

                        HSNCount += 1
                    Next recrow
                    HsnCountCN = HSNCount
                End If



                '----------' 'B2CL....................B2CL..................------------------------------------
                Dim B2CLSheet As Excel.Worksheet = xlBook.Worksheets("B2CL")
                



                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_B2CLarge]')) " _
                                & " Drop View [dbo].[vw_B2CLarge]"
                Common.ExecuteQuery(Query)

                Query = "Create View vw_B2CLarge As  " _
                                   & " Select SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc,SaleBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Taxable_Amt+salebill.Tax_Amt+salebill.OthChgs_Amt Gross_Total,salebill.Doc_Dt ," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                                   & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                                   & " Left Join SalebillTxTm on SalebillTxTm.Doc_Id=SaleBill.Doc_Id LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                   & " Where SaleBill.Status = '1' and State.Alt_Code<>'" & StateCode & "' And Ledger.GSTNo='' And Salebill.Taxable_Amt>250000  " _
                                   & " AND SaleBill.Doc_Type='A' and SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' And SaleBill.FcYr_Id ='" & SelYearId & "' " _
                                   & " Group by SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc,State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt"


                Common.ExecuteQuery(Query)
                Query = "SELECT Taxable_Amt,Tax1_Perc,GSTNo,InvoiceNo,Gross_Total,convert(varchar, Doc_Dt, 6)as Doc_Dt,PlaceofSupply,Sum(GST5)GST5,Sum(CGST)CGST,Sum(SGST)SGST,sum(IGST5)IGST5,Sum(GST12)GST12,Sum(CGST6)CGST6,Sum(SGST6)SGST6,Sum(IGST12)IGST12,Sum(GST18)GST18,Sum(CGST9)CGST9,Sum(SGST9)SGST9,Sum(IGST18)IGST18,Sum(GST28)GST28,Sum(CGST14)CGST14,Sum(SGST14)SGST14,Sum(IGST28)IGST28 FROM vw_B2CLarge " _
                      & " Group By Taxable_Amt,Tax1_Perc,GSTNo,InvoiceNo,Gross_Total,Doc_Dt,PlaceofSupply"
                Dim dtb2CSLarge As System.Data.DataTable = Common.GetDataTable(Query)



                If dtb2CSLarge.Rows.Count > 0 Then
                    Dim b2cl As Integer = 5
                    For Each recrow In dtb2CSLarge.Rows

                        B2CLSheet.Cells(b2cl, 1) = recrow("InvoiceNo")
                        B2CLSheet.Cells(b2cl, 2) = recrow("Doc_Dt")
                        B2CLSheet.Cells(b2cl, 3) = recrow("Gross_Total")
                        B2CLSheet.Cells(b2cl, 4) = recrow("PlaceofSupply")
                        B2CLSheet.Cells(b2cl, 5) = ""
                        If recrow("Tax1_Perc") > 1 Or recrow("Tax1_Perc") < 4 Then
                            B2CLSheet.Cells(b2cl, 6) = 5
                        ElseIf recrow("Tax1_Perc") > 5 Or recrow("Tax1_Perc") < 8 Then
                            B2CLSheet.Cells(b2cl, 6) = 12
                        ElseIf recrow("Tax1_Perc") > 8 Or recrow("Tax1_Perc") < 10 Then
                            B2CLSheet.Cells(b2cl, 6) = 18
                        ElseIf recrow("Tax1_Perc") > 12 Or recrow("Tax1_Perc") < 15 Then
                            B2CLSheet.Cells(b2cl, 6) = 28
                        Else
                            B2CLSheet.Cells(b2cl, 6) = recrow("Tax1_Perc")
                        End If

                        B2CLSheet.Cells(b2cl, 7) = recrow("Taxable_Amt") 'recrow("GST5") + recrow("GST12") + recrow("GST18") + recrow("GST28")
                        B2CLSheet.Cells(b2cl, 8) = "" '0
                        B2CLSheet.Cells(b2cl, 9) = ""
                        b2cl += 1
                        DocB2CL += 1
                    Next recrow

                End If

            End If
            'xlBook.Save()

            ' 'B2CS excel creation................B2CS excel creation.............
            Dim B2CSSheet As Excel.Worksheet = xlBook.Worksheets("B2CS")
            If b2b = 0 Then


                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_B2CSmall]')) " _
                                   & " Drop View [dbo].[vw_B2CSmall]"
                Common.ExecuteQuery(Query)


                Query = "Create View vw_B2CSmall As  " _
                                   & " Select SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc, SaleBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Taxable_Amt+salebill.Tax_Amt+salebill.OthChgs_Amt Gross_Total,salebill.Doc_Dt ," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                                   & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                                   & " Left Join SalebillTxTm on SalebillTxTm.Doc_Id=SaleBill.Doc_Id LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                   & " Where SaleBill.Status = '1' and State.Alt_Code='" & StateCode & "' And  Ledger.GSTNo='' " _
                                   & " AND SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' And SaleBill.FcYr_Id ='" & SelYearId & "'" _
                                   & " Group by SalebillTxTm.Taxable_Amt, SalebillTxTm.Tax1_Perc ,State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt" _
                                   & " Union All  " _
                                   & " Select SalebillTxTm.Taxable_Amt,SalebillTxTm.Tax1_Perc ,SaleBill.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,salebill.Doc_no AS InvoiceNo,salebill.Taxable_Amt+salebill.Tax_Amt+salebill.OthChgs_Amt Gross_Total,salebill.Doc_Dt ," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST5," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST5," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST12," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST12," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST18," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST18," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as GST28," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as CGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as SGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from salebilltxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SaleBilltxTm.Doc_Id=SaleBill.Doc_Id) as IGST28" _
                                   & " from Salebill Left Join Ledger on Ledger.Led_Key=SaleBill.Cust_Key  " _
                                   & " Left Join SalebillTxTm on SalebillTxTm.Doc_Id=SaleBill.Doc_Id LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                   & " Where SaleBill.Status = '1' and State.Alt_Code<>'" & StateCode & "' And Salebill.Taxable_Amt<=250000 And  Ledger.GSTNo='' " _
                                   & " AND SaleBill.Doc_Type='A' And SaleBill.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SaleBill.COBR_ID ='" & SelBranchId & "' And SaleBill.FcYr_Id ='" & SelYearId & "'" _
                                   & " Group by SalebillTxTm.Taxable_Amt, SalebillTxTm.Tax1_Perc, State.Alt_Code,STATE.State_Name,Ledger.Abbr,salebill.Doc_no  ,salebill.Doc_Dt ,Ledger.GSTNo ,SaleBill.Doc_Id,Salebill.Taxable_Amt,Salebill.Tax_Amt,salebill.OthChgs_Amt" _
                                   & strSrch
                Common.ExecuteQuery(Query)

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[B2CS]')) " _
                                 & " Drop View [dbo].[B2CS]"
                Common.ExecuteQuery(Query)



                Query = "  Create view B2CS as  select sum(SalebillOutletsdtl.Taxable)Taxable_Amt,SalebillOutletsdtl.TaxPerc,(STATE.State_Name)Statename from SalebillOutlets " _
                        & " left join SalebillOutletsdtl on SalebillOutletsdtl.Doc_Id=SalebillOutlets.Doc_Id " _
                        & " LEFT JOIN STATION ON STATION.STN_KEY = SalebillOutlets.STN_KEY    " _
                        & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                        & "  inner JOIN Ledger ON Ledger.Led_KEY = SalebillOutlets.Cust_Key " _
                        & " Where SalebillOutlets.Status = '1'   AND SalebillOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND " _
                        & " SalebillOutlets.COBR_ID ='" & SelBranchId & "'  And Ledger.Franchisee_code<>'' And SalebillOutletsdtl.TaxPerc > 0 And SalebillOutlets.FcYr_Id ='" & SelYearId & "' " & StateName & " " _
                        & " Group by  SalebillOutletsdtl.TaxPerc ,State.Alt_Code,STATE.State_Name " _
                        & " Union All " _
                        & "  select -sum(SalesRtnOutletsdtl.Taxable)Taxable_Amt,SalesRtnOutletsdtl.TaxPerc,(STATE.State_Name)Statename from SalesRtnOutlets " _
                        & " left join SalesRtnOutletsdtl on SalesRtnOutletsdtl.Doc_Id=SalesRtnOutlets.Doc_Id " _
                        & " LEFT JOIN STATION ON STATION.STN_KEY = SalesRtnOutlets.STN_KEY    " _
                        & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                        & "  inner JOIN Ledger ON Ledger.Led_KEY = SalesRtnOutlets.Cust_Key " _
                        & " Where SalesRtnOutlets.Status = '1'   AND SalesRtnOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND " _
                        & " SalesRtnOutlets.COBR_ID ='" & SelBranchId & "'  And Ledger.Franchisee_code<>'' And SalesRtnOutletsdtl.TaxPerc > 0 And SalesRtnOutlets.FcYr_Id ='" & SelYearId & "' " & StateName & " " _
                        & " Group by  SalesRtnOutletsdtl.TaxPerc ,State.Alt_Code,STATE.State_Name "

                Common.ExecuteQuery(Query)

                ' Query = "SELECT PlaceofSupply , sum(GST5+GST18+GST12+GST28)as TaxableAmt,Gross_Total,Doc_Id,GSTNo , SUM(GST5) GST5, sum(CGST) CGST25, sum(SGST) SGST25,Sum(IGST5)IGST5,  sum(GST18) GST18,sum(CGST9) CGST9,sum(SGST9) SGST9,Sum(IGST18)IGST18,Sum(GST12)GST12, Sum(GST28)GST28 FROM vw_B2CSmall  Group By PlaceofSupply, Gross_Total, Doc_Id ,GSTNo "
                Query = "SELECT sum(Taxable_Amt)Taxable_Amt,Tax1_Perc,PlaceofSupply  FROM vw_B2CSmall " _
                & " Group By PlaceofSupply,Tax1_Perc" _
                & " Union All select sum(Taxable_Amt)Taxable_Amt,TaxPerc,Statename from B2CS group by TaxPerc, Statename "

                Dim b2CSmall As System.Data.DataTable = Common.GetDataTable(Query)


                If b2CSmall.Rows.Count > 0 Then
                    Dim b2cS As Integer = 5
                    For Each recrow In b2CSmall.Rows

                        B2CSSheet.Cells(b2cS, 1) = "OE"
                        B2CSSheet.Cells(b2cS, 2) = recrow("PlaceofSupply")



                        If recrow("Tax1_Perc") = "2.5" Then
                            xlSheet.Cells(b2cS, 3) = 5
                        ElseIf recrow("Tax1_Perc") = "6" Then
                            xlSheet.Cells(b2cS, 3) = 12
                        ElseIf recrow("Tax1_Perc") = "9" Then
                            xlSheet.Cells(b2cS, 3) = 18
                        ElseIf recrow("Tax1_Perc") = "14" Then
                            xlSheet.Cells(b2cS, 3) = 28
                        Else
                            B2CSSheet.Cells(b2cS, 3) = recrow("Tax1_Perc")
                        End If

                        B2CSSheet.Cells(b2cS, 4) = Val(recrow("Taxable_Amt")) 'Val(recrow("GST5")) + Val(recrow("GST18") + recrow("GST12")) + Val(recrow("GST28"))
                        B2CSSheet.Cells(b2cS, 5) = "" '0
                        B2CSSheet.Cells(b2cS, 6) = ""
                        b2cS += 1
                        DocB2CS += 1
                    Next recrow
                End If
                'xlBook.Save()
            End If
            If GetSettingAsPerId(ApplnSettingsIdx.DisplayStateinGSTR) = "1" Then

                If b2b = 1 Then
                    Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[B2CS]')) " _
                                      & " Drop View [dbo].[B2CS]"
                    Common.ExecuteQuery(Query)



                    Query = "  Create view B2CS as  select sum(SalebillOutletsdtl.Taxable)Taxable_Amt,SalebillOutletsdtl.TaxPerc,(STATE.State_Name)Statename from SalebillOutlets " _
                            & " left join SalebillOutletsdtl on SalebillOutletsdtl.Doc_Id=SalebillOutlets.Doc_Id " _
                            & " LEFT JOIN STATION ON STATION.STN_KEY = SalebillOutlets.STN_KEY    " _
                            & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                            & "  inner JOIN Ledger ON Ledger.Led_KEY = SalebillOutlets.Cust_Key " _
                            & " Where SalebillOutlets.Status = '1'   AND SalebillOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND " _
                            & " SalebillOutlets.COBR_ID ='" & SelBranchId & "'  And Ledger.Franchisee_code<>'' And SalebillOutletsdtl.TaxPerc > 0 And SalebillOutlets.FcYr_Id ='" & SelYearId & "' " & StateName & " " _
                            & " Group by  SalebillOutletsdtl.TaxPerc ,State.Alt_Code,STATE.State_Name " _
                            & " Union All " _
                            & "  select -sum(SalesRtnOutletsdtl.Taxable)Taxable_Amt,SalesRtnOutletsdtl.TaxPerc,(STATE.State_Name)Statename from SalesRtnOutlets " _
                            & " left join SalesRtnOutletsdtl on SalesRtnOutletsdtl.Doc_Id=SalesRtnOutlets.Doc_Id " _
                            & " LEFT JOIN STATION ON STATION.STN_KEY = SalesRtnOutlets.STN_KEY    " _
                            & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                            & "  inner JOIN Ledger ON Ledger.Led_KEY = SalesRtnOutlets.Cust_Key " _
                            & " Where SalesRtnOutlets.Status = '1'   AND SalesRtnOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND " _
                            & " SalesRtnOutlets.COBR_ID ='" & SelBranchId & "'  And Ledger.Franchisee_code<>'' And SalesRtnOutletsdtl.TaxPerc > 0 And SalesRtnOutlets.FcYr_Id ='" & SelYearId & "' " & StateName & " " _
                            & " Group by  SalesRtnOutletsdtl.TaxPerc ,State.Alt_Code,STATE.State_Name "

                    Common.ExecuteQuery(Query)

                    Query = "select sum(Taxable_Amt)Taxable_Amt , TaxPerc, Statename from B2CS group by TaxPerc, Statename"
                    Dim b2CSDB As System.Data.DataTable = Common.GetDataTable(Query)


                    If b2CSDB.Rows.Count > 0 Then
                        Dim b2cS As Integer = 5
                        For Each recrow In b2CSDB.Rows

                            B2CSSheet.Cells(b2cS, 1) = "OE"
                            B2CSSheet.Cells(b2cS, 2) = recrow("Statename")



                            If recrow("TaxPerc") = "2.5" Then
                                B2CSSheet.Cells(b2cS, 3) = 5
                            ElseIf recrow("TaxPerc") = "6" Then
                                B2CSSheet.Cells(b2cS, 3) = 12
                            ElseIf recrow("TaxPerc") = "9" Then
                                B2CSSheet.Cells(b2cS, 3) = 18
                            ElseIf recrow("TaxPerc") = "14" Then
                                B2CSSheet.Cells(b2cS, 3) = 28
                            Else
                                B2CSSheet.Cells(b2cS, 3) = recrow("TaxPerc")
                            End If

                            B2CSSheet.Cells(b2cS, 4) = Val(recrow("Taxable_Amt")) 'Val(recrow("GST5")) + Val(recrow("GST18") + recrow("GST12")) + Val(recrow("GST28"))
                            B2CSSheet.Cells(b2cS, 5) = "" '0
                            B2CSSheet.Cells(b2cS, 6) = ""
                            b2cS += 1
                            DocB2CS += 1
                        Next recrow
                    End If

                    Dim HSNSheet As Excel.Worksheet = xlBook.Worksheets("HSN")

                    Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_hsnB2cs]')) " _
                           & " Drop View [dbo].[vw_hsnB2cs]"
                    Common.ExecuteQuery(Query)
                    Query = " Create view [vw_hsnB2cs] as  Select HsnCode,UNIT_NAME,Sum(Qty)Qty,Sum(Taxable)Taxable,Sum(SalebillOutletsdtl.Tax_Amt)TaxAmt,  Sum(Tax1_Amt)CGSTAmt,Sum(Tax2_Amt)SGSTAmt, " _
                        & " Sum(Tax3_Amt)IGSTAmt   from SalebillOutletsdtl Inner Join Style On Style.Style_Key=SalebillOutletsdtl.Style_Key  LEFT JOIN UNIT  " _
                        & " ON UNIT.UNIT_KEY = SalebillOutletsdtl.UNIT_KEY Inner Join SalebillOutlets on SalebillOutlets.DOc_id=SalebillOutletsdtl.DOc_id   " _
                        & " LEFT JOIN STATION ON STATION.STN_KEY = SalebillOutlets.STN_KEY    " _
                        & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                          & "  inner JOIN Ledger ON Ledger.Led_KEY = SalebillOutlets.Cust_Key " _
                        & " where SalebillOutlets.Doc_Type='A' and SalebillOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalebillOutlets.COBR_ID ='" & SelBranchId & "'  " _
                        & " And SalebillOutlets.FcYr_Id ='" & SelYearId & "' And Ledger.Franchisee_code<>'' " & StateName & " Group by HsnCode,UNIT_NAME " _
                        & "Union All " _
                        & " Select HsnCode,UNIT_NAME,-Sum(Qty)Qty,-Sum(Taxable)Taxable,-Sum(SalesRtnOutletsdtl.Tax_Amt)TaxAmt, - Sum(Tax1_Amt)CGSTAmt,-Sum(Tax2_Amt)SGSTAmt, " _
                        & " -Sum(Tax3_Amt)IGSTAmt   from SalesRtnOutletsdtl Inner Join Style On Style.Style_Key=SalesRtnOutletsdtl.Style_Key  LEFT JOIN UNIT  " _
                        & " ON UNIT.UNIT_KEY = SalesRtnOutletsdtl.UNIT_KEY Inner Join SalesRtnOutlets on SalesRtnOutlets.DOc_id=SalesRtnOutletsdtl.DOc_id   " _
                        & " LEFT JOIN STATION ON STATION.STN_KEY = SalesRtnOutlets.STN_KEY    " _
                        & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                          & "  inner JOIN Ledger ON Ledger.Led_KEY = SalesRtnOutlets.Cust_Key " _
                        & " where SalesRtnOutlets.Doc_Type='A' and SalesRtnOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND SalesRtnOutlets.COBR_ID ='" & SelBranchId & "'  " _
                        & " And SalesRtnOutlets.FcYr_Id ='" & SelYearId & "' And Ledger.Franchisee_code<>''  " & StateName & " Group by HsnCode,UNIT_NAME "

                    Common.ExecuteQuery(Query)
                    Query = "SELECT HSNCODE,sum(Qty) Qty, SUM(TAXABLE) TAXABLE, sum(IGSTAmt) IGST, sum(SGSTAmt) SGST,sum(CGSTAmt) CGST " _
                                                    & " FROM vw_hsnB2cs " _
                                                    & " Group By HSNCODE "
                    Dim dtHSNWise As System.Data.DataTable = Common.GetDataTable(Query)
                    Dim HsnCountCN As Integer = 0
                    If dtHSNWise.Rows.Count > 0 Then
                        Dim HSNCount As Integer = 5
                        For Each recrow In dtHSNWise.Rows



                            HSNSheet.Cells(HSNCount, 1) = recrow("HSNCODE")

                            Query = "select Item.Item_Desc,unit.Abbr from unit Inner join Item on Item.Unit_Key=unit.Unit_Key where HSNCode='" & recrow("HSNCode") & "'"
                            Dim BillDtl1 As System.Data.DataTable = Common.GetDataTable(Query)
                            If BillDtl1.Rows.Count > 0 Then
                                HSNSheet.Cells(HSNCount, 3) = BillDtl1.Rows(0)("Abbr") & ""
                                HSNSheet.Cells(HSNCount, 2) = BillDtl1.Rows(0)("Item_Desc") & ""
                            Else
                                HSNSheet.Cells(HSNCount, 3) = ""
                                HSNSheet.Cells(HSNCount, 2) = ""
                            End If

                            ' HSNSheet.Cells(HSNCount, 2) = "" 'recrow("SrTo")
                            '  HSNSheet.Cells(HSNCount, 3) = "" 'recrow("SrFrom")
                            HSNSheet.Cells(HSNCount, 4) = recrow("Qty")
                            HSNSheet.Cells(HSNCount, 5) = Val(Val(recrow("TAXABLE")) + Val(recrow("IGST")) + Val(recrow("SGST")) + Val(recrow("CGST")))
                            HSNSheet.Cells(HSNCount, 6) = recrow("TAXABLE")
                            HSNSheet.Cells(HSNCount, 7) = recrow("IGST")
                            HSNSheet.Cells(HSNCount, 8) = recrow("CGST")
                            HSNSheet.Cells(HSNCount, 9) = recrow("SGST")
                            HSNSheet.Cells(HSNCount, 10) = "" '0 'recrow("SrTo")

                            HSNCount += 1
                        Next recrow
                        HsnCountCN = HSNCount
                    End If

                End If
            End If


            'CDNR Ecel creation................CDNR Ecel creation.............
            If cdnr = 0 Then


                Dim CDNRSheet As Excel.Worksheet = xlBook.Worksheets("cdnr")


                Dim strFilter As String = ""
                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_CNRegistered]')) " _
                         & " Drop View [dbo].[vw_CNRegistered]"
                Common.ExecuteQuery(Query)
                strFilter = "And  Ledger.GSTNo<>''"

                Query = " Create View [vw_CNRegistered] as Select Salesrtntxtm.Taxable_Amt as Taxable_Amt1 ,Salesrtntxtm.TaxTerm_Perc, State.Alt_code,Salesrtn.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,Salesrtn.Doc_no AS InvoiceNo,Salesrtn.Taxable_Amt+Salesrtn.Tax_Amt+Salesrtn.OthChgs_Amt Gross_Total,Salesrtn.Doc_Dt ," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST5," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST5," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST12," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST6," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST6," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST12," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST18," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST9," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST9," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST18," _
                                 & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST28," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST14," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST14," _
                                 & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST28" _
                                 & " from Salesrtn Left Join Ledger on Ledger.Led_Key=Salesrtn.Cust_Key  " _
                                 & "  LEFT JOIN Salesrtntxtm ON Salesrtn.Doc_Id = Salesrtntxtm.Doc_Id  LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                 & " Where Salesrtn.Status = '1' and  Direct_CN=1 " _
                                 & " AND Salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Salesrtn.COBR_ID ='" & SelBranchId & "' And Salesrtn.FcYr_Id ='" & SelYearId & "'" _
                                 & strFilter _
                                 & " Group by Salesrtntxtm.Taxable_Amt,Salesrtntxtm.TaxTerm_Perc,State.Alt_Code,STATE.State_Name,Ledger.Abbr,Salesrtn.Doc_no  ,Salesrtn.Doc_Dt ,Ledger.GSTNo ,Salesrtn.Doc_Id,Salesrtn.Taxable_Amt,Salesrtn.Tax_Amt,Salesrtn.OthChgs_Amt" _
                                 & "  UNION ALL " _
                                 & " Select '0' as Taxable_Amt1, '0' as TaxTerm_Perc, State.Alt_code,CN.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,CN.Doc_no AS InvoiceNo,CN.Taxable_Amt+CN.Tax_Amt+CN.OthChgs_Amt Gross_Total,CN.Doc_Dt ,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST5,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST5,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST12,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST12,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST18," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST9," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST9," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST18," _
                                 & " (Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST28," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST14," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST14," _
                                 & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST28 " _
                                 & " from CN Left Join Ledger on Ledger.Led_Key=CN.Cust_Key   LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY   " _
                                 & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY   Where CN.Status = '1' " _
                                 & " AND CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "'  And CN.FcYr_Id ='" & SelYearId & "' " _
                                 & strFilter _
                                 & "	Group by State.Alt_Code,STATE.State_Name,Ledger.Abbr,CN.Doc_no  ,CN.Doc_Dt ,Ledger.GSTNo ," _
                                 & "	CN.Doc_Id,CN.Taxable_Amt,CN.Tax_Amt,CN.OthChgs_Amt"


                Common.ExecuteQuery(Query)

                Query = "SELECT Taxable_Amt1,TaxTerm_Perc,Doc_Id,GSTNo,Party,InvoiceNo,Alt_code StateCode,convert(varchar, Doc_Dt, 6)as Doc_Dt,sum(Gross_Total)Gross_Total,PlaceofSupply,sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28 FROM vw_CNRegistered " _
                    & " Group By Taxable_Amt1,TaxTerm_Perc,Doc_Id,GSTNo,Alt_code,Party,InvoiceNo,Doc_Dt,PlaceofSupply Order by  InvoiceNo Asc"

                Dim dtCNRegistered As System.Data.DataTable = Common.GetDataTable(Query)
                Dim countcdnr As Integer = 5
                If dtCNRegistered.Rows.Count > 0 Then

                    For Each recrow In dtCNRegistered.Rows

                        CDNRSheet.Cells(countcdnr, 1) = recrow("GSTNo")

                        Query = "select  Party_RefNo, convert(varchar, Party_RefDt, 6)as Doc_Dt from Salesrtn where Salesrtn.Doc_Id=" & Val(recrow("Doc_Id"))
                        Dim BillDtl As System.Data.DataTable = Common.GetDataTable(Query)
                        If BillDtl.Rows.Count > 0 Then

                            CDNRSheet.Cells(countcdnr, 2) = BillDtl.Rows(0)("Party_RefNo")
                            CDNRSheet.Cells(countcdnr, 3) = BillDtl.Rows(0)("Doc_Dt")
                        Else

                            CDNRSheet.Cells(countcdnr, 2) = "" 'BillDtl.Rows(0)(0)("Bill_No")
                            CDNRSheet.Cells(countcdnr, 3) = "" 'BillDtl.Rows(0)(0)("Bill_Dt")
                        End If

                        CDNRSheet.Cells(countcdnr, 4) = recrow("InvoiceNo")
                        CDNRSheet.Cells(countcdnr, 5) = recrow("Doc_Dt")
                        CDNRSheet.Cells(countcdnr, 6) = "C"
                        ' CDNRSheet.Cells(countcdnr, 7) = ""
                        CDNRSheet.Cells(countcdnr, 7) = recrow("PlaceofSupply")
                        CDNRSheet.Cells(countcdnr, 8) = recrow("Gross_Total") '+ recrow("CGST25") + recrow("SGST25") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18")
                        CDNRSheet.Cells(countcdnr, 9) = ""



                      
                        CDNRSheet.Cells(countcdnr, 10) = recrow("TaxTerm_Perc")
                        'End If

                        CDNRSheet.Cells(countcdnr, 11) = Val(recrow("Taxable_Amt1")) 'Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18") + Val(recrow("GST28"))))
                        CDNRSheet.Cells(countcdnr, 12) = "" '0
                        CDNRSheet.Cells(countcdnr, 13) = "N"

                        countcdnr += 1

                        DocCDNR += 1


                    Next recrow

                End If

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_CNRegisteredSAT]')) " _
                               & " Drop View [dbo].[vw_CNRegisteredSAT]"
                Common.ExecuteQuery(Query)

                '---for CDNR Vchr------------------------------
                Query = "Create View [vw_CNRegisteredSAT] as " _
                & " select ( select top 1 VchrdtlRef.Doc_No from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id) as  billNo,( select top 1 convert(varchar, VchrdtlRef.Doc_Dt, 6)  from VchrdtlRef where VchrdtlRef.Doc_Id=Vchr.Doc_Id)as BillDt,Ledger.Tax_Perc,Vchrdtl.AmtFlag,Vchr.Doc_Id,convert(varchar, Vchr.Doc_Dt, 6) as Doc_Dt,Vchr.PDoc_No as Doc_No,Vchr.VchrRefNo ,Vchr.Amount as Net_Amt,Vchrdtl.GST_On_Amt ,(select Top 1 Vchrdtl.Amount from Vchrdtl  " _
                & " left join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key  where V.Doc_Id=Vchr.Doc_Id And Vchrdtl.AmtFlag = 'D' ) as TaxableAmt,     " _
                & " (select Top 1 Ledger.Led_Name from Vchrdtl left join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key JOIN STATION ON STATION.STN_Id = Ledger.OSTN_Key  LEFT JOIN STATE ON STATE.STATE_Id = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0  And Vchrdtl.AmtFlag = 'C')as Led_Name, " _
                & " (select Top 1 Ledger.GSTNo from Ledger where Led_Key=(  select Top 1 Led_Key from vchrdtl where Doc_Id=Vchr.Doc_Id)) as GSTNo, " _
                & " (select Top 1  State.Alt_code+'-' +STATE.State_Name  from Vchrdtl Inner join Vchr V on V.Doc_Id=Vchrdtl.Doc_Id  Inner join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key Inner JOIN STATION ON STATION.STN_Id = Ledger.OSTN_Key  Inner JOIN STATE ON STATE.STATE_Id = STATION.STATE_Key where V.Doc_Id=Vchr.Doc_Id And Ledger.Tax_Perc = 0 )as PlaceofSupply " _
                & " from Vchrdtl " _
                & " left join Vchr on Vchr.Doc_Id=Vchrdtl.Doc_Id " _
                & " left join VchrdtlRef on VchrdtlRef.Doc_Id=Vchrdtl.Doc_Id " _
                & " left join Ledger on Ledger.Led_Key=Vchrdtl.Led_Key " _
                & " where   Ledger.Tax_Perc > 0 And Vchr.Doc_Dt BETWEEN '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'    and Vchrdtl.GST_On_Amt<> 0 " _
                & " And  Vchr.PDoc_No <> '' AND Vchr.Cobr_Id='" & SelBranchId & "'  And FcYr_Id = '" & SelYearId & "' And VchrType ='CN' " _
                & "  group by  VchrdtlRef.Doc_Dt, Ledger.Tax_Perc,Vchrdtl.AmtFlag,Vchr.Doc_Id,Vchr.Doc_Dt,Vchr.PDoc_No,Vchr.VchrRefNo ,Vchr.Amount ,Vchrdtl.GST_On_Amt "

                Common.ExecuteQuery(Query)

                Query = "select * from vw_CNRegisteredSAT"

                dtCNRegistered = Common.GetDataTable(Query)

                If dtCNRegistered.Rows.Count > 0 Then

                    For Each recrow In dtCNRegistered.Rows

                        'Dim perc As Double = 0
                        'If Val(recrow("Taxable_Amt") & "") > 0 Then
                        '    perc = Val(Val(Val(Val(recrow("Tax_Amount")) / recrow("Taxable_Amt"))) * 100)
                        'Else
                        '    Continue For
                        'End If
                        CDNRSheet.Cells(countcdnr, 1) = recrow("GSTNO")
                        




                        CDNRSheet.Cells(countcdnr, 2) = recrow("BillNo")
                        CDNRSheet.Cells(countcdnr, 3) = recrow("BillDt")


                        CDNRSheet.Cells(countcdnr, 4) = recrow("Doc_No")
                        CDNRSheet.Cells(countcdnr, 5) = recrow("Doc_Dt")
                        CDNRSheet.Cells(countcdnr, 6) = "C"

                        CDNRSheet.Cells(countcdnr, 7) = recrow("PlaceofSupply")
                        CDNRSheet.Cells(countcdnr, 8) = recrow("Net_Amt") 'recrow("GST5") + recrow("CGST25") + recrow("SGST25") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18")
                        CDNRSheet.Cells(countcdnr, 9) = ""
                        'If perc > 1 And perc < 6 Then
                        CDNRSheet.Cells(countcdnr, 10) = Val(recrow("Tax_Perc"))
                        'ElseIf perc > 6 And perc < 13 Then
                        '    CDNRSheet.Cells(countcdnr, 10) = Val(12)
                        'ElseIf perc > 13 And perc < 19 Then
                        '    CDNRSheet.Cells(countcdnr, 10) = Val(18)
                        'ElseIf perc > 19 And perc < 29 Then
                        '    B2CSSheet.Cells(countcdnr, 10) = 28
                        'Else
                        '    CDNRSheet.Cells(countcdnr, 10) = Val(0)
                        'End If

                        CDNRSheet.Cells(countcdnr, 11) = Val(recrow("GST_On_Amt") & "") 'Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18")))
                        CDNRSheet.Cells(countcdnr, 12) = "" '0
                        CDNRSheet.Cells(countcdnr, 13) = "N"

                        countcdnr += 1

                        DocCDNR += 1
                    Next recrow

                End If


                ''---------Debit CDNR Excel------------------------------------
         

                'CDNRU Ecel creation................CDNRU Exce creation.............
                Dim CDNURSheet As Excel.Worksheet = xlBook.Worksheets("CDNUR")
                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_CNURegistered]')) " _
                             & " Drop View [dbo].[vw_CNURegistered]"
                Common.ExecuteQuery(Query)

                strFilter = " And  Ledger.GSTNo = ''"

                Query = " Create View [vw_CNURegistered] as Select Salesrtn.Doc_Number,State.Alt_code,Salesrtn.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,Salesrtn.Doc_no AS InvoiceNo,Salesrtn.Taxable_Amt+Salesrtn.Tax_Amt+Salesrtn.OthChgs_Amt Gross_Total,Salesrtn.Doc_Dt ," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST5," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST5," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST12," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST6," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST12," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST18," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST9," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST18," _
                                   & "(Select Isnull(max(Taxable_Amt),0)from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as GST28," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as CGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as SGST14," _
                                   & "(Select Isnull(max(Tax_Amt),0) from Salesrtntxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And SalesrtntxTm.Doc_Id=Salesrtn.Doc_Id) as IGST28" _
                                   & " from Salesrtn Left Join Ledger on Ledger.Led_Key=Salesrtn.Cust_Key  " _
                                   & " LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY    LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                                   & " Where Salesrtn.Status = '1' and  Direct_CN=1 " _
                                   & " AND Salesrtn.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND Salesrtn.COBR_ID ='" & SelBranchId & "' " _
                                   & strFilter _
                                   & " Group by Doc_Number, State.Alt_Code,STATE.State_Name,Ledger.Abbr,Salesrtn.Doc_no  ,Salesrtn.Doc_Dt ,Ledger.GSTNo ,Salesrtn.Doc_Id,Salesrtn.Taxable_Amt,Salesrtn.Tax_Amt,Salesrtn.OthChgs_Amt" _
                                   & "  UNION ALL " _
                                   & " Select CN.Doc_Number,State.Alt_code,CN.Doc_Id,Ledger.GSTNo,State.Alt_code+'-' +State_Name PlaceofSupply,Ledger.Abbr as Party,CN.Doc_no AS InvoiceNo,CN.Taxable_Amt+CN.Tax_Amt+CN.OthChgs_Amt Gross_Total,CN.Doc_Dt ,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (2.5,5)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST5,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=2.5 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=5 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST5,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (6,12)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST12,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=6 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST6,(Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=12 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST12,(Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (9,18)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST18," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST9," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=9 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST9," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=18 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST18," _
                                   & " (Select Isnull(max(Taxable_Amt),0)from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc in (14,28)  And CNtxTm.Doc_Id=CN.Doc_Id) as GST28," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as CGST14," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=14 And CNtxTm.Doc_Id=CN.Doc_Id) as SGST14," _
                                   & " (Select Isnull(max(Tax_Amt),0) from CNtxtm WHere AddSubTract='+' and TaxTerm_Perc=28 And CNtxTm.Doc_Id=CN.Doc_Id) as IGST28 " _
                                   & " from CN Left Join Ledger on Ledger.Led_Key=CN.Cust_Key   LEFT JOIN STATION ON STATION.STN_KEY = LEDGER.OSTN_KEY   " _
                                   & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY   Where CN.Status = '1' " _
                                   & " AND CN.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CN.COBR_ID ='" & SelBranchId & "' " _
                                   & strFilter _
                                   & "	Group by Doc_Number, State.Alt_Code,STATE.State_Name,Ledger.Abbr,CN.Doc_no  ,CN.Doc_Dt ,Ledger.GSTNo ," _
                                   & "	CN.Doc_Id,CN.Taxable_Amt,CN.Tax_Amt,CN.OthChgs_Amt"


                Common.ExecuteQuery(Query)
                Query = "SELECT GSTNo,Party,InvoiceNo,Alt_code StateCode,convert(varchar, Doc_Dt, 6)as Doc_Dt,sum(Gross_Total)Gross_Total,PlaceofSupply,sum(GST5)GST5,sum(CGST)CGST,sum(SGST)SGST,sum(IGST5)IGST5,sum(GST12)GST12,sum(CGST6)CGST6,sum(SGST6)SGST6,sum(IGST12)IGST12,sum(GST18)GST18,sum(CGST9)CGST9,sum(SGST9)SGST9,sum(IGST18)IGST18,sum(GST28)GST28,sum(CGST14)CGST14,sum(SGST14)SGST14,sum(IGST28)IGST28 FROM vw_CNURegistered " _
                      & " Group By GSTNo,Alt_code,Party,InvoiceNo,Doc_Dt,PlaceofSupply Order by  InvoiceNo Asc"

                Dim dtCNUnRegistered As System.Data.DataTable = Common.GetDataTable(Query)


                'Dim ObjcdnurDtl As cdnurDtl = New cdnurDtl()
                Dim CDNURCount As Integer = 5
                If dtCNUnRegistered.Rows.Count > 0 Then

                    For Each recrow In dtCNUnRegistered.Rows

                        CDNURSheet.Cells(CDNURCount, 1) = "b2cl" 'recrow("GSTNo")
                        CDNURSheet.Cells(CDNURCount, 2) = recrow("InvoiceNo")

                        CDNURSheet.Cells(CDNURCount, 3) = recrow("DOC_DT")
                        CDNURSheet.Cells(CDNURCount, 4) = "C"
                        'CDNURSheet.Cells(CDNURCount, 5) = recrow("Bill_No")
                        'CDNURSheet.Cells(CDNURCount, 6) = recrow("Bill_Dt")
                        CDNURSheet.Cells(CDNURCount, 7) = "" 'recrow("PlaceofSupply")
                        CDNURSheet.Cells(CDNURCount, 8) = recrow("PLACEOFSUPPLY")
                        CDNURSheet.Cells(CDNURCount, 9) = recrow("Gross_Total") '+ recrow("CGST25") + recrow("SGST25") + recrow("IGST5") + recrow("GST12") + recrow("CGST6") + recrow("SGST6") + recrow("IGST12") + recrow("GST18") + recrow("CGST9") + recrow("SGST9") + recrow("IGST18")




                        If recrow("CGST") > 0 Or recrow("IGST5") > 0 Then
                            xlSheet.Cells(CDNURCount, 10) = 5
                        ElseIf recrow("CGST6") > 0 Or recrow("IGST12") > 0 Then
                            xlSheet.Cells(CDNURCount, 10) = 12
                        ElseIf recrow("CGST9") > 0 Or recrow("IGST18") > 0 Then
                            xlSheet.Cells(CDNURCount, 10) = 18
                        ElseIf recrow("CGST14") > 0 Or recrow("IGST28") > 0 Then
                            xlSheet.Cells(CDNURCount, 10) = 28
                        Else
                            xlSheet.Cells(CDNURCount, 10) = 0
                        End If

                        CDNURSheet.Cells(CDNURCount, 11) = Val(Val(recrow("GST5")) + Val(recrow("GST12")) + Val(recrow("GST18")) + Val(recrow("GST28")))
                        CDNURSheet.Cells(CDNURCount, 12) = 0
                        CDNURSheet.Cells(CDNURCount, 13) = "N"

                        CDNURCount += 1

                        DocCDNU += 1

                    Next recrow

                End If




                '------------Debit ----------CDNU excel----------------------------------




                '--------------Export------Doc--24062019---------------------------------
                Dim ExpSheet As Excel.Worksheet = xlBook.Worksheets("exp")

                Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_exp]')) " _
                               & " Drop View [dbo].[vw_exp]"
                Common.ExecuteQuery(Query)

                Query = "CREATE View [vw_exp] AS  " _
                        & " select convert(varchar, salebill.Doc_Dt, 6)as Doc_Dt,ledger.Led_Name,salebill.Doc_No,salebill.Taxable_Amt,salebill.Net_Amt from salebill  " _
                        & " Left join Ledger on Ledger.Led_Key=salebill.Cust_Key  where Doc_Dt between  '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And salebill.Led_Key=0126 And salebill.COBR_ID ='" & SelBranchId & "'"
                Common.ExecuteQuery(Query)

                Query = "SELECT * from vw_exp "
                Dim dtExp As System.Data.DataTable = Common.GetDataTable(Query)
                If dtExp.Rows.Count > 0 Then
                    Dim ExpCount As Integer = 5
                    For Each recrow In dtExp.Rows

                        'If recrow("Type") = "C" Then
                        ExpSheet.Cells(ExpCount, 1) = "WOPAY"
                        'Else
                        ExpSheet.Cells(ExpCount, 2) = recrow("Doc_No")
                        ExpSheet.Cells(ExpCount, 3) = recrow("Doc_Dt")
                        ExpSheet.Cells(ExpCount, 4) = recrow("Net_Amt")
                        ExpSheet.Cells(ExpCount, 5) = ""
                        ExpSheet.Cells(ExpCount, 6) = ""
                        ExpSheet.Cells(ExpCount, 7) = ""
                        ExpSheet.Cells(ExpCount, 8) = 0
                        ExpSheet.Cells(ExpCount, 9) = recrow("Taxable_Amt")

                        ExpCount += 1

                    Next recrow

                End If

            End If
            '-----------------Doc_Issue................

            Dim DocsSheet As Excel.Worksheet = xlBook.Worksheets("DOCS")

            Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vw_DocSummary]')) " _
                           & " Drop View [dbo].[vw_DocSummary]"
            Common.ExecuteQuery(Query)
            If b2b = 0 Then


                Query = "CREATE View [vw_DocSummary] AS  " _
                        & " SELECT  Doc_No,'B' Type FROM SaleBill WHERE Doc_Dt BETWEEN  '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND COBR_ID ='" & SelBranchId & "'    " _
                        & " UNION ALL  SELECT Doc_No,'C' Type FROM [vw_CNRegisteredSAT] WHERE TaxableAmt <> 0   " _
                        & " UNION ALL  SELECT InvoiceNo Doc_No,'C' Type FROM vw_CNRegistered    "
                Common.ExecuteQuery(Query)
                Query = "SELECT MIN(Doc_No) SrFrom,MAX(Doc_No) SrTo,COUNT(distinct Doc_No) Tot_Doc,Type FROM vw_DocSummary GROUP BY Type "
                Dim dtDoc As System.Data.DataTable = Common.GetDataTable(Query)
                If dtDoc.Rows.Count > 0 Then
                    Dim DocsCount As Integer = 5
                    For Each recrow In dtDoc.Rows

                        If recrow("Type") = "C" Then
                            DocsSheet.Cells(DocsCount, 1) = "Credit Note"
                        Else
                            DocsSheet.Cells(DocsCount, 1) = "Invoices for outward supply"
                        End If

                        Dim formatRange As Excel.Range

                        DocsSheet.Cells(DocsCount, 2) = recrow("SrFrom") & ""
                        DocsSheet.Cells(DocsCount, 3) = recrow("SrTo") & ""

                        DocsSheet.Cells(DocsCount, 4) = recrow("Tot_Doc")

                        DocsSheet.Cells(DocsCount, 5) = 0
                        DocsCount += 1

                    Next recrow

                End If

            Else
                Query = "CREATE View [vw_DocSummary] AS  " _
                 & " select  Doc_Sr, PDoc_No as Doc_No,'B' as Type  from BillSync where BillSync.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND CoBr_Id in( " _
                    & " select Franchisee_code from ledger where Franchisee_code <> '' And Led_Key in ( " _
                    & " select Cust_Key from SalebillOutlets " _
                    & " LEFT JOIN STATION ON STATION.STN_KEY = SalebillOutlets.STN_KEY    " _
                    & " LEFT JOIN STATE ON STATE.STATE_KEY = STATION.STATE_KEY  " _
                    & " Where SalebillOutlets.Status = '1'   AND SalebillOutlets.Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND " _
                    & " SalebillOutlets.COBR_ID ='" & SelBranchId & "' " & StateName & " And   SalebillOutlets.FcYr_Id ='" & SelYearId & "' ))  "

                Common.ExecuteQuery(Query)
                Query = "SELECT MIN(Doc_No) SrFrom,MAX(Doc_No) SrTo,COUNT(distinct Doc_No) Tot_Doc,Type FROM vw_DocSummary GROUP BY Type,Doc_Sr "
                Dim dtDoc As System.Data.DataTable = Common.GetDataTable(Query)
                If dtDoc.Rows.Count > 0 Then
                    Dim DocsCount As Integer = 5
                    For Each recrow In dtDoc.Rows

                        If recrow("Type") = "C" Then
                            DocsSheet.Cells(DocsCount, 1) = "Credit Note"
                        Else
                            DocsSheet.Cells(DocsCount, 1) = "Invoices for outward supply"
                        End If

                        Dim formatRange As Excel.Range

                        DocsSheet.Cells(DocsCount, 2) = recrow("SrFrom") & ""
                        DocsSheet.Cells(DocsCount, 3) = recrow("SrTo") & ""

                        DocsSheet.Cells(DocsCount, 4) = recrow("Tot_Doc")

                        DocsSheet.Cells(DocsCount, 5) = 0
                        DocsCount += 1

                    Next recrow

                End If

            End If





            '---------------------------------------------end--------------------------------------------------

            If (Not System.IO.Directory.Exists(Environment.GetFolderPath(Environment.SpecialFolder.Desktop) & "\GSTR-1")) Then
                System.IO.Directory.CreateDirectory(Environment.GetFolderPath(Environment.SpecialFolder.Desktop) & "\GSTR-1")
            End If
            Dim strExportFile As String = ""
            strExportFile = Environment.GetFolderPath(Environment.SpecialFolder.Desktop) & "\GSTR-1\GSTR1-" & Format$(dtpFrom.Value, "MMddyyyy") & ".xlsx"
            MsgBox("GSTR-1 Excel Generated Successfully On Path : " & strExportFile, MsgBoxStyle.Exclamation)
            xlBook.SaveAs(strExportFile)
            xlBook.Close()

            System.Diagnostics.Process.Start(strExportFile)

            '------------------------END Ecel------------------------------------
            btnGSTR1Excel.Enabled = True
            Cursor = Cursors.Default
        Catch ex As Exception
            Common.LogAndDisplayException(ex)
            btnGSTR1Excel.Enabled = True
            Cursor = Cursors.Default
        End Try




    End Sub

    Private Sub btnGSTR3BExcel_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnGSTR3BExcel.Click
        Try


            If MsgBox("Do You Want To Continue GSTR-3B , It Will Take Some Time", MsgBoxStyle.Question + MsgBoxStyle.YesNo) = MsgBoxResult.No Then

                Exit Sub
            End If
            btnGSTR3BExcel.Enabled = False
            Cursor = Cursors.WaitCursor

            If (Not System.IO.Directory.Exists(System.Windows.Forms.Application.StartupPath & "\GSTR-3B")) Then
                System.IO.Directory.CreateDirectory(System.Windows.Forms.Application.StartupPath & "\GSTR-3B")
                MsgBox("GSTR-3B Excel file Not Found  !", MsgBoxStyle.Exclamation)
                Exit Sub
            End If
            If (Not System.IO.File.Exists(System.Windows.Forms.Application.StartupPath & "\GSTR-3B\GSTR-3B.xlsm")) Then
                MsgBox("GSTR-3B Excel file Not Found  !", MsgBoxStyle.Exclamation)
                Exit Sub
            End If
            Dim StateGSTN As String = ""
            If GetSettingAsPerId(ApplnSettingsIdx.DisplayStateinGSTR) = "1" Then
                Query = "  Select STATE.GST_No from STATE   where STATE.STATE_Key= '" & cmbStateGSTR.EditValue & "'"
                Dim StateN As String = Common.ExecuteScalar(Query, Nothing)
                If StateN.Trim.Length > 0 Then
                    'If cmbStateGSTR.Text <> StateN Then

                    'If cmbStateGSTR.ItemIndex <> -1 And chkStatewise.Checked = True Then
                    StateGSTN = StateN '"And STATE.STATE_KEY= '" & cmbStateGSTR.EditValue & "'"
                    'ElseIf cmbStore.EditValue <> -1 And chkStorewise.Checked = True Then
                    '    StateName += "And Ledger.Led_KEY= '" & cmbStore.EditValue & "'"
                End If

                'End If

                'End If

            End If

            Dim xlApp As New Excel.Application
            Dim xlBook As Excel.Workbook = xlApp.Workbooks.Open(System.Windows.Forms.Application.StartupPath & "\GSTR-3B\GSTR-3B.xlsm", , False)
            'xlBook.Activate()
            Dim xlSheet1 As Excel.Worksheet = xlBook.Worksheets("GSTR-3B")
            xlSheet1 = xlBook.ActiveSheet
            If xlSheet1.Protection.AllowInsertingRows = False Then
                'xlBook.Protect(AllowInsertingRow:=True) 
                xlSheet1.Protect(AllowInsertingRows:=False)
            End If

            'xlBook.Save()
            Dim Today As String = Date.Now.ToString("dd/MM/yyyy")
            Today = Regex.Replace(Today, "[^A-Za-z0-9\-]", "")
            Query = "Select GSTNo,CoBr_Name from cobr where cobr_id=  " & SelBranchId
            Dim DtApproval As DataTable = Common.GetDataTable(Query)
            If DtApproval.Rows.Count > 0 Then
                If StateGSTN <> "" Then
                    xlSheet1.Cells(5, 3) = StateGSTN
                Else
                    xlSheet1.Cells(5, 3) = DtApproval.Rows(0)(0)
                End If

                xlSheet1.Cells(6, 3) = DtApproval.Rows(0)(1)
                xlSheet1.Cells(5, 7) = "20" & SelYearId & "-" & SelYearId + 1
                Dim MyDateTime As DateTime = DateTime.Parse(Format$(dtpFrom.Value, "MM/dd/yyyy"), New CultureInfo("en-US"))
                Dim Month As String = MyDateTime.ToString("MMMM", New CultureInfo("en-US"))

                xlSheet1.Cells(6, 7) = Month
                'xlSheet1.Range(xlSheet1.Cells(5, 3), xlSheet1.Cells(5, 4)).Merge()
                'xlSheet1.Range(xlSheet1.Cells(6, 3), xlSheet1.Cells(6, 4)).Merge()
            End If

            'Dim StateCode As String = ""
            'If GST.Trim.Length > 0 Then
            '    StateCode = Mid$(GST, 1, 2)
            'End If



            Query = "If exists (Select * from sys.views WHERE object_id = OBJECT_ID(N'[dbo].[GSTR3B_View]')) " _
                                    & " Drop View [dbo].[GSTR3B_View]"
            Common.ExecuteQuery(Query)

            Query = "Create view [GSTR3B_View] as " _
                    & " select  'PB' Type ,sum(purchasebill.BillDisc_Amt)BillDisc_Amt,sum(purchasebillTxTm.Tax_Amt)Tax_Amt,sum(purchasebill.Net_Amt)Net_Amt,sum(purchasebillTxTm.TaxTerm_Perc)TaxTerm_Perc,sum(purchasebillTxTm.Taxable_Amt)Taxable_Amt, " _
                    & " (select sum(PT.Tax_Amt) from purchasebillTxTm PT where AddSubtract ='+' And Tax1_Perc in (2.5,6,9,14) ) as CGST_Am, " _
                    & " (select sum(PT.Tax_Amt) from purchasebillTxTm PT where AddSubtract ='+' And Tax1_Perc in (5,12,18,28) ) as IGST_Amt " _
                    & " from purchasebill " _
                    & " left join purchasebillDtl on purchasebillDtl.Doc_Id=purchasebill.Doc_Id " _
                    & " left join purchasebillTxTm on purchasebillTxTm.Doc_Id=purchasebill.Doc_Id " _
                    & " where purchasebillTxTm.TaxTerm_Perc <> 0 " _
                     & "   AND purchasebill.DOC_DT BETWEEN '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' AND  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND purchasebill.COBR_ID ='" & SelBranchId & "' " _
                    & " Union all " _
                    & "  select 'PR' Type,sum(purchaseRtn.BillDisc_Amt)BillDisc_Amt,sum(purchaseRtnTxTm.Tax_Amt)Tax_Amt,sum(purchaseRtn.Net_Amt)Net_Amt,sum(purchaseRtnTxTm.TaxTerm_Perc)TaxTerm_Perc,sum(purchaseRtnTxTm.Taxable_Amt)Taxable_Amt, " _
                    & " (select sum(PT.Tax_Amt) from purchaseRtnTxTm PT where AddSubtract ='+' And Tax1_Perc in (2.5,6,9,14) ) as CGST_Amt, " _
                    & " (select sum(PT.Tax_Amt) from purchaseRtnTxTm PT where AddSubtract ='+' And Tax1_Perc in (5,12,18,28) ) as IGST_Amt " _
                    & " from purchaseRtn " _
                    & " left join purchasebillDtl on purchasebillDtl.Doc_Id=purchaseRtn.Doc_Id " _
                    & " left join purchaseRtnTxTm on purchaseRtnTxTm.Doc_Id=purchaseRtn.Doc_Id " _
                    & " where purchaseRtnTxTm.TaxTerm_Perc <> 0  " _
                    & "   AND purchaseRtn.DOC_DT BETWEEN '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' AND  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND purchaseRtn.COBR_ID ='" & SelBranchId & "' " _
                    & " Union All " _
                    & " select  'SB' Type ,sum(salebill.BillDisc_Amt)BillDisc_Amt,sum(salebillTxTm.Tax_Amt)Tax_Amt,sum(salebill.Net_Amt)Net_Amt,sum(salebillTxTm.TaxTerm_Perc)TaxTerm_Perc,sum(salebillTxTm.Taxable_Amt)Taxable_Amt, " _
                    & " (select sum(PT.Tax_Amt) from salebillTxTm PT where AddSubtract ='+' And Tax1_Perc in (2.5,6,9,14) ) as CGST_Amt , " _
                    & " (select sum(PT.Tax_Amt) from salebillTxTm PT where AddSubtract ='+' And Tax1_Perc in (5,12,18,28) ) as IGST_Amt  " _
                    & " from salebill  " _
                    & " left join salebilldtl on salebilldtl.Doc_Id=salebill.Doc_Id " _
                    & " left join salebillTxTm on salebillTxTm.Doc_Id=salebill.Doc_Id " _
                    & " where(salebillTxTm.TaxTerm_Perc <> 0) " _
                      & "   AND salebill.DOC_DT BETWEEN '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' AND  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salebill.COBR_ID ='" & SelBranchId & "' " _
                    & " Union all " _
                    & " select 'SR' Type,sum(salesRtn.BillDisc_Amt)BillDisc_Amt,sum(salesRtnTxTm.Tax_Amt)Tax_Amt,sum(salesRtn.Net_Amt)Net_Amt,sum(salesRtnTxTm.TaxTerm_Perc)TaxTerm_Perc,sum(salesRtnTxTm.Taxable_Amt)Taxable_Amt, " _
                    & " (select sum(PT.Tax_Amt) from salesRtnTxTm PT where AddSubtract ='+' And Tax1_Perc in (2.5,6,9,14) ) as CGST_Amt , " _
                    & " (select sum(PT.Tax_Amt) from salesRtnTxTm PT where AddSubtract ='+' And Tax1_Perc in (5,12,18,28) ) as IGST_Amt  " _
                    & " from salesRtn " _
                    & " left join salesRtnDtl on salesRtnDtl.Doc_Id=salesRtn.Doc_Id " _
                    & " left join salesRtnTxTm on salesRtnTxTm.Doc_Id=salesRtn.Doc_Id " _
                    & " where salesRtnTxTm.TaxTerm_Perc <> 0  " _
                    & "   AND salesRtn.DOC_DT BETWEEN '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' AND  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' AND salesRtn.COBR_ID ='" & SelBranchId & "' "


            Common.ExecuteQuery(Query)



            Query = "select * from GSTR3B_View where Type in ('SB','SR') "
            Dim GSTR3B As System.Data.DataTable = Common.GetDataTable(Query)

            If GSTR3B.Rows.Count > 0 Then
                Dim count As Integer = 0
                Dim taxable As Decimal = 0
                Dim cgst As Decimal = 0
                Dim igst As Decimal = 0
                For Each Recrow In GSTR3B.Rows

                    If Recrow("Type") = "SB" Then
                        taxable = Val(Recrow("Taxable_Amt") & "")
                        cgst = Val(Recrow("CGST_Am") & "")
                        igst = Val(Recrow("IGST_Amt") & "")
                    Else
                        xlSheet1.Cells(11, 3) = Val(Val(taxable - Val(Recrow("Taxable_Amt") & "")))
                        xlSheet1.Cells(11, 4) = Val(cgst - Val(Recrow("CGST_Am") & ""))
                        xlSheet1.Cells(11, 5) = Val(igst - Val(Recrow("IGST_Amt") & ""))
                    End If

                    xlSheet1.Cells(11, 7) = "0"



                Next

            End If

            Query = "select * from GSTR3B_View where Type in ('PB','PR') "
            GSTR3B = Common.GetDataTable(Query)

            If GSTR3B.Rows.Count > 0 Then
                Dim count As Integer = 0
                Dim taxable As Decimal = 0
                Dim cgst As Decimal = 0
                Dim igst As Decimal = 0
                For Each Recrow In GSTR3B.Rows

                    If Recrow("Type") = "PB" Then
                        taxable = Val(Recrow("Taxable_Amt") & "")
                        cgst = Val(Recrow("CGST_Am") & "")
                        igst = Val(Recrow("IGST_Amt") & "")
                    Else
                        'xlSheet1.Cells(25, 3) = Val(Val(taxable - Val(Recrow("Taxable_Amt") & "")))
                        xlSheet1.Cells(25, 4) = Val(cgst - Val(Recrow("CGST_Am") & ""))
                        xlSheet1.Cells(25, 3) = Val(igst - Val(Recrow("IGST_Amt") & ""))

                        'xlSheet1.Cells(14, 7) = "0"
                    End If

                Next

            End If


            Query = "select 'SB' type ,sum(salebill.BillDisc_Amt)BillDisc_Amt,sum(salebillTxTm.TaxTerm_Perc)TaxTerm_Perc,sum(salebillTxTm.Taxable_Amt)Taxable_Amt from salebill " _
                & "inner join salebillTxTm on salebillTxTm.Doc_Id=salebill.Doc_Id " _
                & " where salebillTxTm.TaxTerm_Perc=0 And salebillTxTm.AddSubtract='+' " _
                & " union all " _
                & " select 'SR' type ,sum(salesrtn.BillDisc_Amt)BillDisc_Amt,sum(salesrtnTxTm.TaxTerm_Perc)TaxTerm_Perc,sum(salesrtnTxTm.Taxable_Amt)Taxable_Amt from salesrtn " _
                & " inner join salesrtnTxTm on salesrtnTxTm.Doc_Id=salesrtn.Doc_Id " _
                & " where salesrtnTxTm.TaxTerm_Perc=0 And salesrtnTxTm.AddSubtract='+'"
            GSTR3B = Common.GetDataTable(Query)

            If GSTR3B.Rows.Count > 0 Then
                Dim count As Integer = 0
                Dim taxable As Decimal = 0
                Dim cgst As Decimal = 0
                Dim igst As Decimal = 0
                For Each Recrow In GSTR3B.Rows

                    If Recrow("Type") = "SB" Then
                        taxable = Val(Recrow("Taxable_Amt") & "")

                    Else
                        xlSheet1.Cells(12, 3) = Val(Val(taxable - Val(Recrow("Taxable_Amt") & "")))
                        xlSheet1.Cells(12, 4) = 0

                        xlSheet1.Cells(12, 7) = "0"
                    End If

                Next

            End If

            '----------------------------SAVE GSTR-3B---------------------------------------------------
            If (Not System.IO.Directory.Exists(System.Windows.Forms.Application.StartupPath & "\GSTR-3B")) Then
                System.IO.Directory.CreateDirectory(System.Windows.Forms.Application.StartupPath & "\GSTR-3B")
            End If
            Dim strExportFile As String = ""
            strExportFile = System.Windows.Forms.Application.StartupPath & "\GSTR-3B\GSTR-3B--" & Format$(dtpFrom.Value, "MMddyyyy") & ".xlsm"
            xlBook.SaveAs(strExportFile)
            xlBook.Close()
            MsgBox("GSTR-3B Excel Generated Successfully On Path : " & strExportFile, MsgBoxStyle.Exclamation)

            System.Diagnostics.Process.Start(strExportFile)

            '----------------------------End  Excel------------------------------------------------------

            btnGSTR3BExcel.Enabled = True
            Cursor = Cursors.Default
        Catch ex As Exception
            Common.LogAndDisplayException(ex)
            btnGSTR3BExcel.Enabled = True
            Cursor = Cursors.Default
        End Try



    End Sub

    Private Sub Label3_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles lblPurchaseType.Click

    End Sub

    Private Sub lblSection_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles lblSection.Click

    End Sub

    Private Sub cmbPurType_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbPurType.ValueChanged

    End Sub

    
    Private Sub txtJobCardTo_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles txtJobCardTo.KeyDown
        If e.KeyCode = Keys.Enter Then
            btnView.Focus()
        End If
    End Sub

    Private Sub chkStatewise_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles chkStatewise.CheckedChanged
        If chkStatewise.Checked = True Then
            chkStatewise.Enabled = True
            cmbStateGSTR.Enabled = True
            chkStorewise.Enabled = False
            cmbStore.Enabled = False
        Else
            chkStatewise.Enabled = True
            cmbStateGSTR.Enabled = False
            chkStorewise.Enabled = True
            'cmbStore.Enabled = True
        End If
    End Sub

    Private Sub chkStorewise_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles chkStorewise.CheckedChanged
        If chkStorewise.Checked = True Then
            chkStatewise.Enabled = False
            cmbStateGSTR.Enabled = False
            chkStorewise.Enabled = True
            cmbStore.Enabled = True
        Else
            chkStatewise.Enabled = True
            'cmbStateGSTR.Enabled = False
            chkStorewise.Enabled = True
            cmbStore.Enabled = False
        End If
    End Sub

    Private Sub cmbJOrderNo_ValueChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmbJOrderNo.ValueChanged
        
    End Sub

    Private Sub dtpFrom_Leave(ByVal sender As Object, ByVal e As System.EventArgs) Handles dtpFrom.Leave
        'Added By Vishnu On 11-11-2019
        If rptType = rptType.JobWorkOrderStatus Then
            Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from jobOrder  Where DOC_ID >0  AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' " _
            & BranchFixFilter _
             & " Order By DOCNO"
            Common.FillCombo2(Query, cmbJOrderNo, "DOCNO", "DOCID")

            ''CHANGE BY RAHUL ON 14/11/2019
        ElseIf rptType = ReportType.SalesOrderReport Then
            Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from SalesOrder  Where DOC_ID >0 AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'  " _
            & BranchFixFilter _
             & " Order By DOCNO"
            Common.FillCombo2(Query, cmbSONo, "DOCNO", "DOCID")
        ElseIf rptType = rptType.JobWorkPOStatus_Billwise Then
            Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobWorkPO  Where DOC_ID >0  AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' " _
            & BranchFixFilter _
             & " Order By DOCNO"
            Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
        ElseIf rptType = ReportType.PPStatus Then
            Query = "Select Doc_Id, Doc_No " _
                 & " From PRODNPLN " _
                 & " Where Status =  '1' AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Doc_No <> '' " & BranchLedFixFilter _
                 & " Order By Doc_No"
            Common.FillCheckBoxCombo(Query, cmbrate, "Doc_No", "Doc_Id")
            ''END

        ElseIf rptType = ReportType.SoFabricIssueAgtJobWorkRpt Then
            Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from jobOrder  Where DOC_ID >0  AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' " _
           & BranchFixFilter _
            & " Order By DOCNO"
            Common.FillCheckBoxCombo(Query, cmbrate, "DOCNO", "DOCID")

        ElseIf rptType = ReportType.SalesOrderStatus Then
            Query = "Select Doc_Id,Doc_no+ '-->' +FCYR_id Doc_No " _
                & " From Salesorder " _
                & " Where Status =  '1' AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Doc_No <> '' " & BranchLedFixFilter _
                & " Order By Doc_No"
            Common.FillCheckBoxCombo(Query, cmbrate, "Doc_No", "Doc_Id")
        End If

        'End
    End Sub

    
    Private Sub dtpTo_Leave(ByVal sender As Object, ByVal e As System.EventArgs) Handles dtpTo.Leave
        'Added By Vishnu On 11-11-2019
        If rptType = rptType.JobWorkOrderStatus Then
            Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from jobOrder  Where DOC_ID >0  AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' " _
            & BranchFixFilter _
             & " Order By DOCNO"
            Common.FillCombo2(Query, cmbJOrderNo, "DOCNO", "DOCID")
            'End

            ''CHANGE BY RAHUL ON 14/11/2019
        ElseIf rptType = ReportType.SalesOrderReport Then
            cmbSONo.Items.Clear()
            Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from SalesOrder  Where DOC_ID >0 AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "'  " _
            & BranchFixFilter _
             & " Order By DOCNO"
            Common.FillCombo2(Query, cmbSONo, "DOCNO", "DOCID")
        ElseIf rptType = rptType.JobWorkPOStatus_Billwise Then
            Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobWorkPO  Where DOC_ID >0  AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' " _
            & BranchFixFilter _
             & " Order By DOCNO"
            Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
        ElseIf rptType = ReportType.PPStatus Then
            Query = "Select Doc_Id, Doc_No " _
                 & " From PRODNPLN " _
                 & " Where Status =  '1' AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Doc_No <> '' " & BranchLedFixFilter _
                 & " Order By Doc_No"
            Common.FillCheckBoxCombo(Query, cmbrate, "Doc_No", "Doc_Id")


        ElseIf rptType = ReportType.SoFabricIssueAgtJobWorkRpt Then
            Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from jobOrder  Where DOC_ID >0  AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' " _
           & BranchFixFilter _
            & " Order By DOCNO"
            Common.FillCheckBoxCombo(Query, cmbrate, "DOCNO", "DOCID")
            ''END

        ElseIf rptType = ReportType.SalesOrderStatus Then
            Query = "Select Doc_Id,Doc_no+ '-->' +FCYR_id Doc_No " _
                & " From Salesorder " _
                & " Where Status =  '1' AND Doc_Dt between '" & Format$(dtpFrom.Value, "MM/dd/yyyy") & "' And  '" & Format$(dtpTo.Value, "MM/dd/yyyy") & "' And Doc_No <> '' " & BranchLedFixFilter _
                & " Order By Doc_No"
            Common.FillCheckBoxCombo(Query, cmbrate, "Doc_No", "Doc_Id")
        End If
    End Sub


    Private Sub DisplayCountry()
        Dim SelectedItems As String = cmbRegion.Properties.GetCheckedItems
        Dim AllRegion As String = SelectedList(cmbRegion, SelectedItems, True)

        If AllRegion <> "" Then
            AllRegion = " And Country.Regn_Id In (" & AllRegion & ")"
        Else
            AllRegion = ""
        End If

        Query = "Select CONT_KEY, CONT_NAME " _
            & " From Country Left Join Region On Country.Regn_Id = Region.Regn_Id " _
            & " Where Country.Status = '1' And Country.CoBr_Id = '" & SelBranchFixId & "' And Cont_Name <> '' " _
            & AllRegion _
            & " Order By Cont_Name"
        Common.FillCheckBoxCombo(Query, cmbCountry, "CONT_NAME", "CONT_KEY")
    End Sub


    Private Sub DisplayState()
        Dim SelectedItems As String = cmbRegion.Properties.GetCheckedItems
        Dim AllRegion As String = SelectedList(cmbRegion, SelectedItems, True)

        If AllRegion <> "" Then
            AllRegion = " And Country.Regn_Id In (" & AllRegion & ")"
        Else
            AllRegion = ""
        End If

        SelectedItems = cmbCountry.Properties.GetCheckedItems
        Dim AllCont As String = SelectedList(cmbCountry, SelectedItems)

        If AllCont <> "" Then
            AllCont = " And State.Cont_Key In (" & AllCont & ")"
        Else
            AllCont = ""
        End If

        Query = "Select STATE_KEY, STATE_NAME " _
            & " From State Left Join Country On Country.Cont_Key = State.Cont_Key " _
            & " Where State.Status = '1' And State.CoBr_Id = '" & SelBranchFixId & "' And State_Name <> '' " _
            & AllRegion & AllCont _
            & " Order By State_Name"
        Common.FillCheckBoxCombo(Query, cmbState, "STATE_NAME", "STATE_KEY")
    End Sub

    Private Sub DisplayConsigneeHeather() ''sunil 03-10-2020

        Dim SelectedItems As String = cmbState.Properties.GetCheckedItems
        Dim AllState As String = SelectedList(cmbState, SelectedItems)

        If AllState <> "" Then
            AllState = " And Station.State_Key In (" & AllState & ")"
        Else
            AllState = ""
        End If

        SelectedItems = cmbCountry.Properties.GetCheckedItems
        Dim AllCountry As String = SelectedList(cmbCountry, SelectedItems)

        If AllCountry <> "" Then
            AllCountry = " And State.Cont_Key In (" & AllCountry & ")"
        Else
            AllCountry = ""
        End If

        SelectedItems = cmbRegion.Properties.GetCheckedItems
        Dim AllRegion As String = SelectedList(cmbRegion, SelectedItems, True)

        If AllRegion <> "" Then
            AllRegion = " And Country.Regn_Id In (" & AllRegion & ")"
        Else
            AllRegion = ""
        End If


        SelectedItems = cmbStation.Properties.GetCheckedItems
        Dim AllStation As String = SelectedList(cmbStation, SelectedItems)

        If AllStation <> "" Then
            AllStation = " And (Ledger.OStn_Key In (" & AllStation & ") Or Ledger.RStn_Key In (" & AllStation & "))"
        Else
            AllStation = ""
        End If

        SelectedItems = cmbParty.Properties.GetCheckedItems
        Dim AllParty As String = SelectedList(cmbParty, SelectedItems)

        If AllParty <> "" Then
            AllParty = " And Ledger.Led_Key In (" & AllParty & ")"
        Else
            AllParty = ""
        End If

        Dim LedgerFltr As String = ""
        Dim StnFltr As String = " From Ledger Left Join Station On Ledger.OStn_Key = Station.Stn_Key "

        'If rptType = ReportType.SalesRegister_SupplierWise Then
        '    LedgerFltr = " And Led_Cat In ('V', 'J', 'O', 'A')"
        'ElseIf TransType = TransactionType.Sales Or TransType = TransactionType.SalesRtn Or rptType = ReportType.CustomerStmt Then
        '    LedgerFltr = " And Led_Cat In ('R', 'W', 'D')"
        '    StnFltr = " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key "
        'ElseIf TransType = TransactionType.Stock Or TransType = TransactionType.PurchaseOrder Or TransType = TransactionType.Purchase Or TransType = TransactionType.PurchaseRtn Or rptType = ReportType.TopNPurchase Or rptType = ReportType.TopSoldItems Then
        '    LedgerFltr = " And Led_Cat In ('V', 'J', 'O', 'A')"
        'End If

        
        LedgerFltr = " And Led_Cat In ('R', 'W', 'D')"
        StnFltr = " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key  Or Ledger.OStn_Key = Station.Stn_Key  "
        'IsSupplier = False

        If rptType = ReportType.SalesOrderRegister_AllInOne And Val(GetSettingAsPerId(ApplnSettingsIdx.HetherGrey)) = 1 Then
            Query = "Select Distinct LED_KEY, LED_NAME From Ledger " _
                & " Left Join Station On Ledger.RStn_Key = Station.Stn_Key  Or Ledger.OStn_Key = Station.Stn_Key " _
                & " inner join state on station.state_key  = state.state_key " _
                & " inner join Country on country.cont_key = state.cont_key " _
                & " Where Led_Cat In ('C') And Ledger.Status = '1' And Ledger.CoBr_Id = '" & SelBranchLedFixId & "' And Led_Name <> '' " _
                & AllRegion & AllCountry & AllState & AllStation _
                & " Order By Led_Name"
        Else
            Query = "Select Distinct LED_KEY, LED_NAME From Ledger " _
                & " Where Led_Cat In ('C') AND DISTR_LED_KEY IN (Select Distinct LED_KEY " _
                & " From Ledger Left Join Station On Ledger.RStn_Key = Station.Stn_Key  Or Ledger.OStn_Key = Station.Stn_Key " _
                & " inner join state on station.state_key  = state.state_key " _
                & " inner join Country on country.cont_key = state.cont_key " _
                & " Where Ledger.Status = '1' And Ledger.CoBr_Id = '" & SelBranchLedFixId & "' And Led_Name <> '' " _
                & AllRegion & AllCountry & AllState & AllStation & LedgerFltr & AllParty _
                & ")" _
                & " Order By Led_Name"
        End If

        Common.FillCheckBoxCombo(Query, cmbOperator, "LED_NAME", "LED_KEY")
    End Sub

    Private Sub LoadImage(ByVal obj As DataRow, ByVal FilePath As String)
        If FilePath <> "" Then
            If (IO.File.Exists(FilePath)) Then
                Dim fs As New IO.FileStream(FilePath, System.IO.FileMode.Open, System.IO.FileAccess.Read)

                Dim br As New IO.BinaryReader(fs)
                Dim imgbyte(fs.Length + 1) As Byte
                imgbyte = br.ReadBytes(br.BaseStream.Length)
                fs.Close()

                obj("StyleImage") = imgbyte
            End If
        End If
    End Sub

    Private Sub chkSize_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles chkSize.CheckedChanged
        If Val(GetSettingAsPerId(ApplnSettingsIdx.SoftwareForRamtex)) = 1 Then
            If chkSize.Checked = True Then
                chkDispRate.Enabled = False
                chkDispValue.Enabled = False
                cmbPurType.SelectedIndex = 0
                cmbPurType.Enabled = False
                chkDispRate.Checked = False
                chkDispValue.Checked = False
            Else
                chkDispRate.Enabled = True
                chkDispValue.Enabled = True
                cmbPurType.SelectedIndex = 0
                cmbPurType.Enabled = True
            End If
        Else
            chkDispRate.Enabled = True
            chkDispValue.Enabled = True
            cmbPurType.Enabled = True
        End If
    End Sub

    Private Sub chkDispRate_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles chkDispRate.Click
        If chkDispRate.Checked = True Then
            chkDispValue.Checked = False
        End If
        If chkDispValue.Checked = True Then
            chkDispRate.Checked = False

        End If
    End Sub
    Private Sub chkDispValue_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles chkDispValue.Click
        If chkDispRate.Checked = True Then
            chkDispValue.Checked = True
            chkDispRate.Checked = False

        End If
        If chkDispValue.Checked = True And chkDispRate.Checked = True Then
            chkDispRate.Checked = False
            chkDispValue.Checked = True
        End If
    End Sub

    Private Sub chkData_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles chkData.CheckedChanged
        If Val(GetSettingAsPerId(ApplnSettingsIdx.Software_For)) = 1 Then
            If rptType = ReportType.FabricIsuReg_JobberWise Or rptType = ReportType.StoresIsuReg_JobberWise Or rptType = ReportType.JobCardReg_JobberWise Or rptType = ReportType.FabricRctReg_JobberWise Then ''SATYAM 29072022
                If chkData.Checked = True Then
                    lblJobOrder.Text = "JobWork PO"
                    cmbOrderNo.Text = ""
                    Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobWOrkPO  Where DOC_ID >0  " _
                   & BranchFixFilter _
                    & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                ElseIf chkData.Checked = False Then
                    lblJobOrder.Text = "Job Order No"
                    cmbOrderNo.Text = ""
                    Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from JobOrder  Where DOC_ID >0  " _
                    & BranchFixFilter _
                     & " Order By DOCNO"
                    Common.FillCombo2(Query, cmbOrderNo, "DOCNO", "DOCID")
                    'End
                End If
            End If
        Else
            Exit Sub
        End If
    End Sub

    Private Sub Label10_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub

   
    Private Sub Label14_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub

   
    Private Sub cmbMIN_KeyDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles cmbMIN.KeyDown, cmbMRN.KeyDown, cmbOCNO.KeyDown, cmbCreationNo.KeyDown
        MoveToNextControl(e)
    End Sub


    Private Sub cmbFromDept_KeyDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles cmbFromDept.KeyDown
        If e.KeyCode = Keys.Enter Then
            btnView.Focus()
        End If
    End Sub

    Private Sub cmbMIN_SelectionChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbMIN.SelectionChanged

    End Sub

    Private Sub cmbMRN_SelectionChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbMRN.SelectionChanged
        
    End Sub

    Private Sub cmbMIN_Validated(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbMIN.Validated
        If cmbMIN.SelectedIndex = -1 Then cmbMIN.SelectedIndex = 0
    End Sub

    Private Sub cmbMRN_Validated(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbMRN.Validated
        If cmbMRN.SelectedIndex = -1 Then cmbMRN.SelectedIndex = 0
    End Sub

    Private Sub cmbOCNO_Validated(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbOCNO.Validated
        If cmbOCNO.SelectedIndex = -1 Then cmbOCNO.SelectedIndex = 0
    End Sub

    Private Sub cmbCreationNo_Validated(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbCreationNo.Validated
        If cmbCreationNo.SelectedIndex = -1 Then cmbCreationNo.SelectedIndex = 0
    End Sub

    Private Sub cmbFromDept_Validated(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbFromDept.Validated
        If cmbFromDept.SelectedIndex = -1 Then cmbFromDept.SelectedIndex = 0
    End Sub

    Private Sub chkDesignAsperStock_CheckedChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles chkDesignAsperStock.CheckedChanged
        cmbStyle.Properties.DataSource = Nothing
        cmbStyle.SetEditValue("")
        ClearDropDown(cmbStyle)

        DisplayStyle()
    End Sub



    Private Sub cmbSalesType_Closed(ByVal sender As Object, ByVal e As DevExpress.XtraEditors.Controls.ClosedEventArgs) Handles cmbSalesType.Closed
        If rptType = ReportType.JobWorkPO_Status Or rptType = ReportType.JobWorkOrder_Status Then
            If cmbSalesType.IsModified Then



                'If cmbSalesType.Properties.Items.GetCheckedValues.Count = 0 Then Exit Sub
            End If
            cmbSONo.DataSource = Nothing
            cmbSONo.Items.Clear()
            cmbSONo.Text = ""
            DisplayOCStatus()
        End If
      
    End Sub
    Private Sub DisplayOCStatus()
        Dim SelectedItems As String = cmbSalesType.Properties.GetCheckedItems
        Dim AllItems As String = SelectedList(cmbSalesType, SelectedItems)

        If AllItems <> "" Then
            SelectedItems = " And Salesorder.SOStatus_Id In (" & AllItems & ")"
        Else
            SelectedItems = ""
        End If

      

        Query = "select Doc_id DOCID,Doc_no+ '-->' +FCYR_id  DOCNO from SalesOrder Left Join SOStatus On SalesOrder.SOStatus_Id = SOStatus.SOStatus_Id Where  Salesorder.Doc_id <> 0  " _
                     & BranchFixFilter _
                       & SelectedItems _
                     & " Order By DOCNO"
        Common.FillCombo2(Query, cmbSONo, "DOCNO", "DOCID")

      
    End Sub

    Private Sub BtnStockExportToExcel_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles BtnStockExportToExcel.Click
        If rptType = ReportType.DesignWiseStockWithImages Then

            Try
                Me.Cursor = Cursors.WaitCursor

                If rdOthOption1.Checked = True Then
                    Query = "select vw_DesignWiseStockWithImage.Style_Code as 'Design No',vw_DesignWiseStockWithImage.Shade_Name as 'Color','' as 'Master Category', vw_DesignWiseStockWithImage.Item_name as 'Product','' as 'Type','' as 'Style' ,'' as 'Booking Type',vw_DesignWiseStockWithImage.Size_name as 'Size',vw_DesignWiseStockWithImage.clqty as 'Qty',(vw_DesignWiseStockWithImage.MRP+vw_DesignWiseStockWithImage.MRPRD) as 'Price' ,'' AS 'Rack','' AS 'Barcode','' as 'Priority'   from vw_DesignWiseStockWithImage where vw_DesignWiseStockWithImage.clqty>0 and  vw_DesignWiseStockWithImage.itemGrp_name='local' and  vw_DesignWiseStockWithImage.Cobr_id='" & SelBranchId & "' "
               
                ElseIf rdOthOption2.Checked = True Then
                    Query = "select vw_DesignWiseStockWithImage.Style_Code as 'Design No',vw_DesignWiseStockWithImage.Shade_Name as 'Color','' as 'Master Category', vw_DesignWiseStockWithImage.Item_name as 'Product','' as 'Type','' as 'Style' ,'' as 'Booking Type',vw_DesignWiseStockWithImage.Size_name as 'Size',vw_DesignWiseStockWithImage.clqty as 'Qty',(vw_DesignWiseStockWithImage.MRP+vw_DesignWiseStockWithImage.MRPRD) as 'Price' ,'' AS 'Rack','' AS 'Barcode','' as 'Priority'   from vw_DesignWiseStockWithImage where vw_DesignWiseStockWithImage.clqty>0 and vw_DesignWiseStockWithImage.Ready='F' and  vw_DesignWiseStockWithImage.itemGrp_name='local' and vw_DesignWiseStockWithImage.Cobr_id='" & SelBranchId & "' "

                ElseIf rdOthOption3.Checked = True Then
                    Query = "select vw_DesignWiseStockWithImage.Style_Code as 'Design No',vw_DesignWiseStockWithImage.Shade_Name as 'Color','' as 'Master Category', vw_DesignWiseStockWithImage.Item_name as 'Product','' as 'Type','' as 'Style' ,'' as 'Booking Type',vw_DesignWiseStockWithImage.Size_name as 'Size',vw_DesignWiseStockWithImage.clqty as 'Qty',(vw_DesignWiseStockWithImage.MRP+vw_DesignWiseStockWithImage.MRPRD) as 'Price' ,'' AS 'Rack','' AS 'Barcode','' as 'Priority'   from vw_DesignWiseStockWithImage where vw_DesignWiseStockWithImage.clqty>0 and vw_DesignWiseStockWithImage.Ready='S' and vw_DesignWiseStockWithImage.itemGrp_name='local' and vw_DesignWiseStockWithImage.Cobr_id='" & SelBranchId & "' "
                End If


                ' Query = " select STYLE.Style_Code as 'Design No',ITEMGRP.ItemGrp_Name as 'Master Category', ItemSubGrp.ItemSubGrp_Name as 'Category',item.Item_name as 'Sub Category', " _
                '& " '' Style ,StyleSize.Size_Name as 'Size',itemstock.ClQty as 'Qty',(Style.MRP+STYLESIZE.MRPRD) Price " _
                '& " from itemstock With(Nolock) " _
                '  & " where Stk_id<>0 AND itemstock.CoBr_Id='" & SelBranchFixId & "' and clqty>0"

                Dim DtExport As DataTable = Common.GetDataTable(Query)
                If DtExport.Rows.Count <= 0 Then Exit Sub
                Dim i As Integer
                Dim j As Byte

                Dim r As Integer = 2
                Dim c As Byte = 1
                Dim cols As Byte
                Dim txtFormat As New ArrayList
                Dim colFormat As New ArrayList

                Dim xlApp As New Excel.Application
                Dim xlBook As Excel.Workbook = xlApp.Workbooks.Add
                Dim xlSheet As Excel.Worksheet = xlBook.ActiveSheet

                'xlSheet.Cells(1, 1) = "" 'HeaderText

                For j = 0 To DtExport.Columns.Count - 1
                    'If DtExport.Columns(j).ColumnName.Length > 5 Then
                    xlSheet.Cells(1, c) = DtExport.Columns(j).ColumnName
                    c += 1 : cols += 1
                    'End If

                    If DtExport.Columns(j).DataType.FullName.ToUpper = "SYSTEM.DECIMAL" Then
                        colFormat.Add(Chr(65 + j))
                    ElseIf DtExport.Columns(j).DataType.FullName.ToUpper = "SYSTEM.STRING" Then
                        txtFormat.Add(Chr(65 + j))
                    End If
                Next j

                c = 1
                For i = 0 To DtExport.Rows.Count - 1
                    For j = 0 To DtExport.Columns.Count - 1
                        'If DtExport.Columns(j).ColumnName.Length > 5 Then
                        xlSheet.Cells(r, c) = DtExport.Rows(i).Item(j) 'dtgDetails.Item(j, i).Value

                        c += 1
                        'End If
                    Next j

                    r += 1 : c = 1
                Next i


                'xlSheet.Range("A1:" & Chr(64 + cols) & "1").MergeCells = True
                'With xlSheet.Range("A1:" & Chr(64 + cols) & "1")
                '    .HorizontalAlignment = Excel.XlHAlign.xlHAlignCenter
                '    .VerticalAlignment = Excel.XlVAlign.xlVAlignCenter
                '    .Font.Bold = True
                '    .Font.Size = 14
                'End With

                xlSheet.Range("A1:" & Chr(64 + cols) & "1").Columns.Font.Bold = True

                For Each obj As Object In colFormat
                    xlSheet.Range(obj & ":" & obj).NumberFormat = "0.00"
                Next obj

                For Each obj As Object In txtFormat
                    xlSheet.Range(obj & ":" & obj).NumberFormat = "@"

                Next obj

                xlSheet.Columns.AutoFit()
                Dim strExportFile As String = Application.StartupPath & "\" & "Product_Color_Format.xlsx"
                xlSheet.SaveAs(strExportFile)

                MsgBox("Exported Successfully !!", MsgBoxStyle.OkOnly)

                xlApp.Visible = True
                xlSheet = Nothing : xlBook = Nothing : xlApp = Nothing



            Catch ex As Exception
                Common.LogAndDisplayException(ex)
            Finally
                Me.Cursor = Cursors.Default
               
            End Try


        End If
    End Sub


    'Suraj 27 12 2023
    Private Sub StockDrillDown()
        Dim cobr As Integer = 0
        Dim PartyFltr As String = ""
        Dim OtherFilter As String = ""
        Dim selCollectionFrom As String = ""
        Dim selCollectionFromCtr As String = ""
        Dim SelState As String = ""
        Dim selStateCtr As String = ""
        Dim SelCity As String = ""
        Dim selCityCtr As String = ""
        Dim SelBroker As String = ""
        Dim selBrokerCtr As String = ""
        Dim SelParty As String = ""
        Dim selPartyCtr As String = ""
        Dim SelRefCode As String = ""
        Dim selRefCodeCtr As String = ""

        Dim SelProduct As String = ""
        Dim selProductCtr As String = ""
        Dim SelDesign As String = ""
        Dim selDesignCtr As String = ""
        Dim SelShade As String = ""
        Dim selShadeCtr As String = ""
        Dim SelCategory As String = ""
        Dim selCategoryCtr As String = ""

        Dim SelType As String = ""
        Dim selTypeCtr As String = ""
        Dim SelBrand As String = ""
        Dim selBrandCtr As String = ""
        Dim SelSize As String = ""
        Dim selSizeCtr As String = ""



        Me.Cursor = Cursors.WaitCursor
        'Dim ReportPath As String = GetValueFromConfig(modMain.ConfigType.Report_Path)
        Dim strFilter As String = ""
        Dim strFilter1 As String = ""

        If rptType = ReportType.Ready_Stock_Multi Then



            SelDesign = GetSelectedAttributesForStock(cmbStyle, "{Style}") ' GetSelectedAttributesForUsers(cmbStyle, "{DesignKey}")
            If SelDesign.Trim.Length > 0 Then
                selDesignCtr &= " And " & SelDesign
            End If
            'End If


            'If cmbShade.IsModified Then
            SelShade = GetSelectedAttributesForStock(cmbShade, "{ShadeKey}")
            If SelShade.Trim.Length > 0 Then
                selShadeCtr &= " And " & SelShade
            End If
            'End If

            SelType = GetSelectedAttributesForStock(cmbType, "{TypeKey}")
            If SelType.Trim.Length > 0 Then
                selTypeCtr &= " And " & SelType
            End If

            SelBrand = GetSelectedAttributesForStock(cmbBrand, "{BrandKey}")
            If SelBrand.Trim.Length > 0 Then
                selBrandCtr &= " And " & SelBrand
            End If

            SelSize = GetSelectedAttributesForStock(cmbSize, "{StyleSize}")
            If SelSize.Trim.Length > 0 Then
                selSizeCtr &= " And " & SelSize
            End If

            SelCategory = GetSelectedAttributesForStock(cmbProductSubGrp, "{ITEMSUBGRPKEY}")
            If SelCategory.Trim.Length > 0 Then
                selCategoryCtr &= " And " & SelCategory
            End If

            'End If
            SelProduct = GetSelectedAttributesForStock(cmbProduct, "{ItemKey}")
            If SelProduct.Trim.Length > 0 Then
                selProductCtr &= " And " & SelProduct
            End If

        End If

        Dim AppliedFilters As String = selStateCtr & selDesignCtr & selShadeCtr & selCategoryCtr & selProductCtr & selBrandCtr & selTypeCtr & selSizeCtr

        Dim formulas As New Hashtable
        Dim ItemText As String = ""
        Dim strDateflt As String = ""

        If rptType = ReportType.Ready_Stock_Multi Then

            'ReportParameters.rptFile = ReportPath & "\Reports\FinStkMulti.rpt"


            strFilter &= " AND {DOCDT} >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' AND {DOCDT} <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'"

            strFilter1 = " AND DOCDT >= '" & Format$(dtpFrom.Value, "yyyy-MM-dd") & "' AND DOCDT <= '" & Format$(dtpTo.Value, "yyyy-MM-dd") & "'"

            ReportParameters.rptFilter = "{GreyStock.COBR_ID} = '" & SelBranchId & "' " & strFilter & selCollectionFromCtr & selStateCtr & selCityCtr & selBrokerCtr & selPartyCtr & selRefCodeCtr & selProductCtr & selDesignCtr & selCategoryCtr & selShadeCtr

            Dim strDateFilter As String = "From " & Format$(dtpFrom.Value, "dd-MM-yyyy") & " To " & Format$(dtpTo.Value, "dd-MM-yyyy") & " "
            AppliedFilters &= strFilter

            AppliedFilters = AppliedFilters.Replace("{", "")
            AppliedFilters = AppliedFilters.Replace("}", "")
            AppliedFilters = AppliedFilters.Replace("[", "(")
            AppliedFilters = AppliedFilters.Replace("]", ")")

            If cmbProduct.Text.Length > 0 Then
                If cmbProduct.Text.Contains(",") Then
                    ItemText = "All Items"
                Else
                    ItemText = cmbProduct.Text
                End If
            Else
                ItemText = "All Items"
            End If


            ReportParameters.rptCaption = "Stock Report "
            Dim frmRpt As New frmStockDrillDown(AppliedFilters, strDateFilter, StkType, ItemText, strFilter1)
            frmRpt.Show()

        End If

        Me.Cursor = Cursors.Default
    End Sub

End Class